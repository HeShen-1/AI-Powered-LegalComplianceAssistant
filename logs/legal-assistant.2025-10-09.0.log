2025-10-09 15:43:05.131 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 26024 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 15:43:05.137 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 15:43:07.636 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 15:43:07.856 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@17e66aed
2025-10-09 15:43:07.936 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 15:43:07.956 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 15:43:07.961 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 15:43:08.058 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-09 15:43:08.060 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 15:43:08.469 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 15:43:09.539 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 15:43:09.541 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 15:43:09.559 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 15:43:09.559 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 15:43:09.560 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 15:43:09.560 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 15:43:09.560 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 15:43:09.560 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 15:43:09.560 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 15:43:09.595 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 15:43:09.738 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 15:43:09.739 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 15:43:10.566 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 15:43:10.597 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 15:43:10.601 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 15:43:10.607 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 15:43:10.608 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 15:43:10.609 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 15:43:10.645 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 15:43:10.829 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 15:43:10.832 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 15:43:10.832 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 15:43:10.833 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 15:43:11.014 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 15:43:11.021 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 15:43:11.022 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 15:43:11.023 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 15:43:11.023 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 15:43:11.030 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 15:43:11.030 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 15:43:11.055 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 15:43:11.055 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 15:43:11.055 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 15:43:11.055 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 15:43:11.055 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 15:43:11.055 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 15:43:11.055 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 15:43:11.067 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 15:43:11.082 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 15:43:11.082 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 15:43:11.091 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 15:43:11.092 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 15:43:11.094 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 15:43:11.094 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 15:43:11.095 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 15:43:11.095 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 15:43:11.144 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 15:43:12.200 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 15:43:12.299 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 15:43:12.301 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 15:43:12.329 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 15:43:12.462 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 15:43:12.687 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-09 15:43:12.957 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 15:43:13.103 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 15:43:13.204 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 15:43:13.991 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.324 seconds (process running for 9.647)
2025-10-09 15:43:13.998 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 15:43:13.999 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 15:43:14.101 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 15:43:28.531 [http-nio-8080-exec-1] INFO  c.r.L.c.AuthenticationController - 用户登录请求: admin
2025-10-09 15:43:28.805 [http-nio-8080-exec-1] INFO  c.r.L.c.AuthenticationController - 用户 admin 登录成功
2025-10-09 15:43:28.830 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b51319de, method=POST, uri=/api/v1/auth/login, status=200, duration=329ms
2025-10-09 15:43:37.683 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=你好, modelType=BASIC
2025-10-09 15:43:37.686 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 15:43:37.687 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 使用基础模式进行流式处理
2025-10-09 15:43:37.689 [Async-1] INFO  c.r.L.service.AgentService - 🚀 开始流式法律咨询处理: question='你好', length=2
2025-10-09 15:43:37.689 [Async-1] INFO  c.r.L.service.AgentService - 使用高级流式模型进行推送
2025-10-09 15:43:37.689 [Async-1] INFO  c.r.L.service.AgentService - 📡 开始使用流式模型处理: model=OpenAiStreamingChatModel
2025-10-09 15:43:37.695 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9dc4e1e6, method=POST, uri=/api/v1/chat/stream, status=200, duration=77ms
2025-10-09 15:44:24.376 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 流式响应完成，总长度: 1917
2025-10-09 15:44:24.387 [http-nio-8080-exec-3] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 15:44:32.516 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=你好, modelType=ADVANCED_RAG
2025-10-09 15:44:32.518 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 15:44:32.520 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4192ff58, method=POST, uri=/api/v1/chat/stream, status=200, duration=5ms
2025-10-09 15:45:53.643 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f10bb831, method=GET, uri=/api/v1/doc.html, status=200, duration=4ms
2025-10-09 15:45:53.689 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=31f5cb9f, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=5ms
2025-10-09 15:45:53.693 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e5051b1f, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=9ms
2025-10-09 15:45:53.694 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4cddca97, method=GET, uri=/api/v1/webjars/js/app.c31badf5.js, status=200, duration=8ms
2025-10-09 15:45:53.707 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bc9a7947, method=GET, uri=/api/v1/webjars/js/chunk-vendors.d51cf6f8.js, status=200, duration=21ms
2025-10-09 15:45:53.709 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f3e0ac65, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=2ms
2025-10-09 15:45:53.710 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=922806d7, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=3ms
2025-10-09 15:45:53.710 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2c5a9934, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=3ms
2025-10-09 15:45:53.712 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=682a389e, method=GET, uri=/api/v1/webjars/js/chunk-0d102d5a.b2bddffc.js, status=200, duration=2ms
2025-10-09 15:45:53.713 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fa15e5ed, method=GET, uri=/api/v1/webjars/js/chunk-0fd67716.d57e2c41.js, status=200, duration=3ms
2025-10-09 15:45:53.722 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=893c8c47, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=3ms
2025-10-09 15:45:53.723 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b2a1d000, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=3ms
2025-10-09 15:45:53.731 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=04734e6c, method=GET, uri=/api/v1/webjars/js/chunk-2d0da532.591ad7fc.js, status=200, duration=4ms
2025-10-09 15:45:53.732 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6c4516d7, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=5ms
2025-10-09 15:45:53.732 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=35469820, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=4ms
2025-10-09 15:45:53.733 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2506233b, method=GET, uri=/api/v1/webjars/js/chunk-260d712a.390177fe.js, status=200, duration=14ms
2025-10-09 15:45:53.738 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d29e1488, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=3ms
2025-10-09 15:45:53.738 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=31eb97e6, method=GET, uri=/api/v1/webjars/js/chunk-589faee0.5bfd1708.js, status=200, duration=2ms
2025-10-09 15:45:53.745 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=835332bc, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=3ms
2025-10-09 15:45:53.745 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=927698ea, method=GET, uri=/api/v1/webjars/js/chunk-735c675c.5b409314.js, status=200, duration=7ms
2025-10-09 15:45:53.748 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5e7d8b00, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=6ms
2025-10-09 15:45:53.907 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5d1b32a3, method=GET, uri=/api/v1/v3/api-docs/swagger-config, status=200, duration=9ms
2025-10-09 15:45:54.428 [http-nio-8080-exec-10] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 509 ms
2025-10-09 15:45:54.444 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5fe1a8a0, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=531ms
2025-10-09 15:45:59.559 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4db4c652, method=GET, uri=/api/v1/doc.html, status=200, duration=2ms
2025-10-09 15:45:59.598 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=282444a0, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=4ms
2025-10-09 15:45:59.599 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5366a852, method=GET, uri=/api/v1/webjars/js/app.c31badf5.js, status=200, duration=5ms
2025-10-09 15:45:59.601 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c6c1094a, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=7ms
2025-10-09 15:45:59.613 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6b741e24, method=GET, uri=/api/v1/webjars/js/chunk-vendors.d51cf6f8.js, status=200, duration=18ms
2025-10-09 15:45:59.624 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6f065919, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=2ms
2025-10-09 15:45:59.625 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f5f304b6, method=GET, uri=/api/v1/webjars/js/chunk-0d102d5a.b2bddffc.js, status=200, duration=3ms
2025-10-09 15:45:59.625 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d5822890, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=3ms
2025-10-09 15:45:59.625 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f672cff5, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=3ms
2025-10-09 15:45:59.626 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=12500804, method=GET, uri=/api/v1/webjars/js/chunk-0fd67716.d57e2c41.js, status=200, duration=4ms
2025-10-09 15:45:59.635 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cd623044, method=GET, uri=/api/v1/webjars/js/chunk-2d0da532.591ad7fc.js, status=200, duration=1ms
2025-10-09 15:45:59.635 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=04055fb7, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=2ms
2025-10-09 15:45:59.635 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c50dc399, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=2ms
2025-10-09 15:45:59.635 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=02c1e0a6, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=1ms
2025-10-09 15:45:59.641 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b1510957, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=2ms
2025-10-09 15:45:59.642 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=301f8c95, method=GET, uri=/api/v1/webjars/js/chunk-260d712a.390177fe.js, status=200, duration=10ms
2025-10-09 15:45:59.648 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=80a2a481, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=3ms
2025-10-09 15:45:59.648 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=221347eb, method=GET, uri=/api/v1/webjars/js/chunk-589faee0.5bfd1708.js, status=200, duration=2ms
2025-10-09 15:45:59.648 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=096d2d8a, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=2ms
2025-10-09 15:45:59.651 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=515ed01a, method=GET, uri=/api/v1/webjars/js/chunk-735c675c.5b409314.js, status=200, duration=5ms
2025-10-09 15:45:59.653 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=02aff5d8, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=5ms
2025-10-09 15:45:59.743 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=af9e338f, method=GET, uri=/api/v1/v3/api-docs/swagger-config, status=200, duration=1ms
2025-10-09 15:45:59.759 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=37ce1b02, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=8ms
2025-10-09 15:46:23.244 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f408a23c, method=GET, uri=/api/v1/doc.html, status=200, duration=2ms
2025-10-09 15:46:23.280 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=55cb601f, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=5ms
2025-10-09 15:46:23.281 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=aae2bb11, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=4ms
2025-10-09 15:46:23.283 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=54954e5f, method=GET, uri=/api/v1/webjars/js/app.c31badf5.js, status=200, duration=4ms
2025-10-09 15:46:23.296 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=243b424b, method=GET, uri=/api/v1/webjars/js/chunk-vendors.d51cf6f8.js, status=200, duration=17ms
2025-10-09 15:46:23.307 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6fbf76bd, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=1ms
2025-10-09 15:46:23.308 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=df248e10, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=1ms
2025-10-09 15:46:23.309 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=45d7df47, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=2ms
2025-10-09 15:46:23.309 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e9be0023, method=GET, uri=/api/v1/webjars/js/chunk-0d102d5a.b2bddffc.js, status=200, duration=1ms
2025-10-09 15:46:23.313 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=284bb343, method=GET, uri=/api/v1/webjars/js/chunk-0fd67716.d57e2c41.js, status=200, duration=3ms
2025-10-09 15:46:23.317 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=990053d6, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=3ms
2025-10-09 15:46:23.317 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fd6e0f8f, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=3ms
2025-10-09 15:46:23.318 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=95339122, method=GET, uri=/api/v1/webjars/js/chunk-2d0da532.591ad7fc.js, status=200, duration=2ms
2025-10-09 15:46:23.322 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=795bc880, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=2ms
2025-10-09 15:46:23.327 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=624e533b, method=GET, uri=/api/v1/webjars/js/chunk-260d712a.390177fe.js, status=200, duration=13ms
2025-10-09 15:46:23.328 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8ee0fbc7, method=GET, uri=/api/v1/webjars/js/chunk-589faee0.5bfd1708.js, status=200, duration=2ms
2025-10-09 15:46:23.328 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d35f4b3f, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=2ms
2025-10-09 15:46:23.329 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=95b3f552, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=3ms
2025-10-09 15:46:23.337 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7e700d4f, method=GET, uri=/api/v1/webjars/js/chunk-735c675c.5b409314.js, status=200, duration=7ms
2025-10-09 15:46:23.337 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0ffc24f2, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=3ms
2025-10-09 15:46:23.342 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e9727caa, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=6ms
2025-10-09 15:46:23.433 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4ac00e9c, method=GET, uri=/api/v1/v3/api-docs/swagger-config, status=200, duration=1ms
2025-10-09 15:46:23.454 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=abf1bf19, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=8ms
2025-10-09 15:46:26.717 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=12bc2df7, method=GET, uri=/api/v1/doc.html, status=200, duration=2ms
2025-10-09 15:46:26.761 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=aa6d4693, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=4ms
2025-10-09 15:46:26.762 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8cf8dd06, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=6ms
2025-10-09 15:46:26.763 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5075325a, method=GET, uri=/api/v1/webjars/js/app.c31badf5.js, status=200, duration=6ms
2025-10-09 15:46:26.778 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9cb8f2cf, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=2ms
2025-10-09 15:46:26.778 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9258a8eb, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=2ms
2025-10-09 15:46:26.779 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=abb46d5d, method=GET, uri=/api/v1/webjars/js/chunk-0d102d5a.b2bddffc.js, status=200, duration=2ms
2025-10-09 15:46:26.779 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d657b8a3, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=3ms
2025-10-09 15:46:26.780 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a922f809, method=GET, uri=/api/v1/webjars/js/chunk-vendors.d51cf6f8.js, status=200, duration=23ms
2025-10-09 15:46:26.782 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=582c042a, method=GET, uri=/api/v1/webjars/js/chunk-0fd67716.d57e2c41.js, status=200, duration=4ms
2025-10-09 15:46:26.790 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2bfcbd06, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=3ms
2025-10-09 15:46:26.791 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=abdfa8b5, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=3ms
2025-10-09 15:46:26.791 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d62f27b6, method=GET, uri=/api/v1/webjars/js/chunk-2d0da532.591ad7fc.js, status=200, duration=2ms
2025-10-09 15:46:26.791 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bf1e63f8, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=3ms
2025-10-09 15:46:26.794 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=36daf240, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=3ms
2025-10-09 15:46:26.800 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a5f95b7e, method=GET, uri=/api/v1/webjars/js/chunk-260d712a.390177fe.js, status=200, duration=13ms
2025-10-09 15:46:26.803 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0b60817c, method=GET, uri=/api/v1/webjars/js/chunk-589faee0.5bfd1708.js, status=200, duration=1ms
2025-10-09 15:46:26.803 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=96da07ec, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=1ms
2025-10-09 15:46:26.803 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d0e60309, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=1ms
2025-10-09 15:46:26.807 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cccfb3fb, method=GET, uri=/api/v1/webjars/js/chunk-735c675c.5b409314.js, status=200, duration=5ms
2025-10-09 15:46:26.811 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a050fa13, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=5ms
2025-10-09 15:46:26.878 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7271de9e, method=GET, uri=/api/v1/v3/api-docs/swagger-config, status=200, duration=2ms
2025-10-09 15:46:26.893 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=49465ad3, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=7ms
2025-10-09 15:46:55.854 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b381c2e7, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=4ms
2025-10-09 15:46:55.856 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=948e4b54, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=6ms
2025-10-09 15:46:59.693 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b72414c2, method=GET, uri=/api/v1/doc.html, status=200, duration=2ms
2025-10-09 15:46:59.741 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=18825c50, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=5ms
2025-10-09 15:46:59.743 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0fac5fa7, method=GET, uri=/api/v1/webjars/js/app.c31badf5.js, status=200, duration=7ms
2025-10-09 15:46:59.744 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fb0268bf, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=8ms
2025-10-09 15:46:59.763 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a355e25f, method=GET, uri=/api/v1/webjars/js/chunk-vendors.d51cf6f8.js, status=200, duration=27ms
2025-10-09 15:46:59.876 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6c180791, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=2ms
2025-10-09 15:46:59.876 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=59a1d7f5, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=2ms
2025-10-09 15:46:59.878 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c310dcf5, method=GET, uri=/api/v1/webjars/js/chunk-0d102d5a.b2bddffc.js, status=200, duration=3ms
2025-10-09 15:46:59.878 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d9212fbf, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=3ms
2025-10-09 15:46:59.880 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ab1c3cbb, method=GET, uri=/api/v1/webjars/js/chunk-0fd67716.d57e2c41.js, status=200, duration=4ms
2025-10-09 15:46:59.884 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fc6a1476, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=1ms
2025-10-09 15:46:59.884 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8b6b936c, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=2ms
2025-10-09 15:46:59.889 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=255dcb90, method=GET, uri=/api/v1/webjars/js/chunk-2d0da532.591ad7fc.js, status=200, duration=3ms
2025-10-09 15:46:59.889 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1c5e37cf, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=2ms
2025-10-09 15:46:59.894 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0c962b48, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=2ms
2025-10-09 15:46:59.895 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=638c9cc7, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=3ms
2025-10-09 15:46:59.897 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9da28503, method=GET, uri=/api/v1/webjars/js/chunk-260d712a.390177fe.js, status=200, duration=15ms
2025-10-09 15:46:59.899 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0205f234, method=GET, uri=/api/v1/webjars/js/chunk-589faee0.5bfd1708.js, status=200, duration=2ms
2025-10-09 15:46:59.903 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=505c8152, method=GET, uri=/api/v1/webjars/js/chunk-735c675c.5b409314.js, status=200, duration=6ms
2025-10-09 15:46:59.904 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=464f87fa, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=1ms
2025-10-09 15:46:59.910 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f27927d0, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=7ms
2025-10-09 15:47:00.176 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8f9760aa, method=GET, uri=/api/v1/v3/api-docs/swagger-config, status=200, duration=1ms
2025-10-09 15:47:00.204 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3705350f, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=10ms
2025-10-09 15:47:09.158 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=41d7a197, method=GET, uri=/api/v1/doc.html, status=200, duration=1ms
2025-10-09 15:47:09.200 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8ec9fb5a, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=6ms
2025-10-09 15:47:09.200 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=07ac8d3c, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=5ms
2025-10-09 15:47:09.201 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=048b2e89, method=GET, uri=/api/v1/webjars/js/app.c31badf5.js, status=200, duration=5ms
2025-10-09 15:47:09.218 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f04d15b7, method=GET, uri=/api/v1/webjars/js/chunk-vendors.d51cf6f8.js, status=200, duration=22ms
2025-10-09 15:47:09.330 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=26ee6a02, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=3ms
2025-10-09 15:47:09.330 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f090826d, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=2ms
2025-10-09 15:47:09.330 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=945244df, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=3ms
2025-10-09 15:47:09.330 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ff347867, method=GET, uri=/api/v1/webjars/js/chunk-0d102d5a.b2bddffc.js, status=200, duration=2ms
2025-10-09 15:47:09.332 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=24566d3e, method=GET, uri=/api/v1/webjars/js/chunk-0fd67716.d57e2c41.js, status=200, duration=4ms
2025-10-09 15:47:09.340 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=24a52846, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=2ms
2025-10-09 15:47:09.341 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9eda12ca, method=GET, uri=/api/v1/webjars/js/chunk-2d0da532.591ad7fc.js, status=200, duration=1ms
2025-10-09 15:47:09.342 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4311c367, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=2ms
2025-10-09 15:47:09.342 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c83a8a83, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=2ms
2025-10-09 15:47:09.351 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=81fe1520, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=4ms
2025-10-09 15:47:09.351 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e7d3d736, method=GET, uri=/api/v1/webjars/js/chunk-260d712a.390177fe.js, status=200, duration=13ms
2025-10-09 15:47:09.355 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=601161c7, method=GET, uri=/api/v1/webjars/js/chunk-589faee0.5bfd1708.js, status=200, duration=3ms
2025-10-09 15:47:09.355 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b005fb20, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=3ms
2025-10-09 15:47:09.357 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=141b4f4d, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=2ms
2025-10-09 15:47:09.360 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=204a1e73, method=GET, uri=/api/v1/webjars/js/chunk-735c675c.5b409314.js, status=200, duration=8ms
2025-10-09 15:47:09.361 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d9da2f54, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=5ms
2025-10-09 15:47:09.618 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0ad387ef, method=GET, uri=/api/v1/v3/api-docs/swagger-config, status=200, duration=2ms
2025-10-09 15:47:09.640 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0995a31d, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=7ms
2025-10-09 15:50:23.786 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=770284f1, method=GET, uri=/api/v1/doc.html, status=200, duration=2ms
2025-10-09 15:50:23.835 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=aa704d6f, method=GET, uri=/api/v1/webjars/js/app.c31badf5.js, status=200, duration=3ms
2025-10-09 15:50:23.835 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8efd6e59, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=4ms
2025-10-09 15:50:23.837 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d2485a5d, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=5ms
2025-10-09 15:50:23.853 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=21691776, method=GET, uri=/api/v1/webjars/js/chunk-vendors.d51cf6f8.js, status=200, duration=20ms
2025-10-09 15:50:23.986 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0216dd58, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=2ms
2025-10-09 15:50:23.987 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=df857f1e, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=1ms
2025-10-09 15:50:23.988 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=44ea5526, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=2ms
2025-10-09 15:50:23.990 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=15643fde, method=GET, uri=/api/v1/webjars/js/chunk-0d102d5a.b2bddffc.js, status=200, duration=2ms
2025-10-09 15:50:23.991 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=391b5d7d, method=GET, uri=/api/v1/webjars/js/chunk-0fd67716.d57e2c41.js, status=200, duration=3ms
2025-10-09 15:50:23.998 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ffc6c43e, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=1ms
2025-10-09 15:50:24.000 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=19505a56, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=2ms
2025-10-09 15:50:24.003 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b6c350a2, method=GET, uri=/api/v1/webjars/js/chunk-260d712a.390177fe.js, status=200, duration=12ms
2025-10-09 15:50:24.006 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a756664e, method=GET, uri=/api/v1/webjars/js/chunk-2d0da532.591ad7fc.js, status=200, duration=2ms
2025-10-09 15:50:24.007 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=43880164, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=2ms
2025-10-09 15:50:24.023 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0c95c683, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=2ms
2025-10-09 15:50:24.025 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=042493fa, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=2ms
2025-10-09 15:50:24.026 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fed471af, method=GET, uri=/api/v1/webjars/js/chunk-589faee0.5bfd1708.js, status=200, duration=2ms
2025-10-09 15:50:24.032 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=75552220, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=3ms
2025-10-09 15:50:24.037 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=99ed6eed, method=GET, uri=/api/v1/webjars/js/chunk-735c675c.5b409314.js, status=200, duration=8ms
2025-10-09 15:50:24.042 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6a53a762, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=5ms
2025-10-09 15:50:24.284 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c1f27812, method=GET, uri=/api/v1/v3/api-docs/swagger-config, status=200, duration=1ms
2025-10-09 15:50:24.306 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7ac06b42, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=5ms
2025-10-09 15:50:32.559 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 15:50:32.562 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 15:50:48.929 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 40600 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 15:50:48.930 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 15:50:51.162 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 15:50:51.297 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@b0d4873
2025-10-09 15:50:51.350 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 15:50:51.367 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 15:50:51.373 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 15:50:51.455 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-09 15:50:51.456 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 15:50:51.852 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 15:50:52.893 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 15:50:52.938 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 15:50:52.939 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 15:50:52.957 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 15:50:52.957 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 15:50:52.958 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 15:50:52.958 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 15:50:52.958 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 15:50:52.958 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 15:50:52.958 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 15:50:52.989 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 15:50:53.112 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 15:50:53.112 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 15:50:53.777 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 15:50:53.808 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 15:50:53.810 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 15:50:53.814 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 15:50:53.815 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 15:50:53.816 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 15:50:53.850 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 15:50:54.031 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 15:50:54.034 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 15:50:54.035 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 15:50:54.035 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 15:50:54.213 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 15:50:54.221 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 15:50:54.223 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 15:50:54.223 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 15:50:54.223 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 15:50:54.230 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 15:50:54.230 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 15:50:54.252 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 15:50:54.253 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 15:50:54.253 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 15:50:54.253 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 15:50:54.253 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 15:50:54.253 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 15:50:54.253 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 15:50:54.265 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 15:50:54.279 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 15:50:54.280 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 15:50:54.291 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 15:50:54.291 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 15:50:54.293 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 15:50:54.293 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 15:50:54.295 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 15:50:54.295 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 15:50:54.347 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 15:50:54.786 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 15:50:54.875 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 15:50:54.877 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 15:50:54.900 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 15:50:54.902 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 15:50:55.022 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 15:50:55.237 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-09 15:50:55.528 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 15:50:55.665 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 15:50:55.741 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 15:50:56.498 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.962 seconds (process running for 8.22)
2025-10-09 15:50:56.503 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 15:50:56.504 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 15:50:56.592 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 15:50:59.441 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=24eac8ef, method=GET, uri=/api/v1/doc.html, status=200, duration=9ms
2025-10-09 15:50:59.493 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c15642a8, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=6ms
2025-10-09 15:50:59.495 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=744e30c4, method=GET, uri=/api/v1/webjars/js/app.c31badf5.js, status=200, duration=7ms
2025-10-09 15:50:59.496 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cc3f3ff6, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=9ms
2025-10-09 15:50:59.509 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=63de03fc, method=GET, uri=/api/v1/webjars/js/chunk-vendors.d51cf6f8.js, status=200, duration=22ms
2025-10-09 15:50:59.637 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=20e73ff0, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=4ms
2025-10-09 15:50:59.637 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=92c11bc6, method=GET, uri=/api/v1/webjars/js/chunk-0d102d5a.b2bddffc.js, status=200, duration=3ms
2025-10-09 15:50:59.639 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=08378269, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=5ms
2025-10-09 15:50:59.638 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1fb98bfb, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=4ms
2025-10-09 15:50:59.644 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d96fe90c, method=GET, uri=/api/v1/webjars/js/chunk-0fd67716.d57e2c41.js, status=200, duration=9ms
2025-10-09 15:50:59.654 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=dace35b7, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=3ms
2025-10-09 15:50:59.655 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5d51d2b6, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=3ms
2025-10-09 15:50:59.655 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c6049062, method=GET, uri=/api/v1/webjars/js/chunk-2d0da532.591ad7fc.js, status=200, duration=2ms
2025-10-09 15:50:59.662 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c91aae5e, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=4ms
2025-10-09 15:50:59.664 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e0573276, method=GET, uri=/api/v1/webjars/js/chunk-260d712a.390177fe.js, status=200, duration=13ms
2025-10-09 15:50:59.681 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f9506d5e, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=1ms
2025-10-09 15:50:59.681 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3098f756, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=3ms
2025-10-09 15:50:59.681 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=46e5f697, method=GET, uri=/api/v1/webjars/js/chunk-589faee0.5bfd1708.js, status=200, duration=1ms
2025-10-09 15:50:59.689 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0cf5e6cb, method=GET, uri=/api/v1/webjars/js/chunk-735c675c.5b409314.js, status=200, duration=8ms
2025-10-09 15:50:59.693 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1c6fe64b, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=4ms
2025-10-09 15:50:59.701 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5961522b, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=5ms
2025-10-09 15:50:59.970 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=012e9c83, method=GET, uri=/api/v1/v3/api-docs/swagger-config, status=200, duration=30ms
2025-10-09 15:51:00.541 [http-nio-8080-exec-8] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 553 ms
2025-10-09 15:51:00.558 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c45e64da, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=580ms
2025-10-09 15:52:03.404 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=62bb0858, method=GET, uri=/api/v1/doc.html, status=200, duration=2ms
2025-10-09 15:52:03.465 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=90064e10, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=4ms
2025-10-09 15:52:03.467 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ee731b19, method=GET, uri=/api/v1/webjars/js/app.c31badf5.js, status=200, duration=5ms
2025-10-09 15:52:03.470 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=54766ecf, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=9ms
2025-10-09 15:52:03.483 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=11aa14be, method=GET, uri=/api/v1/webjars/js/chunk-vendors.d51cf6f8.js, status=200, duration=21ms
2025-10-09 15:52:03.607 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ce45fcaf, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=1ms
2025-10-09 15:52:03.607 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=266aab50, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=2ms
2025-10-09 15:52:03.608 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8ffa93d6, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=1ms
2025-10-09 15:52:03.612 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=545bc8cf, method=GET, uri=/api/v1/webjars/js/chunk-0d102d5a.b2bddffc.js, status=200, duration=4ms
2025-10-09 15:52:03.616 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b6fa4454, method=GET, uri=/api/v1/webjars/js/chunk-0fd67716.d57e2c41.js, status=200, duration=6ms
2025-10-09 15:52:03.622 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=02132465, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=1ms
2025-10-09 15:52:03.622 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=11038acb, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=4ms
2025-10-09 15:52:03.645 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2d5ad69c, method=GET, uri=/api/v1/webjars/js/chunk-2d0da532.591ad7fc.js, status=200, duration=2ms
2025-10-09 15:52:03.645 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0b707976, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=2ms
2025-10-09 15:52:03.648 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9df6cbf8, method=GET, uri=/api/v1/webjars/js/chunk-260d712a.390177fe.js, status=200, duration=30ms
2025-10-09 15:52:03.656 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=dba90f95, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=4ms
2025-10-09 15:52:03.657 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7f8e6d00, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=5ms
2025-10-09 15:52:03.662 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ab7aa341, method=GET, uri=/api/v1/webjars/js/chunk-589faee0.5bfd1708.js, status=200, duration=5ms
2025-10-09 15:52:03.665 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bf5b6f4b, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=2ms
2025-10-09 15:52:03.668 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3ed2d007, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=4ms
2025-10-09 15:52:03.670 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1bf0a1a7, method=GET, uri=/api/v1/webjars/js/chunk-735c675c.5b409314.js, status=200, duration=12ms
2025-10-09 15:52:03.913 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8e64d711, method=GET, uri=/api/v1/v3/api-docs/swagger-config, status=200, duration=1ms
2025-10-09 15:52:03.937 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a65b27a6, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=6ms
2025-10-09 15:54:52.166 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 15:54:52.169 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 15:55:43.960 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 17800 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 15:55:43.962 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 15:55:46.399 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 15:55:46.526 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3e563293
2025-10-09 15:55:46.571 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 15:55:46.600 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 15:55:46.606 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 15:55:46.687 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-09 15:55:46.690 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 15:55:47.068 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 15:55:48.060 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 15:55:48.112 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 15:55:48.114 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 15:55:48.136 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 15:55:48.136 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 15:55:48.136 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 15:55:48.136 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 15:55:48.136 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 15:55:48.138 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 15:55:48.138 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 15:55:48.170 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 15:55:48.278 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 15:55:48.278 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 15:55:49.036 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 15:55:49.073 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 15:55:49.076 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 15:55:49.080 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 15:55:49.081 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 15:55:49.082 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 15:55:49.114 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 15:55:49.305 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 15:55:49.308 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 15:55:49.308 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 15:55:49.308 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 15:55:49.493 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 15:55:49.501 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 15:55:49.503 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 15:55:49.503 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 15:55:49.503 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 15:55:49.509 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 15:55:49.509 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 15:55:49.531 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 15:55:49.531 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 15:55:49.532 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 15:55:49.532 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 15:55:49.532 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 15:55:49.532 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 15:55:49.533 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 15:55:49.544 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 15:55:49.559 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 15:55:49.560 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 15:55:49.570 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 15:55:49.570 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 15:55:49.572 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 15:55:49.572 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 15:55:49.574 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 15:55:49.574 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 15:55:49.633 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 15:55:50.095 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 15:55:50.202 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 15:55:50.204 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 15:55:50.227 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 15:55:50.228 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 15:55:50.353 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 15:55:50.556 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-09 15:55:50.884 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 15:55:51.048 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 15:55:51.141 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 15:55:51.967 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.435 seconds (process running for 8.72)
2025-10-09 15:55:51.973 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 15:55:51.974 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 15:55:52.088 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 15:56:28.315 [http-nio-8080-exec-1] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 582 ms
2025-10-09 15:56:28.349 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=19f94514, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=635ms
2025-10-09 15:56:46.733 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8413f723, method=GET, uri=/api/v1/doc.html, status=200, duration=7ms
2025-10-09 15:56:46.815 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b851302e, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=12ms
2025-10-09 15:56:46.818 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=dfe9aaae, method=GET, uri=/api/v1/webjars/js/app.c31badf5.js, status=200, duration=11ms
2025-10-09 15:56:46.821 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bd726778, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=19ms
2025-10-09 15:56:46.844 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=af60c0d3, method=GET, uri=/api/v1/webjars/js/chunk-vendors.d51cf6f8.js, status=200, duration=34ms
2025-10-09 15:56:46.996 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ad8774d0, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=4ms
2025-10-09 15:56:46.996 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=868a7e66, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=4ms
2025-10-09 15:56:46.998 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=eb9c7f36, method=GET, uri=/api/v1/webjars/js/chunk-0d102d5a.b2bddffc.js, status=200, duration=3ms
2025-10-09 15:56:46.997 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=64d21d56, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=5ms
2025-10-09 15:56:47.004 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=14e3ad05, method=GET, uri=/api/v1/webjars/js/chunk-0fd67716.d57e2c41.js, status=200, duration=6ms
2025-10-09 15:56:47.012 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fe5cc4e5, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=7ms
2025-10-09 15:56:47.014 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=20e4a0bb, method=GET, uri=/api/v1/webjars/js/chunk-2d0da532.591ad7fc.js, status=200, duration=4ms
2025-10-09 15:56:47.014 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a98a9747, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=4ms
2025-10-09 15:56:47.021 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=af4fb7bd, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=4ms
2025-10-09 15:56:47.025 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0bc182ba, method=GET, uri=/api/v1/webjars/js/chunk-260d712a.390177fe.js, status=200, duration=20ms
2025-10-09 15:56:47.026 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cfb8ba53, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=5ms
2025-10-09 15:56:47.029 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=906d6fea, method=GET, uri=/api/v1/webjars/js/chunk-589faee0.5bfd1708.js, status=200, duration=2ms
2025-10-09 15:56:47.029 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cf51369f, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=2ms
2025-10-09 15:56:47.034 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4e4bb2f6, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=4ms
2025-10-09 15:56:47.038 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ed9ed426, method=GET, uri=/api/v1/webjars/js/chunk-735c675c.5b409314.js, status=200, duration=8ms
2025-10-09 15:56:47.040 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=31084fab, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=6ms
2025-10-09 15:56:47.356 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=027e715a, method=GET, uri=/api/v1/v3/api-docs/swagger-config, status=200, duration=10ms
2025-10-09 15:56:47.392 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=263bc100, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=15ms
2025-10-09 15:56:59.041 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a498795f, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=6ms
2025-10-09 15:57:09.111 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9a7bebc2, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=5ms
2025-10-09 15:57:20.402 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6814e17c, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=5ms
2025-10-09 15:58:17.500 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 33240 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 15:58:17.501 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 15:58:20.009 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 15:58:20.133 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@594fcb22
2025-10-09 15:58:20.177 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 15:58:20.196 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 15:58:20.202 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 15:58:20.284 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-09 15:58:20.286 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 15:58:20.643 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 15:58:21.673 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 15:58:21.723 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 15:58:21.724 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 15:58:21.753 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 15:58:21.753 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 15:58:21.754 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 15:58:21.754 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 15:58:21.754 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 15:58:21.754 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 15:58:21.754 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 15:58:21.784 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 15:58:21.875 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 15:58:21.876 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 15:58:22.578 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 15:58:22.607 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 15:58:22.610 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 15:58:22.614 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 15:58:22.615 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 15:58:22.616 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 15:58:22.645 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 15:58:22.847 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 15:58:22.849 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 15:58:22.850 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 15:58:22.850 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 15:58:23.037 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 15:58:23.044 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 15:58:23.046 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 15:58:23.047 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 15:58:23.047 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 15:58:23.054 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 15:58:23.054 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 15:58:23.076 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 15:58:23.076 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 15:58:23.076 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 15:58:23.077 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 15:58:23.077 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 15:58:23.077 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 15:58:23.078 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 15:58:23.090 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 15:58:23.106 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 15:58:23.106 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 15:58:23.117 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 15:58:23.118 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 15:58:23.119 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 15:58:23.121 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 15:58:23.122 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 15:58:23.123 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 15:58:23.175 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 15:58:23.646 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 15:58:23.754 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 15:58:23.756 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 15:58:23.779 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 15:58:23.780 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 15:58:23.915 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 15:58:24.147 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 15:58:24.516 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 15:58:24.684 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 15:58:24.769 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 15:58:25.586 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.5 seconds (process running for 8.775)
2025-10-09 15:58:25.592 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 15:58:25.594 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 15:58:25.684 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 15:58:39.072 [http-nio-8080-exec-1] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 557 ms
2025-10-09 15:58:39.090 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6c41c4e6, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=592ms
2025-10-09 15:59:08.639 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=63dba30c, method=GET, uri=/api/v1/doc.html, status=200, duration=3ms
2025-10-09 15:59:11.819 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e6369734, method=GET, uri=/api/v1/doc.html, status=200, duration=3ms
2025-10-09 15:59:11.886 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d4e5fd21, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=7ms
2025-10-09 15:59:11.889 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=aa2d1b6f, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=12ms
2025-10-09 15:59:11.890 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b6664137, method=GET, uri=/api/v1/webjars/js/app.c31badf5.js, status=200, duration=8ms
2025-10-09 15:59:11.911 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5125f2c6, method=GET, uri=/api/v1/webjars/js/chunk-vendors.d51cf6f8.js, status=200, duration=27ms
2025-10-09 15:59:12.048 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4cacffad, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=4ms
2025-10-09 15:59:12.048 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6485780d, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=4ms
2025-10-09 15:59:12.048 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c128e186, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=4ms
2025-10-09 15:59:12.050 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f65b2e6b, method=GET, uri=/api/v1/webjars/js/chunk-0d102d5a.b2bddffc.js, status=200, duration=3ms
2025-10-09 15:59:12.053 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8a02f541, method=GET, uri=/api/v1/webjars/js/chunk-0fd67716.d57e2c41.js, status=200, duration=4ms
2025-10-09 15:59:12.061 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f3a5e255, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=1ms
2025-10-09 15:59:12.061 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a3e4a7b9, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=1ms
2025-10-09 15:59:12.070 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=46ed6f83, method=GET, uri=/api/v1/webjars/js/chunk-2d0da532.591ad7fc.js, status=200, duration=2ms
2025-10-09 15:59:12.070 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3d39e111, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=2ms
2025-10-09 15:59:12.072 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ac555c8a, method=GET, uri=/api/v1/webjars/js/chunk-260d712a.390177fe.js, status=200, duration=14ms
2025-10-09 15:59:12.092 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=31530e1e, method=GET, uri=/api/v1/webjars/js/chunk-589faee0.5bfd1708.js, status=200, duration=2ms
2025-10-09 15:59:12.092 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6995542e, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=2ms
2025-10-09 15:59:12.093 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=eb1cf895, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=2ms
2025-10-09 15:59:12.097 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f777d16c, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=2ms
2025-10-09 15:59:12.101 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=72c51cc5, method=GET, uri=/api/v1/webjars/js/chunk-735c675c.5b409314.js, status=200, duration=6ms
2025-10-09 15:59:12.110 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=84962029, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=5ms
2025-10-09 15:59:12.400 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ae43796e, method=GET, uri=/api/v1/v3/api-docs/swagger-config, status=200, duration=15ms
2025-10-09 15:59:12.437 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=79fbfc6d, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=8ms
2025-10-09 15:59:29.238 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f23f3fb0, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=2ms
2025-10-09 15:59:29.238 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=71294b9a, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=2ms
2025-10-09 15:59:29.239 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7998896b, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=2ms
2025-10-09 15:59:29.240 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5b1300c0, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=2ms
2025-10-09 15:59:29.240 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8e2c2d33, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=2ms
2025-10-09 15:59:29.249 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b905ae8b, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=5ms
2025-10-09 15:59:29.275 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=01213b24, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=2ms
2025-10-09 15:59:29.275 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=86358d1c, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=2ms
2025-10-09 15:59:29.276 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=debc7f40, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=3ms
2025-10-09 15:59:29.283 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b0f03a61, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=1ms
2025-10-09 15:59:56.339 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5e6b5999, method=GET, uri=/api/v1/doc.html, status=200, duration=2ms
2025-10-09 16:03:22.897 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 16:03:22.901 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 16:03:38.566 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 21912 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 16:03:38.568 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 16:03:41.087 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 16:03:41.214 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@b0d4873
2025-10-09 16:03:41.255 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 16:03:41.274 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 16:03:41.280 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 16:03:41.374 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-09 16:03:41.376 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 16:03:41.722 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 16:03:42.780 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 16:03:42.833 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 16:03:42.834 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 16:03:42.858 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 16:03:42.858 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 16:03:42.859 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 16:03:42.859 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 16:03:42.859 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 16:03:42.859 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 16:03:42.859 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 16:03:42.893 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 16:03:42.988 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 16:03:42.989 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 16:03:43.700 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 16:03:43.728 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 16:03:43.729 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 16:03:43.732 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 16:03:43.734 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 16:03:43.735 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 16:03:43.770 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 16:03:43.946 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 16:03:43.948 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 16:03:43.948 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 16:03:43.949 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 16:03:44.138 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 16:03:44.146 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 16:03:44.148 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 16:03:44.148 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 16:03:44.148 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 16:03:44.154 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 16:03:44.154 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 16:03:44.176 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 16:03:44.176 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 16:03:44.177 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 16:03:44.177 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 16:03:44.177 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 16:03:44.177 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 16:03:44.177 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 16:03:44.188 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 16:03:44.203 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 16:03:44.203 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 16:03:44.212 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 16:03:44.212 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 16:03:44.216 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 16:03:44.216 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 16:03:44.218 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 16:03:44.218 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 16:03:44.269 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 16:03:44.742 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 16:03:44.850 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 16:03:44.855 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 16:03:44.891 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 16:03:44.892 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 16:03:45.019 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 16:03:45.258 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 16:03:45.590 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 16:03:45.750 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 16:03:45.839 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 16:03:46.661 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.522 seconds (process running for 8.822)
2025-10-09 16:03:46.667 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 16:03:46.669 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 16:03:46.757 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 16:06:59.903 [http-nio-8080-exec-1] ERROR c.r.L.e.GlobalExceptionHandler - 运行时异常
org.springframework.http.converter.HttpMessageNotReadableException: JSON parse error: Cannot deserialize value of type `com.river.LegalAssistant.dto.UnifiedChatRequest$ModelType` from String "UNIFIED": not one of the values accepted for Enum class: [ADVANCED, ADVANCED_RAG, BASIC]
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.readJavaType(AbstractJackson2HttpMessageConverter.java:406)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.read(AbstractJackson2HttpMessageConverter.java:354)
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodArgumentResolver.readWithMessageConverters(AbstractMessageConverterMethodArgumentResolver.java:184)
	at org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor.readWithMessageConverters(RequestResponseBodyMethodProcessor.java:161)
	at org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor.resolveArgument(RequestResponseBodyMethodProcessor.java:135)
	at org.springframework.web.method.support.HandlerMethodArgumentResolverComposite.resolveArgument(HandlerMethodArgumentResolverComposite.java:122)
	at org.springframework.web.method.support.InvocableHandlerMethod.getMethodArgumentValues(InvocableHandlerMethod.java:224)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:178)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: com.fasterxml.jackson.databind.exc.InvalidFormatException: Cannot deserialize value of type `com.river.LegalAssistant.dto.UnifiedChatRequest$ModelType` from String "UNIFIED": not one of the values accepted for Enum class: [ADVANCED, ADVANCED_RAG, BASIC]
 at [Source: REDACTED (`StreamReadFeature.INCLUDE_SOURCE_IN_LOCATION` disabled); line: 1, column: 33] (through reference chain: com.river.LegalAssistant.dto.UnifiedChatRequest["modelType"])
	at com.fasterxml.jackson.databind.exc.InvalidFormatException.from(InvalidFormatException.java:67)
	at com.fasterxml.jackson.databind.DeserializationContext.weirdStringException(DeserializationContext.java:1958)
	at com.fasterxml.jackson.databind.DeserializationContext.handleWeirdStringValue(DeserializationContext.java:1245)
	at com.fasterxml.jackson.databind.deser.std.EnumDeserializer._deserializeAltString(EnumDeserializer.java:447)
	at com.fasterxml.jackson.databind.deser.std.EnumDeserializer._fromString(EnumDeserializer.java:304)
	at com.fasterxml.jackson.databind.deser.std.EnumDeserializer.deserialize(EnumDeserializer.java:273)
	at com.fasterxml.jackson.databind.deser.impl.MethodProperty.deserializeAndSet(MethodProperty.java:129)
	at com.fasterxml.jackson.databind.deser.BeanDeserializer.vanillaDeserialize(BeanDeserializer.java:310)
	at com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:177)
	at com.fasterxml.jackson.databind.deser.DefaultDeserializationContext.readRootValue(DefaultDeserializationContext.java:342)
	at com.fasterxml.jackson.databind.ObjectReader._bindAndClose(ObjectReader.java:2125)
	at com.fasterxml.jackson.databind.ObjectReader.readValue(ObjectReader.java:1501)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.readJavaType(AbstractJackson2HttpMessageConverter.java:395)
	... 148 common frames omitted
2025-10-09 16:06:59.920 [http-nio-8080-exec-1] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.river.LegalAssistant.exception.GlobalExceptionHandler#handleRuntimeException(RuntimeException)
org.springframework.web.HttpMediaTypeNotAcceptableException: No acceptable representation
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:256)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:432)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:74)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:175)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1358)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-09 16:06:59.925 [http-nio-8080-exec-1] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.http.converter.HttpMessageNotReadableException: JSON parse error: Cannot deserialize value of type `com.river.LegalAssistant.dto.UnifiedChatRequest$ModelType` from String "UNIFIED": not one of the values accepted for Enum class: [ADVANCED, ADVANCED_RAG, BASIC]]
2025-10-09 16:06:59.926 [http-nio-8080-exec-1] WARN  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=16164e00, method=POST, uri=/api/v1/chat/stream, status=400, duration=65ms
2025-10-09 16:07:09.556 [http-nio-8080-exec-4] INFO  c.r.L.c.AuthenticationController - 用户登录请求: admin
2025-10-09 16:07:09.727 [http-nio-8080-exec-4] INFO  c.r.L.c.AuthenticationController - 用户 admin 登录成功
2025-10-09 16:07:09.736 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=05da5369, method=POST, uri=/api/v1/auth/login, status=200, duration=187ms
2025-10-09 16:07:13.996 [http-nio-8080-exec-3] ERROR c.r.L.e.GlobalExceptionHandler - 运行时异常
org.springframework.http.converter.HttpMessageNotReadableException: JSON parse error: Cannot deserialize value of type `com.river.LegalAssistant.dto.UnifiedChatRequest$ModelType` from String "UNIFIED": not one of the values accepted for Enum class: [ADVANCED, ADVANCED_RAG, BASIC]
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.readJavaType(AbstractJackson2HttpMessageConverter.java:406)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.read(AbstractJackson2HttpMessageConverter.java:354)
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodArgumentResolver.readWithMessageConverters(AbstractMessageConverterMethodArgumentResolver.java:184)
	at org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor.readWithMessageConverters(RequestResponseBodyMethodProcessor.java:161)
	at org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor.resolveArgument(RequestResponseBodyMethodProcessor.java:135)
	at org.springframework.web.method.support.HandlerMethodArgumentResolverComposite.resolveArgument(HandlerMethodArgumentResolverComposite.java:122)
	at org.springframework.web.method.support.InvocableHandlerMethod.getMethodArgumentValues(InvocableHandlerMethod.java:224)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:178)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: com.fasterxml.jackson.databind.exc.InvalidFormatException: Cannot deserialize value of type `com.river.LegalAssistant.dto.UnifiedChatRequest$ModelType` from String "UNIFIED": not one of the values accepted for Enum class: [ADVANCED, ADVANCED_RAG, BASIC]
 at [Source: REDACTED (`StreamReadFeature.INCLUDE_SOURCE_IN_LOCATION` disabled); line: 1, column: 33] (through reference chain: com.river.LegalAssistant.dto.UnifiedChatRequest["modelType"])
	at com.fasterxml.jackson.databind.exc.InvalidFormatException.from(InvalidFormatException.java:67)
	at com.fasterxml.jackson.databind.DeserializationContext.weirdStringException(DeserializationContext.java:1958)
	at com.fasterxml.jackson.databind.DeserializationContext.handleWeirdStringValue(DeserializationContext.java:1245)
	at com.fasterxml.jackson.databind.deser.std.EnumDeserializer._deserializeAltString(EnumDeserializer.java:447)
	at com.fasterxml.jackson.databind.deser.std.EnumDeserializer._fromString(EnumDeserializer.java:304)
	at com.fasterxml.jackson.databind.deser.std.EnumDeserializer.deserialize(EnumDeserializer.java:273)
	at com.fasterxml.jackson.databind.deser.impl.MethodProperty.deserializeAndSet(MethodProperty.java:129)
	at com.fasterxml.jackson.databind.deser.BeanDeserializer.vanillaDeserialize(BeanDeserializer.java:310)
	at com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:177)
	at com.fasterxml.jackson.databind.deser.DefaultDeserializationContext.readRootValue(DefaultDeserializationContext.java:342)
	at com.fasterxml.jackson.databind.ObjectReader._bindAndClose(ObjectReader.java:2125)
	at com.fasterxml.jackson.databind.ObjectReader.readValue(ObjectReader.java:1501)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.readJavaType(AbstractJackson2HttpMessageConverter.java:395)
	... 148 common frames omitted
2025-10-09 16:07:14.001 [http-nio-8080-exec-3] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.river.LegalAssistant.exception.GlobalExceptionHandler#handleRuntimeException(RuntimeException)
org.springframework.web.HttpMediaTypeNotAcceptableException: No acceptable representation
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:256)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:432)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:74)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:175)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1358)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-09 16:07:14.005 [http-nio-8080-exec-3] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.http.converter.HttpMessageNotReadableException: JSON parse error: Cannot deserialize value of type `com.river.LegalAssistant.dto.UnifiedChatRequest$ModelType` from String "UNIFIED": not one of the values accepted for Enum class: [ADVANCED, ADVANCED_RAG, BASIC]]
2025-10-09 16:07:14.005 [http-nio-8080-exec-3] WARN  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=43a2b97c, method=POST, uri=/api/v1/chat/stream, status=400, duration=10ms
2025-10-09 16:09:54.316 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 16:09:54.319 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 16:11:59.004 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 8012 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 16:11:59.012 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 16:12:01.278 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 16:12:01.441 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3e563293
2025-10-09 16:12:01.503 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 16:12:01.525 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 16:12:01.531 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 16:12:01.616 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-09 16:12:01.619 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 16:12:01.966 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 16:12:02.914 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 16:12:02.960 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 16:12:02.961 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 16:12:02.983 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 16:12:02.984 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 16:12:02.984 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 16:12:02.984 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 16:12:02.984 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 16:12:02.984 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 16:12:02.984 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 16:12:03.016 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 16:12:03.154 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 16:12:03.155 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 16:12:03.852 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 16:12:03.878 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 16:12:03.880 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 16:12:03.884 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 16:12:03.885 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 16:12:03.885 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 16:12:03.918 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 16:12:04.092 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 16:12:04.094 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 16:12:04.094 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 16:12:04.094 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 16:12:04.276 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 16:12:04.284 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 16:12:04.285 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 16:12:04.286 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 16:12:04.286 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 16:12:04.291 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 16:12:04.291 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 16:12:04.314 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 16:12:04.315 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 16:12:04.315 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 16:12:04.315 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 16:12:04.315 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 16:12:04.315 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 16:12:04.315 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 16:12:04.327 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 16:12:04.342 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 16:12:04.343 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 16:12:04.353 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 16:12:04.353 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 16:12:04.355 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 16:12:04.355 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 16:12:04.357 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 16:12:04.357 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 16:12:04.406 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 16:12:04.855 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 16:12:04.962 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 16:12:04.964 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 16:12:04.985 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 16:12:04.987 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 16:12:05.106 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 16:12:05.313 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 16:12:05.609 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 16:12:05.763 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 16:12:05.850 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 16:12:06.613 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.007 seconds (process running for 8.279)
2025-10-09 16:12:06.620 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 16:12:06.621 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 16:12:06.719 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 16:12:40.987 [http-nio-8080-exec-1] INFO  c.r.L.c.AuthenticationController - 用户登录请求: admin
2025-10-09 16:12:41.240 [http-nio-8080-exec-1] INFO  c.r.L.c.AuthenticationController - 用户 admin 登录成功
2025-10-09 16:12:41.261 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=86ad22e6, method=POST, uri=/api/v1/auth/login, status=200, duration=304ms
2025-10-09 16:12:47.987 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=你好, modelType=UNIFIED
2025-10-09 16:12:47.991 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 16:12:47.992 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 16:12:47.994 [Async-1] INFO  c.r.L.service.AgentService - 🚀 开始流式法律咨询处理: question='你好', length=2
2025-10-09 16:12:47.994 [Async-1] INFO  c.r.L.service.AgentService - 使用高级流式模型进行推送
2025-10-09 16:12:47.994 [Async-1] INFO  c.r.L.service.AgentService - 📡 开始使用流式模型处理: model=OpenAiStreamingChatModel
2025-10-09 16:12:48.000 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=682ab808, method=POST, uri=/api/v1/chat/stream, status=200, duration=61ms
2025-10-09 16:13:19.470 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 流式响应完成，总长度: 1193
2025-10-09 16:13:19.479 [http-nio-8080-exec-5] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 16:19:13.006 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 16:19:13.011 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 16:23:11.418 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 13116 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 16:23:11.420 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 16:23:13.713 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 16:23:13.938 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@6f00c40e
2025-10-09 16:23:13.980 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 16:23:14.000 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 16:23:14.006 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 16:23:14.080 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-09 16:23:14.082 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 16:23:14.425 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 16:23:15.381 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 16:23:15.428 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 16:23:15.428 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 16:23:15.448 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 16:23:15.448 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 16:23:15.449 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 16:23:15.449 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 16:23:15.449 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 16:23:15.449 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 16:23:15.450 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 16:23:15.487 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 16:23:15.570 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 16:23:15.570 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 16:23:16.250 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 16:23:16.277 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 16:23:16.280 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 16:23:16.285 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 16:23:16.286 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 16:23:16.287 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 16:23:16.320 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 16:23:16.485 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 16:23:16.487 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 16:23:16.488 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 16:23:16.488 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 16:23:16.667 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 16:23:16.674 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 16:23:16.676 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 16:23:16.676 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 16:23:16.676 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 16:23:16.683 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 16:23:16.683 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 16:23:16.705 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 16:23:16.706 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 16:23:16.706 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 16:23:16.706 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 16:23:16.706 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 16:23:16.706 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 16:23:16.706 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 16:23:16.720 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 16:23:16.728 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 16:23:16.740 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 16:23:16.741 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 16:23:16.750 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 16:23:16.751 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 16:23:16.753 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 16:23:16.753 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 16:23:16.754 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 16:23:16.755 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 16:23:16.803 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 16:23:17.254 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 16:23:17.353 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 16:23:17.355 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 16:23:17.378 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 16:23:17.380 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 16:23:17.503 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 16:23:17.695 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 16:23:17.971 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 16:23:18.132 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 16:23:18.218 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 16:23:18.987 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.973 seconds (process running for 8.235)
2025-10-09 16:23:18.992 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 16:23:18.993 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 16:23:19.085 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 16:23:30.104 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=你好, modelType=UNIFIED
2025-10-09 16:23:30.107 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 16:23:30.107 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 16:23:30.107 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced RAG (默认)
2025-10-09 16:23:30.108 [http-nio-8080-exec-1] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式处理法律咨询: 你好, 会话: session_1759998206052
2025-10-09 16:23:30.108 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始检索相关法律知识...
2025-10-09 16:23:30.108 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索法律内容: 你好
2025-10-09 16:23:30.115 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a0438e86, method=POST, uri=/api/v1/chat/stream, status=200, duration=89ms
2025-10-09 16:23:32.566 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索完成，返回 10 个结果
2025-10-09 16:23:32.566 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索到 10 条相关内容
2025-10-09 16:23:35.974 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式响应完成，总长度: 104
2025-10-09 16:23:35.990 [http-nio-8080-exec-3] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 16:23:58.440 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=你是谁, modelType=UNIFIED
2025-10-09 16:23:58.441 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 16:23:58.442 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 16:23:58.442 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced RAG (默认)
2025-10-09 16:23:58.442 [http-nio-8080-exec-2] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式处理法律咨询: 你是谁, 会话: session_1759998206052
2025-10-09 16:23:58.443 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始检索相关法律知识...
2025-10-09 16:23:58.443 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索法律内容: 你是谁
2025-10-09 16:23:58.443 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=06039d15, method=POST, uri=/api/v1/chat/stream, status=200, duration=6ms
2025-10-09 16:23:58.709 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索完成，返回 10 个结果
2025-10-09 16:23:58.709 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索到 10 条相关内容
2025-10-09 16:23:59.934 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式响应完成，总长度: 58
2025-10-09 16:23:59.938 [http-nio-8080-exec-6] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 16:24:15.652 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=你有哪些功能, modelType=UNIFIED
2025-10-09 16:24:15.654 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 16:24:15.654 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 16:24:15.654 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced RAG (默认)
2025-10-09 16:24:15.654 [http-nio-8080-exec-4] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式处理法律咨询: 你有哪些功能, 会话: session_1759998206052
2025-10-09 16:24:15.655 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始检索相关法律知识...
2025-10-09 16:24:15.655 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索法律内容: 你有哪些功能
2025-10-09 16:24:15.655 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ac8cf185, method=POST, uri=/api/v1/chat/stream, status=200, duration=4ms
2025-10-09 16:24:15.807 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索完成，返回 10 个结果
2025-10-09 16:24:15.807 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索到 10 条相关内容
2025-10-09 16:24:21.083 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式响应完成，总长度: 999
2025-10-09 16:24:21.087 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 16:27:53.268 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 16:27:53.274 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 16:28:13.838 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 12380 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 16:28:13.840 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 16:28:16.218 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 16:28:16.343 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@b0d4873
2025-10-09 16:28:16.388 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 16:28:16.408 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 16:28:16.414 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 16:28:16.491 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-09 16:28:16.493 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 16:28:16.854 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 16:28:17.859 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 16:28:17.910 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 16:28:17.911 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 16:28:17.940 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 16:28:17.940 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 16:28:17.941 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 16:28:17.941 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 16:28:17.941 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 16:28:17.941 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 16:28:17.941 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 16:28:17.971 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 16:28:18.061 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 16:28:18.061 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 16:28:18.778 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 16:28:18.808 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 16:28:18.810 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 16:28:18.814 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 16:28:18.815 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 16:28:18.816 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 16:28:18.852 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 16:28:19.037 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 16:28:19.040 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 16:28:19.040 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 16:28:19.041 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 16:28:19.239 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 16:28:19.247 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 16:28:19.249 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 16:28:19.249 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 16:28:19.249 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 16:28:19.256 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 16:28:19.257 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 16:28:19.282 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 16:28:19.282 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 16:28:19.282 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 16:28:19.282 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 16:28:19.282 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 16:28:19.282 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 16:28:19.283 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 16:28:19.294 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 16:28:19.302 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 16:28:19.314 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 16:28:19.315 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 16:28:19.325 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 16:28:19.325 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 16:28:19.327 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 16:28:19.328 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 16:28:19.329 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 16:28:19.329 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 16:28:19.385 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 16:28:19.855 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 16:28:19.959 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 16:28:19.961 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 16:28:19.984 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 16:28:19.985 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 16:28:20.146 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 16:28:20.374 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 16:28:20.665 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 16:28:20.817 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 16:28:20.904 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 16:28:21.713 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.282 seconds (process running for 8.562)
2025-10-09 16:28:21.718 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 16:28:21.720 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 16:28:21.814 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 16:28:28.979 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=你好, modelType=UNIFIED
2025-10-09 16:28:28.981 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 16:28:28.982 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 16:28:28.982 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced RAG (默认)
2025-10-09 16:28:28.982 [http-nio-8080-exec-1] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式处理法律咨询: 你好, 会话: session_1759998506592
2025-10-09 16:28:28.982 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 识别为常规问题，无需检索法律知识
2025-10-09 16:28:28.999 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=812eda93, method=POST, uri=/api/v1/chat/stream, status=200, duration=78ms
2025-10-09 16:28:29.294 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式响应完成，总长度: 14
2025-10-09 16:28:29.303 [http-nio-8080-exec-10] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 16:28:33.094 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=你是谁, modelType=UNIFIED
2025-10-09 16:28:33.095 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 16:28:33.096 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 16:28:33.096 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced RAG (默认)
2025-10-09 16:28:33.096 [http-nio-8080-exec-4] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式处理法律咨询: 你是谁, 会话: session_1759998506592
2025-10-09 16:28:33.096 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 识别为常规问题，无需检索法律知识
2025-10-09 16:28:33.096 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=17ab5a97, method=POST, uri=/api/v1/chat/stream, status=200, duration=4ms
2025-10-09 16:28:33.445 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式响应完成，总长度: 58
2025-10-09 16:28:33.464 [http-nio-8080-exec-5] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 16:28:49.643 [http-nio-8080-exec-6] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=请你告诉我合同纠纷中的赔偿该怎么计算, modelType=UNIFIED
2025-10-09 16:28:49.645 [http-nio-8080-exec-6] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 16:28:49.646 [http-nio-8080-exec-6] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 16:28:49.646 [http-nio-8080-exec-6] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced RAG
2025-10-09 16:28:49.646 [http-nio-8080-exec-6] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式处理法律咨询: 请你告诉我合同纠纷中的赔偿该怎么计算, 会话: session_1759998506592
2025-10-09 16:28:49.647 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 识别为法律问题，开始检索相关法律知识...
2025-10-09 16:28:49.647 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e6d87313, method=POST, uri=/api/v1/chat/stream, status=200, duration=7ms
2025-10-09 16:28:49.647 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索法律内容: 请你告诉我合同纠纷中的赔偿该怎么计算
2025-10-09 16:28:50.073 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索完成，返回 10 个结果
2025-10-09 16:28:50.074 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索到 10 条相关内容
2025-10-09 16:28:52.986 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式响应完成，总长度: 492
2025-10-09 16:28:52.991 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 16:32:00.138 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=案例类型： 非法解除劳动合同
案情简介：
申请人（员工）： 李工
被申请人（公司）： 某科技公司
李工在该科技公司担任软件工程师已满三年，劳动合同尚有一年才到期。近期，公司因业务调整，计划裁撤李工所在的整个项目组。
公司人事部找到李工谈话，表示由于“客观情况发生重大变化”，希望与他协商解除劳动合同，并愿意支付“N+1”的经济补偿金。李工不同意解除，认为自己工作表现良好，公司应安排其他岗位。
协商未果后，公司单方面向李工发出了《解除劳动合同通知书》，理由是“客观情况发生重大变化，致使劳动合同无法继续履行，且经协商未能就变更劳动合同内容达成协议”。
核心法律问题：
公司“业务调整、裁撤项目组”是否属于《劳动合同法》规定的“客观情况发生重大变化”？
公司在单方面解除合同前，是否履行了必要的程序？（例如，是否真正提供了其他岗位供协商变更）
公司的解除行为是合法解除还是违法解除？
如果被认定为违法解除，李工有哪些选择？（是要求公司支付赔偿金（2N），还是可以要求继续履行劳动合同？）, modelType=UNIFIED
2025-10-09 16:32:00.139 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 16:32:00.139 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 16:32:00.139 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced RAG
2025-10-09 16:32:00.139 [http-nio-8080-exec-7] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式处理法律咨询: 案例类型： 非法解除劳动合同
案情简介：
申请人（员工）： 李工
被申请人（公司）： 某科技公司
李工在该科技公司担任软件工程师已满三年，劳动合同尚有一年才到期。近期，公司因业务调整，计划裁撤李工所在的整个项目组。
公司人事部找到李工谈话，表示由于“客观情况发生重大变化”，希望与他协商解除劳动合同，并愿意支付“N+1”的经济补偿金。李工不同意解除，认为自己工作表现良好，公司应安排其他岗位。
协商未果后，公司单方面向李工发出了《解除劳动合同通知书》，理由是“客观情况发生重大变化，致使劳动合同无法继续履行，且经协商未能就变更劳动合同内容达成协议”。
核心法律问题：
公司“业务调整、裁撤项目组”是否属于《劳动合同法》规定的“客观情况发生重大变化”？
公司在单方面解除合同前，是否履行了必要的程序？（例如，是否真正提供了其他岗位供协商变更）
公司的解除行为是合法解除还是违法解除？
如果被认定为违法解除，李工有哪些选择？（是要求公司支付赔偿金（2N），还是可以要求继续履行劳动合同？）, 会话: session_1759998718052
2025-10-09 16:32:00.140 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.s.a.AdvancedLegalRagService - 识别为法律问题，开始检索相关法律知识...
2025-10-09 16:32:00.140 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cbdf49f0, method=POST, uri=/api/v1/chat/stream, status=200, duration=4ms
2025-10-09 16:32:00.140 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索法律内容: 案例类型： 非法解除劳动合同
案情简介：
申请人（员工）： 李工
被申请人（公司）： 某科技公司
李工在该科技公司担任软件工程师已满三年，劳动合同尚有一年才到期。近期，公司因业务调整，计划裁撤李工所在的整个项目组。
公司人事部找到李工谈话，表示由于“客观情况发生重大变化”，希望与他协商解除劳动合同，并愿意支付“N+1”的经济补偿金。李工不同意解除，认为自己工作表现良好，公司应安排其他岗位。
协商未果后，公司单方面向李工发出了《解除劳动合同通知书》，理由是“客观情况发生重大变化，致使劳动合同无法继续履行，且经协商未能就变更劳动合同内容达成协议”。
核心法律问题：
公司“业务调整、裁撤项目组”是否属于《劳动合同法》规定的“客观情况发生重大变化”？
公司在单方面解除合同前，是否履行了必要的程序？（例如，是否真正提供了其他岗位供协商变更）
公司的解除行为是合法解除还是违法解除？
如果被认定为违法解除，李工有哪些选择？（是要求公司支付赔偿金（2N），还是可以要求继续履行劳动合同？）
2025-10-09 16:32:00.353 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索完成，返回 10 个结果
2025-10-09 16:32:00.353 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索到 10 条相关内容
2025-10-09 16:32:03.853 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式响应完成，总长度: 691
2025-10-09 16:32:03.855 [http-nio-8080-exec-9] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 16:32:43.825 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 16:32:43.829 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 16:33:13.714 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 26544 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 16:33:13.715 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 16:33:16.075 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 16:33:16.202 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@6a905513
2025-10-09 16:33:16.247 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 16:33:16.266 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 16:33:16.273 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 16:33:16.352 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-09 16:33:16.353 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 16:33:16.719 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 16:33:17.722 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 16:33:17.777 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 16:33:17.778 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 16:33:17.800 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 16:33:17.801 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 16:33:17.801 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 16:33:17.801 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 16:33:17.801 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 16:33:17.801 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 16:33:17.801 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 16:33:17.833 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 16:33:17.919 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 16:33:17.921 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 16:33:18.609 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 16:33:18.638 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 16:33:18.641 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 16:33:18.645 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 16:33:18.645 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 16:33:18.646 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 16:33:18.678 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 16:33:18.849 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 16:33:18.852 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 16:33:18.852 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 16:33:18.852 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 16:33:19.035 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 16:33:19.042 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 16:33:19.045 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 16:33:19.045 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 16:33:19.045 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 16:33:19.051 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 16:33:19.051 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 16:33:19.075 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 16:33:19.075 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 16:33:19.075 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 16:33:19.075 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 16:33:19.075 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 16:33:19.075 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 16:33:19.075 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 16:33:19.088 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 16:33:19.096 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 16:33:19.109 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 16:33:19.109 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 16:33:19.119 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 16:33:19.119 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 16:33:19.121 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 16:33:19.121 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 16:33:19.123 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 16:33:19.123 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 16:33:19.182 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 16:33:19.647 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 16:33:19.746 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 16:33:19.748 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 16:33:19.768 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 16:33:19.770 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 16:33:19.897 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 16:33:20.108 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 16:33:20.407 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 16:33:20.555 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 16:33:20.637 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 16:33:21.450 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.15 seconds (process running for 8.504)
2025-10-09 16:33:21.455 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 16:33:21.456 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 16:33:21.551 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 16:33:25.642 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=案例类型： 著作权（版权）侵权
案情简介：
权利人： 摄影师陈女士
侵权方： “美食攻略”微信公众号运营公司
摄影师陈女士是一位美食摄影爱好者，她拍摄了一组关于城市特色小吃的精美照片，并发布在自己的个人微博上，但未添加水印。
“美食攻略”公众号在未经陈女士许可的情况下，直接从其微博下载了9张照片，用于一篇介绍该城市美食的商业推广文章中，文章阅读量超过10万。文章中未注明照片来源和作者。
陈女士发现后，联系该公众号要求删除照片、公开道歉并赔偿损失。对方仅删除了照片，但拒绝道歉和赔偿，声称照片来自网络，属于“合理使用”。
核心法律问题：
陈女士发布在微博上的照片是否享有著作权？
“美食攻略”公众号的使用行为是否构成对陈女士著作权的侵犯？具体侵犯了哪些权利（如复制权、信息网络传播权、署名权）？
公众号“图片来自网络”和“合理使用”的抗辩理由是否成立？
如果构成侵权，陈女士可以提出的赔偿请求应如何计算？（在无法证明其实际损失和对方违法所得的情况下，法院如何适用法定赔偿？）, modelType=UNIFIED
2025-10-09 16:33:25.643 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 16:33:25.645 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 16:33:25.646 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced RAG
2025-10-09 16:33:25.646 [http-nio-8080-exec-1] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式处理法律咨询: 案例类型： 著作权（版权）侵权
案情简介：
权利人： 摄影师陈女士
侵权方： “美食攻略”微信公众号运营公司
摄影师陈女士是一位美食摄影爱好者，她拍摄了一组关于城市特色小吃的精美照片，并发布在自己的个人微博上，但未添加水印。
“美食攻略”公众号在未经陈女士许可的情况下，直接从其微博下载了9张照片，用于一篇介绍该城市美食的商业推广文章中，文章阅读量超过10万。文章中未注明照片来源和作者。
陈女士发现后，联系该公众号要求删除照片、公开道歉并赔偿损失。对方仅删除了照片，但拒绝道歉和赔偿，声称照片来自网络，属于“合理使用”。
核心法律问题：
陈女士发布在微博上的照片是否享有著作权？
“美食攻略”公众号的使用行为是否构成对陈女士著作权的侵犯？具体侵犯了哪些权利（如复制权、信息网络传播权、署名权）？
公众号“图片来自网络”和“合理使用”的抗辩理由是否成立？
如果构成侵权，陈女士可以提出的赔偿请求应如何计算？（在无法证明其实际损失和对方违法所得的情况下，法院如何适用法定赔偿？）, 会话: session_1759998803701
2025-10-09 16:33:25.646 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 识别为法律问题，开始检索相关法律知识...
2025-10-09 16:33:25.647 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索法律内容: 案例类型： 著作权（版权）侵权
案情简介：
权利人： 摄影师陈女士
侵权方： “美食攻略”微信公众号运营公司
摄影师陈女士是一位美食摄影爱好者，她拍摄了一组关于城市特色小吃的精美照片，并发布在自己的个人微博上，但未添加水印。
“美食攻略”公众号在未经陈女士许可的情况下，直接从其微博下载了9张照片，用于一篇介绍该城市美食的商业推广文章中，文章阅读量超过10万。文章中未注明照片来源和作者。
陈女士发现后，联系该公众号要求删除照片、公开道歉并赔偿损失。对方仅删除了照片，但拒绝道歉和赔偿，声称照片来自网络，属于“合理使用”。
核心法律问题：
陈女士发布在微博上的照片是否享有著作权？
“美食攻略”公众号的使用行为是否构成对陈女士著作权的侵犯？具体侵犯了哪些权利（如复制权、信息网络传播权、署名权）？
公众号“图片来自网络”和“合理使用”的抗辩理由是否成立？
如果构成侵权，陈女士可以提出的赔偿请求应如何计算？（在无法证明其实际损失和对方违法所得的情况下，法院如何适用法定赔偿？）
2025-10-09 16:33:25.653 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a43e1997, method=POST, uri=/api/v1/chat/stream, status=200, duration=74ms
2025-10-09 16:33:26.010 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索完成，返回 10 个结果
2025-10-09 16:33:26.011 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索到 10 条相关内容
2025-10-09 16:33:30.865 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式响应完成，总长度: 955
2025-10-09 16:33:30.873 [http-nio-8080-exec-3] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 16:34:17.565 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=案例类型： 饲养动物损害责任
案情简介：
受害人： 小学生王某（8岁）
责任方： 宠物狗主人赵某
某周日下午，赵某在小区内遛其饲养的大型犬（金毛寻回犬），但未使用牵引绳。此时，小学生王某在小区花园玩耍，看到金毛犬跑来，出于好奇上前抚摸。金毛犬突然受惊，将王某扑倒，导致王某右臂被抓伤，并有轻微咬痕。
事后，王某的父母要求赵某赔偿医疗费、精神损害抚慰金等共计8000元。赵某认为，他的狗平时很温顺，是王某主动上前挑逗才导致狗受惊，且伤情不重，赔偿要求过高。他辩称王某的监护人也应承担部分责任。
核心法律问题：
本案属于一般侵权责任还是特殊侵权责任（饲养动物损害责任）？
赵某作为动物饲养人，其“未拴绳”的行为是否是认定其承担责任的关键？
王某“主动抚摸”的行为是否可以作为减轻或免除赵某责任的法定事由？（即是否存在受害人故意或重大过失的情形）
王某父母（监护人）是否因未尽到看护责任而应承担相应责任？
精神损害抚慰金的主张是否合理？, modelType=UNIFIED
2025-10-09 16:34:17.566 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 16:34:17.566 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 16:34:17.567 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced RAG
2025-10-09 16:34:17.567 [http-nio-8080-exec-2] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式处理法律咨询: 案例类型： 饲养动物损害责任
案情简介：
受害人： 小学生王某（8岁）
责任方： 宠物狗主人赵某
某周日下午，赵某在小区内遛其饲养的大型犬（金毛寻回犬），但未使用牵引绳。此时，小学生王某在小区花园玩耍，看到金毛犬跑来，出于好奇上前抚摸。金毛犬突然受惊，将王某扑倒，导致王某右臂被抓伤，并有轻微咬痕。
事后，王某的父母要求赵某赔偿医疗费、精神损害抚慰金等共计8000元。赵某认为，他的狗平时很温顺，是王某主动上前挑逗才导致狗受惊，且伤情不重，赔偿要求过高。他辩称王某的监护人也应承担部分责任。
核心法律问题：
本案属于一般侵权责任还是特殊侵权责任（饲养动物损害责任）？
赵某作为动物饲养人，其“未拴绳”的行为是否是认定其承担责任的关键？
王某“主动抚摸”的行为是否可以作为减轻或免除赵某责任的法定事由？（即是否存在受害人故意或重大过失的情形）
王某父母（监护人）是否因未尽到看护责任而应承担相应责任？
精神损害抚慰金的主张是否合理？, 会话: session_1759998803701
2025-10-09 16:34:17.568 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 识别为法律问题，开始检索相关法律知识...
2025-10-09 16:34:17.568 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索法律内容: 案例类型： 饲养动物损害责任
案情简介：
受害人： 小学生王某（8岁）
责任方： 宠物狗主人赵某
某周日下午，赵某在小区内遛其饲养的大型犬（金毛寻回犬），但未使用牵引绳。此时，小学生王某在小区花园玩耍，看到金毛犬跑来，出于好奇上前抚摸。金毛犬突然受惊，将王某扑倒，导致王某右臂被抓伤，并有轻微咬痕。
事后，王某的父母要求赵某赔偿医疗费、精神损害抚慰金等共计8000元。赵某认为，他的狗平时很温顺，是王某主动上前挑逗才导致狗受惊，且伤情不重，赔偿要求过高。他辩称王某的监护人也应承担部分责任。
核心法律问题：
本案属于一般侵权责任还是特殊侵权责任（饲养动物损害责任）？
赵某作为动物饲养人，其“未拴绳”的行为是否是认定其承担责任的关键？
王某“主动抚摸”的行为是否可以作为减轻或免除赵某责任的法定事由？（即是否存在受害人故意或重大过失的情形）
王某父母（监护人）是否因未尽到看护责任而应承担相应责任？
精神损害抚慰金的主张是否合理？
2025-10-09 16:34:17.568 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c6ef6b10, method=POST, uri=/api/v1/chat/stream, status=200, duration=5ms
2025-10-09 16:34:17.738 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索完成，返回 10 个结果
2025-10-09 16:34:17.738 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索到 10 条相关内容
2025-10-09 16:34:21.865 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式响应完成，总长度: 724
2025-10-09 16:34:21.869 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 16:34:53.805 [http-nio-8080-exec-6] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=案例类型： 买卖合同违约
案情简介：
原告： “风雅轩”画廊
被告： 艺术家张先生
2023年5月，风雅轩画廊与小有名气的青年艺术家张先生签订了一份独家作品收购合同。合同约定，张先生在未来一年内创作的10幅油画作品将由风雅轩画廊独家收购，每幅收购价为5万元人民币，画廊需在张先生交付作品时付款。合同还规定，张先生不得将此期间创作的任何作品出售给第三方。
2023年10月，张先生完成了一幅名为《秋日私语》的油画，但他认为这幅作品是自己的“生涯杰作”，市场价值远超5万元。于是，他私下通过一场拍卖会，将该画以20万元的价格卖给了私人收藏家李某。
风雅轩画廊得知此事后，认为张先生严重违约，要求其承担违约责任。张先生辩称，该画作具有特殊性，不应受普通合同条款约束，且画廊并未实际损失。
核心法律问题：
张先生将《秋日私语》出售给第三方的行为是否构成对独家收购合同的违约？
合同中的独家收购条款是否有效？
如果构成违约，风雅轩画廊可以主张哪些权利？（例如，要求继续履行合同、赔偿损失等）
损失赔偿的范围应如何计算？是按照合同价与拍卖价的差额（15万元）计算，还是有其他计算方式？, modelType=UNIFIED
2025-10-09 16:34:53.806 [http-nio-8080-exec-6] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 16:34:53.807 [http-nio-8080-exec-6] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 16:34:53.807 [http-nio-8080-exec-6] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced RAG
2025-10-09 16:34:53.807 [http-nio-8080-exec-6] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式处理法律咨询: 案例类型： 买卖合同违约
案情简介：
原告： “风雅轩”画廊
被告： 艺术家张先生
2023年5月，风雅轩画廊与小有名气的青年艺术家张先生签订了一份独家作品收购合同。合同约定，张先生在未来一年内创作的10幅油画作品将由风雅轩画廊独家收购，每幅收购价为5万元人民币，画廊需在张先生交付作品时付款。合同还规定，张先生不得将此期间创作的任何作品出售给第三方。
2023年10月，张先生完成了一幅名为《秋日私语》的油画，但他认为这幅作品是自己的“生涯杰作”，市场价值远超5万元。于是，他私下通过一场拍卖会，将该画以20万元的价格卖给了私人收藏家李某。
风雅轩画廊得知此事后，认为张先生严重违约，要求其承担违约责任。张先生辩称，该画作具有特殊性，不应受普通合同条款约束，且画廊并未实际损失。
核心法律问题：
张先生将《秋日私语》出售给第三方的行为是否构成对独家收购合同的违约？
合同中的独家收购条款是否有效？
如果构成违约，风雅轩画廊可以主张哪些权利？（例如，要求继续履行合同、赔偿损失等）
损失赔偿的范围应如何计算？是按照合同价与拍卖价的差额（15万元）计算，还是有其他计算方式？, 会话: session_1759998803701
2025-10-09 16:34:53.808 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 识别为法律问题，开始检索相关法律知识...
2025-10-09 16:34:53.808 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6af2facd, method=POST, uri=/api/v1/chat/stream, status=200, duration=5ms
2025-10-09 16:34:53.808 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索法律内容: 案例类型： 买卖合同违约
案情简介：
原告： “风雅轩”画廊
被告： 艺术家张先生
2023年5月，风雅轩画廊与小有名气的青年艺术家张先生签订了一份独家作品收购合同。合同约定，张先生在未来一年内创作的10幅油画作品将由风雅轩画廊独家收购，每幅收购价为5万元人民币，画廊需在张先生交付作品时付款。合同还规定，张先生不得将此期间创作的任何作品出售给第三方。
2023年10月，张先生完成了一幅名为《秋日私语》的油画，但他认为这幅作品是自己的“生涯杰作”，市场价值远超5万元。于是，他私下通过一场拍卖会，将该画以20万元的价格卖给了私人收藏家李某。
风雅轩画廊得知此事后，认为张先生严重违约，要求其承担违约责任。张先生辩称，该画作具有特殊性，不应受普通合同条款约束，且画廊并未实际损失。
核心法律问题：
张先生将《秋日私语》出售给第三方的行为是否构成对独家收购合同的违约？
合同中的独家收购条款是否有效？
如果构成违约，风雅轩画廊可以主张哪些权利？（例如，要求继续履行合同、赔偿损失等）
损失赔偿的范围应如何计算？是按照合同价与拍卖价的差额（15万元）计算，还是有其他计算方式？
2025-10-09 16:34:53.983 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索完成，返回 10 个结果
2025-10-09 16:34:53.985 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索到 10 条相关内容
2025-10-09 16:34:56.272 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式响应完成，总长度: 370
2025-10-09 16:34:56.275 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 16:40:34.378 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 16:40:34.381 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 16:40:50.026 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 25384 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 16:40:50.028 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 16:40:52.264 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 16:40:52.389 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@41c83af0
2025-10-09 16:40:52.432 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 16:40:52.450 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 16:40:52.455 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 16:40:52.529 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-09 16:40:52.531 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 16:40:52.866 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 16:40:53.813 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 16:40:53.861 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 16:40:53.861 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 16:40:53.882 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 16:40:53.882 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 16:40:53.883 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 16:40:53.883 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 16:40:53.883 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 16:40:53.883 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 16:40:53.883 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 16:40:53.914 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 16:40:54.003 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 16:40:54.004 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 16:40:54.696 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 16:40:54.730 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 16:40:54.731 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 16:40:54.735 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 16:40:54.736 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 16:40:54.737 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 16:40:54.776 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 16:40:54.941 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 16:40:54.944 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 16:40:54.945 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 16:40:54.945 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 16:40:55.116 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 16:40:55.124 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 16:40:55.125 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 16:40:55.125 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 16:40:55.125 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 16:40:55.132 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 16:40:55.132 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 16:40:55.153 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 16:40:55.153 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 16:40:55.153 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 16:40:55.154 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 16:40:55.154 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 16:40:55.154 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 16:40:55.154 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 16:40:55.165 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 16:40:55.173 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 16:40:55.186 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 16:40:55.186 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 16:40:55.195 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 16:40:55.196 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 16:40:55.198 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 16:40:55.198 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 16:40:55.199 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 16:40:55.199 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 16:40:55.245 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 16:40:55.687 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 16:40:55.781 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 16:40:55.783 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 16:40:55.804 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 16:40:55.805 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 16:40:55.933 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 16:40:56.126 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 16:40:56.424 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 16:40:56.580 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 16:40:56.663 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 16:40:57.455 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.824 seconds (process running for 8.096)
2025-10-09 16:40:57.460 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 16:40:57.462 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 16:40:57.549 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 16:41:15.249 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=案例类型： 饲养动物损害责任
案情简介：
受害人： 小学生王某（8岁）
责任方： 宠物狗主人赵某
某周日下午，赵某在小区内遛其饲养的大型犬（金毛寻回犬），但未使用牵引绳。此时，小学生王某在小区花园玩耍，看到金毛犬跑来，出于好奇上前抚摸。金毛犬突然受惊，将王某扑倒，导致王某右臂被抓伤，并有轻微咬痕。
事后，王某的父母要求赵某赔偿医疗费、精神损害抚慰金等共计8000元。赵某认为，他的狗平时很温顺，是王某主动上前挑逗才导致狗受惊，且伤情不重，赔偿要求过高。他辩称王某的监护人也应承担部分责任。
核心法律问题：
本案属于一般侵权责任还是特殊侵权责任（饲养动物损害责任）？
赵某作为动物饲养人，其“未拴绳”的行为是否是认定其承担责任的关键？
王某“主动抚摸”的行为是否可以作为减轻或免除赵某责任的法定事由？（即是否存在受害人故意或重大过失的情形）
王某父母（监护人）是否因未尽到看护责任而应承担相应责任？
精神损害抚慰金的主张是否合理？, modelType=UNIFIED
2025-10-09 16:41:15.251 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 16:41:15.252 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 16:41:15.253 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced Agent (复杂分析)
2025-10-09 16:41:15.255 [Async-1] INFO  c.r.L.service.AgentService - 🚀 开始流式法律咨询处理: question='案例类型： 饲养动物损害责任
案情简介：
受害人： 小学生王某（8岁）
责任方： 宠物狗主人赵某
某周日下午，赵某在小区内遛其饲养的大型犬（金毛寻回犬），但未使用牵引绳。此时，小学生王某在小区花园玩耍，看到金毛犬跑来，出于好奇上前抚摸。金毛犬突然受惊，将王某扑倒，导致王某右臂被抓伤，并有轻微咬痕。
事后，王某的父母要求赵某赔偿医疗费、精神损害抚慰金等共计8000元。赵某认为，他的狗平时很温顺，是王某主动上前挑逗才导致狗受惊，且伤情不重，赔偿要求过高。他辩称王某的监护人也应承担部分责任。
核心法律问题：
本案属于一般侵权责任还是特殊侵权责任（饲养动物损害责任）？
赵某作为动物饲养人，其“未拴绳”的行为是否是认定其承担责任的关键？
王某“主动抚摸”的行为是否可以作为减轻或免除赵某责任的法定事由？（即是否存在受害人故意或重大过失的情形）
王某父母（监护人）是否因未尽到看护责任而应承担相应责任？
精神损害抚慰金的主张是否合理？', length=415
2025-10-09 16:41:15.256 [Async-1] INFO  c.r.L.service.AgentService - 使用高级流式模型进行推送
2025-10-09 16:41:15.256 [Async-1] INFO  c.r.L.service.AgentService - 📡 开始使用流式模型处理: model=OpenAiStreamingChatModel
2025-10-09 16:41:15.264 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f5dfc334, method=POST, uri=/api/v1/chat/stream, status=200, duration=96ms
2025-10-09 16:42:27.149 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 流式响应完成，总长度: 2751
2025-10-09 16:42:27.157 [http-nio-8080-exec-6] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 16:42:45.797 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=请你解释一下中华人民共和国民法典》第一千一百八十三条, modelType=UNIFIED
2025-10-09 16:42:45.798 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 16:42:45.798 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 16:42:45.798 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced RAG (简单查询)
2025-10-09 16:42:45.798 [http-nio-8080-exec-4] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式处理法律咨询: 请你解释一下中华人民共和国民法典》第一千一百八十三条, 会话: session_1759999261060
2025-10-09 16:42:45.799 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b0560425, method=POST, uri=/api/v1/chat/stream, status=200, duration=3ms
2025-10-09 16:42:45.799 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 识别为法律问题，开始检索相关法律知识...
2025-10-09 16:42:45.800 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索法律内容: 请你解释一下中华人民共和国民法典》第一千一百八十三条
2025-10-09 16:42:46.835 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.LegalContentRetriever - 多源检索完成，返回 10 个结果
2025-10-09 16:42:46.835 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索到 10 条相关内容
2025-10-09 16:42:49.192 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG 流式响应完成，总长度: 152
2025-10-09 16:42:49.194 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 16:51:13.685 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 16:51:13.689 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 17:12:25.312 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 29300 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 17:12:25.319 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 17:12:27.962 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 17:12:28.332 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@11678469
2025-10-09 17:12:28.406 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 17:12:28.429 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 17:12:28.436 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 17:12:28.544 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-09 17:12:28.560 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema "public" to version "11 - Create Chat History Tables"
2025-10-09 17:12:28.680 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 1 migration to schema "public", now at version v11 (execution time 00:00.101s)
2025-10-09 17:12:29.132 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 17:12:30.231 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 17:12:30.282 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 17:12:30.284 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 17:12:30.303 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 17:12:30.304 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 17:12:30.304 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 17:12:30.304 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 17:12:30.304 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 17:12:30.304 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 17:12:30.305 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 17:12:30.333 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 17:12:30.470 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 17:12:30.471 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 17:12:31.212 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 17:12:31.242 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 17:12:31.243 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 17:12:31.247 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 17:12:31.248 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 17:12:31.249 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 17:12:31.285 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 17:12:31.473 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 17:12:31.475 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 17:12:31.475 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 17:12:31.475 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 17:12:31.661 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 17:12:31.669 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 17:12:31.671 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 17:12:31.672 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 17:12:31.672 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 17:12:31.679 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 17:12:31.679 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 17:12:31.708 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 17:12:31.709 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 17:12:31.709 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 17:12:31.709 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 17:12:31.709 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 17:12:31.709 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 17:12:31.709 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 17:12:31.720 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 17:12:31.728 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 17:12:31.740 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 17:12:31.741 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 17:12:31.751 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 17:12:31.751 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 17:12:31.753 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 17:12:31.753 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 17:12:31.756 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 17:12:31.756 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 17:12:31.810 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 17:12:32.816 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 17:12:32.970 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 17:12:32.972 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 17:12:32.997 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 17:12:32.999 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 17:12:33.114 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 17:12:33.352 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 17:12:33.675 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 17:12:33.847 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 17:12:33.950 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 17:12:34.808 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.899 seconds (process running for 10.174)
2025-10-09 17:12:34.816 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 17:12:34.817 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 17:12:34.923 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 17:13:14.401 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c1ff7ac6, method=GET, uri=/api/v1/doc.html, status=200, duration=12ms
2025-10-09 17:13:14.455 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=16cd60e5, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=6ms
2025-10-09 17:13:14.459 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5da838d8, method=GET, uri=/api/v1/webjars/js/app.c31badf5.js, status=200, duration=9ms
2025-10-09 17:13:14.459 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4ddb160a, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=11ms
2025-10-09 17:13:14.475 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1ceeecb6, method=GET, uri=/api/v1/webjars/js/chunk-vendors.d51cf6f8.js, status=200, duration=24ms
2025-10-09 17:13:14.587 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=76a5eb2f, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=4ms
2025-10-09 17:13:14.588 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=57f134aa, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=3ms
2025-10-09 17:13:14.588 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d9f6dfe7, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=3ms
2025-10-09 17:13:14.588 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4195c2fd, method=GET, uri=/api/v1/webjars/js/chunk-0d102d5a.b2bddffc.js, status=200, duration=2ms
2025-10-09 17:13:14.591 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=36819f97, method=GET, uri=/api/v1/webjars/js/chunk-0fd67716.d57e2c41.js, status=200, duration=5ms
2025-10-09 17:13:14.599 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=be3cadc6, method=GET, uri=/api/v1/webjars/js/chunk-2d0da532.591ad7fc.js, status=200, duration=3ms
2025-10-09 17:13:14.599 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e2dba786, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=3ms
2025-10-09 17:13:14.599 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8fcaaa58, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=3ms
2025-10-09 17:13:14.604 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e4dae4c7, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=4ms
2025-10-09 17:13:14.610 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=16f615f7, method=GET, uri=/api/v1/webjars/js/chunk-260d712a.390177fe.js, status=200, duration=14ms
2025-10-09 17:13:14.617 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7eb010d1, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=4ms
2025-10-09 17:13:14.617 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3f3befcc, method=GET, uri=/api/v1/webjars/js/chunk-589faee0.5bfd1708.js, status=200, duration=4ms
2025-10-09 17:13:14.620 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3f23be61, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=7ms
2025-10-09 17:13:14.623 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=06ccd1da, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=4ms
2025-10-09 17:13:14.629 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=aa1baf44, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=10ms
2025-10-09 17:13:14.630 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2c287df5, method=GET, uri=/api/v1/webjars/js/chunk-735c675c.5b409314.js, status=200, duration=12ms
2025-10-09 17:13:14.842 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=481b8857, method=GET, uri=/api/v1/v3/api-docs/swagger-config, status=200, duration=42ms
2025-10-09 17:13:15.486 [http-nio-8080-exec-3] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 628 ms
2025-10-09 17:13:15.511 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b36341dd, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=662ms
2025-10-09 17:13:15.601 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b5b7b4b5, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=3ms
2025-10-09 17:13:15.601 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4fdfa785, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=4ms
2025-10-09 17:13:15.601 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7cdbbc04, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=3ms
2025-10-09 17:13:15.601 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ba6f1f36, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=2ms
2025-10-09 17:13:15.602 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1cf061f0, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=5ms
2025-10-09 17:13:15.612 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=749daf64, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=4ms
2025-10-09 17:13:15.646 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=53a6ca94, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=3ms
2025-10-09 17:13:15.647 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e7e11b4a, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=4ms
2025-10-09 17:13:15.648 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4e6c6560, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=5ms
2025-10-09 17:13:15.657 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=255565ec, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=3ms
2025-10-09 17:16:31.336 [http-nio-8080-exec-5] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 17:16:31.347 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=95e76e7f, method=GET, uri=/api/v1/chat/sessions, status=200, duration=21ms
2025-10-09 17:16:31.356 [http-nio-8080-exec-4] WARN  c.r.L.filter.RateLimitFilter - [RATE_LIMIT] 请求速率超限: ip=0:0:0:0:0:0:0:1, uri=/api/v1/chat/sessions
2025-10-09 17:16:31.357 [http-nio-8080-exec-4] WARN  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ee457acd, method=GET, uri=/api/v1/chat/sessions, status=429, duration=1ms
2025-10-09 17:16:33.788 [http-nio-8080-exec-7] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 17:16:33.791 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=99c873fd, method=GET, uri=/api/v1/chat/sessions, status=200, duration=4ms
2025-10-09 17:16:33.801 [http-nio-8080-exec-3] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 17:16:33.805 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b7c8bdc6, method=GET, uri=/api/v1/chat/sessions, status=200, duration=6ms
2025-10-09 17:19:10.793 [http-nio-8080-exec-6] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 17:19:10.797 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=802816d4, method=GET, uri=/api/v1/chat/sessions, status=200, duration=5ms
2025-10-09 17:19:10.808 [http-nio-8080-exec-1] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 17:19:10.812 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d125f500, method=GET, uri=/api/v1/chat/sessions, status=200, duration=5ms
2025-10-09 17:19:26.597 [http-nio-8080-exec-2] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 17:19:26.601 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0b689019, method=GET, uri=/api/v1/chat/sessions, status=200, duration=6ms
2025-10-09 17:19:26.612 [http-nio-8080-exec-10] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 17:19:26.615 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=81a72c9f, method=GET, uri=/api/v1/chat/sessions, status=200, duration=4ms
2025-10-09 17:20:50.378 [http-nio-8080-exec-8] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=你好, modelType=UNIFIED
2025-10-09 17:20:50.381 [http-nio-8080-exec-8] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 17:20:50.431 [http-nio-8080-exec-8] INFO  c.r.L.service.ChatHistoryService - 创建新会话: sessionId=session_1760001650305_a311xqqd3, userId=1, title=你好
2025-10-09 17:20:50.483 [http-nio-8080-exec-8] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 17:20:50.483 [http-nio-8080-exec-8] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced Agent (默认)
2025-10-09 17:20:50.488 [Async-1] INFO  c.r.L.service.AgentService - 🚀 开始流式法律咨询处理: question='你好', length=2
2025-10-09 17:20:50.489 [Async-1] INFO  c.r.L.service.AgentService - 使用高级流式模型进行推送
2025-10-09 17:20:50.489 [Async-1] INFO  c.r.L.service.AgentService - 📡 开始使用流式模型处理: model=OpenAiStreamingChatModel
2025-10-09 17:20:50.494 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d491a464, method=POST, uri=/api/v1/chat/stream, status=200, duration=173ms
2025-10-09 17:21:14.532 [ForkJoinPool.commonPool-worker-6] INFO  c.r.L.service.AgentService - 流式响应完成，总长度: 946
2025-10-09 17:21:14.542 [http-nio-8080-exec-9] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 17:21:14.554 [http-nio-8080-exec-5] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 17:21:14.567 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=46bbd5ef, method=GET, uri=/api/v1/chat/sessions, status=200, duration=14ms
2025-10-09 17:21:38.033 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=请你告诉我三方协议是什么, modelType=UNIFIED
2025-10-09 17:21:38.035 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 17:21:38.040 [http-nio-8080-exec-4] INFO  c.r.L.service.ChatHistoryService - 创建新会话: sessionId=session_1760001698021_5otmhft6h, userId=1, title=请你告诉我三方协议是什么
2025-10-09 17:21:38.054 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 17:21:38.055 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced Agent (默认)
2025-10-09 17:21:38.055 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=62c95773, method=POST, uri=/api/v1/chat/stream, status=200, duration=23ms
2025-10-09 17:21:38.055 [Async-2] INFO  c.r.L.service.AgentService - 🚀 开始流式法律咨询处理: question='请你告诉我三方协议是什么', length=12
2025-10-09 17:21:38.057 [Async-2] INFO  c.r.L.service.AgentService - 使用高级流式模型进行推送
2025-10-09 17:21:38.057 [Async-2] INFO  c.r.L.service.AgentService - 📡 开始使用流式模型处理: model=OpenAiStreamingChatModel
2025-10-09 17:22:42.816 [ForkJoinPool.commonPool-worker-6] INFO  c.r.L.service.AgentService - 流式响应完成，总长度: 2870
2025-10-09 17:22:42.819 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 17:22:42.852 [http-nio-8080-exec-3] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 17:22:42.869 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a71ba32b, method=GET, uri=/api/v1/chat/sessions, status=200, duration=18ms
2025-10-09 17:23:06.587 [http-nio-8080-exec-6] INFO  c.r.L.service.ChatHistoryService - 用户 1 删除会话 session_1760001650305_a311xqqd3
2025-10-09 17:23:06.607 [http-nio-8080-exec-6] INFO  c.r.L.service.ChatHistoryService - 会话 session_1760001650305_a311xqqd3 已删除
2025-10-09 17:23:06.629 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=55052070, method=DELETE, uri=/api/v1/chat/sessions/session_1760001650305_a311xqqd3, status=200, duration=43ms
2025-10-09 17:23:28.034 [http-nio-8080-exec-1] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 17:23:28.041 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b6684c63, method=GET, uri=/api/v1/chat/sessions, status=200, duration=7ms
2025-10-09 17:23:28.052 [http-nio-8080-exec-2] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 17:23:28.059 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f388304f, method=GET, uri=/api/v1/chat/sessions, status=200, duration=7ms
2025-10-09 17:29:07.662 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1b4f3ed5, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=47ms
2025-10-09 17:29:18.330 [http-nio-8080-exec-8] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 17:29:18.337 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=baa281bb, method=GET, uri=/api/v1/chat/sessions, status=200, duration=8ms
2025-10-09 17:29:18.350 [http-nio-8080-exec-9] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 17:29:18.356 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4a3a484e, method=GET, uri=/api/v1/chat/sessions, status=200, duration=7ms
2025-10-09 17:29:20.486 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5dc098d2, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=9ms
2025-10-09 17:49:50.577 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7bdaee6f, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=13ms
2025-10-09 17:49:57.785 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d239c1e5, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=10ms
2025-10-09 17:50:00.203 [http-nio-8080-exec-3] ERROR c.r.L.e.GlobalExceptionHandler - 未处理的异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource users.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-09 17:50:00.211 [http-nio-8080-exec-3] ERROR c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5c0e44cc, method=GET, uri=/api/v1/users, status=500, duration=14ms
2025-10-09 17:50:02.307 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 17:50:02.310 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b4d9caed, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=20ms
2025-10-09 17:53:30.096 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 17:53:30.099 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 17:59:29.679 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 29656 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 17:59:29.681 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 17:59:32.110 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 17:59:32.295 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3e5ed0d4
2025-10-09 17:59:32.363 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 17:59:32.384 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 17:59:32.389 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 17:59:32.475 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 17:59:32.477 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 17:59:32.903 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 17:59:33.997 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 17:59:34.047 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 17:59:34.049 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 17:59:34.069 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 17:59:34.069 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 17:59:34.069 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 17:59:34.069 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 17:59:34.069 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 17:59:34.069 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 17:59:34.069 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 17:59:34.099 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 17:59:34.239 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 17:59:34.240 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 17:59:34.962 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 17:59:34.991 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 17:59:34.992 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 17:59:34.996 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 17:59:34.997 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 17:59:34.998 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 17:59:35.030 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 17:59:35.205 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 17:59:35.207 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 17:59:35.207 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 17:59:35.208 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 17:59:35.441 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 17:59:35.450 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 17:59:35.454 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 17:59:35.454 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 17:59:35.454 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 17:59:35.461 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 17:59:35.461 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 17:59:35.486 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 17:59:35.486 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 17:59:35.486 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 17:59:35.486 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 17:59:35.486 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 17:59:35.487 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 17:59:35.487 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 17:59:35.497 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 17:59:35.505 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 17:59:35.517 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 17:59:35.518 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 17:59:35.533 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 17:59:35.533 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 17:59:35.535 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 17:59:35.535 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 17:59:35.537 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 17:59:35.537 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 17:59:35.609 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 17:59:36.453 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 17:59:36.629 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 17:59:36.630 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 17:59:36.652 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 17:59:36.653 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 17:59:36.774 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 17:59:37.011 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 17:59:37.321 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 17:59:37.465 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 17:59:37.556 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 17:59:38.295 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.059 seconds (process running for 9.353)
2025-10-09 17:59:38.302 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 17:59:38.304 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 17:59:38.391 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 17:59:43.088 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 17:59:43.109 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9d243a23, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=83ms
2025-10-09 17:59:46.043 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2d9d9d63, method=GET, uri=/api/v1/users, status=200, duration=9ms
2025-10-09 18:00:05.969 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 18:00:05.971 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3c2b140e, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=12ms
2025-10-09 18:00:07.197 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 18:00:07.198 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5eff671a, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=9ms
2025-10-09 18:00:07.579 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 18:00:07.581 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f398f62f, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=8ms
2025-10-09 18:00:08.257 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 18:00:08.259 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=73eb1f3e, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=9ms
2025-10-09 18:00:08.443 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 18:00:08.444 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ba88029b, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=8ms
2025-10-09 18:00:08.614 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 18:00:08.616 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=915225c9, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=8ms
2025-10-09 18:00:08.766 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 18:00:08.768 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6cf62f63, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=9ms
2025-10-09 18:00:08.915 [http-nio-8080-exec-10] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 18:00:08.916 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1bb0104a, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=7ms
2025-10-09 18:00:09.051 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 18:00:09.053 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cd583d55, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=18ms
2025-10-09 18:00:14.771 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 18:00:14.773 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c1e2e59e, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=7ms
2025-10-09 18:00:15.476 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 18:00:15.478 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5572c39d, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=9ms
2025-10-09 18:00:15.655 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 18:00:15.657 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bf672c11, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=8ms
2025-10-09 18:00:15.807 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 18:00:15.810 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8d1abb67, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=9ms
2025-10-09 18:00:24.629 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 18:00:24.632 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 19:46:43.322 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 27908 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 19:46:43.324 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 19:46:45.958 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 19:46:46.240 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3d9cba2
2025-10-09 19:46:46.304 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 19:46:46.325 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 19:46:46.331 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 19:46:46.417 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 19:46:46.419 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 19:46:46.904 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 19:46:48.120 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 19:46:48.175 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 19:46:48.177 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 19:46:48.195 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 19:46:48.195 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 19:46:48.195 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 19:46:48.195 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 19:46:48.195 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 19:46:48.195 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 19:46:48.195 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 19:46:48.226 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 19:46:48.362 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 19:46:48.362 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 19:46:49.113 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 19:46:49.149 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 19:46:49.152 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 19:46:49.156 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 19:46:49.157 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 19:46:49.158 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 19:46:49.212 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 19:46:49.392 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 19:46:49.394 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 19:46:49.394 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 19:46:49.395 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 19:46:49.582 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 19:46:49.590 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 19:46:49.592 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 19:46:49.592 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 19:46:49.592 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 19:46:49.599 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 19:46:49.599 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 19:46:49.624 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 19:46:49.625 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 19:46:49.625 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 19:46:49.625 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 19:46:49.625 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 19:46:49.625 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 19:46:49.625 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 19:46:49.646 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 19:46:49.653 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 19:46:49.665 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 19:46:49.666 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 19:46:49.677 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 19:46:49.677 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 19:46:49.680 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 19:46:49.680 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 19:46:49.681 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 19:46:49.682 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 19:46:49.732 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 19:46:50.429 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 19:46:50.617 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 19:46:50.619 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 19:46:50.648 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 19:46:50.650 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 19:46:50.776 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 19:46:51.003 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 19:46:51.299 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 19:46:51.451 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 19:46:51.548 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 19:46:52.389 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.479 seconds (process running for 9.759)
2025-10-09 19:46:52.396 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 19:46:52.397 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 19:46:52.506 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 19:46:55.384 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4068a79e, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=86ms
2025-10-09 19:47:02.765 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fa5f1059, method=GET, uri=/api/v1/users, status=200, duration=25ms
2025-10-09 19:47:05.848 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 19:47:05.854 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a87c915a, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=25ms
2025-10-09 19:47:40.694 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=08310f5e, method=PUT, uri=/api/v1/users/3, status=200, duration=137ms
2025-10-09 19:47:40.743 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ee083286, method=GET, uri=/api/v1/users, status=200, duration=9ms
2025-10-09 19:47:44.195 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=20c8f934, method=GET, uri=/api/v1/users, status=200, duration=7ms
2025-10-09 19:49:38.621 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a3364836, method=GET, uri=/api/v1/users, status=200, duration=27ms
2025-10-09 19:49:42.670 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 19:49:42.677 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d6432ea6, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=27ms
2025-10-09 19:49:52.170 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=37ad0390, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=17ms
2025-10-09 19:52:48.975 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 19:52:48.976 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=81e33b4a, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=9ms
2025-10-09 19:53:29.896 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 19:53:29.901 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 19:54:53.123 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 37716 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 19:54:53.125 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 19:54:55.648 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 19:54:55.786 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@16a15261
2025-10-09 19:54:55.844 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 19:54:55.864 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 19:54:55.871 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 19:54:55.952 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 19:54:55.954 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 19:54:56.416 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 19:54:57.498 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 19:54:57.550 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 19:54:57.551 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 19:54:57.571 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 19:54:57.571 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 19:54:57.572 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 19:54:57.572 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 19:54:57.572 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 19:54:57.572 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 19:54:57.572 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 19:54:57.605 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 19:54:57.734 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 19:54:57.735 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 19:54:58.496 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 19:54:58.528 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 19:54:58.530 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 19:54:58.534 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 19:54:58.536 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 19:54:58.537 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 19:54:58.572 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 19:54:58.755 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 19:54:58.758 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 19:54:58.759 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 19:54:58.759 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 19:54:58.943 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 19:54:58.951 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 19:54:58.953 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 19:54:58.953 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 19:54:58.953 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 19:54:58.960 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 19:54:58.960 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 19:54:58.984 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 19:54:58.984 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 19:54:58.984 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 19:54:58.984 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 19:54:58.985 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 19:54:58.985 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 19:54:58.985 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 19:54:59.004 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 19:54:59.014 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 19:54:59.030 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 19:54:59.030 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 19:54:59.044 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 19:54:59.044 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 19:54:59.047 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 19:54:59.047 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 19:54:59.049 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 19:54:59.049 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 19:54:59.106 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 19:54:59.582 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 19:54:59.772 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 19:54:59.774 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 19:54:59.796 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 19:54:59.798 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 19:54:59.928 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 19:55:00.141 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 19:55:00.502 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 19:55:00.661 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 19:55:00.749 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 19:55:01.550 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.902 seconds (process running for 9.17)
2025-10-09 19:55:01.555 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 19:55:01.558 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 19:55:01.656 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 19:55:10.663 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 19:55:10.685 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9ee364e5, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=91ms
2025-10-09 19:55:50.820 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e4bd37cc, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=42ms
2025-10-09 19:56:24.111 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 19:56:24.116 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 20:05:59.633 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 14044 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 20:05:59.634 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 20:06:02.086 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 20:06:02.223 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3c981f76
2025-10-09 20:06:02.265 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 20:06:02.287 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 20:06:02.293 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 20:06:02.375 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 20:06:02.377 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 20:06:02.739 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 20:06:03.834 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 20:06:03.889 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 20:06:03.892 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 20:06:03.915 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 20:06:03.916 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 20:06:03.916 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 20:06:03.916 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 20:06:03.916 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 20:06:03.916 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 20:06:03.916 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 20:06:03.963 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 20:06:04.073 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 20:06:04.073 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 20:06:04.802 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 20:06:04.831 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 20:06:04.833 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 20:06:04.837 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 20:06:04.838 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 20:06:04.839 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 20:06:04.872 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 20:06:05.070 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 20:06:05.071 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 20:06:05.072 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 20:06:05.072 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 20:06:05.263 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 20:06:05.271 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 20:06:05.273 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 20:06:05.273 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 20:06:05.274 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 20:06:05.280 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 20:06:05.280 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 20:06:05.302 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 20:06:05.303 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 20:06:05.303 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 20:06:05.303 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 20:06:05.303 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 20:06:05.304 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 20:06:05.304 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 20:06:05.315 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 20:06:05.324 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 20:06:05.336 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 20:06:05.337 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 20:06:05.353 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 20:06:05.353 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 20:06:05.356 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 20:06:05.356 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 20:06:05.357 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 20:06:05.358 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 20:06:05.409 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 20:06:05.861 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 20:06:06.046 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 20:06:06.049 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 20:06:06.074 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 20:06:06.076 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 20:06:06.214 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 20:06:06.440 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 20:06:06.771 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 20:06:06.975 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 20:06:07.068 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 20:06:08.013 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.813 seconds (process running for 9.078)
2025-10-09 20:06:08.019 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 20:06:08.021 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 20:06:08.118 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 20:06:13.737 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 20:06:13.764 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=83d92f4c, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=99ms
2025-10-09 20:06:39.069 [http-nio-8080-exec-2] INFO  c.r.L.c.KnowledgeBaseController - 管理员删除单个文档: 14
2025-10-09 20:06:39.073 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 开始删除文档: 14
2025-10-09 20:06:39.100 [http-nio-8080-exec-2] WARN  c.r.L.service.KnowledgeBaseService - 删除文档块功能需要根据具体的VectorStore实现来完成: F:\LegalAssistant\uploads\contracts\573fde99c3197ab6b24a557b15e4dac514eae53250c2754db7097329e68420f3_上海市拍卖业委托拍卖合同示范文本.docx
2025-10-09 20:06:39.174 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 文档删除成功: 573fde99c3197ab6b24a557b15e4dac514eae53250c2754db7097329e68420f3_上海市拍卖业委托拍卖合同示范文本.docx (ID: 14)
2025-10-09 20:06:39.188 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b8f2a335, method=DELETE, uri=/api/v1/knowledge-base/documents/14, status=200, duration=134ms
2025-10-09 20:06:39.263 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:06:39.267 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f902e061, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=19ms
2025-10-09 20:07:03.552 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 20:07:03.557 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 20:09:31.056 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 33508 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 20:09:31.058 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 20:09:33.578 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 20:09:33.742 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3c981f76
2025-10-09 20:09:33.799 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 20:09:33.820 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 20:09:33.826 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 20:09:33.908 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 20:09:33.911 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 20:09:34.343 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 20:09:35.481 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 20:09:35.540 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 20:09:35.541 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 20:09:35.561 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 20:09:35.562 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 20:09:35.562 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 20:09:35.562 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 20:09:35.562 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 20:09:35.562 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 20:09:35.562 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 20:09:35.593 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 20:09:35.728 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 20:09:35.730 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 20:09:36.471 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 20:09:36.501 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 20:09:36.504 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 20:09:36.508 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 20:09:36.509 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 20:09:36.510 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 20:09:36.545 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 20:09:36.715 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 20:09:36.717 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 20:09:36.717 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 20:09:36.718 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 20:09:36.923 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 20:09:36.932 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 20:09:36.934 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 20:09:36.934 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 20:09:36.934 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 20:09:36.942 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 20:09:36.942 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 20:09:36.974 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 20:09:36.974 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 20:09:36.974 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 20:09:36.974 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 20:09:36.974 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 20:09:36.974 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 20:09:36.974 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 20:09:36.985 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 20:09:36.994 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 20:09:37.006 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 20:09:37.006 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 20:09:37.016 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 20:09:37.016 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 20:09:37.019 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 20:09:37.019 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 20:09:37.021 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 20:09:37.021 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 20:09:37.082 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 20:09:37.627 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 20:09:37.830 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 20:09:37.833 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 20:09:37.872 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 20:09:37.874 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 20:09:38.019 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 20:09:38.258 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 20:09:38.596 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 20:09:38.763 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 20:09:38.862 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 20:09:39.958 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.346 seconds (process running for 9.619)
2025-10-09 20:09:39.966 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 20:09:39.968 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 20:09:40.121 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 20:09:40.604 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:09:40.624 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9d332ca6, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=87ms
2025-10-09 20:09:42.879 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:09:42.882 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=509cd61a, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=17ms
2025-10-09 20:09:49.975 [http-nio-8080-exec-3] ERROR c.r.L.e.GlobalExceptionHandler - 未处理的异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource knowledge/upload.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-09 20:09:49.984 [http-nio-8080-exec-3] ERROR c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4c44d2e8, method=POST, uri=/api/v1/knowledge/upload, status=500, duration=31ms
2025-10-09 20:10:30.158 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:10:30.161 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=01e5ce68, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=11ms
2025-10-09 20:12:55.093 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:12:55.094 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=25beafc6, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=7ms
2025-10-09 20:12:59.931 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:12:59.932 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=34c7d747, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=6ms
2025-10-09 20:13:06.102 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:13:06.104 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=874b5f53, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=7ms
2025-10-09 20:13:11.328 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:13:11.329 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2438574a, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=9ms
2025-10-09 20:14:41.391 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:14:41.392 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e0954a60, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=6ms
2025-10-09 20:14:49.566 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 20:14:49.570 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 20:16:58.984 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 26840 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 20:16:58.985 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 20:17:01.181 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 20:17:01.299 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@237bdbcb
2025-10-09 20:17:01.341 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 20:17:01.360 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 20:17:01.365 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 20:17:01.441 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 20:17:01.443 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 20:17:01.773 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 20:17:02.716 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 20:17:02.763 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 20:17:02.764 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 20:17:02.783 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 20:17:02.784 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 20:17:02.784 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 20:17:02.784 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 20:17:02.784 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 20:17:02.784 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 20:17:02.785 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 20:17:02.815 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 20:17:02.903 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 20:17:02.903 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 20:17:03.529 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 20:17:03.556 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 20:17:03.558 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 20:17:03.561 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 20:17:03.562 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 20:17:03.563 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 20:17:03.592 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 20:17:03.769 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 20:17:03.771 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 20:17:03.772 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 20:17:03.773 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 20:17:03.932 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 20:17:03.940 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 20:17:03.942 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 20:17:03.942 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 20:17:03.942 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 20:17:03.948 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 20:17:03.948 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 20:17:03.970 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 20:17:03.971 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 20:17:03.971 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 20:17:03.971 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 20:17:03.971 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 20:17:03.971 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 20:17:03.971 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 20:17:03.982 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 20:17:03.991 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 20:17:04.003 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 20:17:04.003 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 20:17:04.014 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 20:17:04.014 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 20:17:04.016 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 20:17:04.016 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 20:17:04.018 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 20:17:04.018 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 20:17:04.067 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 20:17:04.492 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 20:17:04.644 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 20:17:04.646 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 20:17:04.665 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 20:17:04.667 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 20:17:04.782 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 20:17:04.979 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 20:17:05.237 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 20:17:05.393 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 20:17:05.469 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 20:17:06.184 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.584 seconds (process running for 7.842)
2025-10-09 20:17:06.190 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 20:17:06.192 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 20:17:06.279 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 20:17:43.437 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:17:43.457 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a4d9ce26, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=84ms
2025-10-09 20:18:10.391 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:18:10.393 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3adc811d, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=11ms
2025-10-09 20:18:11.776 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:18:11.778 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=068e0a05, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=8ms
2025-10-09 20:18:12.108 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:18:12.110 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=dc0c2d72, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=9ms
2025-10-09 20:18:12.266 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:18:12.267 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=48145cab, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=8ms
2025-10-09 20:18:12.425 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:18:12.427 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f8adcee5, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=8ms
2025-10-09 20:18:15.729 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:18:15.731 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=877a1d63, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=8ms
2025-10-09 20:18:21.911 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=law, 总数=0
2025-10-09 20:18:21.912 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1f3db851, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=24ms
2025-10-09 20:18:25.383 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:18:25.384 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6b4e31ad, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=6ms
2025-10-09 20:18:29.454 [http-nio-8080-exec-10] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=contract, 总数=0
2025-10-09 20:18:29.456 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c8d26cdf, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=5ms
2025-10-09 20:18:34.934 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=contract, 总数=0
2025-10-09 20:18:34.936 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f1f791e1, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=5ms
2025-10-09 20:18:42.345 [http-nio-8080-exec-8] INFO  c.r.L.c.KnowledgeBaseController - 管理员上传单个法律文档: 杭州市消防检测技术服务合同.pdf
2025-10-09 20:18:42.359 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 开始上传文档到知识库 (使用EtlService): 杭州市消防检测技术服务合同.pdf, 大小: 189350 bytes
2025-10-09 20:18:42.359 [http-nio-8080-exec-8] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 杭州市消防检测技术服务合同.pdf, 类型: pdf, 大小: 189350 bytes
2025-10-09 20:18:42.736 [http-nio-8080-exec-8] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 杭州市消防检测技术服务合同.pdf, 内容长度: 5495 字符
2025-10-09 20:18:42.739 [http-nio-8080-exec-8] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 5495 字符
2025-10-09 20:18:42.744 [http-nio-8080-exec-8] INFO  c.r.L.service.EtlService - 文本分块完成，生成 404 个文本块
2025-10-09 20:18:50.924 [http-nio-8080-exec-8] INFO  c.r.L.service.EtlService - 文本内容处理完成，404 个向量块已存储
2025-10-09 20:18:50.979 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 文档保存到数据库成功：杭州市消防检测技术服务合同.pdf
2025-10-09 20:18:50.979 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 文档上传完成 (EtlService): 杭州市消防检测技术服务合同.pdf, 文档ID: 18, 块数: 404
2025-10-09 20:18:50.986 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7c09d9a3, method=POST, uri=/api/v1/knowledge-base/documents/upload-single, status=200, duration=8662ms
2025-10-09 20:19:04.860 [http-nio-8080-exec-4] INFO  c.r.L.c.KnowledgeBaseController - 管理员上传单个法律文档: 杭州市消防检测技术服务合同.pdf
2025-10-09 20:19:04.870 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 开始上传文档到知识库 (使用EtlService): 杭州市消防检测技术服务合同.pdf, 大小: 189350 bytes
2025-10-09 20:19:04.871 [http-nio-8080-exec-4] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 杭州市消防检测技术服务合同.pdf, 类型: pdf, 大小: 189350 bytes
2025-10-09 20:19:04.930 [http-nio-8080-exec-4] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 杭州市消防检测技术服务合同.pdf, 内容长度: 5495 字符
2025-10-09 20:19:04.940 [http-nio-8080-exec-4] WARN  c.r.L.service.KnowledgeBaseService - 文档已存在: 杭州市消防检测技术服务合同.pdf
2025-10-09 20:19:04.942 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c19ff8f5, method=POST, uri=/api/v1/knowledge-base/documents/upload-single, status=200, duration=86ms
2025-10-09 20:19:17.448 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 20:19:17.449 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ddaa5bb6, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=8ms
2025-10-09 20:19:29.130 [http-nio-8080-exec-2] INFO  c.r.L.c.VectorIndexController - 管理员请求重建知识库索引
2025-10-09 20:19:29.130 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 开始重建知识库索引...
2025-10-09 20:19:29.131 [ForkJoinPool.commonPool-worker-2] WARN  c.r.L.service.KnowledgeBaseService - 清空向量存储功能需要根据具体的VectorStore实现来完成
2025-10-09 20:19:29.132 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a979d8b1, method=POST, uri=/api/v1/vector-index/rebuild, status=200, duration=4ms
2025-10-09 20:19:29.141 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.KnowledgeBaseService - 重新索引文档: 民法典.pdf (ID: 11)
2025-10-09 20:19:29.142 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.KnowledgeBaseService - 重新索引文档: 环境保护法.pdf (ID: 6)
2025-10-09 20:19:29.142 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.KnowledgeBaseService - 重新索引文档: 刑法.pdf (ID: 7)
2025-10-09 20:19:29.142 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.KnowledgeBaseService - 重新索引文档: 劳动法.pdf (ID: 8)
2025-10-09 20:19:29.143 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.KnowledgeBaseService - 重新索引文档: 宪法.pdf (ID: 9)
2025-10-09 20:19:29.143 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.KnowledgeBaseService - 重新索引文档: 民事诉讼法.pdf (ID: 10)
2025-10-09 20:19:29.143 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.KnowledgeBaseService - 重新索引文档: 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx (ID: 12)
2025-10-09 20:19:29.143 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.KnowledgeBaseService - 重新索引文档: 454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx (ID: 13)
2025-10-09 20:19:29.143 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.KnowledgeBaseService - 重新索引文档: 杭州市消防检测技术服务合同.pdf (ID: 18)
2025-10-09 20:19:29.144 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.KnowledgeBaseService - 知识库索引重建完成，共处理 9 个文档
2025-10-09 20:22:31.473 [http-nio-8080-exec-6] INFO  c.r.L.c.KnowledgeBaseController - 管理员删除单个文档: 18
2025-10-09 20:22:31.477 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 开始删除文档: 18
2025-10-09 20:22:31.495 [http-nio-8080-exec-6] WARN  c.r.L.service.KnowledgeBaseService - 删除文档块功能需要根据具体的VectorStore实现来完成: uploads/杭州市消防检测技术服务合同.pdf
2025-10-09 20:22:31.529 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 文档删除成功: 杭州市消防检测技术服务合同.pdf (ID: 18)
2025-10-09 20:22:31.535 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0f6439e5, method=DELETE, uri=/api/v1/knowledge-base/documents/18, status=200, duration=66ms
2025-10-09 20:22:31.579 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:22:31.582 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fe364e2d, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=12ms
2025-10-09 20:26:27.267 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:26:27.269 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ce3552d2, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=6ms
2025-10-09 20:26:32.496 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:26:32.498 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=560cd807, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=7ms
2025-10-09 20:26:38.367 [http-nio-8080-exec-10] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:26:38.368 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a975f68c, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=6ms
2025-10-09 20:27:07.514 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:27:07.516 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b25d0d94, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=5ms
2025-10-09 20:27:20.322 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:27:20.323 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=417712c4, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=6ms
2025-10-09 20:27:29.960 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:27:29.964 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=98a2b4d2, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=8ms
2025-10-09 20:27:36.655 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:27:36.657 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1e54cd5b, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=6ms
2025-10-09 20:27:42.527 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:27:42.528 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=68a5fc33, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=5ms
2025-10-09 20:31:36.885 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:31:36.886 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d7bd6061, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=5ms
2025-10-09 20:32:59.947 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:32:59.949 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cc646c65, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=6ms
2025-10-09 20:33:13.226 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:33:13.227 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f2128243, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=5ms
2025-10-09 20:33:14.489 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=law, 总数=0
2025-10-09 20:33:14.490 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=005d7d91, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=3ms
2025-10-09 20:33:19.946 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 20:33:19.952 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 20:36:49.083 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 8492 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 20:36:49.084 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 20:36:51.426 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 20:36:51.560 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@11678469
2025-10-09 20:36:51.601 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 20:36:51.620 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 20:36:51.628 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 20:36:51.703 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 20:36:51.705 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 20:36:52.070 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 20:36:53.087 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 20:36:53.141 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 20:36:53.142 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 20:36:53.164 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 20:36:53.164 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 20:36:53.164 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 20:36:53.165 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 20:36:53.165 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 20:36:53.165 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 20:36:53.165 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 20:36:53.206 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 20:36:53.307 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 20:36:53.308 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 20:36:54.070 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 20:36:54.097 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 20:36:54.099 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 20:36:54.104 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 20:36:54.105 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 20:36:54.106 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 20:36:54.151 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 20:36:54.310 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 20:36:54.311 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 20:36:54.312 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 20:36:54.312 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 20:36:54.484 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 20:36:54.491 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 20:36:54.493 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 20:36:54.493 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 20:36:54.493 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 20:36:54.500 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 20:36:54.500 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 20:36:54.522 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 20:36:54.523 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 20:36:54.523 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 20:36:54.523 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 20:36:54.523 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 20:36:54.523 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 20:36:54.524 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 20:36:54.536 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 20:36:54.545 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 20:36:54.558 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 20:36:54.558 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 20:36:54.571 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 20:36:54.571 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 20:36:54.572 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 20:36:54.573 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 20:36:54.574 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 20:36:54.574 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 20:36:54.625 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 20:36:55.075 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 20:36:55.233 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 20:36:55.234 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 20:36:55.255 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 20:36:55.256 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 20:36:55.398 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 20:36:55.622 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 20:36:55.961 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 20:36:56.121 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 20:36:56.206 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 20:36:56.993 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.359 seconds (process running for 8.671)
2025-10-09 20:36:56.998 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 20:36:56.999 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 20:36:57.124 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 20:36:59.878 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:36:59.900 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c3aa6afe, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=83ms
2025-10-09 20:37:02.424 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=law, 总数=0
2025-10-09 20:37:02.426 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=07650c5b, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=9ms
2025-10-09 20:37:04.239 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=contract, 总数=0
2025-10-09 20:37:04.240 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=70a88000, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=3ms
2025-10-09 20:37:05.355 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=law, 总数=0
2025-10-09 20:37:05.357 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=86f3ca89, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=5ms
2025-10-09 20:37:06.166 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=case, 总数=0
2025-10-09 20:37:06.167 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9bb423cf, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=3ms
2025-10-09 20:37:16.297 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=case, 总数=0
2025-10-09 20:37:16.298 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ba210682, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=4ms
2025-10-09 20:37:17.999 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=case, 总数=0
2025-10-09 20:37:18.000 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=11568906, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=4ms
2025-10-09 20:37:18.607 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=case, 总数=0
2025-10-09 20:37:18.609 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2df03247, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=4ms
2025-10-09 20:37:18.821 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=case, 总数=0
2025-10-09 20:37:18.822 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8295ca2f, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=3ms
2025-10-09 20:37:18.995 [http-nio-8080-exec-10] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=case, 总数=0
2025-10-09 20:37:18.996 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9c57c7b0, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=3ms
2025-10-09 20:37:19.148 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=case, 总数=0
2025-10-09 20:37:19.149 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=57043bef, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=4ms
2025-10-09 20:37:19.294 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=case, 总数=0
2025-10-09 20:37:19.295 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=88c14963, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=4ms
2025-10-09 20:37:23.226 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=case, 总数=0
2025-10-09 20:37:23.227 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=99426773, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=4ms
2025-10-09 20:37:23.414 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=case, 总数=0
2025-10-09 20:37:23.416 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7b9e9ceb, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=5ms
2025-10-09 20:37:28.869 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=case, 总数=0
2025-10-09 20:37:28.870 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d5711521, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=4ms
2025-10-09 20:37:33.926 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=case, 总数=0
2025-10-09 20:37:33.927 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=aef0895c, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=4ms
2025-10-09 20:37:36.260 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=contract, 总数=0
2025-10-09 20:37:36.262 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9794878b, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=5ms
2025-10-09 20:37:37.151 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=contract, 总数=0
2025-10-09 20:37:37.153 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b25d041e, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=4ms
2025-10-09 20:37:41.931 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=contract, 总数=0
2025-10-09 20:37:41.932 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=84515a01, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=3ms
2025-10-09 20:37:43.203 [http-nio-8080-exec-10] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=law, 总数=0
2025-10-09 20:37:43.205 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7344b51b, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=5ms
2025-10-09 20:37:44.974 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=law, 总数=0
2025-10-09 20:37:44.975 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4e692444, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=4ms
2025-10-09 20:37:46.237 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:37:46.239 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=78cfcbe1, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=9ms
2025-10-09 20:37:51.090 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:37:51.092 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=03f016c4, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=10ms
2025-10-09 20:37:52.396 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=law, 总数=0
2025-10-09 20:37:52.398 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=90916c42, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=4ms
2025-10-09 20:38:00.802 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:38:00.803 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=aa0d67bd, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=13ms
2025-10-09 20:38:22.420 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=law, 总数=0
2025-10-09 20:38:22.422 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=68059f25, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=5ms
2025-10-09 20:43:37.502 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:43:37.504 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7c8dfd10, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=9ms
2025-10-09 20:43:38.799 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=law, 总数=0
2025-10-09 20:43:38.800 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=93617275, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=3ms
2025-10-09 20:43:43.075 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 20:43:43.078 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 20:43:57.944 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 29556 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 20:43:57.944 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 20:44:00.192 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 20:44:00.312 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@237bdbcb
2025-10-09 20:44:00.356 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 20:44:00.375 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 20:44:00.381 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 20:44:00.455 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 20:44:00.458 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 20:44:00.776 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 20:44:01.777 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 20:44:01.826 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 20:44:01.827 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 20:44:01.854 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 20:44:01.854 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 20:44:01.854 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 20:44:01.854 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 20:44:01.855 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 20:44:01.855 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 20:44:01.855 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 20:44:01.886 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 20:44:01.983 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 20:44:01.983 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 20:44:02.644 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 20:44:02.670 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 20:44:02.673 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 20:44:02.677 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 20:44:02.677 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 20:44:02.678 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 20:44:02.715 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 20:44:02.884 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 20:44:02.886 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 20:44:02.886 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 20:44:02.887 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 20:44:03.082 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 20:44:03.092 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 20:44:03.094 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 20:44:03.094 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 20:44:03.094 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 20:44:03.101 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 20:44:03.101 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 20:44:03.126 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 20:44:03.126 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 20:44:03.126 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 20:44:03.126 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 20:44:03.126 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 20:44:03.126 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 20:44:03.126 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 20:44:03.138 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 20:44:03.146 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 20:44:03.168 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 20:44:03.168 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 20:44:03.187 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 20:44:03.188 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 20:44:03.191 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 20:44:03.192 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 20:44:03.194 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 20:44:03.194 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 20:44:03.246 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 20:44:03.684 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 20:44:03.853 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 20:44:03.854 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 20:44:03.875 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 20:44:03.876 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 20:44:04.005 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 20:44:04.211 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 20:44:04.500 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 20:44:04.645 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 20:44:04.730 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 20:44:05.497 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.946 seconds (process running for 8.229)
2025-10-09 20:44:05.500 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 20:44:05.502 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 20:44:05.588 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 20:44:33.016 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:44:33.038 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4d92fe86, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=80ms
2025-10-09 20:44:35.109 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 分类筛选: 前端值=law, 数据库值=LAW
2025-10-09 20:44:35.117 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=law, 总数=6
2025-10-09 20:44:35.118 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b6cd83fd, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=14ms
2025-10-09 20:44:36.871 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 分类筛选: 前端值=contract, 数据库值=CONTRACT_TEMPLATE
2025-10-09 20:44:36.875 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=contract, 总数=2
2025-10-09 20:44:36.876 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=454c466c, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=7ms
2025-10-09 20:44:38.085 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:44:38.087 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=309f7d90, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=12ms
2025-10-09 20:47:55.072 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:47:55.074 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=46bc41d8, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=7ms
2025-10-09 20:48:07.704 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:48:07.706 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c921bd62, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=8ms
2025-10-09 20:48:21.375 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:48:21.377 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=581b8da2, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=7ms
2025-10-09 20:50:36.401 [http-nio-8080-exec-10] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:50:36.402 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7e75bd82, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=5ms
2025-10-09 20:51:12.206 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:51:12.208 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=021aaa9d, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=6ms
2025-10-09 20:51:17.023 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 20:51:17.026 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 20:51:32.127 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 21784 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 20:51:32.128 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 20:51:34.379 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 20:51:34.497 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@56f19f36
2025-10-09 20:51:34.540 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 20:51:34.557 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 20:51:34.563 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 20:51:34.641 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 20:51:34.643 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 20:51:34.966 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 20:51:35.965 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 20:51:36.017 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 20:51:36.018 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 20:51:36.040 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 20:51:36.040 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 20:51:36.040 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 20:51:36.041 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 20:51:36.041 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 20:51:36.041 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 20:51:36.041 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 20:51:36.071 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 20:51:36.158 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 20:51:36.158 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 20:51:36.828 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 20:51:36.857 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 20:51:36.860 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 20:51:36.864 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 20:51:36.865 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 20:51:36.866 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 20:51:36.903 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 20:51:37.090 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 20:51:37.093 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 20:51:37.093 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 20:51:37.094 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 20:51:37.265 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 20:51:37.271 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 20:51:37.274 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 20:51:37.274 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 20:51:37.275 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 20:51:37.281 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 20:51:37.281 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 20:51:37.303 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 20:51:37.303 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 20:51:37.303 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 20:51:37.304 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 20:51:37.304 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 20:51:37.304 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 20:51:37.304 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 20:51:37.316 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 20:51:37.325 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 20:51:37.339 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 20:51:37.339 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 20:51:37.351 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 20:51:37.351 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 20:51:37.353 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 20:51:37.353 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 20:51:37.354 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 20:51:37.355 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 20:51:37.407 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 20:51:37.841 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 20:51:38.022 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 20:51:38.025 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 20:51:38.046 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 20:51:38.048 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 20:51:38.164 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 20:51:38.367 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 20:51:38.687 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 20:51:38.835 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 20:51:38.949 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 20:51:39.714 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.988 seconds (process running for 8.278)
2025-10-09 20:51:39.719 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 20:51:39.721 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 20:51:39.811 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 20:51:43.978 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:51:43.997 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0c53f4d3, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=75ms
2025-10-09 20:51:44.571 [http-nio-8080-exec-1] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 13
2025-10-09 20:51:44.572 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 13
2025-10-09 20:51:44.602 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 20:51:44.629 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=264ac552, method=GET, uri=/api/v1/knowledge-base/documents/13/chunks, status=200, duration=71ms
2025-10-09 20:52:01.760 [http-nio-8080-exec-3] INFO  c.r.L.c.KnowledgeBaseController - 管理员请求重新处理文档: 13
2025-10-09 20:52:01.761 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 开始重新处理文档: 13
2025-10-09 20:52:01.766 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=37cf61a4, method=POST, uri=/api/v1/knowledge-base/documents/13/reprocess, status=200, duration=8ms
2025-10-09 20:52:01.769 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.KnowledgeBaseService - 找到文档: 454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx, 开始重新处理
2025-10-09 20:52:01.770 [ForkJoinPool.commonPool-worker-1] WARN  c.r.L.service.KnowledgeBaseService - 删除文档块功能需要根据具体的VectorStore实现来完成: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-09 20:52:01.770 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.KnowledgeBaseService - 删除文档旧的向量数据: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-09 20:52:01.771 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 2003 字符
2025-10-09 20:52:01.779 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 402 个文本块
2025-10-09 20:52:03.830 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:52:03.832 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e0db76ec, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=15ms
2025-10-09 20:52:08.465 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 20:52:08.468 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6cefafc1, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=14ms
2025-10-09 20:52:10.360 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，402 个向量块已存储
2025-10-09 20:52:10.409 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.KnowledgeBaseService - 文档重新处理成功: 454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx, 新的块数: 402
2025-10-09 20:52:14.936 [http-nio-8080-exec-6] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 13
2025-10-09 20:52:14.936 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 13
2025-10-09 20:52:14.944 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 20:52:14.953 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6adf4365, method=GET, uri=/api/v1/knowledge-base/documents/13/chunks, status=200, duration=19ms
2025-10-09 20:52:19.683 [http-nio-8080-exec-8] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 13
2025-10-09 20:52:19.684 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 13
2025-10-09 20:52:19.693 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 20:52:19.703 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5bda1d5d, method=GET, uri=/api/v1/knowledge-base/documents/13/chunks, status=200, duration=23ms
2025-10-09 20:52:43.902 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b162445e, method=GET, uri=/api/v1/users, status=200, duration=9ms
2025-10-09 20:52:45.323 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ee116252, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=46ms
2025-10-09 20:52:51.548 [http-nio-8080-exec-9] INFO  c.r.L.c.KnowledgeBaseController - 管理员删除单个文档: 13
2025-10-09 20:52:51.549 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 开始删除文档: 13
2025-10-09 20:52:51.551 [http-nio-8080-exec-9] WARN  c.r.L.service.KnowledgeBaseService - 删除文档块功能需要根据具体的VectorStore实现来完成: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-09 20:52:51.565 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 文档删除成功: 454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx (ID: 13)
2025-10-09 20:52:51.582 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b76f7abc, method=DELETE, uri=/api/v1/knowledge-base/documents/13, status=200, duration=38ms
2025-10-09 20:52:51.619 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=7
2025-10-09 20:52:51.620 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=adbce0a7, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=7ms
2025-10-09 20:52:53.017 [http-nio-8080-exec-1] INFO  c.r.L.c.KnowledgeBaseController - 管理员删除单个文档: 12
2025-10-09 20:52:53.017 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 开始删除文档: 12
2025-10-09 20:52:53.019 [http-nio-8080-exec-1] WARN  c.r.L.service.KnowledgeBaseService - 删除文档块功能需要根据具体的VectorStore实现来完成: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-09 20:52:53.022 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 文档删除成功: 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx (ID: 12)
2025-10-09 20:52:53.034 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8d132159, method=DELETE, uri=/api/v1/knowledge-base/documents/12, status=200, duration=18ms
2025-10-09 20:52:53.083 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=6
2025-10-09 20:52:53.086 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d74774d0, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=16ms
2025-10-09 20:52:54.055 [http-nio-8080-exec-5] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 11
2025-10-09 20:52:54.056 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 11
2025-10-09 20:52:54.062 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 20:52:54.069 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8a1548bd, method=GET, uri=/api/v1/knowledge-base/documents/11/chunks, status=200, duration=16ms
2025-10-09 20:53:10.543 [http-nio-8080-exec-4] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 11
2025-10-09 20:53:10.544 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 11
2025-10-09 20:53:10.551 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 20:53:10.558 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a683e576, method=GET, uri=/api/v1/knowledge-base/documents/11/chunks, status=200, duration=18ms
2025-10-09 20:55:52.057 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=6
2025-10-09 20:55:52.059 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=10d5c227, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=6ms
2025-10-09 20:57:40.600 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 20:57:40.605 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 21:00:01.019 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 33228 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 21:00:01.020 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 21:00:03.285 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 21:00:03.420 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@673a5aa7
2025-10-09 21:00:03.463 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 21:00:03.484 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 21:00:03.489 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 21:00:03.566 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 21:00:03.568 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 21:00:03.900 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 21:00:04.866 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 21:00:04.915 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 21:00:04.916 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 21:00:04.937 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 21:00:04.938 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 21:00:04.938 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 21:00:04.938 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 21:00:04.938 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 21:00:04.938 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 21:00:04.938 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 21:00:04.970 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 21:00:05.067 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 21:00:05.067 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 21:00:05.772 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 21:00:05.799 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 21:00:05.801 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 21:00:05.810 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 21:00:05.812 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 21:00:05.814 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 21:00:05.845 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 21:00:06.001 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 21:00:06.003 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 21:00:06.003 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 21:00:06.004 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 21:00:06.185 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 21:00:06.194 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 21:00:06.196 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 21:00:06.196 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 21:00:06.197 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 21:00:06.203 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 21:00:06.203 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 21:00:06.228 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 21:00:06.228 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 21:00:06.229 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 21:00:06.229 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 21:00:06.229 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 21:00:06.229 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 21:00:06.229 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 21:00:06.241 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 21:00:06.249 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 21:00:06.261 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 21:00:06.261 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 21:00:06.271 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 21:00:06.271 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 21:00:06.274 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 21:00:06.274 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 21:00:06.276 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 21:00:06.276 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 21:00:06.331 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 21:00:06.787 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 21:00:06.951 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 21:00:06.953 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 21:00:06.973 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 21:00:06.975 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 21:00:07.090 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 21:00:07.285 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 21:00:07.580 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 21:00:07.739 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 21:00:07.826 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 21:00:08.582 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.971 seconds (process running for 8.243)
2025-10-09 21:00:08.587 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 21:00:08.588 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 21:00:08.678 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 21:00:49.061 [http-nio-8080-exec-1] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 11
2025-10-09 21:00:49.061 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 11
2025-10-09 21:00:49.085 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 21:00:49.109 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fe4f77b7, method=GET, uri=/api/v1/knowledge-base/documents/11/chunks, status=200, duration=80ms
2025-10-09 21:00:51.648 [http-nio-8080-exec-7] INFO  c.r.L.c.KnowledgeBaseController - 管理员下载文档: 11, 格式: pdf
2025-10-09 21:00:51.649 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 下载文档: 11, 格式: pdf
2025-10-09 21:00:51.928 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - PDF中文字体加载成功
2025-10-09 21:00:52.065 [http-nio-8080-exec-7] ERROR c.r.L.service.KnowledgeBaseService - 生成PDF文件失败: 民法典.pdf
com.itextpdf.kernel.exceptions.PdfException: Cannot draw elements on already flushed pages.
	at com.itextpdf.layout.renderer.DocumentRenderer.flushSingleRenderer(DocumentRenderer.java:144)
	at com.itextpdf.layout.renderer.RootRenderer.addChild(RootRenderer.java:250)
	at com.itextpdf.layout.RootElement.createAndAddRendererSubTree(RootElement.java:347)
	at com.itextpdf.layout.RootElement.addElement(RootElement.java:357)
	at com.itextpdf.layout.RootElement.add(RootElement.java:85)
	at com.itextpdf.layout.Document.add(Document.java:119)
	at com.itextpdf.layout.Document.add(Document.java:49)
	at com.itextpdf.layout.RootElement.showTextAligned(RootElement.java:334)
	at com.river.LegalAssistant.service.KnowledgeBaseService.generatePdfFile(KnowledgeBaseService.java:1246)
	at com.river.LegalAssistant.service.KnowledgeBaseService.downloadDocument(KnowledgeBaseService.java:1088)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:716)
	at com.river.LegalAssistant.service.KnowledgeBaseService$$SpringCGLIB$$0.downloadDocument(<generated>)
	at com.river.LegalAssistant.controller.KnowledgeBaseController.downloadDocument(KnowledgeBaseController.java:484)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.KnowledgeBaseController$$SpringCGLIB$$0.downloadDocument(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-09 21:00:52.073 [http-nio-8080-exec-7] ERROR c.r.L.service.KnowledgeBaseService - 下载文档失败: 11
java.lang.RuntimeException: 生成PDF文件失败: Cannot draw elements on already flushed pages.
	at com.river.LegalAssistant.service.KnowledgeBaseService.generatePdfFile(KnowledgeBaseService.java:1263)
	at com.river.LegalAssistant.service.KnowledgeBaseService.downloadDocument(KnowledgeBaseService.java:1088)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:716)
	at com.river.LegalAssistant.service.KnowledgeBaseService$$SpringCGLIB$$0.downloadDocument(<generated>)
	at com.river.LegalAssistant.controller.KnowledgeBaseController.downloadDocument(KnowledgeBaseController.java:484)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.KnowledgeBaseController$$SpringCGLIB$$0.downloadDocument(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: com.itextpdf.kernel.exceptions.PdfException: Cannot draw elements on already flushed pages.
	at com.itextpdf.layout.renderer.DocumentRenderer.flushSingleRenderer(DocumentRenderer.java:144)
	at com.itextpdf.layout.renderer.RootRenderer.addChild(RootRenderer.java:250)
	at com.itextpdf.layout.RootElement.createAndAddRendererSubTree(RootElement.java:347)
	at com.itextpdf.layout.RootElement.addElement(RootElement.java:357)
	at com.itextpdf.layout.RootElement.add(RootElement.java:85)
	at com.itextpdf.layout.Document.add(Document.java:119)
	at com.itextpdf.layout.Document.add(Document.java:49)
	at com.itextpdf.layout.RootElement.showTextAligned(RootElement.java:334)
	at com.river.LegalAssistant.service.KnowledgeBaseService.generatePdfFile(KnowledgeBaseService.java:1246)
	... 166 common frames omitted
2025-10-09 21:00:52.077 [http-nio-8080-exec-7] ERROR c.r.L.c.KnowledgeBaseController - 下载文档失败: 11
java.lang.RuntimeException: 下载文档失败: 生成PDF文件失败: Cannot draw elements on already flushed pages.
	at com.river.LegalAssistant.service.KnowledgeBaseService.downloadDocument(KnowledgeBaseService.java:1098)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:716)
	at com.river.LegalAssistant.service.KnowledgeBaseService$$SpringCGLIB$$0.downloadDocument(<generated>)
	at com.river.LegalAssistant.controller.KnowledgeBaseController.downloadDocument(KnowledgeBaseController.java:484)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.KnowledgeBaseController$$SpringCGLIB$$0.downloadDocument(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.RuntimeException: 生成PDF文件失败: Cannot draw elements on already flushed pages.
	at com.river.LegalAssistant.service.KnowledgeBaseService.generatePdfFile(KnowledgeBaseService.java:1263)
	at com.river.LegalAssistant.service.KnowledgeBaseService.downloadDocument(KnowledgeBaseService.java:1088)
	... 165 common frames omitted
Caused by: com.itextpdf.kernel.exceptions.PdfException: Cannot draw elements on already flushed pages.
	at com.itextpdf.layout.renderer.DocumentRenderer.flushSingleRenderer(DocumentRenderer.java:144)
	at com.itextpdf.layout.renderer.RootRenderer.addChild(RootRenderer.java:250)
	at com.itextpdf.layout.RootElement.createAndAddRendererSubTree(RootElement.java:347)
	at com.itextpdf.layout.RootElement.addElement(RootElement.java:357)
	at com.itextpdf.layout.RootElement.add(RootElement.java:85)
	at com.itextpdf.layout.Document.add(Document.java:119)
	at com.itextpdf.layout.Document.add(Document.java:49)
	at com.itextpdf.layout.RootElement.showTextAligned(RootElement.java:334)
	at com.river.LegalAssistant.service.KnowledgeBaseService.generatePdfFile(KnowledgeBaseService.java:1246)
	... 166 common frames omitted
2025-10-09 21:00:52.087 [http-nio-8080-exec-7] ERROR c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7e3f16b4, method=GET, uri=/api/v1/knowledge-base/documents/11/download, status=500, duration=444ms
2025-10-09 21:01:02.537 [http-nio-8080-exec-3] INFO  c.r.L.c.KnowledgeBaseController - 管理员下载文档: 11, 格式: txt
2025-10-09 21:01:02.538 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 下载文档: 11, 格式: txt
2025-10-09 21:01:02.550 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a08b192b, method=GET, uri=/api/v1/knowledge-base/documents/11/download, status=200, duration=16ms
2025-10-09 21:03:43.483 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=6
2025-10-09 21:03:43.487 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3f760299, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=21ms
2025-10-09 21:04:59.551 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 21:04:59.555 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 21:05:13.674 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 8736 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 21:05:13.676 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 21:05:15.995 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 21:05:16.138 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3b28ab9b
2025-10-09 21:05:16.196 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 21:05:16.215 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 21:05:16.222 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 21:05:16.302 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 21:05:16.304 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 21:05:16.730 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 21:05:17.818 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 21:05:17.867 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 21:05:17.868 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 21:05:17.890 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 21:05:17.890 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 21:05:17.890 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 21:05:17.890 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 21:05:17.891 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 21:05:17.891 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 21:05:17.891 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 21:05:17.920 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 21:05:18.042 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 21:05:18.042 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 21:05:18.812 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 21:05:18.839 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 21:05:18.843 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 21:05:18.847 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 21:05:18.848 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 21:05:18.849 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 21:05:18.887 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 21:05:19.065 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 21:05:19.067 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 21:05:19.067 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 21:05:19.068 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 21:05:19.243 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 21:05:19.251 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 21:05:19.253 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 21:05:19.253 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 21:05:19.254 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 21:05:19.260 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 21:05:19.261 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 21:05:19.285 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 21:05:19.286 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 21:05:19.286 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 21:05:19.286 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 21:05:19.286 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 21:05:19.286 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 21:05:19.286 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 21:05:19.298 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 21:05:19.306 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 21:05:19.318 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 21:05:19.319 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 21:05:19.329 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 21:05:19.329 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 21:05:19.332 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 21:05:19.332 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 21:05:19.333 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 21:05:19.334 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 21:05:19.395 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 21:05:19.863 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 21:05:20.036 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 21:05:20.038 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 21:05:20.058 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 21:05:20.060 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 21:05:20.179 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 21:05:20.378 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 21:05:20.692 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 21:05:20.843 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 21:05:20.928 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 21:05:21.747 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.459 seconds (process running for 8.758)
2025-10-09 21:05:21.754 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 21:05:21.756 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 21:05:21.853 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 21:05:25.212 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=6
2025-10-09 21:05:25.232 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ea467624, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=77ms
2025-10-09 21:05:26.908 [http-nio-8080-exec-5] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 11
2025-10-09 21:05:26.910 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 11
2025-10-09 21:05:26.940 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 21:05:26.957 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c1441817, method=GET, uri=/api/v1/knowledge-base/documents/11/chunks, status=200, duration=68ms
2025-10-09 21:06:14.533 [http-nio-8080-exec-3] INFO  c.r.L.c.KnowledgeBaseController - 管理员上传单个法律文档: 拍卖法.pdf
2025-10-09 21:06:14.548 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 开始上传文档到知识库 (使用EtlService): 拍卖法.pdf, 大小: 194898 bytes
2025-10-09 21:06:14.548 [http-nio-8080-exec-3] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 拍卖法.pdf, 类型: pdf, 大小: 194898 bytes
2025-10-09 21:06:14.937 [http-nio-8080-exec-3] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 拍卖法.pdf, 内容长度: 5198 字符
2025-10-09 21:06:14.940 [http-nio-8080-exec-3] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 5198 字符
2025-10-09 21:06:14.945 [http-nio-8080-exec-3] INFO  c.r.L.service.EtlService - 文本分块完成，生成 404 个文本块
2025-10-09 21:06:22.890 [http-nio-8080-exec-3] INFO  c.r.L.service.EtlService - 文本内容处理完成，404 个向量块已存储
2025-10-09 21:06:22.937 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 文档保存到数据库成功：拍卖法.pdf
2025-10-09 21:06:22.937 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 文档上传完成 (EtlService): 拍卖法.pdf, 文档ID: 19, 块数: 404
2025-10-09 21:06:22.945 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ca7e4c60, method=POST, uri=/api/v1/knowledge-base/documents/upload-single, status=200, duration=8436ms
2025-10-09 21:06:23.038 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=7
2025-10-09 21:06:23.041 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fca68e6f, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=28ms
2025-10-09 21:06:30.107 [http-nio-8080-exec-6] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 19
2025-10-09 21:06:30.108 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 19
2025-10-09 21:06:30.113 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 21:06:30.119 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=86748a68, method=GET, uri=/api/v1/knowledge-base/documents/19/chunks, status=200, duration=14ms
2025-10-09 21:06:39.837 [http-nio-8080-exec-7] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 19
2025-10-09 21:06:39.837 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 19
2025-10-09 21:06:39.844 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 21:06:39.848 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=aa65ea89, method=GET, uri=/api/v1/knowledge-base/documents/19/chunks, status=200, duration=12ms
2025-10-09 21:07:38.812 [http-nio-8080-exec-8] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 19
2025-10-09 21:07:38.812 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 19
2025-10-09 21:07:38.818 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 21:07:38.823 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4a9dbf0e, method=GET, uri=/api/v1/knowledge-base/documents/19/chunks, status=200, duration=13ms
2025-10-09 21:12:03.629 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 21:12:03.632 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 21:12:20.366 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 41628 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 21:12:20.368 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 21:12:22.758 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 21:12:22.876 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1443539
2025-10-09 21:12:22.916 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 21:12:22.936 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 21:12:22.942 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 21:12:23.016 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 21:12:23.018 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 21:12:23.348 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 21:12:24.371 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 21:12:24.422 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 21:12:24.423 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 21:12:24.443 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 21:12:24.444 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 21:12:24.444 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 21:12:24.444 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 21:12:24.444 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 21:12:24.445 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 21:12:24.445 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 21:12:24.475 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 21:12:24.570 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 21:12:24.571 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 21:12:25.233 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 21:12:25.259 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 21:12:25.261 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 21:12:25.264 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 21:12:25.265 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 21:12:25.271 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 21:12:25.301 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 21:12:25.482 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 21:12:25.484 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 21:12:25.485 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 21:12:25.485 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 21:12:25.678 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 21:12:25.685 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 21:12:25.688 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 21:12:25.688 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 21:12:25.688 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 21:12:25.694 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 21:12:25.695 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 21:12:25.724 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 21:12:25.724 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 21:12:25.724 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 21:12:25.724 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 21:12:25.724 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 21:12:25.725 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 21:12:25.725 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 21:12:25.736 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 21:12:25.745 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 21:12:25.758 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 21:12:25.758 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 21:12:25.772 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 21:12:25.772 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 21:12:25.774 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 21:12:25.775 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 21:12:25.776 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 21:12:25.776 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 21:12:25.833 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 21:12:26.280 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 21:12:26.477 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 21:12:26.479 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 21:12:26.503 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 21:12:26.505 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 21:12:26.639 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 21:12:26.862 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 21:12:27.182 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 21:12:27.336 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 21:12:27.418 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 21:12:28.168 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.193 seconds (process running for 8.499)
2025-10-09 21:12:28.173 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 21:12:28.174 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 21:12:28.265 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 21:12:31.471 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=7
2025-10-09 21:12:31.491 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8d9a5c99, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=80ms
2025-10-09 21:12:33.890 [http-nio-8080-exec-5] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 19
2025-10-09 21:12:33.891 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 19
2025-10-09 21:12:33.918 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 21:12:33.944 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8dcc3e9f, method=GET, uri=/api/v1/knowledge-base/documents/19/chunks, status=200, duration=73ms
2025-10-09 21:12:59.540 [http-nio-8080-exec-3] INFO  c.r.L.c.KnowledgeBaseController - 管理员上传单个法律文档: 民事诉讼法.pdf
2025-10-09 21:12:59.540 [http-nio-8080-exec-4] INFO  c.r.L.c.KnowledgeBaseController - 管理员上传单个法律文档: 社会保险法.pdf
2025-10-09 21:12:59.558 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 开始上传文档到知识库 (使用EtlService): 民事诉讼法.pdf, 大小: 435705 bytes
2025-10-09 21:12:59.558 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 开始上传文档到知识库 (使用EtlService): 社会保险法.pdf, 大小: 204661 bytes
2025-10-09 21:12:59.558 [http-nio-8080-exec-3] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 民事诉讼法.pdf, 类型: pdf, 大小: 435705 bytes
2025-10-09 21:12:59.558 [http-nio-8080-exec-4] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 社会保险法.pdf, 类型: pdf, 大小: 204661 bytes
2025-10-09 21:13:00.040 [http-nio-8080-exec-4] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 社会保险法.pdf, 内容长度: 10888 字符
2025-10-09 21:13:00.044 [http-nio-8080-exec-4] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 10888 字符
2025-10-09 21:13:00.050 [http-nio-8080-exec-4] INFO  c.r.L.service.EtlService - 文本分块完成，生成 407 个文本块
2025-10-09 21:13:00.195 [http-nio-8080-exec-3] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 民事诉讼法.pdf, 内容长度: 37209 字符
2025-10-09 21:13:00.199 [http-nio-8080-exec-3] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 37209 字符
2025-10-09 21:13:00.202 [http-nio-8080-exec-3] INFO  c.r.L.service.EtlService - 文本分块完成，生成 424 个文本块
2025-10-09 21:13:11.428 [http-nio-8080-exec-4] INFO  c.r.L.service.EtlService - 文本内容处理完成，407 个向量块已存储
2025-10-09 21:13:11.474 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 文档保存到数据库成功：社会保险法.pdf
2025-10-09 21:13:11.475 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 文档上传完成 (EtlService): 社会保险法.pdf, 文档ID: 20, 块数: 407
2025-10-09 21:13:11.482 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8151c24c, method=POST, uri=/api/v1/knowledge-base/documents/upload-single, status=200, duration=11970ms
2025-10-09 21:13:14.098 [http-nio-8080-exec-3] INFO  c.r.L.service.EtlService - 文本内容处理完成，424 个向量块已存储
2025-10-09 21:13:14.104 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 文档保存到数据库成功：民事诉讼法.pdf
2025-10-09 21:13:14.105 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 文档上传完成 (EtlService): 民事诉讼法.pdf, 文档ID: 21, 块数: 424
2025-10-09 21:13:14.106 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=50be4ae2, method=POST, uri=/api/v1/knowledge-base/documents/upload-single, status=200, duration=14596ms
2025-10-09 21:13:14.153 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 21:13:14.154 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6f8ff9a7, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=8ms
2025-10-09 21:13:27.867 [http-nio-8080-exec-6] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 21
2025-10-09 21:13:27.868 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 21
2025-10-09 21:13:27.876 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 21:13:27.884 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4fed8408, method=GET, uri=/api/v1/knowledge-base/documents/21/chunks, status=200, duration=19ms
2025-10-09 21:13:36.312 [http-nio-8080-exec-7] INFO  c.r.L.c.KnowledgeBaseController - 管理员删除单个文档: 10
2025-10-09 21:13:36.314 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 开始删除文档: 10
2025-10-09 21:13:36.316 [http-nio-8080-exec-7] WARN  c.r.L.service.KnowledgeBaseService - 删除文档块功能需要根据具体的VectorStore实现来完成: F:\LegalAssistant\uploads\law\民事诉讼法.pdf
2025-10-09 21:13:36.343 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 文档删除成功: 民事诉讼法.pdf (ID: 10)
2025-10-09 21:13:36.351 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6e2dcee6, method=DELETE, uri=/api/v1/knowledge-base/documents/10, status=200, duration=41ms
2025-10-09 21:13:36.394 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 21:13:36.398 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=de229046, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=11ms
2025-10-09 21:13:45.154 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=81f0cd90, method=GET, uri=/api/v1/users, status=200, duration=7ms
2025-10-09 21:13:46.041 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bec608e0, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=45ms
2025-10-09 21:14:06.454 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=74f84d99, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=10ms
2025-10-09 21:14:28.337 [http-nio-8080-exec-5] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 21:14:28.369 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c5a94ab0, method=GET, uri=/api/v1/chat/sessions, status=200, duration=34ms
2025-10-09 21:14:28.385 [http-nio-8080-exec-4] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 21:14:28.395 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5f75f92e, method=GET, uri=/api/v1/chat/sessions, status=200, duration=11ms
2025-10-09 21:25:10.625 [http-nio-8080-exec-3] ERROR c.r.L.e.GlobalExceptionHandler - 未处理的异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource users/1/stats.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-09 21:25:10.630 [http-nio-8080-exec-3] ERROR c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2ebe4207, method=GET, uri=/api/v1/users/1/stats, status=500, duration=9ms
2025-10-09 21:26:02.844 [http-nio-8080-exec-2] ERROR c.r.L.e.GlobalExceptionHandler - 未处理的异常
org.springframework.web.servlet.resource.NoResourceFoundException: No static resource users/1/stats.
	at org.springframework.web.servlet.resource.ResourceHttpRequestHandler.handleRequest(ResourceHttpRequestHandler.java:585)
	at org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter.handle(HttpRequestHandlerAdapter.java:52)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-09 21:26:02.847 [http-nio-8080-exec-2] ERROR c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=71388762, method=GET, uri=/api/v1/users/1/stats, status=500, duration=4ms
2025-10-09 21:26:25.848 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 21:26:25.852 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 21:26:41.397 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 37064 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 21:26:41.399 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 21:26:43.914 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 21:26:44.038 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@8aafd70
2025-10-09 21:26:44.088 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 21:26:44.108 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 21:26:44.113 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 21:26:44.193 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 21:26:44.195 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 21:26:44.556 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 21:26:46.095 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 21:26:46.148 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 21:26:46.149 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 21:26:46.175 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 21:26:46.175 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 21:26:46.175 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 21:26:46.175 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 21:26:46.175 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 21:26:46.175 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 21:26:46.175 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 21:26:46.210 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 21:26:46.305 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 21:26:46.305 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 21:26:46.867 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 21:26:46.894 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 21:26:46.896 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 21:26:46.900 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 21:26:46.901 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 21:26:46.901 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 21:26:46.930 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 21:26:47.141 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 21:26:47.144 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 21:26:47.145 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 21:26:47.145 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 21:26:47.349 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 21:26:47.357 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 21:26:47.359 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 21:26:47.359 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 21:26:47.359 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 21:26:47.368 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 21:26:47.368 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 21:26:47.391 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 21:26:47.391 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 21:26:47.391 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 21:26:47.392 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 21:26:47.392 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 21:26:47.392 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 21:26:47.392 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 21:26:47.406 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 21:26:47.415 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 21:26:47.429 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 21:26:47.429 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 21:26:47.441 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 21:26:47.441 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 21:26:47.443 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 21:26:47.444 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 21:26:47.445 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 21:26:47.445 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 21:26:47.503 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 21:26:47.903 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 21:26:48.011 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 21:26:48.012 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 21:26:48.037 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 21:26:48.039 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 21:26:48.171 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 21:26:48.422 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 21:26:48.757 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 21:26:48.913 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 21:26:49.011 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 21:26:49.824 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.864 seconds (process running for 9.154)
2025-10-09 21:26:49.829 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 21:26:49.831 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 21:26:49.927 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 开始自动索引...
2025-10-09 21:26:49.927 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始批量索引目录: uploads/law, 递归: false
2025-10-09 21:26:49.928 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 发现 6 个文档待索引
2025-10-09 21:26:49.928 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\刑法.pdf
2025-10-09 21:26:49.929 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\刑法.pdf
2025-10-09 21:26:49.930 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\劳动法.pdf
2025-10-09 21:26:49.931 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\劳动法.pdf
2025-10-09 21:26:49.931 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\宪法.pdf
2025-10-09 21:26:49.933 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\宪法.pdf
2025-10-09 21:26:49.934 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\民事诉讼法.pdf
2025-10-09 21:26:53.311 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档索引完成: F:\LegalAssistant\uploads\law\民事诉讼法.pdf, 片段数: 20, 耗时: 3377ms
2025-10-09 21:26:53.311 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\民法典.pdf
2025-10-09 21:26:53.314 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\民法典.pdf
2025-10-09 21:26:53.314 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\环境保护法.pdf
2025-10-09 21:26:53.316 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\环境保护法.pdf
2025-10-09 21:26:53.316 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 批量索引完成: 总计 6 个文档, 成功 6 个, 生成 20 个片段, 耗时 3389ms
2025-10-09 21:26:53.317 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 自动索引完成 - 总文档: 6, 成功: 6, 总片段: 20, 耗时: 3389ms
2025-10-09 21:26:53.317 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 法律文档索引完成，AI聊天功能现在可以使用这些文档进行问答
2025-10-09 21:27:44.158 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3096260b, method=GET, uri=/api/v1/users/1/stats, status=200, duration=83ms
2025-10-09 21:27:54.762 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=14299eff, method=GET, uri=/api/v1/users/1/stats, status=200, duration=25ms
2025-10-09 21:28:00.043 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a99e34c4, method=GET, uri=/api/v1/users/1/stats, status=200, duration=21ms
2025-10-09 21:28:03.267 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=34694121, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=36ms
2025-10-09 21:28:04.428 [http-nio-8080-exec-5] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 21:28:04.442 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7770e512, method=GET, uri=/api/v1/chat/sessions, status=200, duration=15ms
2025-10-09 21:28:04.455 [http-nio-8080-exec-6] WARN  c.r.L.filter.RateLimitFilter - [RATE_LIMIT] 请求速率超限: ip=0:0:0:0:0:0:0:1, uri=/api/v1/chat/sessions
2025-10-09 21:28:04.457 [http-nio-8080-exec-6] WARN  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ebdd6f9d, method=GET, uri=/api/v1/chat/sessions, status=429, duration=2ms
2025-10-09 21:28:24.917 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d911c509, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=8ms
2025-10-09 21:28:35.771 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 21:28:35.775 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f4ee13b7, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=17ms
2025-10-09 21:28:37.013 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=66982dd9, method=GET, uri=/api/v1/users, status=200, duration=8ms
2025-10-09 21:29:31.630 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=acf5bc75, method=GET, uri=/api/v1/users/1/stats, status=200, duration=17ms
2025-10-09 21:31:35.782 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b6b17830, method=GET, uri=/api/v1/users/1/stats, status=200, duration=13ms
2025-10-09 21:31:45.041 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=50f42bf9, method=GET, uri=/api/v1/users/1/stats, status=200, duration=12ms
2025-10-09 21:31:47.897 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a629e2dd, method=GET, uri=/api/v1/users/1/stats, status=200, duration=15ms
2025-10-09 21:32:47.713 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=036b2d3e, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=13ms
2025-10-09 21:33:54.340 [http-nio-8080-exec-5] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 21:33:54.347 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bd992573, method=GET, uri=/api/v1/chat/sessions, status=200, duration=8ms
2025-10-09 21:33:54.357 [http-nio-8080-exec-6] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 21:33:54.365 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d5e02430, method=GET, uri=/api/v1/chat/sessions, status=200, duration=8ms
2025-10-09 21:34:02.465 [http-nio-8080-exec-7] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760001698021_5otmhft6h 的消息
2025-10-09 21:34:02.476 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9fde30d2, method=GET, uri=/api/v1/chat/sessions/session_1760001698021_5otmhft6h, status=200, duration=16ms
2025-10-09 21:35:09.514 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4087e5be, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=9ms
2025-10-09 21:35:25.500 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e8ea558d, method=GET, uri=/api/v1/users/1/stats, status=200, duration=12ms
2025-10-09 21:41:05.111 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 38284 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 21:41:05.112 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 21:41:07.374 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 21:41:07.507 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@54d2887a
2025-10-09 21:41:07.563 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 21:41:07.580 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 21:41:07.586 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 21:41:07.662 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 21:41:07.665 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 21:41:08.058 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 21:41:09.481 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 21:41:09.532 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 21:41:09.533 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 21:41:09.555 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 21:41:09.555 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 21:41:09.556 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 21:41:09.556 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 21:41:09.556 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 21:41:09.556 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 21:41:09.556 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 21:41:09.584 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 21:41:09.710 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 21:41:09.710 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 21:41:10.232 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 21:41:10.258 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 21:41:10.261 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 21:41:10.264 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 21:41:10.265 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 21:41:10.267 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 21:41:10.293 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 21:41:10.464 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 21:41:10.466 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 21:41:10.467 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 21:41:10.467 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 21:41:10.651 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 21:41:10.657 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 21:41:10.659 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 21:41:10.659 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 21:41:10.659 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 21:41:10.665 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 21:41:10.665 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 21:41:10.688 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 21:41:10.688 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 21:41:10.688 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 21:41:10.688 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 21:41:10.688 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 21:41:10.689 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 21:41:10.689 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 21:41:10.700 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 21:41:10.709 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 21:41:10.722 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 21:41:10.722 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 21:41:10.733 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 21:41:10.734 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 21:41:10.737 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 21:41:10.737 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 21:41:10.739 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 21:41:10.739 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 21:41:10.796 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 21:41:11.177 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 21:41:11.292 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 21:41:11.294 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 21:41:11.317 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 21:41:11.318 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 21:41:11.456 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 21:41:11.692 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 21:41:11.984 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 21:41:12.124 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 21:41:12.207 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 21:41:13.008 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.286 seconds (process running for 8.543)
2025-10-09 21:41:13.014 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 21:41:13.016 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 21:41:13.112 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 21:41:17.006 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f4714bb4, method=GET, uri=/api/v1/users/1/stats, status=200, duration=127ms
2025-10-09 21:41:17.986 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0da41cf9, method=GET, uri=/api/v1/users/1/stats, status=200, duration=22ms
2025-10-09 21:41:19.663 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7f095343, method=GET, uri=/api/v1/users/1/stats, status=200, duration=17ms
2025-10-09 21:42:01.695 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b5dd9e23, method=GET, uri=/api/v1/users/1/stats, status=200, duration=18ms
2025-10-09 21:42:35.921 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7aeae28e, method=GET, uri=/api/v1/users/1/stats, status=200, duration=12ms
2025-10-09 21:42:36.272 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3fe7439d, method=GET, uri=/api/v1/users/1/stats, status=200, duration=12ms
2025-10-09 21:42:37.586 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b18000da, method=GET, uri=/api/v1/users/1/stats, status=200, duration=9ms
2025-10-09 21:42:38.137 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2b0740a2, method=GET, uri=/api/v1/users/1/stats, status=200, duration=10ms
2025-10-09 21:42:51.574 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fee4cff0, method=GET, uri=/api/v1/users/1/stats, status=200, duration=9ms
2025-10-09 21:42:52.126 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8dc2d15e, method=GET, uri=/api/v1/users/1/stats, status=200, duration=9ms
2025-10-09 21:42:52.681 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=80e8fb87, method=GET, uri=/api/v1/users/1/stats, status=200, duration=9ms
2025-10-09 21:42:53.296 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f467cd55, method=GET, uri=/api/v1/users/1/stats, status=200, duration=8ms
2025-10-09 21:42:53.863 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=755fc13c, method=GET, uri=/api/v1/users/1/stats, status=200, duration=8ms
2025-10-09 21:42:54.313 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9dca253e, method=GET, uri=/api/v1/users/1/stats, status=200, duration=8ms
2025-10-09 21:42:54.685 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b87cdc62, method=GET, uri=/api/v1/users/1/stats, status=200, duration=10ms
2025-10-09 21:42:55.192 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=439f7b36, method=GET, uri=/api/v1/users/1/stats, status=200, duration=12ms
2025-10-09 21:42:55.502 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7f3b5ee7, method=GET, uri=/api/v1/users/1/stats, status=200, duration=11ms
2025-10-09 21:42:55.804 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b729ed3c, method=GET, uri=/api/v1/users/1/stats, status=200, duration=11ms
2025-10-09 21:42:57.118 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=494e30b1, method=GET, uri=/api/v1/users/1/stats, status=200, duration=11ms
2025-10-09 21:43:48.502 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1a66289c, method=GET, uri=/api/v1/users/1/stats, status=200, duration=10ms
2025-10-09 21:43:49.236 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=05ac9e08, method=GET, uri=/api/v1/users/1/stats, status=200, duration=10ms
2025-10-09 21:43:49.896 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=38cf01e6, method=GET, uri=/api/v1/users/1/stats, status=200, duration=10ms
2025-10-09 21:43:50.635 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9af01fb2, method=GET, uri=/api/v1/users/1/stats, status=200, duration=7ms
2025-10-09 21:44:50.901 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b6760f38, method=GET, uri=/api/v1/users/1/stats, status=200, duration=9ms
2025-10-09 21:44:51.760 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=eeee83ab, method=GET, uri=/api/v1/users/1/stats, status=200, duration=9ms
2025-10-09 21:44:58.565 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ff0401e5, method=GET, uri=/api/v1/users/1/stats, status=200, duration=9ms
2025-10-09 21:44:59.084 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1936a526, method=GET, uri=/api/v1/users/1/stats, status=200, duration=8ms
2025-10-09 21:45:01.373 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e7f0944f, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=24ms
2025-10-09 21:45:05.952 [http-nio-8080-exec-3] INFO  c.r.L.c.AuthenticationController - 用户登出
2025-10-09 21:45:05.956 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7c15c415, method=POST, uri=/api/v1/auth/logout, status=200, duration=4ms
2025-10-09 21:45:11.023 [http-nio-8080-exec-10] INFO  c.r.L.c.AuthenticationController - 用户登录请求: admin
2025-10-09 21:45:11.186 [http-nio-8080-exec-10] INFO  c.r.L.c.AuthenticationController - 用户 admin 登录成功
2025-10-09 21:45:11.191 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=92931a5f, method=POST, uri=/api/v1/auth/login, status=200, duration=182ms
2025-10-09 21:45:11.307 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=48810300, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=10ms
2025-10-09 21:45:15.915 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f06f8c45, method=GET, uri=/api/v1/users/1/stats, status=200, duration=14ms
2025-10-09 21:45:53.380 [http-nio-8080-exec-2] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 21:45:53.398 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a561d6df, method=GET, uri=/api/v1/chat/sessions, status=200, duration=20ms
2025-10-09 21:45:53.408 [http-nio-8080-exec-4] WARN  c.r.L.filter.RateLimitFilter - [RATE_LIMIT] 请求速率超限: ip=0:0:0:0:0:0:0:1, uri=/api/v1/chat/sessions
2025-10-09 21:45:53.410 [http-nio-8080-exec-4] WARN  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c9e818d9, method=GET, uri=/api/v1/chat/sessions, status=429, duration=2ms
2025-10-09 21:46:31.832 [http-nio-8080-exec-7] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 21:46:31.837 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=eab62585, method=GET, uri=/api/v1/chat/sessions, status=200, duration=6ms
2025-10-09 21:46:31.847 [http-nio-8080-exec-6] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 21:46:31.851 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6412b254, method=GET, uri=/api/v1/chat/sessions, status=200, duration=5ms
2025-10-09 21:47:11.959 [http-nio-8080-exec-8] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760001698021_5otmhft6h 的消息
2025-10-09 21:47:11.966 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=16014002, method=GET, uri=/api/v1/chat/sessions/session_1760001698021_5otmhft6h, status=200, duration=18ms
2025-10-09 21:47:15.721 [http-nio-8080-exec-9] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760001698021_5otmhft6h 的消息
2025-10-09 21:47:15.727 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4580b374, method=GET, uri=/api/v1/chat/sessions/session_1760001698021_5otmhft6h, status=200, duration=7ms
2025-10-09 21:48:31.852 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e3e9d744, method=GET, uri=/api/v1/users/1/stats, status=200, duration=9ms
2025-10-09 21:48:37.342 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=beb319d6, method=GET, uri=/api/v1/users/1/stats, status=200, duration=11ms
2025-10-09 21:48:43.566 [http-nio-8080-exec-1] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 21:48:43.571 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fe7f7ad3, method=GET, uri=/api/v1/chat/sessions, status=200, duration=6ms
2025-10-09 21:48:43.581 [http-nio-8080-exec-5] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 21:48:43.586 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=db81c5f4, method=GET, uri=/api/v1/chat/sessions, status=200, duration=7ms
2025-10-09 21:48:46.219 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b4847f7f, method=GET, uri=/api/v1/users, status=200, duration=8ms
2025-10-09 21:49:09.411 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e2b27cee, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=7ms
2025-10-09 21:49:11.672 [http-nio-8080-exec-7] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760001698021_5otmhft6h 的消息
2025-10-09 21:49:11.675 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=970a18fd, method=GET, uri=/api/v1/chat/sessions/session_1760001698021_5otmhft6h, status=200, duration=4ms
2025-10-09 21:50:39.573 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=000b6541, method=GET, uri=/api/v1/users/1/stats, status=200, duration=9ms
2025-10-09 21:50:48.242 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f1269203, method=GET, uri=/api/v1/users/1/stats, status=200, duration=13ms
2025-10-09 21:51:07.191 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f0d2b8ee, method=GET, uri=/api/v1/users/1/stats, status=200, duration=9ms
2025-10-09 21:51:19.045 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4693e47a, method=GET, uri=/api/v1/users/1/stats, status=200, duration=14ms
2025-10-09 21:51:22.406 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3e16d4c0, method=GET, uri=/api/v1/users/1/stats, status=200, duration=11ms
2025-10-09 21:51:24.221 [http-nio-8080-exec-1] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 21:51:24.227 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9a4280b6, method=GET, uri=/api/v1/chat/sessions, status=200, duration=6ms
2025-10-09 21:51:24.233 [http-nio-8080-exec-5] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 21:51:24.235 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c16230d5, method=GET, uri=/api/v1/chat/sessions, status=200, duration=3ms
2025-10-09 21:51:25.297 [http-nio-8080-exec-2] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760001698021_5otmhft6h 的消息
2025-10-09 21:51:25.302 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ee21ff19, method=GET, uri=/api/v1/chat/sessions/session_1760001698021_5otmhft6h, status=200, duration=6ms
2025-10-09 21:51:53.800 [http-nio-8080-exec-4] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760001698021_5otmhft6h 的消息
2025-10-09 21:51:53.804 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=98bebbab, method=GET, uri=/api/v1/chat/sessions/session_1760001698021_5otmhft6h, status=200, duration=5ms
2025-10-09 21:51:54.807 [http-nio-8080-exec-7] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760001698021_5otmhft6h 的消息
2025-10-09 21:51:54.811 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e904d8ca, method=GET, uri=/api/v1/chat/sessions/session_1760001698021_5otmhft6h, status=200, duration=5ms
2025-10-09 21:51:55.324 [http-nio-8080-exec-6] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760001698021_5otmhft6h 的消息
2025-10-09 21:51:55.328 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3c8db17e, method=GET, uri=/api/v1/chat/sessions/session_1760001698021_5otmhft6h, status=200, duration=5ms
2025-10-09 21:51:58.842 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=47692daf, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=9ms
2025-10-09 21:55:10.966 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=19898122, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=5ms
2025-10-09 21:55:16.537 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=33279911, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=7ms
2025-10-09 21:58:38.659 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 21:58:38.663 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 22:01:12.289 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 20040 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 22:01:12.291 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 22:01:14.627 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 22:01:14.771 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@7ca0b05e
2025-10-09 22:01:14.825 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 22:01:14.855 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 22:01:14.860 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 22:01:14.942 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 22:01:14.945 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 22:01:15.368 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 22:01:16.836 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 22:01:16.897 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 22:01:16.898 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 22:01:16.921 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 22:01:16.921 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 22:01:16.921 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 22:01:16.922 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 22:01:16.922 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 22:01:16.922 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 22:01:16.922 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 22:01:16.954 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 22:01:17.075 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 22:01:17.076 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 22:01:17.532 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 22:01:17.561 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 22:01:17.563 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 22:01:17.567 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 22:01:17.567 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 22:01:17.568 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 22:01:17.598 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 22:01:17.761 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 22:01:17.763 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 22:01:17.764 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 22:01:17.764 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 22:01:17.941 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 22:01:17.947 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 22:01:17.949 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 22:01:17.949 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 22:01:17.949 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 22:01:17.955 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 22:01:17.956 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 22:01:17.983 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 22:01:17.984 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 22:01:17.984 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 22:01:17.984 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 22:01:17.984 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 22:01:17.984 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 22:01:17.984 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 22:01:17.997 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 22:01:18.005 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 22:01:18.018 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 22:01:18.019 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 22:01:18.030 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 22:01:18.030 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 22:01:18.033 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 22:01:18.033 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 22:01:18.036 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 22:01:18.036 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 22:01:18.087 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 22:01:18.503 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 22:01:18.604 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 22:01:18.605 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 22:01:18.627 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 22:01:18.629 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 22:01:18.768 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 22:01:18.969 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 22:01:19.260 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 22:01:19.400 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 22:01:19.480 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 22:01:20.239 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.349 seconds (process running for 8.607)
2025-10-09 22:01:20.245 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 22:01:20.246 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 22:01:20.338 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 22:01:26.070 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ba7e527d, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=106ms
2025-10-09 22:01:27.255 [http-nio-8080-exec-6] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 22:01:27.278 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=67814b77, method=GET, uri=/api/v1/chat/sessions, status=200, duration=31ms
2025-10-09 22:01:27.291 [http-nio-8080-exec-2] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 22:01:27.301 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c4b145db, method=GET, uri=/api/v1/chat/sessions, status=200, duration=11ms
2025-10-09 22:01:28.441 [http-nio-8080-exec-4] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760001698021_5otmhft6h 的消息
2025-10-09 22:01:28.453 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bd25c1d4, method=GET, uri=/api/v1/chat/sessions/session_1760001698021_5otmhft6h, status=200, duration=19ms
2025-10-09 22:01:31.151 [http-nio-8080-exec-5] INFO  c.r.L.service.ChatHistoryService - 用户 1 删除会话 session_1760001698021_5otmhft6h
2025-10-09 22:01:31.188 [http-nio-8080-exec-5] INFO  c.r.L.service.ChatHistoryService - 会话 session_1760001698021_5otmhft6h 已删除
2025-10-09 22:01:31.238 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3f6b2c01, method=DELETE, uri=/api/v1/chat/sessions/session_1760001698021_5otmhft6h, status=200, duration=89ms
2025-10-09 22:01:46.154 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=请你告诉我三方协议是什么, modelType=UNIFIED
2025-10-09 22:01:46.156 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-09 22:01:46.186 [http-nio-8080-exec-7] INFO  c.r.L.service.ChatHistoryService - 创建新会话: sessionId=session_1760018506076_0uolseobk, userId=1, title=请你告诉我三方协议是什么
2025-10-09 22:01:46.219 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 使用统一模式进行流式处理
2025-10-09 22:01:46.219 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 统一流式模式路由到 -> Advanced Agent (默认)
2025-10-09 22:01:46.222 [Async-1] INFO  c.r.L.service.AgentService - 🚀 开始流式法律咨询处理: question='请你告诉我三方协议是什么', length=12
2025-10-09 22:01:46.222 [Async-1] INFO  c.r.L.service.AgentService - 使用高级流式模型进行推送
2025-10-09 22:01:46.222 [Async-1] INFO  c.r.L.service.AgentService - 📡 开始使用流式模型处理: model=OpenAiStreamingChatModel
2025-10-09 22:01:46.228 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c288045b, method=POST, uri=/api/v1/chat/stream, status=200, duration=136ms
2025-10-09 22:02:54.362 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 流式响应完成，总长度: 3022
2025-10-09 22:02:54.374 [http-nio-8080-exec-8] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-09 22:02:54.405 [http-nio-8080-exec-9] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 22:02:54.411 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cb87baf1, method=GET, uri=/api/v1/chat/sessions, status=200, duration=7ms
2025-10-09 22:02:56.464 [http-nio-8080-exec-3] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760018506076_0uolseobk 的消息
2025-10-09 22:02:56.471 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1809c2b8, method=GET, uri=/api/v1/chat/sessions/session_1760018506076_0uolseobk, status=200, duration=8ms
2025-10-09 22:02:57.353 [http-nio-8080-exec-10] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760018506076_0uolseobk 的消息
2025-10-09 22:02:57.359 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e2960aee, method=GET, uri=/api/v1/chat/sessions/session_1760018506076_0uolseobk, status=200, duration=7ms
2025-10-09 22:03:00.165 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8072ae8e, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=13ms
2025-10-09 22:03:11.458 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=766000fe, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=11ms
2025-10-09 22:03:18.235 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7b28a2d5, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=7ms
2025-10-09 22:03:22.894 [http-nio-8080-exec-4] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 22:03:22.899 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d58d53ce, method=GET, uri=/api/v1/chat/sessions, status=200, duration=6ms
2025-10-09 22:03:22.910 [http-nio-8080-exec-5] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 22:03:22.916 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7af64665, method=GET, uri=/api/v1/chat/sessions, status=200, duration=7ms
2025-10-09 22:03:24.206 [http-nio-8080-exec-7] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760018506076_0uolseobk 的消息
2025-10-09 22:03:24.211 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ed0c2c19, method=GET, uri=/api/v1/chat/sessions/session_1760018506076_0uolseobk, status=200, duration=7ms
2025-10-09 22:07:21.378 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ecf19189, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=7ms
2025-10-09 22:07:33.241 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a663fc8d, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=9ms
2025-10-09 22:07:39.936 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b8d439fd, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=6ms
2025-10-09 22:08:40.146 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=37fe8f91, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=6ms
2025-10-09 22:08:52.193 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 22:08:52.197 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 22:09:07.472 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 34676 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 22:09:07.474 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 22:09:10.114 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 22:09:10.284 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1443539
2025-10-09 22:09:10.336 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 22:09:10.354 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 22:09:10.360 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 22:09:10.440 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 22:09:10.442 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 22:09:10.896 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 22:09:12.467 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 22:09:12.517 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 22:09:12.519 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 22:09:12.540 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 22:09:12.540 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 22:09:12.540 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 22:09:12.541 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 22:09:12.541 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 22:09:12.541 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 22:09:12.541 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 22:09:12.571 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 22:09:12.698 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 22:09:12.699 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 22:09:13.159 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 22:09:13.199 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 22:09:13.201 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 22:09:13.206 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 22:09:13.207 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 22:09:13.208 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 22:09:13.241 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 22:09:13.432 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 22:09:13.435 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 22:09:13.435 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 22:09:13.435 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 22:09:13.637 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 22:09:13.644 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 22:09:13.647 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 22:09:13.647 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 22:09:13.647 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 22:09:13.654 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 22:09:13.655 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 22:09:13.681 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 22:09:13.682 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 22:09:13.682 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 22:09:13.682 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 22:09:13.682 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 22:09:13.682 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 22:09:13.683 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 22:09:13.696 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 22:09:13.704 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 22:09:13.717 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 22:09:13.718 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 22:09:13.730 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 22:09:13.730 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 22:09:13.733 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 22:09:13.733 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 22:09:13.736 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 22:09:13.736 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 22:09:13.792 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 22:09:14.234 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 22:09:14.346 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 22:09:14.348 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 22:09:14.373 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 22:09:14.375 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 22:09:14.513 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 22:09:14.737 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 22:09:15.074 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 22:09:15.249 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 22:09:15.336 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 22:09:16.229 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.174 seconds (process running for 9.454)
2025-10-09 22:09:16.236 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 22:09:16.237 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 22:09:16.358 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 22:09:19.294 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=72d5b9d7, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=85ms
2025-10-09 22:09:21.349 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - 删除审查记录: 14
2025-10-09 22:09:21.430 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 删除了审查记录 14
2025-10-09 22:09:21.432 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=35f3d691, method=DELETE, uri=/api/v1/contracts/14, status=200, duration=111ms
2025-10-09 22:09:22.740 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - 删除审查记录: 13
2025-10-09 22:09:22.763 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 删除了审查记录 13
2025-10-09 22:09:22.766 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ac040afa, method=DELETE, uri=/api/v1/contracts/13, status=200, duration=37ms
2025-10-09 22:09:24.251 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c95f3ef0, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=7ms
2025-10-09 22:09:28.830 [http-nio-8080-exec-5] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 22:09:28.850 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1976249e, method=GET, uri=/api/v1/chat/sessions, status=200, duration=21ms
2025-10-09 22:09:28.861 [http-nio-8080-exec-6] WARN  c.r.L.filter.RateLimitFilter - [RATE_LIMIT] 请求速率超限: ip=0:0:0:0:0:0:0:1, uri=/api/v1/chat/sessions
2025-10-09 22:09:28.863 [http-nio-8080-exec-6] WARN  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bb218b7d, method=GET, uri=/api/v1/chat/sessions, status=429, duration=2ms
2025-10-09 22:10:19.935 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d86a7ae5, method=GET, uri=/api/v1/users, status=200, duration=7ms
2025-10-09 22:10:20.884 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 22:10:20.888 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d9ed39ba, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=14ms
2025-10-09 22:11:26.153 [http-nio-8080-exec-9] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 22:11:26.158 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=051c1f8d, method=GET, uri=/api/v1/chat/sessions, status=200, duration=6ms
2025-10-09 22:12:22.913 [http-nio-8080-exec-10] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 22:12:22.917 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=417d407e, method=GET, uri=/api/v1/chat/sessions, status=200, duration=4ms
2025-10-09 22:12:38.100 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 22:12:38.103 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 22:12:53.647 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 10688 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 22:12:53.649 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 22:12:56.218 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 22:12:56.379 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5d8112e6
2025-10-09 22:12:56.453 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 22:12:56.481 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 22:12:56.506 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 22:12:56.594 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 22:12:56.597 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 22:12:57.001 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 22:12:58.517 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 22:12:58.597 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 22:12:58.598 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 22:12:58.627 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 22:12:58.627 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 22:12:58.627 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 22:12:58.627 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 22:12:58.628 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 22:12:58.628 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 22:12:58.628 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 22:12:58.666 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 22:12:58.769 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 22:12:58.770 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 22:12:59.250 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 22:12:59.280 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 22:12:59.282 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 22:12:59.286 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 22:12:59.288 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 22:12:59.289 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 22:12:59.321 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 22:12:59.523 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 22:12:59.525 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 22:12:59.525 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 22:12:59.525 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 22:12:59.734 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 22:12:59.743 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 22:12:59.745 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 22:12:59.745 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 22:12:59.745 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 22:12:59.753 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 22:12:59.753 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 22:12:59.780 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 22:12:59.781 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 22:12:59.781 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 22:12:59.781 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 22:12:59.781 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 22:12:59.781 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 22:12:59.782 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 22:12:59.794 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 22:12:59.803 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 22:12:59.815 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 22:12:59.816 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 22:12:59.833 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 22:12:59.833 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 22:12:59.836 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 22:12:59.836 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 22:12:59.837 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 22:12:59.837 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 22:12:59.893 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 22:13:00.336 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 22:13:00.454 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 22:13:00.457 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 22:13:00.484 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 22:13:00.486 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 22:13:00.620 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 22:13:00.850 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 22:13:01.236 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 22:13:01.432 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 22:13:01.540 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 22:13:02.485 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.289 seconds (process running for 9.606)
2025-10-09 22:13:02.491 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 22:13:02.492 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 22:13:02.596 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 22:13:07.721 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e5911e76, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=68ms
2025-10-09 22:13:09.801 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=dfb76974, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=12ms
2025-10-09 22:13:13.034 [http-nio-8080-exec-3] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 22:13:13.066 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0dd84963, method=GET, uri=/api/v1/chat/sessions, status=200, duration=41ms
2025-10-09 22:13:14.211 [http-nio-8080-exec-6] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760018506076_0uolseobk 的消息
2025-10-09 22:13:14.237 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=19b05841, method=GET, uri=/api/v1/chat/sessions/session_1760018506076_0uolseobk, status=200, duration=33ms
2025-10-09 22:13:29.134 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 22:13:29.138 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=36ad1c90, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=26ms
2025-10-09 22:13:53.598 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7dfb1a5e, method=GET, uri=/api/v1/users, status=200, duration=5ms
2025-10-09 22:19:25.791 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=427feb89, method=GET, uri=/api/v1/users, status=200, duration=7ms
2025-10-09 22:20:15.638 [http-nio-8080-exec-7] INFO  c.r.L.service.UserService - 创建新用户: river
2025-10-09 22:20:15.645 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3c7e5a50, method=POST, uri=/api/v1/users/register, status=200, duration=218ms
2025-10-09 22:20:15.719 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c7bf9de7, method=GET, uri=/api/v1/users, status=200, duration=13ms
2025-10-09 22:20:30.522 [http-nio-8080-exec-2] INFO  c.r.L.service.UserService - 用户 user2 状态更新为: 禁用
2025-10-09 22:20:30.557 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7e5d28ad, method=POST, uri=/api/v1/users/3/toggle-status, status=200, duration=60ms
2025-10-09 22:20:30.604 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=90782d9f, method=GET, uri=/api/v1/users, status=200, duration=10ms
2025-10-09 22:20:52.428 [http-nio-8080-exec-10] INFO  c.r.L.service.UserService - 用户 user2 状态更新为: 禁用
2025-10-09 22:20:52.430 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2d1e7e9a, method=POST, uri=/api/v1/users/3/toggle-status, status=200, duration=9ms
2025-10-09 22:20:52.489 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cd79668c, method=GET, uri=/api/v1/users, status=200, duration=14ms
2025-10-09 22:21:15.401 [http-nio-8080-exec-6] INFO  c.r.L.service.UserService - 用户 user2 状态更新为: 启用
2025-10-09 22:21:15.413 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=860672f1, method=POST, uri=/api/v1/users/3/toggle-status, status=200, duration=14ms
2025-10-09 22:25:44.517 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 22:25:44.521 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-09 22:26:12.406 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 2896 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-09 22:26:12.408 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-09 22:26:15.041 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-09 22:26:15.170 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5d8112e6
2025-10-09 22:26:15.218 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-09 22:26:15.238 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-09 22:26:15.245 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-09 22:26:15.341 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-09 22:26:15.343 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-09 22:26:15.760 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-09 22:26:17.334 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-09 22:26:17.413 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-09 22:26:17.414 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-09 22:26:17.438 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-09 22:26:17.439 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-09 22:26:17.439 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-09 22:26:17.439 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-09 22:26:17.439 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-09 22:26:17.439 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-09 22:26:17.439 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-09 22:26:17.473 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-09 22:26:17.575 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-09 22:26:17.575 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-09 22:26:18.061 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-09 22:26:18.093 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-09 22:26:18.094 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-09 22:26:18.100 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-09 22:26:18.101 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-09 22:26:18.101 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-09 22:26:18.132 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-09 22:26:18.335 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-09 22:26:18.337 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-09 22:26:18.338 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-09 22:26:18.338 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-09 22:26:18.545 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-09 22:26:18.553 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-09 22:26:18.555 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-09 22:26:18.555 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-09 22:26:18.555 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-09 22:26:18.563 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-09 22:26:18.564 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-09 22:26:18.589 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-09 22:26:18.589 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-09 22:26:18.589 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-09 22:26:18.589 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-09 22:26:18.590 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-09 22:26:18.590 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-09 22:26:18.590 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-09 22:26:18.604 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-09 22:26:18.613 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-09 22:26:18.626 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-09 22:26:18.627 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-09 22:26:18.637 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-09 22:26:18.638 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-09 22:26:18.640 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-09 22:26:18.640 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-09 22:26:18.642 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-09 22:26:18.642 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-09 22:26:18.699 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-09 22:26:19.126 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-09 22:26:19.254 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-09 22:26:19.257 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-09 22:26:19.292 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-09 22:26:19.293 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-09 22:26:19.421 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-09 22:26:19.643 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-09 22:26:19.975 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-09 22:26:20.155 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-09 22:26:20.259 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-09 22:26:21.160 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.213 seconds (process running for 9.497)
2025-10-09 22:26:21.167 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-09 22:26:21.168 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-09 22:26:21.264 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-09 22:26:26.336 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=332dc933, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=73ms
2025-10-09 22:26:28.066 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=86043a54, method=GET, uri=/api/v1/users, status=200, duration=21ms
2025-10-09 22:26:30.783 [http-nio-8080-exec-2] INFO  c.r.L.service.UserService - 删除用户 user2 的 0 个聊天会话
2025-10-09 22:26:30.789 [http-nio-8080-exec-2] INFO  c.r.L.service.UserService - 保留用户 user2 的 0 个合同审查记录（用户引用已移除）
2025-10-09 22:26:30.803 [http-nio-8080-exec-2] INFO  c.r.L.service.UserService - 已删除用户: user2
2025-10-09 22:26:30.847 [http-nio-8080-exec-2] INFO  c.r.L.controller.UserController - 管理员 admin 删除了用户 3
2025-10-09 22:26:30.871 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ca7cd7be, method=DELETE, uri=/api/v1/users/3, status=200, duration=141ms
2025-10-09 22:26:30.937 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cadaed99, method=GET, uri=/api/v1/users, status=200, duration=7ms
2025-10-09 22:26:44.090 [http-nio-8080-exec-5] INFO  c.r.L.service.UserService - 删除用户 user1 的 0 个聊天会话
2025-10-09 22:26:44.095 [http-nio-8080-exec-5] INFO  c.r.L.service.UserService - 保留用户 user1 的 0 个合同审查记录（用户引用已移除）
2025-10-09 22:26:44.096 [http-nio-8080-exec-5] INFO  c.r.L.service.UserService - 已删除用户: user1
2025-10-09 22:26:44.108 [http-nio-8080-exec-5] INFO  c.r.L.controller.UserController - 管理员 admin 删除了用户 4
2025-10-09 22:26:44.111 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=69c2c311, method=DELETE, uri=/api/v1/users/4, status=200, duration=34ms
2025-10-09 22:26:44.138 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=08029329, method=GET, uri=/api/v1/users, status=200, duration=6ms
2025-10-09 22:26:47.642 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-09 22:26:47.645 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=15a3b617, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=18ms
2025-10-09 22:27:28.217 [http-nio-8080-exec-8] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 22
2025-10-09 22:27:28.219 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 22
2025-10-09 22:27:28.235 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 22:27:28.249 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7f1d6601, method=GET, uri=/api/v1/knowledge-base/documents/22/chunks, status=200, duration=44ms
2025-10-09 22:27:31.922 [http-nio-8080-exec-3] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 22
2025-10-09 22:27:31.923 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 22
2025-10-09 22:27:31.929 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 22:27:31.939 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9019c899, method=GET, uri=/api/v1/knowledge-base/documents/22/chunks, status=200, duration=19ms
2025-10-09 22:27:34.505 [http-nio-8080-exec-10] INFO  c.r.L.c.KnowledgeBaseController - 管理员删除单个文档: 22
2025-10-09 22:27:34.507 [http-nio-8080-exec-10] INFO  c.r.L.service.KnowledgeBaseService - 开始删除文档: 22
2025-10-09 22:27:34.511 [http-nio-8080-exec-10] WARN  c.r.L.service.KnowledgeBaseService - 删除文档块功能需要根据具体的VectorStore实现来完成: F:\LegalAssistant\uploads\law\民事诉讼法.pdf
2025-10-09 22:27:34.517 [http-nio-8080-exec-10] INFO  c.r.L.service.KnowledgeBaseService - 文档删除成功: 民事诉讼法.pdf (ID: 22)
2025-10-09 22:27:34.537 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a8e5febf, method=DELETE, uri=/api/v1/knowledge-base/documents/22, status=200, duration=32ms
2025-10-09 22:27:34.614 [http-nio-8080-exec-1] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 22:27:34.619 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=abd1e681, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=28ms
2025-10-09 22:27:52.765 [http-nio-8080-exec-7] INFO  c.r.L.c.KnowledgeBaseController - 管理员请求重新处理文档: 9
2025-10-09 22:27:52.768 [http-nio-8080-exec-7] INFO  c.r.L.service.KnowledgeBaseService - 开始重新处理文档: 9
2025-10-09 22:27:52.774 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=94eea239, method=POST, uri=/api/v1/knowledge-base/documents/9/reprocess, status=200, duration=14ms
2025-10-09 22:27:52.782 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.KnowledgeBaseService - 找到文档: 宪法.pdf, 开始重新处理
2025-10-09 22:27:52.782 [ForkJoinPool.commonPool-worker-2] WARN  c.r.L.service.KnowledgeBaseService - 删除文档块功能需要根据具体的VectorStore实现来完成: F:\LegalAssistant\uploads\law\宪法.pdf
2025-10-09 22:27:52.782 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.KnowledgeBaseService - 删除文档旧的向量数据: F:\LegalAssistant\uploads\law\宪法.pdf
2025-10-09 22:27:52.782 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 2003 字符
2025-10-09 22:27:52.788 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.EtlService - 文本分块完成，生成 402 个文本块
2025-10-09 22:27:54.834 [http-nio-8080-exec-2] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 22:27:54.836 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=255117ca, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=9ms
2025-10-09 22:27:57.447 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 22:27:57.449 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=05542438, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=9ms
2025-10-09 22:28:01.234 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.EtlService - 文本内容处理完成，402 个向量块已存储
2025-10-09 22:28:01.251 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.KnowledgeBaseService - 文档重新处理成功: 宪法.pdf, 新的块数: 402
2025-10-09 22:28:30.577 [http-nio-8080-exec-5] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-09 22:28:30.578 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a7cf3eac, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=8ms
2025-10-09 22:28:39.836 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1717a08f, method=GET, uri=/api/v1/users, status=200, duration=7ms
2025-10-09 22:28:41.369 [http-nio-8080-exec-9] INFO  c.r.L.c.KnowledgeBaseController - 管理员获取文档向量块: 20
2025-10-09 22:28:41.370 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 获取文档向量块信息: 20
2025-10-09 22:28:41.388 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 获取到 103 个向量块
2025-10-09 22:28:41.394 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a673e430, method=GET, uri=/api/v1/knowledge-base/documents/20/chunks, status=200, duration=28ms
2025-10-09 22:28:46.216 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cf25265f, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=5ms
2025-10-09 22:28:54.858 [http-nio-8080-exec-3] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-09 22:28:54.859 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-09 22:28:54.893 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 15, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-09 22:28:54.902 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 15
2025-10-09 22:28:54.902 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-09 22:28:54.904 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=749e7a1a, method=POST, uri=/api/v1/contracts/upload, status=202, duration=81ms
2025-10-09 22:28:54.912 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-09 22:28:54.913 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-09 22:28:54.926 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 15
2025-10-09 22:28:54.928 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 15
2025-10-09 22:28:54.933 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 15
2025-10-09 22:28:54.933 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=15
2025-10-09 22:28:54.936 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-09 22:28:54.940 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e34c0703, method=GET, uri=/api/v1/contracts/15/analyze-async, status=200, duration=15ms
2025-10-09 22:28:54.947 [Async-2] WARN  c.r.L.service.ContractReviewService - 合同文本内容为空，可能文件还在解析中: reviewId=15
2025-10-09 22:28:55.422 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-09 22:28:55.422 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-09 22:28:55.422 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=15, 文本长度: 7321
2025-10-09 22:28:55.423 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-09 22:28:55.424 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-09 22:28:55.953 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=15
2025-10-09 22:28:55.954 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-09 22:28:56.968 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=15
2025-10-09 22:28:56.969 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-09 22:28:57.979 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=15
2025-10-09 22:28:57.981 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-09 22:28:58.991 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=15
2025-10-09 22:28:58.993 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-09 22:29:00.000 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=15
2025-10-09 22:29:00.001 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-09 22:29:01.014 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=15
2025-10-09 22:29:01.016 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-09 22:29:02.019 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=15
2025-10-09 22:29:02.021 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-09 22:29:02.050 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-09 22:29:02.050 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 15, 块数: 405
2025-10-09 22:29:02.050 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 15
2025-10-09 22:29:02.050 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 15
2025-10-09 22:29:03.034 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=15
2025-10-09 22:29:03.036 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-09 22:29:03.036 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 8秒, reviewId=15
2025-10-09 22:29:03.037 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，开始分析: reviewId=15, 文本长度: 7321
2025-10-09 22:29:03.053 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-09 22:30:26.469 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-09 22:30:26.534 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-09 22:30:26.543 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=15
2025-10-09 22:30:27.591 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 15
2025-10-09 22:30:27.592 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 15
2025-10-09 22:30:27.593 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 15
2025-10-09 22:30:27.594 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=18b402c9, method=GET, uri=/api/v1/contracts/15/analyze-async, status=200, duration=4ms
2025-10-09 22:30:27.594 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=15
2025-10-09 22:30:27.596 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-09 22:30:27.597 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=15
2025-10-09 22:30:27.610 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=15
2025-10-09 22:32:51.789 [http-nio-8080-exec-4] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 22:32:51.809 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=44ddc00c, method=GET, uri=/api/v1/chat/sessions, status=200, duration=22ms
2025-10-09 22:32:52.763 [http-nio-8080-exec-5] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760018506076_0uolseobk 的消息
2025-10-09 22:32:52.772 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=461aa6fc, method=GET, uri=/api/v1/chat/sessions/session_1760018506076_0uolseobk, status=200, duration=10ms
2025-10-09 22:32:55.521 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=71364c17, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=8ms
2025-10-09 22:33:05.010 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=24e8931c, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=9ms
2025-10-09 22:34:41.655 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=59b96a8d, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=6ms
2025-10-09 22:35:02.567 [http-nio-8080-exec-3] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-09 22:35:02.575 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5193be37, method=GET, uri=/api/v1/chat/sessions, status=200, duration=9ms
2025-10-09 22:35:05.333 [http-nio-8080-exec-10] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760018506076_0uolseobk 的消息
2025-10-09 22:35:05.338 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0c3ca669, method=GET, uri=/api/v1/chat/sessions/session_1760018506076_0uolseobk, status=200, duration=5ms
2025-10-09 22:35:47.511 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-09 22:35:47.515 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
