2025-10-08 15:27:54.093 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 25152 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 15:27:54.099 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 15:27:56.660 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 15:27:56.873 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1ecf784f
2025-10-08 15:27:56.952 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 15:27:56.980 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 15:27:56.986 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 15:27:57.076 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 15:27:57.079 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 15:27:57.516 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 15:27:58.586 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 15:27:58.588 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 15:27:58.606 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 15:27:58.607 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 15:27:58.607 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 15:27:58.607 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 15:27:58.607 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 15:27:58.607 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 15:27:58.608 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 15:27:58.640 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 15:27:58.773 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 15:27:58.773 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 15:27:59.465 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 15:27:59.500 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 15:27:59.502 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 15:27:59.506 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 15:27:59.507 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 15:27:59.508 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 15:27:59.538 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 15:27:59.718 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 15:27:59.721 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 15:27:59.722 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 15:27:59.722 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 15:27:59.902 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 15:27:59.910 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 15:27:59.912 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 15:27:59.912 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 15:27:59.912 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 15:27:59.920 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 15:27:59.920 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 15:27:59.950 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 15:27:59.951 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 15:27:59.951 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 15:27:59.951 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 15:27:59.951 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 15:27:59.951 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 15:27:59.951 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 15:27:59.962 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 15:27:59.979 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 15:27:59.980 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 15:27:59.990 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 15:27:59.990 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 15:27:59.993 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 15:27:59.993 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 15:27:59.995 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 15:27:59.995 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 15:28:00.050 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 15:28:01.148 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 15:28:01.234 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 15:28:01.243 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 15:28:01.273 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 15:28:01.396 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 15:28:02.129 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 15:28:02.916 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.286 seconds (process running for 9.606)
2025-10-08 15:28:02.923 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 15:28:02.924 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 15:28:03.028 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 15:28:14.203 [http-nio-8080-exec-1] INFO  c.r.L.c.AuthenticationController - 用户登录请求: admin
2025-10-08 15:28:14.476 [http-nio-8080-exec-1] INFO  c.r.L.c.AuthenticationController - 用户 admin 登录成功
2025-10-08 15:28:14.496 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=874f96ec, method=POST, uri=/api/v1/auth/login, status=200, duration=323ms
2025-10-08 15:28:30.060 [http-nio-8080-exec-3] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=请你介绍一下民法典, modelType=BASIC
2025-10-08 15:28:30.063 [http-nio-8080-exec-3] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-08 15:28:30.064 [http-nio-8080-exec-3] INFO  c.r.L.c.UnifiedChatController - 使用基础模式进行流式处理
2025-10-08 15:28:30.066 [Async-1] INFO  c.r.L.service.AgentService - 开始流式法律咨询处理: 请你介绍一下民法典
2025-10-08 15:28:30.067 [Async-1] INFO  c.r.L.service.AgentService - 使用高级流式模型进行推送
2025-10-08 15:28:30.073 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e5b15b04, method=POST, uri=/api/v1/chat/stream, status=200, duration=70ms
2025-10-08 15:28:30.107 [Async-1] INFO  d.l.h.client.log.LoggingHttpClient - HTTP request:
- method: POST
- url: https://api.deepseek.com/chat/completions
- headers: [Authorization: Beare...72], [User-Agent: langchain4j-openai], [Content-Type: application/json]
- body: {
  "model" : "deepseek-chat",
  "messages" : [ {
    "role" : "user",
    "content" : "作为专业法律助手，请提供准确、详细的法律建议：请你介绍一下民法典"
  } ],
  "temperature" : 0.3,
  "stream" : true,
  "stream_options" : {
    "include_usage" : true
  },
  "max_tokens" : 4096
}

2025-10-08 15:29:45.620 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 流式响应完成，总长度: 3477
2025-10-08 15:29:45.633 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-08 15:32:42.862 [http-nio-8080-exec-5] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=请你介绍一下民法典, modelType=BASIC
2025-10-08 15:32:42.863 [http-nio-8080-exec-5] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-08 15:32:42.863 [http-nio-8080-exec-5] INFO  c.r.L.c.UnifiedChatController - 使用基础模式进行流式处理
2025-10-08 15:32:42.865 [Async-2] INFO  c.r.L.service.AgentService - 开始流式法律咨询处理: 请你介绍一下民法典
2025-10-08 15:32:42.865 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8a807b13, method=POST, uri=/api/v1/chat/stream, status=200, duration=4ms
2025-10-08 15:32:42.865 [Async-2] INFO  c.r.L.service.AgentService - 使用高级流式模型进行推送
2025-10-08 15:32:42.866 [Async-2] INFO  d.l.h.client.log.LoggingHttpClient - HTTP request:
- method: POST
- url: https://api.deepseek.com/chat/completions
- headers: [Authorization: Beare...72], [User-Agent: langchain4j-openai], [Content-Type: application/json]
- body: {
  "model" : "deepseek-chat",
  "messages" : [ {
    "role" : "user",
    "content" : "作为专业法律助手，请提供准确、详细的法律建议：请你介绍一下民法典"
  } ],
  "temperature" : 0.3,
  "stream" : true,
  "stream_options" : {
    "include_usage" : true
  },
  "max_tokens" : 4096
}

2025-10-08 15:33:48.617 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 流式响应完成，总长度: 3107
2025-10-08 15:33:48.621 [http-nio-8080-exec-8] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-08 15:38:28.637 [http-nio-8080-exec-9] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=请你介绍一下民法典, modelType=BASIC
2025-10-08 15:38:28.638 [http-nio-8080-exec-9] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-08 15:38:28.639 [http-nio-8080-exec-9] INFO  c.r.L.c.UnifiedChatController - 使用基础模式进行流式处理
2025-10-08 15:38:28.641 [Async-3] INFO  c.r.L.service.AgentService - 开始流式法律咨询处理: 请你介绍一下民法典
2025-10-08 15:38:28.641 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=26e643f9, method=POST, uri=/api/v1/chat/stream, status=200, duration=6ms
2025-10-08 15:38:28.641 [Async-3] INFO  c.r.L.service.AgentService - 使用高级流式模型进行推送
2025-10-08 15:38:28.642 [Async-3] INFO  d.l.h.client.log.LoggingHttpClient - HTTP request:
- method: POST
- url: https://api.deepseek.com/chat/completions
- headers: [Authorization: Beare...72], [User-Agent: langchain4j-openai], [Content-Type: application/json]
- body: {
  "model" : "deepseek-chat",
  "messages" : [ {
    "role" : "user",
    "content" : "作为专业法律助手，请提供准确、详细的法律建议：请你介绍一下民法典"
  } ],
  "temperature" : 0.3,
  "stream" : true,
  "stream_options" : {
    "include_usage" : true
  },
  "max_tokens" : 4096
}

2025-10-08 15:39:44.510 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.AgentService - 流式响应完成，总长度: 3344
2025-10-08 15:39:44.513 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-08 15:44:12.211 [http-nio-8080-exec-10] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=你好, modelType=BASIC
2025-10-08 15:44:12.212 [http-nio-8080-exec-10] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-08 15:44:12.212 [http-nio-8080-exec-10] INFO  c.r.L.c.UnifiedChatController - 使用基础模式进行流式处理
2025-10-08 15:44:12.213 [Async-4] INFO  c.r.L.service.AgentService - 开始流式法律咨询处理: 你好
2025-10-08 15:44:12.213 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2a0fab3e, method=POST, uri=/api/v1/chat/stream, status=200, duration=3ms
2025-10-08 15:44:12.213 [Async-4] INFO  c.r.L.service.AgentService - 使用高级流式模型进行推送
2025-10-08 15:44:12.214 [Async-4] INFO  d.l.h.client.log.LoggingHttpClient - HTTP request:
- method: POST
- url: https://api.deepseek.com/chat/completions
- headers: [Authorization: Beare...72], [User-Agent: langchain4j-openai], [Content-Type: application/json]
- body: {
  "model" : "deepseek-chat",
  "messages" : [ {
    "role" : "user",
    "content" : "作为专业法律助手，请提供准确、详细的法律建议：你好"
  } ],
  "temperature" : 0.3,
  "stream" : true,
  "stream_options" : {
    "include_usage" : true
  },
  "max_tokens" : 4096
}

2025-10-08 15:44:33.161 [ForkJoinPool.commonPool-worker-7] INFO  c.r.L.service.AgentService - 流式响应完成，总长度: 895
2025-10-08 15:44:33.163 [http-nio-8080-exec-6] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-08 15:48:42.045 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=你好, modelType=BASIC
2025-10-08 15:48:42.047 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-08 15:48:42.048 [http-nio-8080-exec-7] INFO  c.r.L.c.UnifiedChatController - 使用基础模式进行流式处理
2025-10-08 15:48:42.048 [Async-5] INFO  c.r.L.service.AgentService - 开始流式法律咨询处理: 你好
2025-10-08 15:48:42.048 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b498b375, method=POST, uri=/api/v1/chat/stream, status=200, duration=5ms
2025-10-08 15:48:42.048 [Async-5] INFO  c.r.L.service.AgentService - 使用高级流式模型进行推送
2025-10-08 15:48:42.049 [Async-5] INFO  d.l.h.client.log.LoggingHttpClient - HTTP request:
- method: POST
- url: https://api.deepseek.com/chat/completions
- headers: [Authorization: Beare...72], [User-Agent: langchain4j-openai], [Content-Type: application/json]
- body: {
  "model" : "deepseek-chat",
  "messages" : [ {
    "role" : "user",
    "content" : "作为专业法律助手，请提供准确、详细的法律建议：你好"
  } ],
  "temperature" : 0.3,
  "stream" : true,
  "stream_options" : {
    "include_usage" : true
  },
  "max_tokens" : 4096
}

2025-10-08 15:48:54.649 [ForkJoinPool.commonPool-worker-9] INFO  c.r.L.service.AgentService - 流式响应完成，总长度: 505
2025-10-08 15:48:54.652 [http-nio-8080-exec-1] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-08 15:53:02.835 [http-nio-8080-exec-3] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=你好, modelType=BASIC
2025-10-08 15:53:02.836 [http-nio-8080-exec-3] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-08 15:53:02.837 [http-nio-8080-exec-3] INFO  c.r.L.c.UnifiedChatController - 使用基础模式进行流式处理
2025-10-08 15:53:02.837 [Async-6] INFO  c.r.L.service.AgentService - 开始流式法律咨询处理: 你好
2025-10-08 15:53:02.837 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d6a5746c, method=POST, uri=/api/v1/chat/stream, status=200, duration=4ms
2025-10-08 15:53:02.838 [Async-6] INFO  c.r.L.service.AgentService - 使用高级流式模型进行推送
2025-10-08 15:53:02.838 [Async-6] INFO  d.l.h.client.log.LoggingHttpClient - HTTP request:
- method: POST
- url: https://api.deepseek.com/chat/completions
- headers: [Authorization: Beare...72], [User-Agent: langchain4j-openai], [Content-Type: application/json]
- body: {
  "model" : "deepseek-chat",
  "messages" : [ {
    "role" : "user",
    "content" : "作为专业法律助手，请提供准确、详细的法律建议：你好"
  } ],
  "temperature" : 0.3,
  "stream" : true,
  "stream_options" : {
    "include_usage" : true
  },
  "max_tokens" : 4096
}

2025-10-08 15:53:17.378 [ForkJoinPool.commonPool-worker-11] INFO  c.r.L.service.AgentService - 流式响应完成，总长度: 567
2025-10-08 15:53:17.381 [http-nio-8080-exec-4] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-08 15:53:34.930 [http-nio-8080-exec-5] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 15:53:34.939 [http-nio-8080-exec-5] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 15:53:34.993 [http-nio-8080-exec-5] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 15:53:35.003 [http-nio-8080-exec-5] ERROR c.r.L.c.ContractReviewController - 文件上传失败
org.springframework.beans.factory.NoSuchBeanDefinitionException: No bean named 'generalTaskExecutor' available: No matching Executor bean found for qualifier 'generalTaskExecutor' - neither qualifier match nor bean name match!
	at org.springframework.beans.factory.annotation.BeanFactoryAnnotationUtils.qualifiedBeanOfType(BeanFactoryAnnotationUtils.java:136)
	at org.springframework.beans.factory.annotation.BeanFactoryAnnotationUtils.qualifiedBeanOfType(BeanFactoryAnnotationUtils.java:95)
	at org.springframework.aop.interceptor.AsyncExecutionAspectSupport.findQualifiedExecutor(AsyncExecutionAspectSupport.java:222)
	at org.springframework.aop.interceptor.AsyncExecutionAspectSupport.determineAsyncExecutor(AsyncExecutionAspectSupport.java:180)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.invoke(AsyncExecutionInterceptor.java:105)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.ContractReviewService$$SpringCGLIB$$0.processUploadedContractAsync(<generated>)
	at com.river.LegalAssistant.controller.ContractReviewController.uploadContract(ContractReviewController.java:121)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.uploadContract(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 15:53:35.016 [http-nio-8080-exec-5] ERROR c.r.L.e.GlobalExceptionHandler - 运行时异常
java.lang.RuntimeException: 文件上传失败: No bean named 'generalTaskExecutor' available: No matching Executor bean found for qualifier 'generalTaskExecutor' - neither qualifier match nor bean name match!
	at com.river.LegalAssistant.controller.ContractReviewController.uploadContract(ContractReviewController.java:141)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.uploadContract(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No bean named 'generalTaskExecutor' available: No matching Executor bean found for qualifier 'generalTaskExecutor' - neither qualifier match nor bean name match!
	at org.springframework.beans.factory.annotation.BeanFactoryAnnotationUtils.qualifiedBeanOfType(BeanFactoryAnnotationUtils.java:136)
	at org.springframework.beans.factory.annotation.BeanFactoryAnnotationUtils.qualifiedBeanOfType(BeanFactoryAnnotationUtils.java:95)
	at org.springframework.aop.interceptor.AsyncExecutionAspectSupport.findQualifiedExecutor(AsyncExecutionAspectSupport.java:222)
	at org.springframework.aop.interceptor.AsyncExecutionAspectSupport.determineAsyncExecutor(AsyncExecutionAspectSupport.java:180)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.invoke(AsyncExecutionInterceptor.java:105)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.ContractReviewService$$SpringCGLIB$$0.processUploadedContractAsync(<generated>)
	at com.river.LegalAssistant.controller.ContractReviewController.uploadContract(ContractReviewController.java:121)
	... 155 common frames omitted
2025-10-08 15:53:35.026 [http-nio-8080-exec-5] ERROR c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7847ae54, method=POST, uri=/api/v1/contracts/upload, status=500, duration=192ms
2025-10-08 15:56:09.270 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 15:56:09.274 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 15:56:52.218 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 14788 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 15:56:52.220 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 15:56:54.594 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 15:56:54.751 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@6a4d57b7
2025-10-08 15:56:54.807 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 15:56:54.826 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 15:56:54.832 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 15:56:54.906 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 15:56:54.909 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 15:56:55.326 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 15:56:56.356 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 15:56:56.357 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 15:56:56.378 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 15:56:56.379 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 15:56:56.379 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 15:56:56.379 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 15:56:56.379 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 15:56:56.379 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 15:56:56.379 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 15:56:56.421 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 15:56:56.543 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 15:56:56.544 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 15:56:57.247 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 15:56:57.274 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 15:56:57.276 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 15:56:57.280 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 15:56:57.280 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 15:56:57.281 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 15:56:57.312 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 15:56:57.477 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 15:56:57.479 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 15:56:57.479 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 15:56:57.480 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 15:56:57.648 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 15:56:57.657 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 15:56:57.659 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 15:56:57.659 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 15:56:57.659 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 15:56:57.665 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 15:56:57.665 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 15:56:57.687 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 15:56:57.687 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 15:56:57.687 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 15:56:57.688 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 15:56:57.688 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 15:56:57.688 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 15:56:57.688 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 15:56:57.700 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 15:56:57.716 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 15:56:57.716 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 15:56:57.726 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 15:56:57.726 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 15:56:57.728 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 15:56:57.728 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 15:56:57.730 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 15:56:57.731 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 15:56:57.798 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 15:56:58.242 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 15:56:58.323 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 15:56:58.324 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 15:56:58.346 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 15:56:58.476 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 15:56:59.211 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 15:57:00.032 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.218 seconds (process running for 8.484)
2025-10-08 15:57:00.039 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 15:57:00.041 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 15:57:00.137 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 15:57:09.390 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 15:57:09.395 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 15:57:09.420 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 15:57:09.427 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 2
2025-10-08 15:57:09.442 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d781364b, method=POST, uri=/api/v1/contracts/upload, status=202, duration=106ms
2025-10-08 15:57:09.452 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 15:57:09.936 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 15:57:09.937 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 15:57:09.939 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 15:57:18.674 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 15:57:18.674 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 2, 块数: 405
2025-10-08 15:57:18.675 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 2
2025-10-08 16:06:04.077 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 16:06:04.080 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 16:12:23.330 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 23488 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 16:12:23.332 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 16:12:25.662 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 16:12:25.837 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@744673f3
2025-10-08 16:12:25.904 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 16:12:25.922 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 16:12:25.927 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 16:12:26.003 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 16:12:26.006 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 16:12:26.427 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 16:12:27.457 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 16:12:27.459 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 16:12:27.478 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 16:12:27.478 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 16:12:27.479 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 16:12:27.479 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 16:12:27.479 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 16:12:27.479 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 16:12:27.479 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 16:12:27.511 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 16:12:27.651 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 16:12:27.651 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 16:12:28.316 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 16:12:28.343 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 16:12:28.344 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 16:12:28.347 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 16:12:28.349 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 16:12:28.350 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 16:12:28.379 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 16:12:28.545 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 16:12:28.547 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 16:12:28.547 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 16:12:28.547 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 16:12:28.726 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 16:12:28.734 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 16:12:28.736 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 16:12:28.736 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 16:12:28.736 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 16:12:28.742 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 16:12:28.742 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 16:12:28.765 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 16:12:28.765 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 16:12:28.765 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 16:12:28.765 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 16:12:28.767 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 16:12:28.767 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 16:12:28.767 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 16:12:28.777 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 16:12:28.792 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 16:12:28.792 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 16:12:28.803 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 16:12:28.804 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 16:12:28.806 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 16:12:28.806 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 16:12:28.808 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 16:12:28.808 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 16:12:28.853 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 16:12:29.715 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 16:12:29.801 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 16:12:29.803 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 16:12:29.827 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 16:12:29.960 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 16:12:30.633 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 16:12:31.413 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.477 seconds (process running for 8.758)
2025-10-08 16:12:31.419 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 16:12:31.421 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 16:12:31.517 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 16:14:22.819 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 收到统一流式聊天请求: message=案例类型： 饲养动物损害责任
案情简介：
受害人： 小学生王某（8岁）
责任方： 宠物狗主人赵某
某周日下午，赵某在小区内遛其饲养的大型犬（金毛寻回犬），但未使用牵引绳。此时，小学生王某在小区花园玩耍，看到金毛犬跑来，出于好奇上前抚摸。金毛犬突然受惊，将王某扑倒，导致王某右臂被抓伤，并有轻微咬痕。
事后，王某的父母要求赵某赔偿医疗费、精神损害抚慰金等共计8000元。赵某认为，他的狗平时很温顺，是王某主动上前挑逗才导致狗受惊，且伤情不重，赔偿要求过高。他辩称王某的监护人也应承担部分责任。
核心法律问题：
本案属于一般侵权责任还是特殊侵权责任（饲养动物损害责任）？
赵某作为动物饲养人，其“未拴绳”的行为是否是认定其承担责任的关键？
王某“主动抚摸”的行为是否可以作为减轻或免除赵某责任的法定事由？（即是否存在受害人故意或重大过失的情形）
王某父母（监护人）是否因未尽到看护责任而应承担相应责任？
精神损害抚慰金的主张是否合理？, modelType=ADVANCED
2025-10-08 16:14:22.821 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 用户 admin 通过JWT验证，开始处理流式聊天
2025-10-08 16:14:22.822 [http-nio-8080-exec-2] INFO  c.r.L.c.UnifiedChatController - 使用高级模式进行流式处理
2025-10-08 16:14:22.825 [Async-1] INFO  c.r.L.service.AgentService - 🚀 开始流式法律咨询处理: question='案例类型： 饲养动物损害责任
案情简介：
受害人： 小学生王某（8岁）
责任方： 宠物狗主人赵某
某周日下午，赵某在小区内遛其饲养的大型犬（金毛寻回犬），但未使用牵引绳。此时，小学生王某在小区花园玩耍，看到金毛犬跑来，出于好奇上前抚摸。金毛犬突然受惊，将王某扑倒，导致王某右臂被抓伤，并有轻微咬痕。
事后，王某的父母要求赵某赔偿医疗费、精神损害抚慰金等共计8000元。赵某认为，他的狗平时很温顺，是王某主动上前挑逗才导致狗受惊，且伤情不重，赔偿要求过高。他辩称王某的监护人也应承担部分责任。
核心法律问题：
本案属于一般侵权责任还是特殊侵权责任（饲养动物损害责任）？
赵某作为动物饲养人，其“未拴绳”的行为是否是认定其承担责任的关键？
王某“主动抚摸”的行为是否可以作为减轻或免除赵某责任的法定事由？（即是否存在受害人故意或重大过失的情形）
王某父母（监护人）是否因未尽到看护责任而应承担相应责任？
精神损害抚慰金的主张是否合理？', length=415
2025-10-08 16:14:22.825 [Async-1] INFO  c.r.L.service.AgentService - 使用高级流式模型进行推送
2025-10-08 16:14:22.826 [Async-1] INFO  c.r.L.service.AgentService - 📡 开始使用流式模型处理: model=OpenAiStreamingChatModel
2025-10-08 16:14:22.832 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9757133d, method=POST, uri=/api/v1/chat/stream, status=200, duration=99ms
2025-10-08 16:14:22.869 [Async-1] INFO  d.l.h.client.log.LoggingHttpClient - HTTP request:
- method: POST
- url: https://api.deepseek.com/chat/completions
- headers: [Authorization: Beare...72], [User-Agent: langchain4j-openai], [Content-Type: application/json]
- body: {
  "model" : "deepseek-chat",
  "messages" : [ {
    "role" : "user",
    "content" : "作为专业法律助手，请提供准确、详细的法律建议：案例类型： 饲养动物损害责任\n案情简介：\n受害人： 小学生王某（8岁）\n责任方： 宠物狗主人赵某\n某周日下午，赵某在小区内遛其饲养的大型犬（金毛寻回犬），但未使用牵引绳。此时，小学生王某在小区花园玩耍，看到金毛犬跑来，出于好奇上前抚摸。金毛犬突然受惊，将王某扑倒，导致王某右臂被抓伤，并有轻微咬痕。\n事后，王某的父母要求赵某赔偿医疗费、精神损害抚慰金等共计8000元。赵某认为，他的狗平时很温顺，是王某主动上前挑逗才导致狗受惊，且伤情不重，赔偿要求过高。他辩称王某的监护人也应承担部分责任。\n核心法律问题：\n本案属于一般侵权责任还是特殊侵权责任（饲养动物损害责任）？\n赵某作为动物饲养人，其“未拴绳”的行为是否是认定其承担责任的关键？\n王某“主动抚摸”的行为是否可以作为减轻或免除赵某责任的法定事由？（即是否存在受害人故意或重大过失的情形）\n王某父母（监护人）是否因未尽到看护责任而应承担相应责任？\n精神损害抚慰金的主张是否合理？"
  } ],
  "temperature" : 0.3,
  "stream" : true,
  "stream_options" : {
    "include_usage" : true
  },
  "max_tokens" : 4096
}

2025-10-08 16:15:28.681 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 流式响应完成，总长度: 2795
2025-10-08 16:15:28.694 [http-nio-8080-exec-3] INFO  c.r.L.c.UnifiedChatController - 流式聊天完成
2025-10-08 16:16:05.418 [http-nio-8080-exec-4] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 16:16:05.424 [http-nio-8080-exec-4] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 16:16:05.452 [http-nio-8080-exec-4] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 16:16:05.462 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 2
2025-10-08 16:16:05.478 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=024dfa79, method=POST, uri=/api/v1/contracts/upload, status=202, duration=111ms
2025-10-08 16:16:05.500 [Async-2] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 16:16:05.514 [http-nio-8080-exec-1] ERROR c.r.L.e.GlobalExceptionHandler - 未处理的异常
org.springframework.web.HttpRequestMethodNotSupportedException: Request method 'GET' is not supported
	at org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.handleNoMatch(RequestMappingInfoHandlerMapping.java:267)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.lookupHandlerMethod(AbstractHandlerMethodMapping.java:441)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.getHandlerInternal(AbstractHandlerMethodMapping.java:382)
	at org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:127)
	at org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:68)
	at org.springframework.web.servlet.handler.AbstractHandlerMapping.getHandler(AbstractHandlerMapping.java:507)
	at org.springframework.web.servlet.DispatcherServlet.getHandler(DispatcherServlet.java:1284)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1065)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:16:05.522 [http-nio-8080-exec-1] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.river.LegalAssistant.exception.GlobalExceptionHandler#handleGeneralException(Exception)
org.springframework.web.HttpMediaTypeNotAcceptableException: No acceptable representation
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:256)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:432)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:74)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:175)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1358)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:16:05.528 [http-nio-8080-exec-1] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.HttpRequestMethodNotSupportedException: Request method 'GET' is not supported]
2025-10-08 16:16:05.528 [http-nio-8080-exec-1] WARN  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b158e6dd, method=GET, uri=/api/v1/contracts/undefined/analyze-async, status=405, duration=17ms
2025-10-08 16:16:06.166 [Async-2] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 16:16:06.167 [Async-2] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 16:16:06.171 [Async-2] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 16:16:14.322 [Async-2] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 16:16:14.322 [Async-2] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 2, 块数: 405
2025-10-08 16:16:14.323 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 2
2025-10-08 16:16:46.067 [http-nio-8080-exec-5] ERROR c.r.L.e.GlobalExceptionHandler - 未处理的异常
org.springframework.web.HttpRequestMethodNotSupportedException: Request method 'GET' is not supported
	at org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.handleNoMatch(RequestMappingInfoHandlerMapping.java:267)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.lookupHandlerMethod(AbstractHandlerMethodMapping.java:441)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.getHandlerInternal(AbstractHandlerMethodMapping.java:382)
	at org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:127)
	at org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:68)
	at org.springframework.web.servlet.handler.AbstractHandlerMapping.getHandler(AbstractHandlerMapping.java:507)
	at org.springframework.web.servlet.DispatcherServlet.getHandler(DispatcherServlet.java:1284)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1065)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:16:46.070 [http-nio-8080-exec-5] ERROR c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bbcafc64, method=GET, uri=/api/v1/contracts/undefined/analyze-async, status=500, duration=4ms
2025-10-08 16:19:15.178 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 16:19:15.183 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 16:20:31.689 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 41176 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 16:20:31.690 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 16:20:33.923 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 16:20:34.042 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@40696fc6
2025-10-08 16:20:34.093 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 16:20:34.113 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 16:20:34.118 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 16:20:34.193 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 16:20:34.195 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 16:20:34.520 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 16:20:35.468 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 16:20:35.469 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 16:20:35.488 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 16:20:35.489 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 16:20:35.489 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 16:20:35.489 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 16:20:35.489 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 16:20:35.489 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 16:20:35.489 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 16:20:35.521 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 16:20:35.607 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 16:20:35.608 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 16:20:36.292 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 16:20:36.320 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 16:20:36.327 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 16:20:36.330 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 16:20:36.331 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 16:20:36.332 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 16:20:36.361 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 16:20:36.542 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 16:20:36.545 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 16:20:36.545 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 16:20:36.546 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 16:20:36.729 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 16:20:36.737 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 16:20:36.738 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 16:20:36.739 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 16:20:36.739 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 16:20:36.746 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 16:20:36.746 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 16:20:36.768 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 16:20:36.768 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 16:20:36.768 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 16:20:36.768 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 16:20:36.769 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 16:20:36.769 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 16:20:36.769 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 16:20:36.782 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 16:20:36.798 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 16:20:36.798 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 16:20:36.809 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 16:20:36.810 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 16:20:36.811 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 16:20:36.811 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 16:20:36.814 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 16:20:36.814 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 16:20:36.868 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 16:20:37.280 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 16:20:37.355 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 16:20:37.357 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 16:20:37.377 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 16:20:37.508 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 16:20:38.234 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 16:20:39.031 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.736 seconds (process running for 7.999)
2025-10-08 16:20:39.038 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 16:20:39.039 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 16:20:39.128 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 16:22:20.241 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 16:22:20.245 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 16:22:20.295 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 7, 文件: 广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 16:22:20.303 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 7
2025-10-08 16:22:20.318 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 广州市既有住宅加装电梯委托管理合同.docx, 类型: docx, 大小: 36076 bytes
2025-10-08 16:22:20.322 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a3d5133a, method=POST, uri=/api/v1/contracts/upload, status=202, duration=133ms
2025-10-08 16:22:20.346 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 7
2025-10-08 16:22:20.348 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析
2025-10-08 16:22:20.352 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 7
2025-10-08 16:22:20.361 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c97699ee, method=GET, uri=/api/v1/contracts/7/analyze-async, status=200, duration=17ms
2025-10-08 16:22:20.381 [Async-2] ERROR c.r.L.service.ContractReviewService - 合同异步分析失败
java.lang.NullPointerException: Cannot invoke "String.length()" because "contractText" is null
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:305)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:22:20.401 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=7
2025-10-08 16:22:20.784 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 广州市既有住宅加装电梯委托管理合同.docx, 内容长度: 3641 字符
2025-10-08 16:22:20.785 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3641 字符
2025-10-08 16:22:20.794 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 16:22:28.354 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 16:22:28.355 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 7, 块数: 403
2025-10-08 16:22:28.355 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 7
2025-10-08 16:22:55.571 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 7
2025-10-08 16:22:55.572 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析
2025-10-08 16:22:55.573 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 7
2025-10-08 16:22:55.573 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a6df420b, method=GET, uri=/api/v1/contracts/7/analyze-async, status=200, duration=3ms
2025-10-08 16:22:55.598 [Async-3] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 3641
2025-10-08 16:23:18.165 [http-nio-8080-exec-5] WARN  c.r.L.service.ContractReviewService - SSE连接超时，标记任务应停止: reviewId=7
2025-10-08 16:23:18.169 [http-nio-8080-exec-5] ERROR c.r.L.e.GlobalExceptionHandler - 运行时异常
org.springframework.web.context.request.async.AsyncRequestTimeoutException: null
	at org.springframework.web.context.request.async.TimeoutDeferredResultProcessingInterceptor.handleTimeout(TimeoutDeferredResultProcessingInterceptor.java:42)
	at org.springframework.web.context.request.async.DeferredResultInterceptorChain.triggerAfterTimeout(DeferredResultInterceptorChain.java:81)
	at org.springframework.web.context.request.async.WebAsyncManager.lambda$startDeferredResultProcessing$5(WebAsyncManager.java:457)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest.onTimeout(StandardServletAsyncWebRequest.java:185)
	at org.apache.catalina.core.AsyncListenerWrapper.fireOnTimeout(AsyncListenerWrapper.java:44)
	at org.apache.catalina.core.AsyncContextImpl.timeout(AsyncContextImpl.java:136)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:135)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:23:18.170 [http-nio-8080-exec-5] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.river.LegalAssistant.exception.GlobalExceptionHandler#handleRuntimeException(RuntimeException)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.river.LegalAssistant.dto.ApiResponse] with preset Content-Type 'text/event-stream;charset=UTF-8'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:319)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:432)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:74)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:175)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1358)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:91)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:632)
	at org.apache.catalina.core.ApplicationDispatcher.doDispatch(ApplicationDispatcher.java:560)
	at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDispatcher.java:531)
	at org.apache.catalina.core.AsyncContextImpl$AsyncRunnable.run(AsyncContextImpl.java:601)
	at org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:344)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:239)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:23:18.173 [http-nio-8080-exec-5] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Ignoring exception, response committed already: org.springframework.web.context.request.async.AsyncRequestTimeoutException
2025-10-08 16:23:18.173 [http-nio-8080-exec-5] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.context.request.async.AsyncRequestTimeoutException]
2025-10-08 16:23:18.174 [http-nio-8080-exec-5] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=7
2025-10-08 16:23:20.239 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 16:23:20.243 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 16:28:44.708 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 4444 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 16:28:44.710 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 16:28:47.013 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 16:28:47.249 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5dd12c19
2025-10-08 16:28:47.291 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 16:28:47.313 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 16:28:47.320 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 16:28:47.400 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 16:28:47.402 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 16:28:47.745 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 16:28:48.722 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 16:28:48.723 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 16:28:48.741 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 16:28:48.742 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 16:28:48.742 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 16:28:48.742 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 16:28:48.742 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 16:28:48.742 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 16:28:48.742 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 16:28:48.775 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 16:28:48.869 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 16:28:48.870 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 16:28:49.551 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 16:28:49.578 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 16:28:49.581 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 16:28:49.584 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 16:28:49.585 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 16:28:49.586 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 16:28:49.619 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 16:28:49.797 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 16:28:49.800 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 16:28:49.800 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 16:28:49.801 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 16:28:49.976 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 16:28:49.983 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 16:28:49.984 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 16:28:49.984 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 16:28:49.985 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 16:28:49.991 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 16:28:49.991 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 16:28:50.012 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 16:28:50.013 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 16:28:50.013 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 16:28:50.013 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 16:28:50.013 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 16:28:50.014 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 16:28:50.014 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 16:28:50.025 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 16:28:50.040 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 16:28:50.041 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 16:28:50.050 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 16:28:50.050 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 16:28:50.052 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 16:28:50.053 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 16:28:50.054 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 16:28:50.054 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 16:28:50.100 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 16:28:50.521 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 16:28:50.601 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 16:28:50.602 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 16:28:50.623 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 16:28:50.751 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 16:28:51.481 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 16:28:52.284 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.97 seconds (process running for 8.256)
2025-10-08 16:28:52.290 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 16:28:52.291 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 16:28:52.380 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 16:29:56.783 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\573fde99c3197ab6b24a557b15e4dac514eae53250c2754db7097329e68420f3_上海市拍卖业委托拍卖合同示范文本.docx
2025-10-08 16:29:56.788 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 上海市拍卖业委托拍卖合同示范文本.docx
2025-10-08 16:29:56.829 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 573fde99c3197ab6b24a557b15e4dac514eae53250c2754db7097329e68420f3 已存在，返回现有审查记录
2025-10-08 16:29:56.838 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 5
2025-10-08 16:29:56.862 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bbb28bcc, method=POST, uri=/api/v1/contracts/upload, status=202, duration=146ms
2025-10-08 16:29:56.868 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 上海市拍卖业委托拍卖合同示范文本.docx, 类型: docx, 大小: 30348 bytes
2025-10-08 16:29:56.889 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 5
2025-10-08 16:29:56.894 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 5
2025-10-08 16:29:56.900 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 5
2025-10-08 16:29:56.914 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e5a3284b, method=GET, uri=/api/v1/contracts/5/analyze-async, status=200, duration=27ms
2025-10-08 16:29:56.967 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 5095
2025-10-08 16:29:57.561 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 上海市拍卖业委托拍卖合同示范文本.docx, 内容长度: 5095 字符
2025-10-08 16:29:57.562 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 5095 字符
2025-10-08 16:29:57.567 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 16:30:03.553 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 16:30:03.554 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 5, 块数: 403
2025-10-08 16:30:03.554 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 5
2025-10-08 16:31:14.375 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 分析合同风险，内容长度: 5095
2025-10-08 16:32:12.164 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 合同风险分析完成，分析结果长度: 2515 字符
2025-10-08 16:32:12.165 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 16:32:12.238 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 16:32:12.254 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=5
2025-10-08 16:32:15.275 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 5
2025-10-08 16:32:15.277 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 5
2025-10-08 16:32:15.278 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 5
2025-10-08 16:32:15.280 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c2fd12b3, method=GET, uri=/api/v1/contracts/5/analyze-async, status=200, duration=5ms
2025-10-08 16:32:15.312 [Async-3] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 5095
2025-10-08 16:33:33.105 [Async-3] INFO  c.r.LegalAssistant.service.AiService - 分析合同风险，内容长度: 5095
2025-10-08 16:34:32.229 [Async-3] INFO  c.r.LegalAssistant.service.AiService - 合同风险分析完成，分析结果长度: 2584 字符
2025-10-08 16:34:32.229 [Async-3] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 16:34:32.264 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 16:34:32.267 [http-nio-8080-exec-6] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=5
2025-10-08 16:34:35.285 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 5
2025-10-08 16:34:35.286 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 5
2025-10-08 16:34:35.286 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 5
2025-10-08 16:34:35.287 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fad4299d, method=GET, uri=/api/v1/contracts/5/analyze-async, status=200, duration=3ms
2025-10-08 16:34:35.310 [Async-4] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 5095
2025-10-08 16:35:49.752 [Async-4] INFO  c.r.LegalAssistant.service.AiService - 分析合同风险，内容长度: 5095
2025-10-08 16:36:35.507 [Async-4] INFO  c.r.LegalAssistant.service.AiService - 合同风险分析完成，分析结果长度: 2004 字符
2025-10-08 16:36:35.507 [Async-4] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 16:36:35.527 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 16:36:35.531 [http-nio-8080-exec-4] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=5
2025-10-08 16:36:38.545 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 5
2025-10-08 16:36:38.546 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 5
2025-10-08 16:36:38.547 [Async-5] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 5
2025-10-08 16:36:38.547 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1bc1f654, method=GET, uri=/api/v1/contracts/5/analyze-async, status=200, duration=2ms
2025-10-08 16:36:38.572 [Async-5] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 5095
2025-10-08 16:37:47.629 [Async-5] INFO  c.r.LegalAssistant.service.AiService - 分析合同风险，内容长度: 5095
2025-10-08 16:38:55.247 [Async-5] INFO  c.r.LegalAssistant.service.AiService - 合同风险分析完成，分析结果长度: 2987 字符
2025-10-08 16:38:55.248 [Async-5] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 16:38:55.250 [Async-5] WARN  c.r.L.service.ContractReviewService - 发送SSE进度消息失败: ServletOutputStream failed to flush: java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
2025-10-08 16:38:55.250 [http-nio-8080-exec-5] WARN  c.r.L.service.ContractReviewService - SSE连接出现错误，标记任务应停止: reviewId=5
java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:137)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:102)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:58)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:542)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:122)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1378)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:728)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:712)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1252)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:299)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:265)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:136)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:412)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:155)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1207)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:483)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:123)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:221)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.send(ResponseBodyEmitterReturnValueHandler.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:223)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:214)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.service.ContractReviewService.sendProgress(ContractReviewService.java:598)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:336)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:38:55.256 [http-nio-8080-exec-5] ERROR c.r.L.e.GlobalExceptionHandler - 未处理的异常
java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:137)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:102)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:58)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:542)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:122)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1378)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:728)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:712)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1252)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:299)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:265)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:136)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:412)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:155)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1207)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:483)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:123)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:221)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.send(ResponseBodyEmitterReturnValueHandler.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:223)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:214)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.service.ContractReviewService.sendProgress(ContractReviewService.java:598)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:336)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:38:55.257 [http-nio-8080-exec-5] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.river.LegalAssistant.exception.GlobalExceptionHandler#handleGeneralException(Exception)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.river.LegalAssistant.dto.ApiResponse] with preset Content-Type 'text/event-stream;charset=UTF-8'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:319)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:432)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:74)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:175)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1358)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:91)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:632)
	at org.apache.catalina.core.ApplicationDispatcher.doDispatch(ApplicationDispatcher.java:560)
	at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDispatcher.java:531)
	at org.apache.catalina.core.AsyncContextImpl$AsyncRunnable.run(AsyncContextImpl.java:601)
	at org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:344)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:239)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:38:55.262 [http-nio-8080-exec-5] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] threw exception
java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:137)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:102)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:58)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:542)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:122)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1378)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:728)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:712)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1252)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:299)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:265)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:136)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:412)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:155)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1207)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:483)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:123)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:221)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.send(ResponseBodyEmitterReturnValueHandler.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:223)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:214)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.service.ContractReviewService.sendProgress(ContractReviewService.java:598)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:336)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:38:55.263 [http-nio-8080-exec-5] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=5
2025-10-08 16:38:55.264 [http-nio-8080-exec-5] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [/api/v1] threw exception
java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:137)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:102)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:58)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:542)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:122)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1378)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:728)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:712)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1252)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:299)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:265)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:136)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:412)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:155)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1207)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:483)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:123)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:221)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.send(ResponseBodyEmitterReturnValueHandler.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:223)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:214)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.service.ContractReviewService.sendProgress(ContractReviewService.java:598)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:336)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:38:55.277 [Async-5] WARN  c.r.L.service.ContractReviewService - SSE连接已关闭，跳过发送进度消息: ResponseBodyEmitter has already completed
2025-10-08 16:38:55.277 [Async-5] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 16:41:20.893 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 16:41:20.900 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 16:41:53.258 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 29112 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 16:41:53.260 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 16:41:55.680 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 16:41:55.821 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@7f5a25e2
2025-10-08 16:41:55.864 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 16:41:55.885 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 16:41:55.892 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 16:41:55.970 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 16:41:55.972 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 16:41:56.358 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 16:41:57.504 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 16:41:57.505 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 16:41:57.527 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 16:41:57.528 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 16:41:57.528 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 16:41:57.528 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 16:41:57.528 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 16:41:57.528 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 16:41:57.528 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 16:41:57.568 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 16:41:57.658 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 16:41:57.659 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 16:41:58.367 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 16:41:58.403 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 16:41:58.405 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 16:41:58.409 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 16:41:58.409 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 16:41:58.410 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 16:41:58.442 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 16:41:58.630 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 16:41:58.633 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 16:41:58.633 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 16:41:58.633 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 16:41:58.808 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 16:41:58.816 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 16:41:58.818 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 16:41:58.818 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 16:41:58.818 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 16:41:58.825 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 16:41:58.825 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 16:41:58.847 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 16:41:58.847 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 16:41:58.847 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 16:41:58.848 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 16:41:58.848 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 16:41:58.848 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 16:41:58.848 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 16:41:58.861 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 16:41:58.876 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 16:41:58.876 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 16:41:58.887 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 16:41:58.887 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 16:41:58.889 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 16:41:58.889 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 16:41:58.891 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 16:41:58.891 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 16:41:58.948 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 16:41:59.406 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 16:41:59.499 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 16:41:59.501 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 16:41:59.524 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 16:41:59.662 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 16:42:00.462 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 16:42:01.305 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.468 seconds (process running for 8.755)
2025-10-08 16:42:01.320 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 16:42:01.321 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 16:42:01.407 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 16:43:18.274 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件保存成功: F:\LegalAssistant\uploads\contracts\0ef4ad0f8392f4e8c55fd9f4b95d9bb83837cb1161ecf2aa87a8d2f1ec2b3014_上海市养老服务合同.doc, 大小: 77312 bytes
2025-10-08 16:43:18.278 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 上海市养老服务合同.doc
2025-10-08 16:43:18.315 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 8, 文件: 上海市养老服务合同.doc
2025-10-08 16:43:18.331 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 8
2025-10-08 16:43:18.350 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 上海市养老服务合同.doc, 类型: doc, 大小: 77312 bytes
2025-10-08 16:43:18.353 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=de76f280, method=POST, uri=/api/v1/contracts/upload, status=202, duration=133ms
2025-10-08 16:43:18.380 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 8
2025-10-08 16:43:18.383 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 8
2025-10-08 16:43:18.389 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 8
2025-10-08 16:43:18.403 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0852bd27, method=GET, uri=/api/v1/contracts/8/analyze-async, status=200, duration=26ms
2025-10-08 16:43:18.422 [Async-2] ERROR c.r.L.service.ContractReviewService - 合同异步分析失败
java.lang.NullPointerException: Cannot invoke "String.length()" because "contractText" is null
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:338)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:43:18.447 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=8
2025-10-08 16:43:18.547 [Async-1] WARN  o.apache.poi.hwpf.model.PAPBinTable - Paragraph [6291; 6292) has no PAPX. Creating new one.
2025-10-08 16:43:18.547 [Async-1] WARN  o.apache.poi.hwpf.model.PAPBinTable - Paragraph [6615; 6616) has no PAPX. Creating new one.
2025-10-08 16:43:18.569 [Async-1] WARN  o.apache.poi.hwpf.model.SectionTable - Your document seemed to be mostly unicode, but the section definition was in bytes! Trying anyway, but things may well go wrong!
2025-10-08 16:43:18.625 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 上海市养老服务合同.doc, 内容长度: 6200 字符
2025-10-08 16:43:18.625 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 6200 字符
2025-10-08 16:43:18.628 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 404 个文本块
2025-10-08 16:43:21.461 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 8
2025-10-08 16:43:21.463 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 8
2025-10-08 16:43:21.464 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 8
2025-10-08 16:43:21.465 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=af383a46, method=GET, uri=/api/v1/contracts/8/analyze-async, status=200, duration=5ms
2025-10-08 16:43:21.484 [Async-3] ERROR c.r.L.service.ContractReviewService - 合同异步分析失败
java.lang.NullPointerException: Cannot invoke "String.length()" because "contractText" is null
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:338)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:43:21.500 [http-nio-8080-exec-5] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=8
2025-10-08 16:43:24.524 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 8
2025-10-08 16:43:24.525 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 8
2025-10-08 16:43:24.526 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 8
2025-10-08 16:43:24.527 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e4e5c092, method=GET, uri=/api/v1/contracts/8/analyze-async, status=200, duration=4ms
2025-10-08 16:43:24.546 [Async-4] ERROR c.r.L.service.ContractReviewService - 合同异步分析失败
java.lang.NullPointerException: Cannot invoke "String.length()" because "contractText" is null
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:338)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:43:24.558 [http-nio-8080-exec-7] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=8
2025-10-08 16:43:25.796 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，404 个向量块已存储
2025-10-08 16:43:25.798 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 8, 块数: 404
2025-10-08 16:43:25.798 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 8
2025-10-08 16:43:27.569 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 8
2025-10-08 16:43:27.569 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 8
2025-10-08 16:43:27.571 [Async-5] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 8
2025-10-08 16:43:27.572 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f7e41ee5, method=GET, uri=/api/v1/contracts/8/analyze-async, status=200, duration=4ms
2025-10-08 16:43:27.602 [Async-5] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 6200
2025-10-08 16:44:30.584 [Async-5] INFO  c.r.LegalAssistant.service.AiService - 分析合同风险，内容长度: 6200
2025-10-08 16:45:20.818 [http-nio-8080-exec-9] WARN  c.r.L.service.ContractReviewService - SSE连接超时，标记任务应停止: reviewId=8
2025-10-08 16:45:20.823 [http-nio-8080-exec-9] ERROR c.r.L.e.GlobalExceptionHandler - 运行时异常
org.springframework.web.context.request.async.AsyncRequestTimeoutException: null
	at org.springframework.web.context.request.async.TimeoutDeferredResultProcessingInterceptor.handleTimeout(TimeoutDeferredResultProcessingInterceptor.java:42)
	at org.springframework.web.context.request.async.DeferredResultInterceptorChain.triggerAfterTimeout(DeferredResultInterceptorChain.java:81)
	at org.springframework.web.context.request.async.WebAsyncManager.lambda$startDeferredResultProcessing$5(WebAsyncManager.java:457)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest.onTimeout(StandardServletAsyncWebRequest.java:185)
	at org.apache.catalina.core.AsyncListenerWrapper.fireOnTimeout(AsyncListenerWrapper.java:44)
	at org.apache.catalina.core.AsyncContextImpl.timeout(AsyncContextImpl.java:136)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:135)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:45:20.824 [http-nio-8080-exec-9] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.river.LegalAssistant.exception.GlobalExceptionHandler#handleRuntimeException(RuntimeException)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.river.LegalAssistant.dto.ApiResponse] with preset Content-Type 'text/event-stream;charset=UTF-8'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:319)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:432)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:74)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:175)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1358)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:91)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:632)
	at org.apache.catalina.core.ApplicationDispatcher.doDispatch(ApplicationDispatcher.java:560)
	at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDispatcher.java:531)
	at org.apache.catalina.core.AsyncContextImpl$AsyncRunnable.run(AsyncContextImpl.java:601)
	at org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:344)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:239)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:45:20.826 [http-nio-8080-exec-9] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Ignoring exception, response committed already: org.springframework.web.context.request.async.AsyncRequestTimeoutException
2025-10-08 16:45:20.827 [http-nio-8080-exec-9] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.context.request.async.AsyncRequestTimeoutException]
2025-10-08 16:45:20.827 [http-nio-8080-exec-9] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=8
2025-10-08 16:45:22.907 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 16:45:22.910 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 16:52:40.403 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 12856 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 16:52:40.405 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 16:52:42.720 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 16:52:42.840 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@38d895e8
2025-10-08 16:52:42.880 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 16:52:42.900 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 16:52:42.906 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 16:52:42.981 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 16:52:42.983 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 16:52:43.307 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 16:52:44.294 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 16:52:44.295 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 16:52:44.313 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 16:52:44.314 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 16:52:44.314 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 16:52:44.314 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 16:52:44.314 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 16:52:44.314 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 16:52:44.314 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 16:52:44.347 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 16:52:44.438 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 16:52:44.438 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 16:52:45.234 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 16:52:45.258 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 16:52:45.261 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 16:52:45.265 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 16:52:45.266 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 16:52:45.266 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 16:52:45.294 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 16:52:45.450 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 16:52:45.453 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 16:52:45.454 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 16:52:45.454 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 16:52:45.622 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 16:52:45.629 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 16:52:45.631 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 16:52:45.632 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 16:52:45.632 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 16:52:45.637 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 16:52:45.638 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 16:52:45.660 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 16:52:45.660 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 16:52:45.661 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 16:52:45.661 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 16:52:45.661 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 16:52:45.661 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 16:52:45.661 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 16:52:45.672 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 16:52:45.686 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 16:52:45.686 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 16:52:45.696 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 16:52:45.697 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 16:52:45.699 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 16:52:45.699 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 16:52:45.700 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 16:52:45.700 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 16:52:45.754 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 16:52:46.189 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 16:52:46.272 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 16:52:46.275 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 16:52:46.297 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 16:52:46.424 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 16:52:47.197 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 16:52:47.986 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.981 seconds (process running for 8.25)
2025-10-08 16:52:47.992 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 16:52:47.993 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 16:52:48.081 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 16:52:56.791 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f_农村土地经营权出租合同.docx
2025-10-08 16:52:56.795 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 农村土地经营权出租合同.docx
2025-10-08 16:52:56.813 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f 已存在，返回现有审查记录
2025-10-08 16:52:56.820 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 6
2025-10-08 16:52:56.844 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 农村土地经营权出租合同.docx, 类型: docx, 大小: 30836 bytes
2025-10-08 16:52:56.846 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=eac3e05f, method=POST, uri=/api/v1/contracts/upload, status=202, duration=107ms
2025-10-08 16:52:56.873 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 6
2025-10-08 16:52:56.875 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 6
2025-10-08 16:52:56.880 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 6
2025-10-08 16:52:56.894 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=62c5febf, method=GET, uri=/api/v1/contracts/6/analyze-async, status=200, duration=25ms
2025-10-08 16:52:56.938 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 3686
2025-10-08 16:52:57.370 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 农村土地经营权出租合同.docx, 内容长度: 3686 字符
2025-10-08 16:52:57.370 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3686 字符
2025-10-08 16:52:57.373 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 16:53:04.480 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 16:53:04.481 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 6, 块数: 403
2025-10-08 16:53:04.482 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 6
2025-10-08 16:54:05.404 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 分析合同风险，内容长度: 3686
2025-10-08 16:55:27.944 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 合同风险分析完成，分析结果长度: 3556 字符
2025-10-08 16:55:27.944 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 16:55:27.992 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 16:55:28.000 [http-nio-8080-exec-4] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=6
2025-10-08 16:55:31.020 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 6
2025-10-08 16:55:31.021 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 6
2025-10-08 16:55:31.021 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 6
2025-10-08 16:55:31.022 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f0f8bc13, method=GET, uri=/api/v1/contracts/6/analyze-async, status=200, duration=3ms
2025-10-08 16:55:31.025 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=6
2025-10-08 16:55:31.027 [Async-3] ERROR c.r.L.service.ContractReviewService - 发送已完成结果失败
org.hibernate.LazyInitializationException: failed to lazily initialize a collection of role: com.river.LegalAssistant.entity.ContractReview.riskClauses: could not initialize proxy - no Session
	at org.hibernate.collection.spi.AbstractPersistentCollection.throwLazyInitializationException(AbstractPersistentCollection.java:636)
	at org.hibernate.collection.spi.AbstractPersistentCollection.withTemporarySessionIfNeeded(AbstractPersistentCollection.java:219)
	at org.hibernate.collection.spi.AbstractPersistentCollection.readSize(AbstractPersistentCollection.java:150)
	at org.hibernate.collection.spi.PersistentBag.isEmpty(PersistentBag.java:358)
	at com.river.LegalAssistant.dto.ContractReviewResultDto.fromEntity(ContractReviewResultDto.java:166)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:276)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:57:03.038 [http-nio-8080-exec-5] WARN  c.r.L.c.ContractReviewController - SSE连接超时: reviewId=6
2025-10-08 16:57:03.042 [http-nio-8080-exec-5] ERROR c.r.L.e.GlobalExceptionHandler - 运行时异常
java.lang.RuntimeException: 分析超时
	at com.river.LegalAssistant.controller.ContractReviewController.lambda$analyzeContractAsync$2(ContractReviewController.java:231)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter$DefaultCallback.run(ResponseBodyEmitter.java:377)
	at org.springframework.web.context.request.async.DeferredResult$1.handleTimeout(DeferredResult.java:298)
	at org.springframework.web.context.request.async.DeferredResultInterceptorChain.triggerAfterTimeout(DeferredResultInterceptorChain.java:81)
	at org.springframework.web.context.request.async.WebAsyncManager.lambda$startDeferredResultProcessing$5(WebAsyncManager.java:457)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest.onTimeout(StandardServletAsyncWebRequest.java:185)
	at org.apache.catalina.core.AsyncListenerWrapper.fireOnTimeout(AsyncListenerWrapper.java:44)
	at org.apache.catalina.core.AsyncContextImpl.timeout(AsyncContextImpl.java:136)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:135)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:57:03.043 [http-nio-8080-exec-5] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.river.LegalAssistant.exception.GlobalExceptionHandler#handleRuntimeException(RuntimeException)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.river.LegalAssistant.dto.ApiResponse] with preset Content-Type 'text/event-stream;charset=UTF-8'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:319)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:432)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:74)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:175)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1358)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:91)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:632)
	at org.apache.catalina.core.ApplicationDispatcher.doDispatch(ApplicationDispatcher.java:560)
	at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDispatcher.java:531)
	at org.apache.catalina.core.AsyncContextImpl$AsyncRunnable.run(AsyncContextImpl.java:601)
	at org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:344)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:239)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 16:57:03.050 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=6
2025-10-08 16:57:05.129 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 16:57:05.133 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 17:01:23.260 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 9364 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 17:01:23.262 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 17:01:25.495 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 17:01:25.617 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@38d895e8
2025-10-08 17:01:25.659 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 17:01:25.678 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 17:01:25.684 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 17:01:25.766 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 17:01:25.767 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 17:01:26.106 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 17:01:27.078 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 17:01:27.079 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 17:01:27.096 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 17:01:27.096 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 17:01:27.096 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 17:01:27.096 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 17:01:27.096 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 17:01:27.096 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 17:01:27.096 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 17:01:27.127 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 17:01:27.207 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 17:01:27.208 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 17:01:27.863 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 17:01:27.891 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 17:01:27.893 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 17:01:27.897 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 17:01:27.898 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 17:01:27.899 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 17:01:27.929 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 17:01:28.112 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 17:01:28.114 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 17:01:28.114 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 17:01:28.115 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 17:01:28.294 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 17:01:28.301 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 17:01:28.302 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 17:01:28.303 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 17:01:28.303 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 17:01:28.309 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 17:01:28.309 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 17:01:28.331 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 17:01:28.331 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 17:01:28.331 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 17:01:28.331 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 17:01:28.331 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 17:01:28.331 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 17:01:28.332 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 17:01:28.342 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 17:01:28.357 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 17:01:28.357 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 17:01:28.367 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 17:01:28.367 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 17:01:28.369 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 17:01:28.369 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 17:01:28.371 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 17:01:28.371 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 17:01:28.420 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 17:01:28.857 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 17:01:28.936 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 17:01:28.938 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 17:01:28.960 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 17:01:29.095 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 17:01:29.792 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 17:01:30.545 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.679 seconds (process running for 7.947)
2025-10-08 17:01:30.550 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 17:01:30.551 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 17:01:30.643 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 17:02:11.207 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\573fde99c3197ab6b24a557b15e4dac514eae53250c2754db7097329e68420f3_上海市拍卖业委托拍卖合同示范文本.docx
2025-10-08 17:02:11.211 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 上海市拍卖业委托拍卖合同示范文本.docx
2025-10-08 17:02:11.236 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 573fde99c3197ab6b24a557b15e4dac514eae53250c2754db7097329e68420f3 已存在，返回现有审查记录
2025-10-08 17:02:11.243 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 5
2025-10-08 17:02:11.257 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fd6933b2, method=POST, uri=/api/v1/contracts/upload, status=202, duration=109ms
2025-10-08 17:02:11.265 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 上海市拍卖业委托拍卖合同示范文本.docx, 类型: docx, 大小: 30348 bytes
2025-10-08 17:02:11.282 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 5
2025-10-08 17:02:11.286 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 5
2025-10-08 17:02:11.291 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 5
2025-10-08 17:02:11.295 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=5
2025-10-08 17:02:11.299 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=04288362, method=GET, uri=/api/v1/contracts/5/analyze-async, status=200, duration=18ms
2025-10-08 17:02:11.350 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=5
2025-10-08 17:02:11.728 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 上海市拍卖业委托拍卖合同示范文本.docx, 内容长度: 5095 字符
2025-10-08 17:02:11.729 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 5095 字符
2025-10-08 17:02:11.731 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 17:02:14.367 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 5
2025-10-08 17:02:14.369 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 5
2025-10-08 17:02:14.371 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 5
2025-10-08 17:02:14.371 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=92f9ed6b, method=GET, uri=/api/v1/contracts/5/analyze-async, status=200, duration=6ms
2025-10-08 17:02:14.376 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=5
2025-10-08 17:02:14.406 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=5
2025-10-08 17:02:17.418 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 5
2025-10-08 17:02:17.419 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 5
2025-10-08 17:02:17.421 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d3a2a12f, method=GET, uri=/api/v1/contracts/5/analyze-async, status=200, duration=4ms
2025-10-08 17:02:17.421 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 5
2025-10-08 17:02:17.424 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=5
2025-10-08 17:02:17.448 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=5
2025-10-08 17:02:17.802 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 17:02:17.804 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 5, 块数: 403
2025-10-08 17:02:17.804 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 5
2025-10-08 17:02:20.462 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 5
2025-10-08 17:02:20.463 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 5
2025-10-08 17:02:20.465 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=98e99bc9, method=GET, uri=/api/v1/contracts/5/analyze-async, status=200, duration=4ms
2025-10-08 17:02:20.465 [Async-5] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 5
2025-10-08 17:02:20.485 [Async-5] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 5095
2025-10-08 17:02:37.322 [http-nio-8080-exec-8] WARN  c.r.L.service.ContractReviewService - SSE连接超时，标记任务应停止: reviewId=5
2025-10-08 17:02:37.325 [http-nio-8080-exec-8] ERROR c.r.L.e.GlobalExceptionHandler - 运行时异常
org.springframework.web.context.request.async.AsyncRequestTimeoutException: null
	at org.springframework.web.context.request.async.TimeoutDeferredResultProcessingInterceptor.handleTimeout(TimeoutDeferredResultProcessingInterceptor.java:42)
	at org.springframework.web.context.request.async.DeferredResultInterceptorChain.triggerAfterTimeout(DeferredResultInterceptorChain.java:81)
	at org.springframework.web.context.request.async.WebAsyncManager.lambda$startDeferredResultProcessing$5(WebAsyncManager.java:457)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest.onTimeout(StandardServletAsyncWebRequest.java:185)
	at org.apache.catalina.core.AsyncListenerWrapper.fireOnTimeout(AsyncListenerWrapper.java:44)
	at org.apache.catalina.core.AsyncContextImpl.timeout(AsyncContextImpl.java:136)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:135)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 17:02:37.327 [http-nio-8080-exec-8] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.river.LegalAssistant.exception.GlobalExceptionHandler#handleRuntimeException(RuntimeException)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.river.LegalAssistant.dto.ApiResponse] with preset Content-Type 'text/event-stream;charset=UTF-8'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:319)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:432)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:74)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:175)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1358)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:91)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:632)
	at org.apache.catalina.core.ApplicationDispatcher.doDispatch(ApplicationDispatcher.java:560)
	at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDispatcher.java:531)
	at org.apache.catalina.core.AsyncContextImpl$AsyncRunnable.run(AsyncContextImpl.java:601)
	at org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:344)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:239)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 17:02:37.330 [http-nio-8080-exec-8] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Ignoring exception, response committed already: org.springframework.web.context.request.async.AsyncRequestTimeoutException
2025-10-08 17:02:37.330 [http-nio-8080-exec-8] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.context.request.async.AsyncRequestTimeoutException]
2025-10-08 17:02:37.331 [http-nio-8080-exec-8] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=5
2025-10-08 17:02:39.428 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 17:02:39.432 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 17:08:36.171 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 26000 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 17:08:36.172 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 17:08:38.650 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 17:08:38.785 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@6b7a0f18
2025-10-08 17:08:38.839 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 17:08:38.860 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 17:08:38.865 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 17:08:38.945 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 17:08:38.948 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 17:08:39.393 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 17:08:40.577 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 17:08:40.578 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 17:08:40.599 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 17:08:40.599 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 17:08:40.600 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 17:08:40.600 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 17:08:40.600 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 17:08:40.600 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 17:08:40.600 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 17:08:40.641 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 17:08:40.788 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 17:08:40.789 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 17:08:41.535 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 17:08:41.566 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 17:08:41.568 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 17:08:41.573 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 17:08:41.573 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 17:08:41.574 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 17:08:41.606 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 17:08:41.821 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 17:08:41.824 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 17:08:41.824 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 17:08:41.825 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 17:08:42.006 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 17:08:42.013 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 17:08:42.015 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 17:08:42.015 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 17:08:42.015 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 17:08:42.021 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 17:08:42.022 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 17:08:42.045 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 17:08:42.046 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 17:08:42.046 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 17:08:42.046 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 17:08:42.046 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 17:08:42.046 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 17:08:42.046 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 17:08:42.058 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 17:08:42.073 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 17:08:42.074 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 17:08:42.083 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 17:08:42.084 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 17:08:42.087 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 17:08:42.087 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 17:08:42.088 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 17:08:42.089 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 17:08:42.137 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 17:08:42.611 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 17:08:42.701 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 17:08:42.703 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 17:08:42.727 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 17:08:42.880 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 17:08:43.634 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 17:08:44.491 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.736 seconds (process running for 9.029)
2025-10-08 17:08:44.498 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 17:08:44.500 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 17:08:44.610 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 17:09:53.303 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f_农村土地经营权出租合同.docx
2025-10-08 17:09:53.309 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 农村土地经营权出租合同.docx
2025-10-08 17:09:53.344 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f 已存在，返回现有审查记录
2025-10-08 17:09:53.353 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 6
2025-10-08 17:09:53.375 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=336a70db, method=POST, uri=/api/v1/contracts/upload, status=202, duration=142ms
2025-10-08 17:09:53.381 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 农村土地经营权出租合同.docx, 类型: docx, 大小: 30836 bytes
2025-10-08 17:09:53.404 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 6
2025-10-08 17:09:53.408 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 6
2025-10-08 17:09:53.415 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 6
2025-10-08 17:09:53.421 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=6
2025-10-08 17:09:53.428 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d47c7027, method=GET, uri=/api/v1/contracts/6/analyze-async, status=200, duration=27ms
2025-10-08 17:09:53.481 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=6
2025-10-08 17:09:54.152 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 农村土地经营权出租合同.docx, 内容长度: 3686 字符
2025-10-08 17:09:54.153 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3686 字符
2025-10-08 17:09:54.157 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 17:09:56.502 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 6
2025-10-08 17:09:56.504 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 6
2025-10-08 17:09:56.505 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 6
2025-10-08 17:09:56.506 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ab23af53, method=GET, uri=/api/v1/contracts/6/analyze-async, status=200, duration=6ms
2025-10-08 17:09:56.510 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=6
2025-10-08 17:09:56.527 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=6
2025-10-08 17:09:59.547 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 6
2025-10-08 17:09:59.549 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 6
2025-10-08 17:09:59.550 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 6
2025-10-08 17:09:59.550 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=26579243, method=GET, uri=/api/v1/contracts/6/analyze-async, status=200, duration=4ms
2025-10-08 17:09:59.554 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=6
2025-10-08 17:09:59.567 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=6
2025-10-08 17:10:01.586 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 17:10:01.587 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 6, 块数: 403
2025-10-08 17:10:01.588 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 6
2025-10-08 17:10:02.590 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 6
2025-10-08 17:10:02.591 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 6
2025-10-08 17:10:02.592 [Async-5] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 6
2025-10-08 17:10:02.593 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a000bf21, method=GET, uri=/api/v1/contracts/6/analyze-async, status=200, duration=4ms
2025-10-08 17:10:02.617 [Async-5] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 3686
2025-10-08 17:10:32.889 [http-nio-8080-exec-2] WARN  c.r.L.service.ContractReviewService - SSE连接超时，标记任务应停止，但分析将继续在后台进行: reviewId=6
2025-10-08 17:10:32.893 [http-nio-8080-exec-2] ERROR c.r.L.e.GlobalExceptionHandler - 运行时异常
org.springframework.web.context.request.async.AsyncRequestTimeoutException: null
	at org.springframework.web.context.request.async.TimeoutDeferredResultProcessingInterceptor.handleTimeout(TimeoutDeferredResultProcessingInterceptor.java:42)
	at org.springframework.web.context.request.async.DeferredResultInterceptorChain.triggerAfterTimeout(DeferredResultInterceptorChain.java:81)
	at org.springframework.web.context.request.async.WebAsyncManager.lambda$startDeferredResultProcessing$5(WebAsyncManager.java:457)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest.onTimeout(StandardServletAsyncWebRequest.java:185)
	at org.apache.catalina.core.AsyncListenerWrapper.fireOnTimeout(AsyncListenerWrapper.java:44)
	at org.apache.catalina.core.AsyncContextImpl.timeout(AsyncContextImpl.java:136)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:135)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 17:10:32.895 [http-nio-8080-exec-2] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.river.LegalAssistant.exception.GlobalExceptionHandler#handleRuntimeException(RuntimeException)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.river.LegalAssistant.dto.ApiResponse] with preset Content-Type 'text/event-stream;charset=UTF-8'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:319)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:432)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:74)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:175)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1358)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:91)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:632)
	at org.apache.catalina.core.ApplicationDispatcher.doDispatch(ApplicationDispatcher.java:560)
	at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDispatcher.java:531)
	at org.apache.catalina.core.AsyncContextImpl$AsyncRunnable.run(AsyncContextImpl.java:601)
	at org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:344)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:239)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 17:10:32.898 [http-nio-8080-exec-2] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Ignoring exception, response committed already: org.springframework.web.context.request.async.AsyncRequestTimeoutException
2025-10-08 17:10:32.898 [http-nio-8080-exec-2] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.context.request.async.AsyncRequestTimeoutException]
2025-10-08 17:10:32.899 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=6
2025-10-08 17:10:35.002 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 17:10:35.006 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 17:16:16.176 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 6032 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 17:16:16.178 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 17:16:18.460 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 17:16:18.590 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@188ab96
2025-10-08 17:16:18.645 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 17:16:18.670 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 17:16:18.677 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 17:16:18.769 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 17:16:18.772 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 17:16:19.207 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 17:16:20.211 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 17:16:20.212 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 17:16:20.231 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 17:16:20.231 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 17:16:20.232 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 17:16:20.232 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 17:16:20.232 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 17:16:20.232 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 17:16:20.232 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 17:16:20.263 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 17:16:20.351 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 17:16:20.352 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 17:16:21.164 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 17:16:21.193 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 17:16:21.195 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 17:16:21.199 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 17:16:21.200 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 17:16:21.201 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 17:16:21.236 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 17:16:21.462 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 17:16:21.466 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 17:16:21.466 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 17:16:21.466 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 17:16:21.640 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 17:16:21.648 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 17:16:21.650 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 17:16:21.650 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 17:16:21.650 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 17:16:21.657 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 17:16:21.657 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 17:16:21.680 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 17:16:21.681 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 17:16:21.681 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 17:16:21.681 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 17:16:21.681 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 17:16:21.681 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 17:16:21.681 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 17:16:21.692 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 17:16:21.707 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 17:16:21.708 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 17:16:21.720 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 17:16:21.720 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 17:16:21.722 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 17:16:21.722 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 17:16:21.724 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 17:16:21.724 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 17:16:21.771 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 17:16:22.236 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 17:16:22.397 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 17:16:22.400 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 17:16:22.426 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 17:16:22.557 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 17:16:23.159 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 17:16:23.242 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 17:16:24.097 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.314 seconds (process running for 8.594)
2025-10-08 17:16:24.102 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 17:16:24.103 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 17:16:24.212 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 17:16:30.613 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 17:16:30.618 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 17:16:30.635 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd 已存在，返回现有审查记录
2025-10-08 17:16:30.642 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 7
2025-10-08 17:16:30.661 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 广州市既有住宅加装电梯委托管理合同.docx, 类型: docx, 大小: 36076 bytes
2025-10-08 17:16:30.665 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4ee1359f, method=POST, uri=/api/v1/contracts/upload, status=202, duration=114ms
2025-10-08 17:16:30.694 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 7
2025-10-08 17:16:30.697 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 7
2025-10-08 17:16:30.704 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 7
2025-10-08 17:16:30.707 [Async-2] WARN  c.r.L.service.ContractReviewService - 合同正在分析中，忽略重复请求: reviewId=7
2025-10-08 17:16:30.717 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d8679162, method=GET, uri=/api/v1/contracts/7/analyze-async, status=200, duration=26ms
2025-10-08 17:16:31.132 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 广州市既有住宅加装电梯委托管理合同.docx, 内容长度: 3641 字符
2025-10-08 17:16:31.132 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3641 字符
2025-10-08 17:16:31.135 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 17:16:33.739 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 7
2025-10-08 17:16:33.740 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 7
2025-10-08 17:16:33.742 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 7
2025-10-08 17:16:33.742 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=842b442e, method=GET, uri=/api/v1/contracts/7/analyze-async, status=200, duration=4ms
2025-10-08 17:16:33.745 [Async-3] WARN  c.r.L.service.ContractReviewService - 合同正在分析中，忽略重复请求: reviewId=7
2025-10-08 17:16:33.751 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=7
2025-10-08 17:16:36.770 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 7
2025-10-08 17:16:36.772 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 7
2025-10-08 17:16:36.774 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c43c59b5, method=GET, uri=/api/v1/contracts/7/analyze-async, status=200, duration=4ms
2025-10-08 17:16:36.774 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 7
2025-10-08 17:16:36.777 [Async-4] WARN  c.r.L.service.ContractReviewService - 合同正在分析中，忽略重复请求: reviewId=7
2025-10-08 17:16:36.780 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=7
2025-10-08 17:16:38.094 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 17:16:38.094 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 7, 块数: 403
2025-10-08 17:16:38.095 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 7
2025-10-08 17:16:52.293 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 17:16:52.299 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 17:22:06.736 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 25944 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 17:22:06.738 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 17:22:08.975 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 17:22:09.101 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@188ab96
2025-10-08 17:22:09.145 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 17:22:09.165 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 17:22:09.171 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 17:22:09.243 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 17:22:09.244 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 17:22:09.568 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 17:22:10.528 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 17:22:10.529 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 17:22:10.552 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 17:22:10.553 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 17:22:10.553 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 17:22:10.553 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 17:22:10.553 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 17:22:10.553 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 17:22:10.553 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 17:22:10.584 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 17:22:10.670 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 17:22:10.671 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 17:22:11.335 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 17:22:11.363 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 17:22:11.365 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 17:22:11.368 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 17:22:11.369 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 17:22:11.370 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 17:22:11.402 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 17:22:11.567 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 17:22:11.569 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 17:22:11.570 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 17:22:11.570 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 17:22:11.746 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 17:22:11.755 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 17:22:11.757 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 17:22:11.757 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 17:22:11.758 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 17:22:11.764 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 17:22:11.764 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 17:22:11.786 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 17:22:11.787 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 17:22:11.787 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 17:22:11.787 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 17:22:11.787 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 17:22:11.787 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 17:22:11.787 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 17:22:11.799 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 17:22:11.814 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 17:22:11.815 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 17:22:11.825 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 17:22:11.825 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 17:22:11.827 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 17:22:11.827 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 17:22:11.828 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 17:22:11.828 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 17:22:11.876 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 17:22:12.315 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 17:22:12.397 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 17:22:12.408 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 17:22:12.430 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 17:22:12.542 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 17:22:13.166 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 17:22:13.256 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 17:22:14.019 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.673 seconds (process running for 7.949)
2025-10-08 17:22:14.024 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 17:22:14.025 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 17:22:14.122 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 17:22:21.420 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 17:22:21.424 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 17:22:21.449 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 17:22:21.456 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 2
2025-10-08 17:22:21.474 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=73c0c300, method=POST, uri=/api/v1/contracts/upload, status=202, duration=108ms
2025-10-08 17:22:21.480 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 17:22:21.501 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:22:21.504 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:22:21.509 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:22:21.516 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7847aad8, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=18ms
2025-10-08 17:22:21.529 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-08 17:22:22.032 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 17:22:22.032 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 17:22:22.036 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 17:22:29.234 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 17:22:29.234 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 2, 块数: 405
2025-10-08 17:22:29.235 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 2
2025-10-08 17:23:21.518 [HikariPool-1 housekeeper] WARN  c.zaxxer.hikari.pool.ProxyLeakTask - Connection leak detection triggered for org.postgresql.jdbc.PgConnection@188ab96 on thread Async-2, stack trace follows
java.lang.Exception: Apparent connection leak detected
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:127)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:46)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:126)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:156)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getConnectionForTransactionManagement(LogicalConnectionManagedImpl.java:286)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.begin(LogicalConnectionManagedImpl.java:294)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.begin(JdbcResourceLocalTransactionCoordinatorImpl.java:232)
	at org.hibernate.engine.transaction.internal.TransactionImpl.begin(TransactionImpl.java:83)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:176)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:405)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:604)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:373)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 17:23:40.950 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 17:23:41.064 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 17:23:41.078 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=2
2025-10-08 17:23:41.087 [Async-2] INFO  c.zaxxer.hikari.pool.ProxyLeakTask - Previously reported leaked connection org.postgresql.jdbc.PgConnection@188ab96 on thread Async-2 was returned to the pool (unleaked)
2025-10-08 17:23:44.095 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:23:44.097 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:23:44.099 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c261e073, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=5ms
2025-10-08 17:23:44.099 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:23:44.103 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:23:44.120 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:23:47.132 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:23:47.133 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:23:47.135 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:23:47.135 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8fa188e0, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=4ms
2025-10-08 17:23:47.140 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:23:47.154 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:23:50.162 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:23:50.163 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:23:50.166 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=44d4e2bd, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=5ms
2025-10-08 17:23:50.166 [Async-5] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:23:50.169 [Async-5] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:23:50.189 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:23:53.200 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:23:53.201 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:23:53.203 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=66c30ebb, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=4ms
2025-10-08 17:23:53.203 [Async-6] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:23:53.205 [Async-6] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:23:53.217 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:23:56.236 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:23:56.237 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:23:56.239 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ce177f60, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=4ms
2025-10-08 17:23:56.239 [Async-7] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:23:56.243 [Async-7] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:23:56.257 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:23:59.277 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:23:59.278 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:23:59.280 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4d697e52, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=4ms
2025-10-08 17:23:59.280 [Async-8] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:23:59.283 [Async-8] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:23:59.297 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:02.318 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:02.319 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:02.322 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9457dbb6, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=4ms
2025-10-08 17:24:02.322 [Async-9] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:02.325 [Async-9] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:02.344 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:05.353 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:05.355 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:05.356 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6ccbc22b, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:05.357 [Async-10] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:05.359 [Async-10] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:05.371 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:08.377 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:08.378 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:08.380 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:08.380 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7a273b15, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:08.382 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:08.398 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:11.418 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:11.419 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:11.421 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:11.421 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=853d8455, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:11.423 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:11.434 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:14.450 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:14.451 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:14.453 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:14.453 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=46523750, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:14.455 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:14.468 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:17.488 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:17.489 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:17.490 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6d2209a1, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:17.490 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:17.493 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:17.504 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:20.516 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:20.517 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:20.518 [Async-5] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:20.518 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=efe803c8, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=2ms
2025-10-08 17:24:20.520 [Async-5] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:20.540 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:23.560 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:23.561 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:23.562 [Async-6] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:23.562 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f77c1874, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:23.564 [Async-6] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:23.573 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:26.584 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:26.585 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:26.586 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ac537179, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:26.586 [Async-7] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:26.588 [Async-7] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:26.599 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:29.618 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:29.619 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:29.620 [Async-8] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:29.620 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=74e1303e, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:29.622 [Async-8] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:29.632 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:32.642 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:32.643 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:32.644 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e6b4393c, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:32.644 [Async-9] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:32.646 [Async-9] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:32.656 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:35.668 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:35.669 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:35.670 [Async-10] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:35.670 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8bbef873, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:35.673 [Async-10] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:35.683 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:38.692 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:38.693 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:38.694 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=245c576d, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:38.694 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:38.696 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:38.708 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:41.717 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:41.719 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:41.720 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=be06c106, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:41.720 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:41.722 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:41.731 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:44.741 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:44.742 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:44.742 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=77003791, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=2ms
2025-10-08 17:24:44.743 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:44.746 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:44.756 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:47.766 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:47.767 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:47.768 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=89666236, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=2ms
2025-10-08 17:24:47.768 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:47.770 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:47.779 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:50.796 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:50.797 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:50.798 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6d4c7240, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:50.798 [Async-5] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:50.801 [Async-5] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:50.810 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:53.825 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:53.826 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:53.827 [Async-6] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:53.827 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7ea4a45c, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=3ms
2025-10-08 17:24:53.829 [Async-6] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:53.839 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:56.846 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:56.847 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:56.848 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a3747073, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=2ms
2025-10-08 17:24:56.848 [Async-7] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:56.851 [Async-7] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:56.859 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:24:59.873 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:24:59.874 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:24:59.874 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=90603882, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=2ms
2025-10-08 17:24:59.874 [Async-8] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:24:59.877 [Async-8] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:24:59.886 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:25:02.898 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:25:02.899 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:25:02.900 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a2e49cab, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=2ms
2025-10-08 17:25:02.900 [Async-9] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:25:02.903 [Async-9] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:25:02.913 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:25:05.921 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:25:05.922 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:25:05.923 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=36baacdb, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=2ms
2025-10-08 17:25:05.923 [Async-10] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:25:05.932 [Async-10] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:25:05.944 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:25:13.619 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 17:25:13.623 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 17:27:57.751 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 14264 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 17:27:57.753 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 17:28:00.228 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 17:28:00.369 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@69c6e5
2025-10-08 17:28:00.414 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 17:28:00.436 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 17:28:00.443 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 17:28:00.524 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 17:28:00.525 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 17:28:00.891 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 17:28:01.989 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 17:28:01.990 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 17:28:02.010 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 17:28:02.011 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 17:28:02.011 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 17:28:02.011 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 17:28:02.011 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 17:28:02.011 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 17:28:02.011 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 17:28:02.048 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 17:28:02.133 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 17:28:02.134 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 17:28:02.826 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 17:28:02.861 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 17:28:02.863 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 17:28:02.867 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 17:28:02.867 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 17:28:02.868 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 17:28:02.905 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 17:28:03.107 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 17:28:03.110 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 17:28:03.110 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 17:28:03.111 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 17:28:03.294 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 17:28:03.302 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 17:28:03.304 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 17:28:03.304 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 17:28:03.305 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 17:28:03.312 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 17:28:03.312 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 17:28:03.334 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 17:28:03.336 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 17:28:03.336 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 17:28:03.336 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 17:28:03.336 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 17:28:03.336 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 17:28:03.336 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 17:28:03.347 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 17:28:03.363 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 17:28:03.363 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 17:28:03.372 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 17:28:03.373 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 17:28:03.376 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 17:28:03.376 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 17:28:03.377 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 17:28:03.377 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 17:28:03.428 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 17:28:03.929 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 17:28:04.016 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 17:28:04.018 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 17:28:04.040 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 17:28:04.194 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 17:28:04.864 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 17:28:04.948 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 17:28:05.872 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.58 seconds (process running for 8.862)
2025-10-08 17:28:05.878 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 17:28:05.880 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 17:28:05.974 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 17:30:08.548 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 17:30:08.554 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 17:30:08.589 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 17:30:08.600 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 2
2025-10-08 17:30:08.623 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cc3dcf8c, method=POST, uri=/api/v1/contracts/upload, status=202, duration=140ms
2025-10-08 17:30:08.634 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 17:30:08.654 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 2
2025-10-08 17:30:08.659 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 2
2025-10-08 17:30:08.668 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 2
2025-10-08 17:30:08.676 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=2
2025-10-08 17:30:08.681 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8da14ba1, method=GET, uri=/api/v1/contracts/2/analyze-async, status=200, duration=30ms
2025-10-08 17:30:08.738 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=2
2025-10-08 17:30:09.313 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 17:30:09.313 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 17:30:09.319 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 17:30:16.461 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 17:30:16.461 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 2, 块数: 405
2025-10-08 17:30:16.462 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 2
2025-10-08 17:30:28.172 [http-nio-8080-exec-5] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f_农村土地经营权出租合同.docx
2025-10-08 17:30:28.172 [http-nio-8080-exec-5] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 农村土地经营权出租合同.docx
2025-10-08 17:30:28.178 [http-nio-8080-exec-5] WARN  c.r.L.service.ContractReviewService - 文件哈希 bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f 已存在，返回现有审查记录
2025-10-08 17:30:28.180 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 6
2025-10-08 17:30:28.181 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4548573c, method=POST, uri=/api/v1/contracts/upload, status=202, duration=28ms
2025-10-08 17:30:28.185 [Async-3] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 农村土地经营权出租合同.docx, 类型: docx, 大小: 30836 bytes
2025-10-08 17:30:28.200 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 6
2025-10-08 17:30:28.202 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 6
2025-10-08 17:30:28.205 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 6
2025-10-08 17:30:28.206 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a168f531, method=GET, uri=/api/v1/contracts/6/analyze-async, status=200, duration=6ms
2025-10-08 17:30:28.231 [Async-4] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 3686
2025-10-08 17:30:28.359 [Async-3] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 农村土地经营权出租合同.docx, 内容长度: 3686 字符
2025-10-08 17:30:28.359 [Async-3] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3686 字符
2025-10-08 17:30:28.361 [Async-3] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 17:30:35.887 [Async-3] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 17:30:35.888 [Async-3] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 6, 块数: 403
2025-10-08 17:30:35.888 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 6
2025-10-08 17:31:28.208 [HikariPool-1 housekeeper] WARN  c.zaxxer.hikari.pool.ProxyLeakTask - Connection leak detection triggered for org.postgresql.jdbc.PgConnection@69c6e5 on thread Async-4, stack trace follows
java.lang.Exception: Apparent connection leak detected
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:127)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:46)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:126)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:156)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getConnectionForTransactionManagement(LogicalConnectionManagedImpl.java:286)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.begin(LogicalConnectionManagedImpl.java:294)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.begin(JdbcResourceLocalTransactionCoordinatorImpl.java:232)
	at org.hibernate.engine.transaction.internal.TransactionImpl.begin(TransactionImpl.java:83)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:176)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:405)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:604)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:373)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 17:31:35.027 [Async-4] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 17:31:35.100 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 17:31:35.104 [Async-4] INFO  c.zaxxer.hikari.pool.ProxyLeakTask - Previously reported leaked connection org.postgresql.jdbc.PgConnection@69c6e5 on thread Async-4 was returned to the pool (unleaked)
2025-10-08 17:31:35.104 [http-nio-8080-exec-7] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=6
2025-10-08 17:31:38.126 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 6
2025-10-08 17:31:38.127 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 6
2025-10-08 17:31:38.129 [Async-5] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 6
2025-10-08 17:31:38.129 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=41964fd4, method=GET, uri=/api/v1/contracts/6/analyze-async, status=200, duration=4ms
2025-10-08 17:31:38.131 [Async-5] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=6
2025-10-08 17:31:38.145 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=6
2025-10-08 17:32:28.201 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 17:32:28.205 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 17:37:52.150 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 41776 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 17:37:52.151 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 17:37:54.394 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 17:37:54.508 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@42ea14b8
2025-10-08 17:37:54.548 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 17:37:54.575 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 17:37:54.581 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 17:37:54.656 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 17:37:54.658 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 17:37:54.982 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 17:37:56.196 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 17:37:56.197 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 17:37:56.216 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 17:37:56.217 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 17:37:56.217 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 17:37:56.217 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 17:37:56.217 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 17:37:56.217 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 17:37:56.217 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 17:37:56.250 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 17:37:56.336 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 17:37:56.337 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 17:37:57.026 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 17:37:57.054 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 17:37:57.056 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 17:37:57.060 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 17:37:57.061 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 17:37:57.062 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 17:37:57.093 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 17:37:57.267 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 17:37:57.270 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 17:37:57.271 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 17:37:57.271 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 17:37:57.429 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 17:37:57.436 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 17:37:57.438 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 17:37:57.438 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 17:37:57.438 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 17:37:57.444 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 17:37:57.445 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 17:37:57.466 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 17:37:57.466 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 17:37:57.466 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 17:37:57.466 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 17:37:57.467 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 17:37:57.467 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 17:37:57.467 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 17:37:57.477 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 17:37:57.491 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 17:37:57.492 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 17:37:57.501 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 17:37:57.501 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 17:37:57.503 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 17:37:57.504 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 17:37:57.505 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 17:37:57.505 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 17:37:57.550 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 17:37:57.989 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 17:37:58.077 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 17:37:58.079 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 17:37:58.101 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 17:37:58.228 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 17:37:58.870 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 17:37:58.956 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 17:37:59.708 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.952 seconds (process running for 8.218)
2025-10-08 17:37:59.715 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 17:37:59.716 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 17:37:59.800 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 17:38:06.982 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 17:38:07.000 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 17:38:07.023 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd 已存在，返回现有审查记录
2025-10-08 17:38:07.032 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 7
2025-10-08 17:38:07.056 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 广州市既有住宅加装电梯委托管理合同.docx, 类型: docx, 大小: 36076 bytes
2025-10-08 17:38:07.061 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4353f101, method=POST, uri=/api/v1/contracts/upload, status=202, duration=146ms
2025-10-08 17:38:07.088 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 7
2025-10-08 17:38:07.091 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 7
2025-10-08 17:38:07.097 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 7
2025-10-08 17:38:07.115 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=dcd49ed7, method=GET, uri=/api/v1/contracts/7/analyze-async, status=200, duration=30ms
2025-10-08 17:38:07.115 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 3641
2025-10-08 17:38:07.771 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 广州市既有住宅加装电梯委托管理合同.docx, 内容长度: 3641 字符
2025-10-08 17:38:07.772 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3641 字符
2025-10-08 17:38:07.779 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 17:38:14.618 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 17:38:14.618 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 7, 块数: 403
2025-10-08 17:38:14.618 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 7
2025-10-08 17:39:07.108 [HikariPool-1 housekeeper] WARN  c.zaxxer.hikari.pool.ProxyLeakTask - Connection leak detection triggered for org.postgresql.jdbc.PgConnection@42ea14b8 on thread Async-2, stack trace follows
java.lang.Exception: Apparent connection leak detected
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:127)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:46)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:126)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:156)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getConnectionForTransactionManagement(LogicalConnectionManagedImpl.java:286)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.begin(LogicalConnectionManagedImpl.java:294)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.begin(JdbcResourceLocalTransactionCoordinatorImpl.java:232)
	at org.hibernate.engine.transaction.internal.TransactionImpl.begin(TransactionImpl.java:83)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:176)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:405)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:604)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:373)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 17:39:13.683 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 17:39:13.777 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 17:39:13.791 [Async-2] INFO  c.zaxxer.hikari.pool.ProxyLeakTask - Previously reported leaked connection org.postgresql.jdbc.PgConnection@42ea14b8 on thread Async-2 was returned to the pool (unleaked)
2025-10-08 17:39:13.791 [http-nio-8080-exec-9] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=7
2025-10-08 17:39:16.814 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 7
2025-10-08 17:39:16.815 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 7
2025-10-08 17:39:16.816 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ce47ec2b, method=GET, uri=/api/v1/contracts/7/analyze-async, status=200, duration=3ms
2025-10-08 17:39:16.816 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 7
2025-10-08 17:39:16.821 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=7
2025-10-08 17:39:16.835 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=7
2025-10-08 17:39:42.700 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 17:39:42.704 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 17:50:34.661 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 27356 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 17:50:34.662 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 17:50:37.251 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 17:50:37.434 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5add7380
2025-10-08 17:50:37.490 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 17:50:37.509 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 17:50:37.516 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 17:50:37.602 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 17:50:37.604 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 17:50:37.990 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 17:50:39.040 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 17:50:39.041 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 17:50:39.062 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 17:50:39.062 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 17:50:39.063 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 17:50:39.063 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 17:50:39.063 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 17:50:39.063 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 17:50:39.063 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 17:50:39.096 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 17:50:39.192 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 17:50:39.192 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 17:50:39.951 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 17:50:39.980 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 17:50:39.982 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 17:50:39.986 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 17:50:39.987 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 17:50:39.987 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 17:50:40.025 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 17:50:40.207 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 17:50:40.209 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 17:50:40.210 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 17:50:40.210 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 17:50:40.446 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 17:50:40.456 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 17:50:40.458 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 17:50:40.458 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 17:50:40.458 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 17:50:40.465 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 17:50:40.466 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 17:50:40.495 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 17:50:40.495 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 17:50:40.495 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 17:50:40.495 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 17:50:40.495 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 17:50:40.496 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 17:50:40.496 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 17:50:40.508 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 17:50:40.525 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 17:50:40.525 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 17:50:40.535 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 17:50:40.536 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 17:50:40.538 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 17:50:40.539 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 17:50:40.541 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 17:50:40.541 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 17:50:40.604 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 17:50:41.090 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 17:50:41.173 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 17:50:41.175 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 17:50:41.197 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 17:50:41.326 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 17:50:42.036 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 17:50:42.121 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 17:50:42.958 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.734 seconds (process running for 9.022)
2025-10-08 17:50:42.965 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 17:50:42.967 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 17:50:43.062 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 17:51:20.519 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 17:51:20.522 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 17:51:36.627 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 36744 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 17:51:36.628 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 17:51:38.923 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 17:51:39.045 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@567baa55
2025-10-08 17:51:39.089 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 17:51:39.110 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 17:51:39.116 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 17:51:39.201 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 17:51:39.203 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 17:51:39.542 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 17:51:40.493 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 17:51:40.493 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 17:51:40.512 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 17:51:40.512 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 17:51:40.512 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 17:51:40.512 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 17:51:40.512 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 17:51:40.513 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 17:51:40.513 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 17:51:40.543 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 17:51:40.634 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 17:51:40.634 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 17:51:41.393 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 17:51:41.429 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 17:51:41.430 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 17:51:41.434 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 17:51:41.435 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 17:51:41.436 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 17:51:41.467 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 17:51:41.648 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 17:51:41.651 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 17:51:41.651 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 17:51:41.652 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 17:51:41.838 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 17:51:41.846 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 17:51:41.848 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 17:51:41.848 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 17:51:41.848 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 17:51:41.854 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 17:51:41.855 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 17:51:41.879 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 17:51:41.879 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 17:51:41.879 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 17:51:41.879 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 17:51:41.879 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 17:51:41.879 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 17:51:41.880 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 17:51:41.891 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 17:51:41.906 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 17:51:41.907 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 17:51:41.918 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 17:51:41.918 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 17:51:41.920 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 17:51:41.920 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 17:51:41.922 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 17:51:41.922 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 17:51:41.975 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 17:51:42.403 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 17:51:42.479 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 17:51:42.481 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 17:51:42.501 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 17:51:42.634 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 17:51:43.260 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 17:51:43.342 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 17:51:44.167 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.941 seconds (process running for 8.206)
2025-10-08 17:51:44.173 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 17:51:44.174 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 17:51:44.262 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 17:51:52.621 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 17:51:52.625 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 17:51:52.661 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 9, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 17:51:52.677 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 9
2025-10-08 17:51:52.695 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 17:51:52.699 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=129220cc, method=POST, uri=/api/v1/contracts/upload, status=202, duration=128ms
2025-10-08 17:51:52.729 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 17:51:52.733 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 17:51:52.739 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 17:51:52.743 [Async-2] WARN  c.r.L.service.ContractReviewService - 合同文本内容为空，可能文件还在解析中: reviewId=9
2025-10-08 17:51:52.753 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=03785644, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=27ms
2025-10-08 17:51:53.276 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 17:51:53.277 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 17:51:53.282 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 17:52:00.786 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 17:52:00.786 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 9, 块数: 405
2025-10-08 17:52:00.787 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 9
2025-10-08 17:52:23.092 [Async-2] ERROR c.r.L.service.ContractReviewService - 等待超时，合同文本内容仍为空: reviewId=9
2025-10-08 17:52:23.114 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=9
2025-10-08 17:57:19.785 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 17:57:19.790 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 18:00:11.029 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 25560 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 18:00:11.030 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 18:00:13.323 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 18:00:13.452 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@67167f8f
2025-10-08 18:00:13.504 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 18:00:13.523 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 18:00:13.529 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 18:00:13.606 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 18:00:13.608 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 18:00:14.018 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 18:00:15.033 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 18:00:15.034 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 18:00:15.053 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 18:00:15.053 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 18:00:15.053 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 18:00:15.053 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 18:00:15.054 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 18:00:15.054 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 18:00:15.054 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 18:00:15.088 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 18:00:15.221 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 18:00:15.221 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 18:00:15.919 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 18:00:15.946 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 18:00:15.947 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 18:00:15.951 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 18:00:15.952 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 18:00:15.953 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 18:00:15.984 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 18:00:16.162 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 18:00:16.165 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 18:00:16.165 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 18:00:16.165 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 18:00:16.339 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 18:00:16.347 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 18:00:16.348 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 18:00:16.348 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 18:00:16.349 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 18:00:16.354 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 18:00:16.355 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 18:00:16.375 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 18:00:16.376 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 18:00:16.376 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 18:00:16.376 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 18:00:16.376 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 18:00:16.377 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 18:00:16.377 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 18:00:16.388 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 18:00:16.409 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 18:00:16.409 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 18:00:16.420 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 18:00:16.420 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 18:00:16.422 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 18:00:16.423 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 18:00:16.425 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 18:00:16.425 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 18:00:16.474 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 18:00:16.920 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 18:00:16.995 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 18:00:16.997 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 18:00:17.015 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 18:00:17.145 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 18:00:17.819 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 18:00:17.909 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 18:00:18.694 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.09 seconds (process running for 8.368)
2025-10-08 18:00:18.699 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 18:00:18.701 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 18:00:18.789 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 18:00:26.962 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:00:26.966 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:00:26.993 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 18:00:27.001 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 9
2025-10-08 18:00:27.021 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=371e1592, method=POST, uri=/api/v1/contracts/upload, status=202, duration=110ms
2025-10-08 18:00:27.024 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 18:00:27.051 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 18:00:27.054 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 18:00:27.060 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 18:00:27.065 [Async-2] WARN  c.r.L.service.ContractReviewService - 合同文本内容为空，可能文件还在解析中: reviewId=9
2025-10-08 18:00:27.073 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4d5c7700, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=25ms
2025-10-08 18:00:27.514 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 18:00:27.514 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 18:00:27.517 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 18:00:34.739 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 18:00:34.739 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 9, 块数: 405
2025-10-08 18:00:34.740 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 9
2025-10-08 18:01:27.062 [HikariPool-1 housekeeper] WARN  c.zaxxer.hikari.pool.ProxyLeakTask - Connection leak detection triggered for org.postgresql.jdbc.PgConnection@67167f8f on thread Async-2, stack trace follows
java.lang.Exception: Apparent connection leak detected
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:127)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:46)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:126)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:156)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getConnectionForTransactionManagement(LogicalConnectionManagedImpl.java:286)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.begin(LogicalConnectionManagedImpl.java:294)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.begin(JdbcResourceLocalTransactionCoordinatorImpl.java:232)
	at org.hibernate.engine.transaction.internal.TransactionImpl.begin(TransactionImpl.java:83)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:176)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:405)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:604)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:373)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:03:29.052 [Async-2] ERROR c.r.L.service.ContractReviewService - 等待超时，合同文本内容仍为空: reviewId=9, 总等待时间: 181秒
2025-10-08 18:03:29.063 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=9
2025-10-08 18:03:29.066 [Async-2] INFO  c.zaxxer.hikari.pool.ProxyLeakTask - Previously reported leaked connection org.postgresql.jdbc.PgConnection@67167f8f on thread Async-2 was returned to the pool (unleaked)
2025-10-08 18:04:12.888 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 18:04:12.891 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 18:10:33.855 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 24852 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 18:10:33.857 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 18:10:36.372 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 18:10:36.521 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@7657d29f
2025-10-08 18:10:36.582 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 18:10:36.603 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 18:10:36.610 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 18:10:36.701 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 18:10:36.702 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 18:10:37.151 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 18:10:38.259 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 18:10:38.261 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 18:10:38.279 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 18:10:38.279 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 18:10:38.279 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 18:10:38.279 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 18:10:38.279 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 18:10:38.280 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 18:10:38.280 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 18:10:38.314 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 18:10:38.446 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 18:10:38.447 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 18:10:39.186 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 18:10:39.217 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 18:10:39.219 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 18:10:39.223 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 18:10:39.223 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 18:10:39.224 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 18:10:39.257 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 18:10:39.429 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 18:10:39.431 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 18:10:39.431 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 18:10:39.432 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 18:10:39.608 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 18:10:39.616 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 18:10:39.618 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 18:10:39.618 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 18:10:39.619 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 18:10:39.625 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 18:10:39.626 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 18:10:39.651 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 18:10:39.652 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 18:10:39.652 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 18:10:39.652 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 18:10:39.652 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 18:10:39.652 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 18:10:39.653 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 18:10:39.663 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 18:10:39.679 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 18:10:39.680 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 18:10:39.690 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 18:10:39.690 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 18:10:39.693 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 18:10:39.693 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 18:10:39.695 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 18:10:39.695 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 18:10:39.747 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 18:10:40.240 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 18:10:40.339 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 18:10:40.341 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 18:10:40.366 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 18:10:40.500 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 18:10:41.125 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 18:10:41.215 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 18:10:42.019 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.619 seconds (process running for 8.916)
2025-10-08 18:10:42.026 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 18:10:42.027 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 18:10:42.140 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 18:10:53.310 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:10:53.316 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:10:53.343 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 18:10:53.353 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 9
2025-10-08 18:10:53.353 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 18:10:53.378 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=dd65a183, method=POST, uri=/api/v1/contracts/upload, status=202, duration=133ms
2025-10-08 18:10:53.381 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:10:53.382 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 18:10:53.406 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 18:10:53.409 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 18:10:53.415 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 18:10:53.420 [Async-2] WARN  c.r.L.service.ContractReviewService - 合同文本内容为空，可能文件还在解析中: reviewId=9
2025-10-08 18:10:53.428 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=83cf5cfd, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=26ms
2025-10-08 18:10:54.142 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 18:10:54.143 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-08 18:10:54.144 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=9, 文本长度: 7321
2025-10-08 18:10:54.144 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 18:10:54.151 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 18:11:01.771 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 18:11:01.771 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 9, 块数: 405
2025-10-08 18:11:01.772 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 9
2025-10-08 18:11:01.772 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 9
2025-10-08 18:11:23.748 [Async-2] INFO  c.r.L.service.ContractReviewService - 仍在等待文件解析完成: reviewId=9, 已等待30秒
2025-10-08 18:11:53.420 [HikariPool-1 housekeeper] WARN  c.zaxxer.hikari.pool.ProxyLeakTask - Connection leak detection triggered for org.postgresql.jdbc.PgConnection@7657d29f on thread Async-2, stack trace follows
java.lang.Exception: Apparent connection leak detected
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:127)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:46)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:126)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:156)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getConnectionForTransactionManagement(LogicalConnectionManagedImpl.java:286)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.begin(LogicalConnectionManagedImpl.java:294)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.begin(JdbcResourceLocalTransactionCoordinatorImpl.java:232)
	at org.hibernate.engine.transaction.internal.TransactionImpl.begin(TransactionImpl.java:83)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:176)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:405)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:604)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:373)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:11:54.029 [Async-2] INFO  c.r.L.service.ContractReviewService - 仍在等待文件解析完成: reviewId=9, 已等待60秒
2025-10-08 18:12:24.368 [Async-2] INFO  c.r.L.service.ContractReviewService - 仍在等待文件解析完成: reviewId=9, 已等待90秒
2025-10-08 18:12:31.148 [http-nio-8080-exec-3] WARN  c.r.L.service.ContractReviewService - SSE连接超时，标记任务应停止，但分析将继续在后台进行: reviewId=9
2025-10-08 18:12:31.158 [http-nio-8080-exec-3] WARN  c.r.L.e.GlobalExceptionHandler - SSE异步请求超时: null
2025-10-08 18:12:31.159 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=9
2025-10-08 18:12:31.426 [Async-2] ERROR c.r.L.service.ContractReviewService - 等待超时，合同文本内容仍为空: reviewId=9, 总等待时间: 98秒
2025-10-08 18:12:31.427 [Async-2] WARN  c.r.L.service.ContractReviewService - SSE连接已关闭，跳过发送进度消息: ResponseBodyEmitter has already completed
2025-10-08 18:12:31.437 [Async-2] INFO  c.zaxxer.hikari.pool.ProxyLeakTask - Previously reported leaked connection org.postgresql.jdbc.PgConnection@7657d29f on thread Async-2 was returned to the pool (unleaked)
2025-10-08 18:12:33.240 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 18:12:33.243 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 18:17:47.948 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 14940 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 18:17:47.949 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 18:17:50.321 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 18:17:50.454 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@9c40f43
2025-10-08 18:17:50.497 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 18:17:50.527 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 18:17:50.534 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 18:17:50.609 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 18:17:50.611 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 18:17:51.025 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 18:17:51.990 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 18:17:51.991 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 18:17:52.007 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 18:17:52.008 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 18:17:52.008 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 18:17:52.008 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 18:17:52.008 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 18:17:52.008 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 18:17:52.009 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 18:17:52.039 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 18:17:52.123 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 18:17:52.124 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 18:17:52.872 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 18:17:52.900 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 18:17:52.902 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 18:17:52.907 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 18:17:52.908 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 18:17:52.908 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 18:17:52.938 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 18:17:53.119 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 18:17:53.122 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 18:17:53.122 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 18:17:53.122 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 18:17:53.335 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 18:17:53.344 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 18:17:53.346 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 18:17:53.346 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 18:17:53.346 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 18:17:53.353 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 18:17:53.353 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 18:17:53.380 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 18:17:53.380 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 18:17:53.380 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 18:17:53.380 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 18:17:53.380 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 18:17:53.380 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 18:17:53.380 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 18:17:53.391 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 18:17:53.410 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 18:17:53.411 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 18:17:53.421 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 18:17:53.421 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 18:17:53.424 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 18:17:53.424 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 18:17:53.425 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 18:17:53.426 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 18:17:53.479 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 18:17:53.934 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 18:17:54.031 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 18:17:54.034 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 18:17:54.053 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 18:17:54.166 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 18:17:54.954 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 18:17:55.063 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 18:17:55.865 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.354 seconds (process running for 8.677)
2025-10-08 18:17:55.871 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 18:17:55.872 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 18:17:55.976 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 18:17:56.209 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 18:17:56.275 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 18:17:56.283 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 18:17:56.297 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7ddcf1f2, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=105ms
2025-10-08 18:17:56.329 [Async-1] WARN  c.r.L.service.ContractReviewService - 合同文本内容为空，可能文件还在解析中: reviewId=9
2025-10-08 18:18:26.692 [Async-1] INFO  c.r.L.service.ContractReviewService - 仍在等待文件解析完成: reviewId=9, 已等待30秒
2025-10-08 18:18:26.697 [Async-1] WARN  c.r.L.service.ContractReviewService - 发送SSE进度消息失败: ServletOutputStream failed to flush: java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
2025-10-08 18:18:26.697 [http-nio-8080-exec-2] WARN  c.r.L.service.ContractReviewService - SSE连接出现错误，标记任务应停止: reviewId=9
java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:137)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:102)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:58)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:542)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:122)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1378)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:728)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:712)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1252)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:299)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:265)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:136)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:412)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:155)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1207)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:483)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:123)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:221)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.send(ResponseBodyEmitterReturnValueHandler.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:223)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:214)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.service.ContractReviewService.sendProgress(ContractReviewService.java:759)
	at com.river.LegalAssistant.service.ContractReviewService.waitForFileParsingCompletion(ContractReviewService.java:321)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:428)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:18:26.706 [http-nio-8080-exec-2] ERROR c.r.L.e.GlobalExceptionHandler - 未处理的异常
java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:137)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:102)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:58)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:542)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:122)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1378)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:728)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:712)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1252)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:299)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:265)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:136)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:412)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:155)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1207)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:483)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:123)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:221)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.send(ResponseBodyEmitterReturnValueHandler.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:223)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:214)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.service.ContractReviewService.sendProgress(ContractReviewService.java:759)
	at com.river.LegalAssistant.service.ContractReviewService.waitForFileParsingCompletion(ContractReviewService.java:321)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:428)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:18:26.712 [http-nio-8080-exec-2] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.river.LegalAssistant.exception.GlobalExceptionHandler#handleGeneralException(Exception)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.river.LegalAssistant.dto.ApiResponse] with preset Content-Type 'text/event-stream;charset=UTF-8'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:319)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:432)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:74)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:175)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1358)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:91)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:632)
	at org.apache.catalina.core.ApplicationDispatcher.doDispatch(ApplicationDispatcher.java:560)
	at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDispatcher.java:531)
	at org.apache.catalina.core.AsyncContextImpl$AsyncRunnable.run(AsyncContextImpl.java:601)
	at org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:344)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:239)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:18:26.716 [http-nio-8080-exec-2] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] threw exception
java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:137)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:102)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:58)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:542)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:122)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1378)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:728)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:712)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1252)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:299)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:265)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:136)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:412)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:155)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1207)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:483)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:123)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:221)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.send(ResponseBodyEmitterReturnValueHandler.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:223)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:214)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.service.ContractReviewService.sendProgress(ContractReviewService.java:759)
	at com.river.LegalAssistant.service.ContractReviewService.waitForFileParsingCompletion(ContractReviewService.java:321)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:428)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:18:26.718 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=9
2025-10-08 18:18:26.719 [http-nio-8080-exec-2] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [/api/v1] threw exception
java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:137)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:102)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:58)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:542)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:122)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1378)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:728)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:712)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1252)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:299)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:265)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:136)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:412)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:155)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1207)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:483)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:123)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:221)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.send(ResponseBodyEmitterReturnValueHandler.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:223)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:214)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.service.ContractReviewService.sendProgress(ContractReviewService.java:759)
	at com.river.LegalAssistant.service.ContractReviewService.waitForFileParsingCompletion(ContractReviewService.java:321)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:428)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:18:27.706 [Async-1] ERROR c.r.L.service.ContractReviewService - 等待超时，合同文本内容仍为空: reviewId=9
2025-10-08 18:18:27.707 [Async-1] WARN  c.r.L.service.ContractReviewService - SSE连接已关闭，跳过发送进度消息: ResponseBodyEmitter has already completed
2025-10-08 18:18:38.780 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 18:18:38.784 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 18:18:47.488 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 40544 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 18:18:47.490 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 18:18:49.729 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 18:18:49.844 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@63a9af28
2025-10-08 18:18:49.884 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 18:18:49.902 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 18:18:49.908 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 18:18:49.985 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 18:18:49.987 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 18:18:50.346 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 18:18:51.383 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 18:18:51.384 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 18:18:51.404 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 18:18:51.405 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 18:18:51.405 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 18:18:51.405 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 18:18:51.405 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 18:18:51.405 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 18:18:51.405 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 18:18:51.436 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 18:18:51.524 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 18:18:51.525 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 18:18:52.172 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 18:18:52.197 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 18:18:52.199 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 18:18:52.203 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 18:18:52.203 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 18:18:52.204 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 18:18:52.236 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 18:18:52.412 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 18:18:52.414 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 18:18:52.415 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 18:18:52.415 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 18:18:52.593 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 18:18:52.601 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 18:18:52.603 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 18:18:52.603 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 18:18:52.603 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 18:18:52.610 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 18:18:52.610 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 18:18:52.634 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 18:18:52.634 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 18:18:52.634 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 18:18:52.634 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 18:18:52.634 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 18:18:52.634 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 18:18:52.635 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 18:18:52.650 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 18:18:52.665 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 18:18:52.665 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 18:18:52.674 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 18:18:52.674 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 18:18:52.677 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 18:18:52.677 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 18:18:52.679 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 18:18:52.679 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 18:18:52.727 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 18:18:53.157 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 18:18:53.240 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 18:18:53.242 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 18:18:53.263 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 18:18:53.394 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 18:18:54.041 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 18:18:54.123 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 18:18:54.880 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.791 seconds (process running for 8.129)
2025-10-08 18:18:54.886 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 18:18:54.887 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 18:18:54.976 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 18:19:12.681 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 18:19:12.685 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 18:19:12.729 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 10, 文件: 广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 18:19:12.737 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 10
2025-10-08 18:19:12.737 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 18:19:12.753 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 广州市既有住宅加装电梯委托管理合同.docx, 路径: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 18:19:12.753 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 广州市既有住宅加装电梯委托管理合同.docx, 类型: docx, 大小: 36076 bytes
2025-10-08 18:19:12.757 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2e5a87be, method=POST, uri=/api/v1/contracts/upload, status=202, duration=128ms
2025-10-08 18:19:12.781 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 10
2025-10-08 18:19:12.785 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 10
2025-10-08 18:19:12.791 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 10
2025-10-08 18:19:12.795 [Async-2] WARN  c.r.L.service.ContractReviewService - 合同文本内容为空，可能文件还在解析中: reviewId=10
2025-10-08 18:19:12.804 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bded4655, method=GET, uri=/api/v1/contracts/10/analyze-async, status=200, duration=25ms
2025-10-08 18:19:13.202 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 广州市既有住宅加装电梯委托管理合同.docx, 内容长度: 3641 字符
2025-10-08 18:19:13.203 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 广州市既有住宅加装电梯委托管理合同.docx, 内容长度: 3641
2025-10-08 18:19:13.203 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=10, 文本长度: 3641
2025-10-08 18:19:13.204 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3641 字符
2025-10-08 18:19:13.206 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 18:19:19.958 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 18:19:19.959 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 10, 块数: 403
2025-10-08 18:19:19.959 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 10
2025-10-08 18:19:19.959 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 10
2025-10-08 18:19:43.121 [Async-2] INFO  c.r.L.service.ContractReviewService - 仍在等待文件解析完成: reviewId=10, 已等待30秒
2025-10-08 18:20:12.799 [HikariPool-1 housekeeper] WARN  c.zaxxer.hikari.pool.ProxyLeakTask - Connection leak detection triggered for org.postgresql.jdbc.PgConnection@63a9af28 on thread Async-2, stack trace follows
java.lang.Exception: Apparent connection leak detected
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:127)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:46)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:126)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:156)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getConnectionForTransactionManagement(LogicalConnectionManagedImpl.java:286)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.begin(LogicalConnectionManagedImpl.java:294)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.begin(JdbcResourceLocalTransactionCoordinatorImpl.java:232)
	at org.hibernate.engine.transaction.internal.TransactionImpl.begin(TransactionImpl.java:83)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:176)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:405)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:604)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:373)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:20:13.405 [Async-2] INFO  c.r.L.service.ContractReviewService - 仍在等待文件解析完成: reviewId=10, 已等待60秒
2025-10-08 18:20:13.406 [Async-2] WARN  c.r.L.service.ContractReviewService - 发送SSE进度消息失败: ServletOutputStream failed to flush: java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
2025-10-08 18:20:13.406 [http-nio-8080-exec-6] WARN  c.r.L.service.ContractReviewService - SSE连接出现错误，标记任务应停止: reviewId=10
java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:137)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:102)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:58)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:542)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:122)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1378)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:728)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:712)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1252)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:299)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:265)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:136)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:412)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:155)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1207)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:483)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:123)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:221)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.send(ResponseBodyEmitterReturnValueHandler.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:223)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:214)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.service.ContractReviewService.sendProgress(ContractReviewService.java:759)
	at com.river.LegalAssistant.service.ContractReviewService.waitForFileParsingCompletion(ContractReviewService.java:321)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:428)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:20:13.416 [http-nio-8080-exec-6] ERROR c.r.L.e.GlobalExceptionHandler - 未处理的异常
java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:137)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:102)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:58)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:542)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:122)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1378)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:728)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:712)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1252)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:299)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:265)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:136)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:412)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:155)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1207)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:483)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:123)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:221)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.send(ResponseBodyEmitterReturnValueHandler.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:223)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:214)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.service.ContractReviewService.sendProgress(ContractReviewService.java:759)
	at com.river.LegalAssistant.service.ContractReviewService.waitForFileParsingCompletion(ContractReviewService.java:321)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:428)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:20:13.418 [http-nio-8080-exec-6] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.river.LegalAssistant.exception.GlobalExceptionHandler#handleGeneralException(Exception)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.river.LegalAssistant.dto.ApiResponse] with preset Content-Type 'text/event-stream;charset=UTF-8'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:319)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:432)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:74)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:175)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1358)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:91)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:101)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:632)
	at org.apache.catalina.core.ApplicationDispatcher.doDispatch(ApplicationDispatcher.java:560)
	at org.apache.catalina.core.ApplicationDispatcher.dispatch(ApplicationDispatcher.java:531)
	at org.apache.catalina.core.AsyncContextImpl$AsyncRunnable.run(AsyncContextImpl.java:601)
	at org.apache.catalina.core.AsyncContextImpl.doInternalDispatch(AsyncContextImpl.java:344)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:239)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:20:13.421 [http-nio-8080-exec-6] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] threw exception
java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:137)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:102)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:58)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:542)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:122)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1378)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:728)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:712)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1252)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:299)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:265)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:136)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:412)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:155)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1207)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:483)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:123)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:221)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.send(ResponseBodyEmitterReturnValueHandler.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:223)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:214)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.service.ContractReviewService.sendProgress(ContractReviewService.java:759)
	at com.river.LegalAssistant.service.ContractReviewService.waitForFileParsingCompletion(ContractReviewService.java:321)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:428)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:20:13.423 [http-nio-8080-exec-6] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=10
2025-10-08 18:20:13.423 [http-nio-8080-exec-6] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [/api/v1] threw exception
java.io.IOException: 你的主机中的软件中止了一个已建立的连接。
	at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
	at java.base/sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:54)
	at java.base/sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:137)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:102)
	at java.base/sun.nio.ch.IOUtil.write(IOUtil.java:58)
	at java.base/sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:542)
	at org.apache.tomcat.util.net.NioChannel.write(NioChannel.java:122)
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1378)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.flushBlocking(SocketWrapperBase.java:728)
	at org.apache.tomcat.util.net.SocketWrapperBase.flush(SocketWrapperBase.java:712)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.flush(Http11OutputBuffer.java:574)
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.flush(ChunkedOutputFilter.java:156)
	at org.apache.coyote.http11.Http11OutputBuffer.flush(Http11OutputBuffer.java:216)
	at org.apache.coyote.http11.Http11Processor.flush(Http11Processor.java:1252)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:408)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:299)
	at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:265)
	at org.apache.catalina.connector.CoyoteOutputStream.flush(CoyoteOutputStream.java:136)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.flush(OnCommittedResponseWrapper.java:524)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.flush(StandardServletAsyncWebRequest.java:412)
	at java.base/java.io.FilterOutputStream.flush(FilterOutputStream.java:155)
	at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1207)
	at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:1063)
	at org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter.writeInternal(AbstractJackson2HttpMessageConverter.java:483)
	at org.springframework.http.converter.AbstractGenericHttpMessageConverter.writeInternal(AbstractGenericHttpMessageConverter.java:123)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.sendInternal(ResponseBodyEmitterReturnValueHandler.java:221)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler$HttpMessageConvertingHandler.send(ResponseBodyEmitterReturnValueHandler.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.sendInternal(ResponseBodyEmitter.java:223)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:214)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.service.ContractReviewService.sendProgress(ContractReviewService.java:759)
	at com.river.LegalAssistant.service.ContractReviewService.waitForFileParsingCompletion(ContractReviewService.java:321)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:428)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:20:14.416 [Async-2] ERROR c.r.L.service.ContractReviewService - 等待超时，合同文本内容仍为空: reviewId=10
2025-10-08 18:20:14.417 [Async-2] WARN  c.r.L.service.ContractReviewService - SSE连接已关闭，跳过发送进度消息: ResponseBodyEmitter has already completed
2025-10-08 18:20:14.428 [Async-2] INFO  c.zaxxer.hikari.pool.ProxyLeakTask - Previously reported leaked connection org.postgresql.jdbc.PgConnection@63a9af28 on thread Async-2 was returned to the pool (unleaked)
2025-10-08 18:20:29.898 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 18:20:29.901 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 18:25:22.877 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 28340 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 18:25:22.879 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 18:25:25.174 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 18:25:25.342 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1ab717f3
2025-10-08 18:25:25.396 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 18:25:25.415 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 18:25:25.420 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 18:25:25.499 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 18:25:25.500 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 18:25:25.837 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 18:25:26.781 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 18:25:26.783 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 18:25:26.801 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 18:25:26.802 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 18:25:26.802 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 18:25:26.802 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 18:25:26.802 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 18:25:26.802 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 18:25:26.802 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 18:25:26.832 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 18:25:26.935 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 18:25:26.936 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 18:25:27.603 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 18:25:27.630 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 18:25:27.632 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 18:25:27.635 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 18:25:27.636 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 18:25:27.637 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 18:25:27.668 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 18:25:27.833 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 18:25:27.836 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 18:25:27.836 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 18:25:27.836 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 18:25:28.015 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 18:25:28.022 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 18:25:28.024 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 18:25:28.024 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 18:25:28.024 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 18:25:28.029 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 18:25:28.031 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 18:25:28.056 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 18:25:28.056 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 18:25:28.056 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 18:25:28.056 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 18:25:28.056 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 18:25:28.057 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 18:25:28.057 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 18:25:28.068 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 18:25:28.083 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 18:25:28.084 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 18:25:28.094 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 18:25:28.095 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 18:25:28.097 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 18:25:28.097 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 18:25:28.099 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 18:25:28.099 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 18:25:28.151 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 18:25:29.005 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 18:25:29.103 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 18:25:29.105 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 18:25:29.124 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 18:25:29.240 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 18:25:29.865 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 18:25:29.948 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 18:25:30.738 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.276 seconds (process running for 8.728)
2025-10-08 18:25:30.743 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 18:25:30.744 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 18:25:30.831 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 18:26:00.412 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 18:26:00.418 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 18:26:00.447 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd 已存在，返回现有审查记录
2025-10-08 18:26:00.457 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 10
2025-10-08 18:26:00.457 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 18:26:00.481 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5b1d516a, method=POST, uri=/api/v1/contracts/upload, status=202, duration=131ms
2025-10-08 18:26:00.483 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 广州市既有住宅加装电梯委托管理合同.docx, 路径: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 18:26:00.483 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 广州市既有住宅加装电梯委托管理合同.docx, 类型: docx, 大小: 36076 bytes
2025-10-08 18:26:00.507 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 10
2025-10-08 18:26:00.510 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 10
2025-10-08 18:26:00.518 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 10
2025-10-08 18:26:00.520 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 18:26:00.528 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8ce98ab3, method=GET, uri=/api/v1/contracts/10/analyze-async, status=200, duration=24ms
2025-10-08 18:26:00.529 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:26:00.565 [Async-2] WARN  c.r.L.service.ContractReviewService - 合同文本内容为空，可能文件还在解析中: reviewId=10
2025-10-08 18:26:01.180 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 广州市既有住宅加装电梯委托管理合同.docx, 内容长度: 3641 字符
2025-10-08 18:26:01.180 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 广州市既有住宅加装电梯委托管理合同.docx, 内容长度: 3641
2025-10-08 18:26:01.182 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=10, 文本长度: 3641
2025-10-08 18:26:01.182 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3641 字符
2025-10-08 18:26:01.187 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 18:26:01.581 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 18:26:01.583 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:26:02.592 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 18:26:02.594 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:26:03.607 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 18:26:03.609 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:26:04.626 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 18:26:04.628 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:26:05.636 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 18:26:05.640 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:26:06.649 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 18:26:06.651 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:26:07.662 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 18:26:07.663 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:26:08.678 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 18:26:08.679 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:26:08.840 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 18:26:08.840 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 10, 块数: 403
2025-10-08 18:26:08.841 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 10
2025-10-08 18:26:08.841 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 10
2025-10-08 18:26:09.691 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 18:26:09.693 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 3641
2025-10-08 18:26:09.694 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 9秒, reviewId=10
2025-10-08 18:26:09.695 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，开始分析: reviewId=10, 文本长度: 3641
2025-10-08 18:26:09.709 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 3641
2025-10-08 18:27:00.520 [HikariPool-1 housekeeper] WARN  c.zaxxer.hikari.pool.ProxyLeakTask - Connection leak detection triggered for org.postgresql.jdbc.PgConnection@1ab717f3 on thread Async-2, stack trace follows
java.lang.Exception: Apparent connection leak detected
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:127)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:46)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:126)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:156)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getConnectionForTransactionManagement(LogicalConnectionManagedImpl.java:286)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.begin(LogicalConnectionManagedImpl.java:294)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.begin(JdbcResourceLocalTransactionCoordinatorImpl.java:232)
	at org.hibernate.engine.transaction.internal.TransactionImpl.begin(TransactionImpl.java:83)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:176)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:405)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:604)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:373)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:27:10.404 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 18:27:10.455 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 18:27:10.459 [Async-2] INFO  c.zaxxer.hikari.pool.ProxyLeakTask - Previously reported leaked connection org.postgresql.jdbc.PgConnection@1ab717f3 on thread Async-2 was returned to the pool (unleaked)
2025-10-08 18:27:10.466 [http-nio-8080-exec-9] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=10
2025-10-08 18:27:13.487 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 10
2025-10-08 18:27:13.488 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 10
2025-10-08 18:27:13.489 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2756fb19, method=GET, uri=/api/v1/contracts/10/analyze-async, status=200, duration=3ms
2025-10-08 18:27:13.489 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 10
2025-10-08 18:27:13.490 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 18:27:13.493 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:27:13.495 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=10
2025-10-08 18:27:13.504 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=10
2025-10-08 18:27:36.329 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 18:27:36.332 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 18:35:12.993 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 36848 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 18:35:12.996 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 18:35:15.524 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 18:35:15.791 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@105cdf61
2025-10-08 18:35:15.853 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 18:35:15.873 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 18:35:15.879 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 18:35:15.961 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 18:35:15.963 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 18:35:16.405 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 18:35:17.511 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 18:35:17.512 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 18:35:17.530 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 18:35:17.530 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 18:35:17.531 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 18:35:17.531 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 18:35:17.531 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 18:35:17.531 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 18:35:17.531 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 18:35:17.565 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 18:35:17.696 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 18:35:17.696 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 18:35:18.398 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 18:35:18.427 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 18:35:18.429 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 18:35:18.433 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 18:35:18.434 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 18:35:18.435 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 18:35:18.471 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 18:35:18.643 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 18:35:18.645 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 18:35:18.645 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 18:35:18.646 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 18:35:18.843 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 18:35:18.853 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 18:35:18.855 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 18:35:18.856 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 18:35:18.856 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 18:35:18.863 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 18:35:18.863 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 18:35:18.890 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 18:35:18.890 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 18:35:18.890 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 18:35:18.890 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 18:35:18.890 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 18:35:18.892 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 18:35:18.892 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 18:35:18.903 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 18:35:18.918 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 18:35:18.918 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 18:35:18.935 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 18:35:18.935 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 18:35:18.937 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 18:35:18.937 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 18:35:18.939 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 18:35:18.939 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 18:35:18.997 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 18:35:19.542 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 18:35:19.628 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 18:35:19.630 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 18:35:19.658 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 18:35:19.782 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 18:35:20.431 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 18:35:20.522 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 18:35:21.374 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.789 seconds (process running for 9.06)
2025-10-08 18:35:21.379 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 18:35:21.381 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 18:35:21.484 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 18:35:42.113 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:35:42.119 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:35:42.148 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 18:35:42.157 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 9
2025-10-08 18:35:42.158 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 18:35:42.182 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2e6ac131, method=POST, uri=/api/v1/contracts/upload, status=202, duration=136ms
2025-10-08 18:35:42.185 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:35:42.185 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 18:35:42.210 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 18:35:42.214 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 18:35:42.220 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 18:35:42.221 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:35:42.223 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:35:42.234 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b3e1e43b, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=27ms
2025-10-08 18:35:42.285 [Async-2] WARN  c.r.L.service.ContractReviewService - 合同文本内容为空，可能文件还在解析中: reviewId=9
2025-10-08 18:35:42.879 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 18:35:42.880 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-08 18:35:42.881 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=9, 文本长度: 7321
2025-10-08 18:35:42.881 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 18:35:42.887 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 18:35:43.301 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:35:43.303 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:35:44.320 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:35:44.323 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:35:45.339 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:35:45.341 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:35:46.349 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:35:46.352 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:35:47.365 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:35:47.369 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:35:48.375 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:35:48.377 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:35:49.388 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:35:49.390 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:35:50.237 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 18:35:50.237 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 9, 块数: 405
2025-10-08 18:35:50.238 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 9
2025-10-08 18:35:50.238 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 9
2025-10-08 18:35:50.395 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:35:50.397 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 18:35:50.398 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 8秒, reviewId=9
2025-10-08 18:35:50.399 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，开始分析: reviewId=9, 文本长度: 7321
2025-10-08 18:35:50.409 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-08 18:37:02.367 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 18:37:02.425 [Async-2] ERROR c.r.L.service.ContractReviewService - 发送分析结果失败
org.hibernate.LazyInitializationException: could not initialize proxy [com.river.LegalAssistant.entity.User#1] - no Session
	at org.hibernate.proxy.AbstractLazyInitializer.initialize(AbstractLazyInitializer.java:165)
	at org.hibernate.proxy.AbstractLazyInitializer.getImplementation(AbstractLazyInitializer.java:314)
	at org.hibernate.proxy.pojo.bytebuddy.ByteBuddyInterceptor.intercept(ByteBuddyInterceptor.java:44)
	at org.hibernate.proxy.ProxyConfiguration$InterceptorDispatcher.intercept(ProxyConfiguration.java:102)
	at com.river.LegalAssistant.entity.User$HibernateProxy$dj06ZVMy.getUsername(Unknown Source)
	at com.river.LegalAssistant.dto.ContractReviewResultDto.fromEntity(ContractReviewResultDto.java:187)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:499)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:37:02.428 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 18:37:02.436 [http-nio-8080-exec-4] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=9
2025-10-08 18:37:05.445 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 18:37:05.446 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 18:37:05.447 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 18:37:05.447 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bc0d051f, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=2ms
2025-10-08 18:37:05.448 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:37:05.450 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 18:37:05.450 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=9
2025-10-08 18:37:05.456 [Async-3] ERROR c.r.L.service.ContractReviewService - 发送已完成结果失败
org.hibernate.LazyInitializationException: could not initialize proxy [com.river.LegalAssistant.entity.User#1] - no Session
	at org.hibernate.proxy.AbstractLazyInitializer.initialize(AbstractLazyInitializer.java:165)
	at org.hibernate.proxy.AbstractLazyInitializer.getImplementation(AbstractLazyInitializer.java:314)
	at org.hibernate.proxy.pojo.bytebuddy.ByteBuddyInterceptor.intercept(ByteBuddyInterceptor.java:44)
	at org.hibernate.proxy.ProxyConfiguration$InterceptorDispatcher.intercept(ProxyConfiguration.java:102)
	at com.river.LegalAssistant.entity.User$HibernateProxy$dj06ZVMy.getUsername(Unknown Source)
	at com.river.LegalAssistant.dto.ContractReviewResultDto.fromEntity(ContractReviewResultDto.java:187)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:375)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:38:38.132 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 18:38:38.133 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 18:38:38.133 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 18:38:38.134 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3a1c3070, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=3ms
2025-10-08 18:38:38.134 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:38:38.136 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 18:38:38.138 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=9
2025-10-08 18:38:38.143 [Async-4] ERROR c.r.L.service.ContractReviewService - 发送已完成结果失败
org.hibernate.LazyInitializationException: could not initialize proxy [com.river.LegalAssistant.entity.User#1] - no Session
	at org.hibernate.proxy.AbstractLazyInitializer.initialize(AbstractLazyInitializer.java:165)
	at org.hibernate.proxy.AbstractLazyInitializer.getImplementation(AbstractLazyInitializer.java:314)
	at org.hibernate.proxy.pojo.bytebuddy.ByteBuddyInterceptor.intercept(ByteBuddyInterceptor.java:44)
	at org.hibernate.proxy.ProxyConfiguration$InterceptorDispatcher.intercept(ProxyConfiguration.java:102)
	at com.river.LegalAssistant.entity.User$HibernateProxy$dj06ZVMy.getUsername(Unknown Source)
	at com.river.LegalAssistant.dto.ContractReviewResultDto.fromEntity(ContractReviewResultDto.java:187)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:375)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:38:52.485 [http-nio-8080-exec-7] WARN  c.r.L.c.ContractReviewController - SSE连接超时，标记任务应停止，但分析将继续在后台进行: reviewId=9
2025-10-08 18:38:52.485 [http-nio-8080-exec-8] WARN  c.r.L.c.ContractReviewController - SSE连接超时，标记任务应停止，但分析将继续在后台进行: reviewId=9
2025-10-08 18:38:52.486 [http-nio-8080-exec-7] ERROR c.r.L.c.ContractReviewController - 发送超时消息失败
java.lang.IllegalStateException: ResponseBodyEmitter has already completed
	at org.springframework.util.Assert.state(Assert.java:97)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.controller.ContractReviewController.lambda$analyzeContractAsync$2(ContractReviewController.java:236)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter$DefaultCallback.run(ResponseBodyEmitter.java:377)
	at org.springframework.web.context.request.async.DeferredResult$1.handleTimeout(DeferredResult.java:298)
	at org.springframework.web.context.request.async.DeferredResultInterceptorChain.triggerAfterTimeout(DeferredResultInterceptorChain.java:81)
	at org.springframework.web.context.request.async.WebAsyncManager.lambda$startDeferredResultProcessing$5(WebAsyncManager.java:457)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest.onTimeout(StandardServletAsyncWebRequest.java:185)
	at org.apache.catalina.core.AsyncListenerWrapper.fireOnTimeout(AsyncListenerWrapper.java:44)
	at org.apache.catalina.core.AsyncContextImpl.timeout(AsyncContextImpl.java:136)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:135)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:38:52.486 [http-nio-8080-exec-8] ERROR c.r.L.c.ContractReviewController - 发送超时消息失败
java.lang.IllegalStateException: ResponseBodyEmitter has already completed
	at org.springframework.util.Assert.state(Assert.java:97)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter.send(ResponseBodyEmitter.java:212)
	at org.springframework.web.servlet.mvc.method.annotation.SseEmitter.send(SseEmitter.java:135)
	at com.river.LegalAssistant.controller.ContractReviewController.lambda$analyzeContractAsync$2(ContractReviewController.java:236)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter$DefaultCallback.run(ResponseBodyEmitter.java:377)
	at org.springframework.web.context.request.async.DeferredResult$1.handleTimeout(DeferredResult.java:298)
	at org.springframework.web.context.request.async.DeferredResultInterceptorChain.triggerAfterTimeout(DeferredResultInterceptorChain.java:81)
	at org.springframework.web.context.request.async.WebAsyncManager.lambda$startDeferredResultProcessing$5(WebAsyncManager.java:457)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest.onTimeout(StandardServletAsyncWebRequest.java:185)
	at org.apache.catalina.core.AsyncListenerWrapper.fireOnTimeout(AsyncListenerWrapper.java:44)
	at org.apache.catalina.core.AsyncContextImpl.timeout(AsyncContextImpl.java:136)
	at org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:135)
	at org.apache.coyote.AbstractProcessor.dispatch(AbstractProcessor.java:243)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:38:52.488 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=9
2025-10-08 18:38:52.489 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=9
2025-10-08 18:38:54.580 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 18:38:54.584 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 18:44:52.188 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 11248 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 18:44:52.189 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 18:44:54.437 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 18:44:54.563 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@103033fe
2025-10-08 18:44:54.608 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 18:44:54.628 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 18:44:54.634 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 18:44:54.710 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 18:44:54.713 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 18:44:55.062 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 18:44:56.094 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 18:44:56.095 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 18:44:56.117 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 18:44:56.118 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 18:44:56.118 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 18:44:56.118 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 18:44:56.118 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 18:44:56.119 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 18:44:56.119 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 18:44:56.162 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 18:44:56.254 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 18:44:56.255 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 18:44:57.045 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 18:44:57.079 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 18:44:57.082 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 18:44:57.086 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 18:44:57.087 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 18:44:57.088 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 18:44:57.124 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 18:44:57.301 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 18:44:57.304 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 18:44:57.305 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 18:44:57.305 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 18:44:57.490 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 18:44:57.498 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 18:44:57.500 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 18:44:57.500 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 18:44:57.500 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 18:44:57.512 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 18:44:57.512 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 18:44:57.535 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 18:44:57.536 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 18:44:57.536 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 18:44:57.536 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 18:44:57.536 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 18:44:57.536 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 18:44:57.536 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 18:44:57.547 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 18:44:57.562 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 18:44:57.562 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 18:44:57.572 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 18:44:57.573 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 18:44:57.575 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 18:44:57.575 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 18:44:57.576 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 18:44:57.577 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 18:44:57.626 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 18:44:58.108 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 18:44:58.202 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 18:44:58.204 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 18:44:58.241 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 18:44:58.370 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 18:44:58.587 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-08 18:44:58.881 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-08 18:44:59.035 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 18:44:59.127 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 18:44:59.872 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.073 seconds (process running for 8.327)
2025-10-08 18:44:59.878 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 18:44:59.879 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 18:44:59.968 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 18:45:51.126 [http-nio-8080-exec-2] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:45:51.130 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:45:51.157 [http-nio-8080-exec-2] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 18:45:51.164 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 9
2025-10-08 18:45:51.164 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 18:45:51.180 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=036c42f9, method=POST, uri=/api/v1/contracts/upload, status=202, duration=102ms
2025-10-08 18:45:51.186 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:45:51.187 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 18:45:51.206 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 18:45:51.208 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 18:45:51.213 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 18:45:51.215 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:45:51.219 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 18:45:51.220 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=9
2025-10-08 18:45:51.222 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=32a64cef, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=19ms
2025-10-08 18:45:51.241 [Async-2] ERROR c.r.L.service.ContractReviewService - 发送已完成结果失败
org.hibernate.LazyInitializationException: could not initialize proxy [com.river.LegalAssistant.entity.User#1] - no Session
	at org.hibernate.proxy.AbstractLazyInitializer.initialize(AbstractLazyInitializer.java:165)
	at org.hibernate.proxy.AbstractLazyInitializer.getImplementation(AbstractLazyInitializer.java:314)
	at org.hibernate.proxy.pojo.bytebuddy.ByteBuddyInterceptor.intercept(ByteBuddyInterceptor.java:44)
	at org.hibernate.proxy.ProxyConfiguration$InterceptorDispatcher.intercept(ProxyConfiguration.java:102)
	at com.river.LegalAssistant.entity.User$HibernateProxy$hrdFRjl3.getUsername(Unknown Source)
	at com.river.LegalAssistant.dto.ContractReviewResultDto.fromEntity(ContractReviewResultDto.java:187)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:375)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:45:51.614 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 18:45:51.615 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-08 18:45:51.615 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=9, 文本长度: 7321
2025-10-08 18:45:51.615 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 18:45:51.618 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 18:45:58.930 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 18:45:58.931 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 9, 块数: 405
2025-10-08 18:45:58.931 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 9
2025-10-08 18:45:58.931 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 9
2025-10-08 18:46:19.702 [http-nio-8080-exec-10] WARN  c.r.L.c.ContractReviewController - SSE连接超时，标记任务应停止，但分析将继续在后台进行: reviewId=9
2025-10-08 18:46:19.703 [http-nio-8080-exec-10] WARN  c.r.L.c.ContractReviewController - SSE连接已关闭，无法发送超时消息: reviewId=9
2025-10-08 18:46:19.712 [http-nio-8080-exec-10] WARN  c.r.L.e.GlobalExceptionHandler - SSE异步请求超时: null
2025-10-08 18:46:19.713 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=9
2025-10-08 18:46:21.808 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 18:46:21.811 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 18:46:31.061 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 13644 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 18:46:31.062 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 18:46:33.282 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 18:46:33.502 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@6c92a59d
2025-10-08 18:46:33.547 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 18:46:33.566 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 18:46:33.573 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 18:46:33.646 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 18:46:33.648 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 18:46:33.965 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 18:46:34.970 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 18:46:34.971 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 18:46:34.990 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 18:46:34.990 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 18:46:34.991 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 18:46:34.991 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 18:46:34.991 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 18:46:34.991 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 18:46:34.991 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 18:46:35.023 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 18:46:35.116 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 18:46:35.117 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 18:46:35.796 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 18:46:35.824 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 18:46:35.826 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 18:46:35.829 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 18:46:35.830 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 18:46:35.831 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 18:46:35.862 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 18:46:36.029 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 18:46:36.031 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 18:46:36.032 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 18:46:36.032 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 18:46:36.193 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 18:46:36.199 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 18:46:36.201 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 18:46:36.201 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 18:46:36.201 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 18:46:36.214 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 18:46:36.214 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 18:46:36.236 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 18:46:36.236 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 18:46:36.236 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 18:46:36.236 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 18:46:36.237 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 18:46:36.237 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 18:46:36.237 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 18:46:36.249 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 18:46:36.266 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 18:46:36.266 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 18:46:36.277 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 18:46:36.277 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 18:46:36.279 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 18:46:36.280 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 18:46:36.281 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 18:46:36.281 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 18:46:36.342 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 18:46:36.774 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 18:46:36.866 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 18:46:36.868 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 18:46:36.890 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 18:46:37.013 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 18:46:37.212 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-08 18:46:37.537 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-08 18:46:37.686 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 18:46:37.767 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 18:46:38.538 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.875 seconds (process running for 8.137)
2025-10-08 18:46:38.544 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 18:46:38.545 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 18:46:38.631 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 18:48:06.908 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f_农村土地经营权出租合同.docx
2025-10-08 18:48:06.913 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 农村土地经营权出租合同.docx
2025-10-08 18:48:06.960 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 11, 文件: 农村土地经营权出租合同.docx
2025-10-08 18:48:06.980 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 11
2025-10-08 18:48:06.981 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 18:48:07.002 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 农村土地经营权出租合同.docx, 路径: F:\LegalAssistant\uploads\contracts\bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f_农村土地经营权出租合同.docx
2025-10-08 18:48:07.002 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 农村土地经营权出租合同.docx, 类型: docx, 大小: 30836 bytes
2025-10-08 18:48:07.015 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e2f313e4, method=POST, uri=/api/v1/contracts/upload, status=202, duration=175ms
2025-10-08 18:48:07.135 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 11
2025-10-08 18:48:07.142 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 11
2025-10-08 18:48:07.147 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 11
2025-10-08 18:48:07.148 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=11
2025-10-08 18:48:07.151 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:48:07.194 [Async-2] WARN  c.r.L.service.ContractReviewService - 合同文本内容为空，可能文件还在解析中: reviewId=11
2025-10-08 18:48:07.208 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2d84ef39, method=GET, uri=/api/v1/contracts/11/analyze-async, status=200, duration=76ms
2025-10-08 18:48:07.776 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 农村土地经营权出租合同.docx, 内容长度: 3686 字符
2025-10-08 18:48:07.776 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 农村土地经营权出租合同.docx, 内容长度: 3686
2025-10-08 18:48:07.777 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=11, 文本长度: 3686
2025-10-08 18:48:07.777 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3686 字符
2025-10-08 18:48:07.782 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 18:48:08.218 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=11
2025-10-08 18:48:08.220 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:48:09.223 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=11
2025-10-08 18:48:09.225 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:48:10.237 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=11
2025-10-08 18:48:10.239 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:48:11.251 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=11
2025-10-08 18:48:11.253 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:48:12.266 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=11
2025-10-08 18:48:12.268 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:48:13.279 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=11
2025-10-08 18:48:13.280 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:48:14.288 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=11
2025-10-08 18:48:14.289 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 18:48:15.135 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 18:48:15.136 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 11, 块数: 403
2025-10-08 18:48:15.136 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 11
2025-10-08 18:48:15.136 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 11
2025-10-08 18:48:15.297 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=11
2025-10-08 18:48:15.298 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 3686
2025-10-08 18:48:15.299 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 8秒, reviewId=11
2025-10-08 18:48:15.300 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，开始分析: reviewId=11, 文本长度: 3686
2025-10-08 18:48:15.307 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 3686
2025-10-08 18:49:22.712 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 18:49:22.773 [Async-2] ERROR c.r.L.service.ContractReviewService - 发送分析结果失败
org.hibernate.LazyInitializationException: could not initialize proxy [com.river.LegalAssistant.entity.User#1] - no Session
	at org.hibernate.proxy.AbstractLazyInitializer.initialize(AbstractLazyInitializer.java:165)
	at org.hibernate.proxy.AbstractLazyInitializer.getImplementation(AbstractLazyInitializer.java:314)
	at org.hibernate.proxy.pojo.bytebuddy.ByteBuddyInterceptor.intercept(ByteBuddyInterceptor.java:44)
	at org.hibernate.proxy.ProxyConfiguration$InterceptorDispatcher.intercept(ProxyConfiguration.java:102)
	at com.river.LegalAssistant.entity.User$HibernateProxy$jJKkWYo5.getUsername(Unknown Source)
	at com.river.LegalAssistant.dto.ContractReviewResultDto.fromEntity(ContractReviewResultDto.java:187)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:499)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:49:22.776 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 18:49:22.789 [http-nio-8080-exec-7] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=11
2025-10-08 18:49:23.812 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 11
2025-10-08 18:49:23.814 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 11
2025-10-08 18:49:23.816 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 11
2025-10-08 18:49:23.817 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4dac7237, method=GET, uri=/api/v1/contracts/11/analyze-async, status=200, duration=6ms
2025-10-08 18:49:23.817 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=11
2025-10-08 18:49:23.820 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 3686
2025-10-08 18:49:23.820 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=11
2025-10-08 18:49:23.828 [Async-3] ERROR c.r.L.service.ContractReviewService - 发送已完成结果失败
org.hibernate.LazyInitializationException: could not initialize proxy [com.river.LegalAssistant.entity.User#1] - no Session
	at org.hibernate.proxy.AbstractLazyInitializer.initialize(AbstractLazyInitializer.java:165)
	at org.hibernate.proxy.AbstractLazyInitializer.getImplementation(AbstractLazyInitializer.java:314)
	at org.hibernate.proxy.pojo.bytebuddy.ByteBuddyInterceptor.intercept(ByteBuddyInterceptor.java:44)
	at org.hibernate.proxy.ProxyConfiguration$InterceptorDispatcher.intercept(ProxyConfiguration.java:102)
	at com.river.LegalAssistant.entity.User$HibernateProxy$jJKkWYo5.getUsername(Unknown Source)
	at com.river.LegalAssistant.dto.ContractReviewResultDto.fromEntity(ContractReviewResultDto.java:187)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:375)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 18:50:02.359 [http-nio-8080-exec-5] WARN  c.r.L.c.ContractReviewController - SSE连接超时，标记任务应停止，但分析将继续在后台进行: reviewId=11
2025-10-08 18:50:02.360 [http-nio-8080-exec-5] WARN  c.r.L.c.ContractReviewController - SSE连接已关闭，无法发送超时消息: reviewId=11
2025-10-08 18:50:02.364 [http-nio-8080-exec-5] WARN  c.r.L.e.GlobalExceptionHandler - SSE异步请求超时: null
2025-10-08 18:50:02.365 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=11
2025-10-08 18:50:04.460 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 18:50:04.463 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 18:55:25.285 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 28404 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 18:55:25.286 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 18:55:27.580 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 18:55:27.697 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1ab717f3
2025-10-08 18:55:27.740 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 18:55:27.758 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 18:55:27.764 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 18:55:27.839 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 18:55:27.841 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 18:55:28.174 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 18:55:29.171 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 18:55:29.172 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 18:55:29.191 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 18:55:29.191 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 18:55:29.191 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 18:55:29.191 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 18:55:29.192 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 18:55:29.192 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 18:55:29.192 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 18:55:29.226 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 18:55:29.313 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 18:55:29.314 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 18:55:29.973 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 18:55:30.001 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 18:55:30.003 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 18:55:30.007 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 18:55:30.008 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 18:55:30.008 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 18:55:30.039 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 18:55:30.201 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 18:55:30.203 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 18:55:30.204 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 18:55:30.204 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 18:55:30.362 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 18:55:30.369 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 18:55:30.371 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 18:55:30.371 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 18:55:30.371 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 18:55:30.377 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 18:55:30.377 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 18:55:30.398 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 18:55:30.399 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 18:55:30.399 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 18:55:30.399 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 18:55:30.399 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 18:55:30.399 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 18:55:30.399 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 18:55:30.411 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 18:55:30.426 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 18:55:30.426 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 18:55:30.436 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 18:55:30.436 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 18:55:30.438 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 18:55:30.439 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 18:55:30.440 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 18:55:30.440 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 18:55:30.496 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 18:55:30.943 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 18:55:31.027 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 18:55:31.029 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 18:55:31.049 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 18:55:31.180 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 18:55:31.440 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-08 18:55:31.748 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-08 18:55:31.906 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 18:55:31.998 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 18:55:32.748 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.859 seconds (process running for 8.148)
2025-10-08 18:55:32.754 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 18:55:32.756 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 18:55:32.839 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 18:55:44.536 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:55:44.540 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:55:44.563 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 18:55:44.570 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 9
2025-10-08 18:55:44.570 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 18:55:44.587 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a78a4e3b, method=POST, uri=/api/v1/contracts/upload, status=202, duration=100ms
2025-10-08 18:55:44.594 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 18:55:44.594 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 18:55:44.624 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 18:55:44.630 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 18:55:44.638 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 18:55:44.640 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:55:44.647 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 18:55:44.658 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=869dc91b, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=41ms
2025-10-08 18:55:44.717 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-08 18:55:45.189 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 18:55:45.189 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-08 18:55:45.190 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=9, 文本长度: 7321
2025-10-08 18:55:45.190 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 18:55:45.194 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 18:55:52.141 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 18:55:52.141 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 9, 块数: 405
2025-10-08 18:55:52.142 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 9
2025-10-08 18:55:52.142 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 9
2025-10-08 18:56:56.580 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 18:56:56.648 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 18:56:56.657 [http-nio-8080-exec-4] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=9
2025-10-08 18:56:57.677 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 18:56:57.678 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 18:56:57.678 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 18:56:57.678 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=94592f5f, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=2ms
2025-10-08 18:56:57.679 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:56:57.681 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 18:56:57.681 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=9
2025-10-08 18:56:57.691 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=9
2025-10-08 18:57:32.711 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 18:57:32.712 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 18:57:32.712 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 18:57:32.713 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=90eb0b0a, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=3ms
2025-10-08 18:57:32.713 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 18:57:32.716 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 18:57:32.716 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=9
2025-10-08 18:57:32.729 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=9
2025-10-08 18:59:05.312 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 18:59:05.316 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 19:02:01.545 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 40184 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 19:02:01.548 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 19:02:04.955 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 19:02:05.110 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@733345f5
2025-10-08 19:02:05.157 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 19:02:05.179 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 19:02:05.185 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 19:02:05.397 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 19:02:05.399 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 19:02:05.797 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 19:02:06.924 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 19:02:06.925 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 19:02:06.950 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 19:02:06.950 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 19:02:06.950 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 19:02:06.950 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 19:02:06.950 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 19:02:06.951 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 19:02:06.951 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 19:02:06.996 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 19:02:07.088 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 19:02:07.089 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 19:02:07.861 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 19:02:07.897 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 19:02:07.899 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 19:02:07.904 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 19:02:07.906 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 19:02:07.907 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 19:02:07.944 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 19:02:08.158 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 19:02:08.160 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 19:02:08.161 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 19:02:08.161 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 19:02:08.390 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 19:02:08.399 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 19:02:08.401 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 19:02:08.402 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 19:02:08.402 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 19:02:08.410 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 19:02:08.410 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 19:02:08.440 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 19:02:08.441 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 19:02:08.441 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 19:02:08.441 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 19:02:08.441 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 19:02:08.441 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 19:02:08.441 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 19:02:08.455 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 19:02:08.473 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 19:02:08.474 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 19:02:08.486 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 19:02:08.486 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 19:02:08.489 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 19:02:08.489 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 19:02:08.491 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 19:02:08.491 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 19:02:08.563 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 19:02:09.190 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 19:02:09.334 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 19:02:09.338 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 19:02:09.378 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 19:02:09.555 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 19:02:09.816 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-08 19:02:10.173 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-08 19:02:10.341 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 19:02:10.437 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 19:02:11.353 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 10.403 seconds (process running for 10.714)
2025-10-08 19:02:11.358 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 19:02:11.360 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 19:02:11.458 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 19:02:23.580 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 19:02:23.586 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 19:02:23.614 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 19:02:23.623 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 9
2025-10-08 19:02:23.623 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 19:02:23.645 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0ee0e77f, method=POST, uri=/api/v1/contracts/upload, status=202, duration=123ms
2025-10-08 19:02:23.651 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 19:02:23.652 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 19:02:23.672 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 19:02:23.675 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 19:02:23.679 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 19:02:23.681 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 19:02:23.685 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 19:02:23.687 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=9
2025-10-08 19:02:23.690 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=45f1208c, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=22ms
2025-10-08 19:02:23.735 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=9
2025-10-08 19:02:24.212 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 19:02:24.212 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-08 19:02:24.212 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=9, 文本长度: 7321
2025-10-08 19:02:24.213 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 19:02:24.215 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 19:02:32.854 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 19:02:32.854 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 9, 块数: 405
2025-10-08 19:02:32.855 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 9
2025-10-08 19:02:32.855 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 9
2025-10-08 19:03:06.705 [http-nio-8080-exec-4] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 19:03:06.706 [http-nio-8080-exec-4] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 19:03:06.709 [http-nio-8080-exec-4] WARN  c.r.L.service.ContractReviewService - 文件哈希 454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd 已存在，返回现有审查记录
2025-10-08 19:03:06.711 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 10
2025-10-08 19:03:06.712 [Async-3] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-3
2025-10-08 19:03:06.712 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4e5be65e, method=POST, uri=/api/v1/contracts/upload, status=202, duration=24ms
2025-10-08 19:03:06.714 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 广州市既有住宅加装电梯委托管理合同.docx, 路径: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 19:03:06.715 [Async-3] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 广州市既有住宅加装电梯委托管理合同.docx, 类型: docx, 大小: 36076 bytes
2025-10-08 19:03:06.727 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 10
2025-10-08 19:03:06.728 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 10
2025-10-08 19:03:06.730 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 10
2025-10-08 19:03:06.730 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 19:03:06.730 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f02ee9c0, method=GET, uri=/api/v1/contracts/10/analyze-async, status=200, duration=4ms
2025-10-08 19:03:06.733 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 19:03:06.734 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=10
2025-10-08 19:03:06.744 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=10
2025-10-08 19:03:06.806 [Async-3] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 广州市既有住宅加装电梯委托管理合同.docx, 内容长度: 3641 字符
2025-10-08 19:03:06.806 [Async-3] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 广州市既有住宅加装电梯委托管理合同.docx, 内容长度: 3641
2025-10-08 19:03:06.807 [Async-3] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=10, 文本长度: 3641
2025-10-08 19:03:06.807 [Async-3] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3641 字符
2025-10-08 19:03:06.809 [Async-3] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 19:03:12.641 [Async-3] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 19:03:12.641 [Async-3] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 10, 块数: 403
2025-10-08 19:03:12.642 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 10
2025-10-08 19:03:12.642 [Async-3] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 10
2025-10-08 19:07:38.067 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 19:07:38.071 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 19:12:36.652 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 32956 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 19:12:36.654 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 19:12:39.457 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 19:12:39.657 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@75d0cac6
2025-10-08 19:12:39.735 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 19:12:39.757 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 19:12:39.763 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 19:12:39.847 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 19:12:39.851 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 19:12:40.328 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 19:12:41.551 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 19:12:41.553 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 19:12:41.574 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 19:12:41.574 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 19:12:41.574 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 19:12:41.575 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 19:12:41.575 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 19:12:41.575 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 19:12:41.575 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 19:12:41.608 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 19:12:41.743 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 19:12:41.745 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 19:12:42.546 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 19:12:42.581 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 19:12:42.584 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 19:12:42.588 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 19:12:42.589 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 19:12:42.590 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 19:12:42.627 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 19:12:42.878 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 19:12:42.881 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 19:12:42.881 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 19:12:42.881 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 19:12:43.089 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 19:12:43.098 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 19:12:43.100 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 19:12:43.100 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 19:12:43.100 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 19:12:43.107 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 19:12:43.107 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 19:12:43.134 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 19:12:43.134 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 19:12:43.134 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 19:12:43.134 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 19:12:43.134 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 19:12:43.135 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 19:12:43.135 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 19:12:43.147 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 19:12:43.164 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 19:12:43.164 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 19:12:43.180 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 19:12:43.180 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 19:12:43.184 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 19:12:43.185 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 19:12:43.187 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 19:12:43.187 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 19:12:43.261 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 19:12:44.293 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 19:12:44.392 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 19:12:44.393 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 19:12:44.417 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 19:12:44.550 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 19:12:44.761 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-08 19:12:45.122 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-08 19:12:45.303 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 19:12:45.407 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 19:12:46.441 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 10.215 seconds (process running for 10.521)
2025-10-08 19:12:46.448 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 19:12:46.450 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 19:12:46.551 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 19:13:16.371 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 19:13:16.376 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 19:13:16.413 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 19:13:16.423 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 9
2025-10-08 19:13:16.423 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 19:13:16.447 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9483720a, method=POST, uri=/api/v1/contracts/upload, status=202, duration=143ms
2025-10-08 19:13:16.453 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 19:13:16.453 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 19:13:16.478 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 19:13:16.482 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 19:13:16.487 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 19:13:16.488 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 19:13:16.493 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 19:13:16.504 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=955a9f64, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=30ms
2025-10-08 19:13:16.556 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-08 19:13:17.247 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 19:13:17.247 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-08 19:13:17.248 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=9, 文本长度: 7321
2025-10-08 19:13:17.248 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 19:13:17.255 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 19:13:25.334 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 19:13:25.335 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 9, 块数: 405
2025-10-08 19:13:25.336 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 9
2025-10-08 19:13:25.336 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 9
2025-10-08 19:14:37.048 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 19:14:37.117 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 19:14:37.125 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=9
2025-10-08 19:14:38.179 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 19:14:38.180 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 19:14:38.181 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 19:14:38.181 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3a529f23, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=3ms
2025-10-08 19:14:38.182 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 19:14:38.183 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 19:14:38.184 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=9
2025-10-08 19:14:38.196 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=9
2025-10-08 19:15:27.211 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 9
2025-10-08 19:15:27.218 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 9
2025-10-08 19:15:27.218 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-08 19:15:27.462 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载中文字体：STSong-Light (UniGB-UCS2-H编码)
2025-10-08 19:15:27.519 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-08 19:15:27.519 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-08 19:15:27.519 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 9
2025-10-08 19:15:35.773 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始使用专用提示词生成PDF报告内容...
2025-10-08 19:15:35.774 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: /*
 * PDF合同审查报告生成专用提示词模板
 * ..., 会话ID: default
2025-10-08 19:15:35.775 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-08 19:15:35.835 [http-nio-8080-exec-6] INFO  d.l.h.client.log.LoggingHttpClient - HTTP request:
- method: POST
- url: https://api.deepseek.com/chat/completions
- headers: [Authorization: Beare...72], [User-Agent: langchain4j-openai], [Content-Type: application/json]
- body: {
  "model" : "deepseek-chat",
  "messages" : [ {
    "role" : "user",
    "content" : "/*\r\n * PDF合同审查报告生成专用提示词模板\r\n * 用于DeepSeek AI生成专业、详尽的合同分析报告内容\r\n */\r\n\r\n作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。\r\n\r\n## 合同基本信息\r\n- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx\r\n- 风险等级: 中等风险\r\n- 识别风险点数量: 10\r\n- 审查完成时间: 2025-10-08 19:14:37\r\n\r\n## 分析要求\r\n\r\n### 1. 执行摘要 (Executive Summary)\r\n请提供一个简洁但全面的执行摘要，包括：\r\n- 合同性质和类型的专业判断\r\n- 主要条款的关键要点总结\r\n- 整体风险评估和建议\r\n- 对决策者的核心建议\r\n要求：语言专业、逻辑清晰，控制在300-500字内。\r\n\r\n### 2. 深度合同分析 (Deep Contract Analysis)\r\n请从以下维度进行深入分析：\r\n\r\n#### 2.1 合同类型和法律性质分析\r\n- 确定合同的具体类型和法律分类\r\n- 分析适用的法律法规框架\r\n- 识别合同的核心法律关系\r\n\r\n#### 2.2 关键条款专业解读\r\n- 识别并解析合同中的核心条款\r\n- 分析条款的法律效力和约束力\r\n- 评估条款的公平性和合理性\r\n- 指出可能存在的歧义或漏洞\r\n\r\n#### 2.3 法律风险深度评估\r\n- 系统性识别潜在法律风险点\r\n- 评估风险发生的概率和影响程度\r\n- 分析风险的法律后果和责任归属\r\n- 提供风险量化评估（如适用）\r\n\r\n#### 2.4 合规性专业检查\r\n- 检查合同是否符合相关法律法规\r\n- 识别可能违反的法律条文\r\n- 评估监管风险和合规要求\r\n- 提出合规性改进建议\r\n\r\n#### 2.5 商业影响分析\r\n- 分析合同对各方商业利益的影响\r\n- 评估财务风险和商业风险\r\n- 识别可能的商业机会和威胁\r\n- 提供商业决策支持建议\r\n\r\n### 3. 专业改进建议 (Professional Improvement Recommendations)\r\n基于以上分析，请提供：\r\n- 具体的合同条款修改建议\r\n- 风险防范和控制措施\r\n- 谈判策略和要点提示\r\n- 替代方案和应急预案\r\n- 后续执行中的注意事项\r\n\r\n## 输出格式要求\r\n- 使用专业、准确的法律术语\r\n- 结构化输出，条理清晰\r\n- 每个建议都要有具体的操作指导\r\n- 避免模糊或不确定的表述\r\n- 提供可行的解决方案\r\n\r\n## 合同内容\r\nGF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )\r\n\r\n请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。\r\n"
  } ],
  "temperature" : 0.3,
  "stream" : false,
  "max_tokens" : 4096,
  "tools" : [ {
    "type" : "function",
    "function" : {
      "name" : "searchLegalKnowledge",
      "description" : "在法律知识库中搜索相关文档和案例。输入查询关键词，返回最相关的法律条文和合同条款。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "query" : {
            "type" : "string"
          },
          "maxResults" : {
            "type" : "integer"
          }
        },
        "required" : [ "query", "maxResults" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "analyzeContractClause",
      "description" : "分析特定合同条款的合法性和合理性。输入条款文本和类型，返回专业分析和改进建议。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "clauseText" : {
            "type" : "string"
          },
          "clauseType" : {
            "type" : "string"
          }
        },
        "required" : [ "clauseText", "clauseType" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "searchRiskInformation",
      "description" : "搜索特定类型的法律风险信息和防范措施。输入风险类型，返回相关的法律条文和专业建议。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "riskType" : {
            "type" : "string"
          }
        },
        "required" : [ "riskType" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "queryLegalArticle",
      "description" : "查询特定法律条文的详细内容和释义。输入法律名称和条文编号，返回条文原文和专业解释。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "lawName" : {
            "type" : "string"
          },
          "articleNumber" : {
            "type" : "string"
          }
        },
        "required" : [ "lawName", "articleNumber" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "calculatePenalty",
      "description" : "计算合同违约金和赔偿金额。输入合同价值、违约金比例和实际损失，返回计算结果和相关法律依据。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "contractValue" : {
            "type" : "number"
          },
          "penaltyRate" : {
            "type" : "number"
          },
          "actualLoss" : {
            "type" : "number"
          }
        },
        "required" : [ "contractValue", "penaltyRate", "actualLoss" ]
      }
    }
  } ]
}

2025-10-08 19:15:40.817 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 危险化学品销售合同 法律风险 合规要求
2025-10-08 19:15:40.819 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同 法律风险 合规要求, 最大结果数: 10
2025-10-08 19:15:40.882 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-08 19:15:41.009 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 6 个结果
2025-10-08 19:15:41.010 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 10 个相似文档
2025-10-08 19:15:41.010 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 10 个结果
2025-10-08 19:15:41.017 [http-nio-8080-exec-6] INFO  d.l.h.client.log.LoggingHttpClient - HTTP request:
- method: POST
- url: https://api.deepseek.com/chat/completions
- headers: [Authorization: Beare...72], [User-Agent: langchain4j-openai], [Content-Type: application/json]
- body: {
  "model" : "deepseek-chat",
  "messages" : [ {
    "role" : "user",
    "content" : "/*\r\n * PDF合同审查报告生成专用提示词模板\r\n * 用于DeepSeek AI生成专业、详尽的合同分析报告内容\r\n */\r\n\r\n作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。\r\n\r\n## 合同基本信息\r\n- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx\r\n- 风险等级: 中等风险\r\n- 识别风险点数量: 10\r\n- 审查完成时间: 2025-10-08 19:14:37\r\n\r\n## 分析要求\r\n\r\n### 1. 执行摘要 (Executive Summary)\r\n请提供一个简洁但全面的执行摘要，包括：\r\n- 合同性质和类型的专业判断\r\n- 主要条款的关键要点总结\r\n- 整体风险评估和建议\r\n- 对决策者的核心建议\r\n要求：语言专业、逻辑清晰，控制在300-500字内。\r\n\r\n### 2. 深度合同分析 (Deep Contract Analysis)\r\n请从以下维度进行深入分析：\r\n\r\n#### 2.1 合同类型和法律性质分析\r\n- 确定合同的具体类型和法律分类\r\n- 分析适用的法律法规框架\r\n- 识别合同的核心法律关系\r\n\r\n#### 2.2 关键条款专业解读\r\n- 识别并解析合同中的核心条款\r\n- 分析条款的法律效力和约束力\r\n- 评估条款的公平性和合理性\r\n- 指出可能存在的歧义或漏洞\r\n\r\n#### 2.3 法律风险深度评估\r\n- 系统性识别潜在法律风险点\r\n- 评估风险发生的概率和影响程度\r\n- 分析风险的法律后果和责任归属\r\n- 提供风险量化评估（如适用）\r\n\r\n#### 2.4 合规性专业检查\r\n- 检查合同是否符合相关法律法规\r\n- 识别可能违反的法律条文\r\n- 评估监管风险和合规要求\r\n- 提出合规性改进建议\r\n\r\n#### 2.5 商业影响分析\r\n- 分析合同对各方商业利益的影响\r\n- 评估财务风险和商业风险\r\n- 识别可能的商业机会和威胁\r\n- 提供商业决策支持建议\r\n\r\n### 3. 专业改进建议 (Professional Improvement Recommendations)\r\n基于以上分析，请提供：\r\n- 具体的合同条款修改建议\r\n- 风险防范和控制措施\r\n- 谈判策略和要点提示\r\n- 替代方案和应急预案\r\n- 后续执行中的注意事项\r\n\r\n## 输出格式要求\r\n- 使用专业、准确的法律术语\r\n- 结构化输出，条理清晰\r\n- 每个建议都要有具体的操作指导\r\n- 避免模糊或不确定的表述\r\n- 提供可行的解决方案\r\n\r\n## 合同内容\r\nGF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )\r\n\r\n请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。\r\n"
  }, {
    "role" : "assistant",
    "content" : "我将为您生成一份专业、详尽的《危险化学品生产经营企业自建网站销售合同》审查报告。首先让我搜索相关的法律知识来支持分析。",
    "tool_calls" : [ {
      "id" : "call_00_6qbNvIIG37VOFc6NCvhLryBS",
      "type" : "function",
      "function" : {
        "name" : "searchLegalKnowledge",
        "arguments" : "{\"query\": \"危险化学品销售合同 法律风险 合规要求\", \"maxResults\": 10}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_6qbNvIIG37VOFc6NCvhLryBS",
    "content" : "找到 10 个相关法律文档：\n\n【文档 1】来源: 劳动法.pdf\n内容: 同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动合同...\n\n【文档 2】来源: 劳动法.pdf\n内容: 合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动合...\n\n【文档 3】来源: 劳动法.pdf\n内容: 动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动...\n\n【文档 4】来源: 劳动法.pdf\n内容: 同规定的义\n\n务。\n\n第十八条 下列劳动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可...\n\n【文档 5】来源: 合同模板\n内容: GF—2023—2611\n\n危险化学品生产经营企业自建网站\n销售合同（示范文本）\n\n国家市场监督管理总局\n中央网信办\n (\n制定\n)教育部 \t\t\t\t\t\t\t\t\t\t                     \n公安部                  \n应急管理部 \n国家邮政局\n\n二〇二三年十一月\n使用说明\n\n一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。\n二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。\n三、当事人可...\n\n【文档 6】来源: 民法典\n内容: 中华人民共和国劳动法\n\n（1994年 7月 5日第八届全国人民代表大会常务委员会第八次会议通过 根\n\n据 2009年 8 月 27 日第十一届全国人民代表大会常务委员会第十次会议《关于修\n\n改部分法律的决定》第一次修正 根据 2018年 12 月 29日第十三届全国人民代\n\n表大会常务委员会第七次会议《关于修改〈中华人民共和国劳动法〉等七部法律\n\n的决定》第二次修正）\n\n目 录\n\n第一章 总 则\n\n第二章 促进就业\n\n第三章 劳动合同和集体合同\n\n第四章 工作时间和休息休假\n\n第五章 工 资\n\n第六章 劳动安全卫生\n\n第七章 女职工和未成年工特殊保护\n\n第八章 职业培训\n\n第九章 社会保险和福...\n\n【文档 7】来源: 民法典\n内容: 2．按甲方　　％，乙方　　％的比例分配买受人违约金。\n按照《中华人民共和国拍卖法》第三十九条执行：乙方征得甲方的同意，将拍卖标的再行拍卖。\n（二）因甲方或乙方的原因致使拍卖标的不能实现交付的，按本合同第十五条第三款、第七款执行。\n第十一条　保密\n双方对保密事项的约定：　　　　　　　　　　　　　　。\n第十二条　保险\n双方对保险事项的约定：　　　　　　　　　　　　　　。\n第十三条　甲方权利和义务\n（一）拍卖开始前，甲方有权随时撤回拍卖标的，但撤回时应向乙方出具书面通知并支付已经发生的相关费用。\n（二）拍卖未成交的，甲方可变更保留价再次拍卖或者撤回委托。甲方在拍卖未成交后　　日内未作明确意思表示或变...\n\n【文档 8】来源: 民法典\n内容: （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。\n甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。\n乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。\n（四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。\n（五）甲方逾期交货的，应当每日按照合同价款的万分之                                  ...\n\n【文档 9】来源: 合同模板\n内容: 使用说明\n\n一、本合同示范文本由上海市市场监督管理局、上海市商务委员会、上海市拍卖行业协会共同制定，供委托人与拍卖人签订委托拍卖合同时参照使用。\n二、签订合同前，请仔细阅读合同内容。本合同有关术语解释如下：\n（一）拍卖标的是指委托人所有或者依法可以处分的物品或者财产权利。\n（二）保留价是指委托人确定的拍卖标的可以成交的最低价格。\n（三）增价拍卖是指价格由低向高的竞价方式。\n（四）减价拍卖是指价格由高向低的竞价方式。\n（五）密封式递价拍卖又称“投标式拍卖”，是指由拍卖人事先公布拍卖标的物的相关情况、参加拍卖的条件和注意事项，竞买人均在规定的时间内将密封的标书递交至拍卖人指定的地点，由拍卖人在公告...\n\n【文档 10】来源: 民法典\n内容: 1.本合同约定托管服务期限内，相关电梯需要依照《电梯监督检验和定期检验规则》《电梯自行检测规则》的要求进行载荷试验，试验费用为      元，由       承担。\n2.本合同约定托管服务期限内，相关电梯不需要依照《电梯监督检验和定期检验规则》《电梯自行检测规则》的要求进行载荷试验。\n（备注：依照《电梯监督检验和定期检验规则》、《电梯自行检测规则》等安全技术规范规定，在用电梯需要每6年进行一次125%载荷试验。）\n第十条 违约责任\n1.一方当事人未按约定履行义务给对方造成损失的，应当承担赔偿责任。\n2.一方当事人无法继续履行合同的，应当提前30日通知对方，并向对方支付合同总额20%的违约金。\n...\n\n"
  } ],
  "temperature" : 0.3,
  "stream" : false,
  "max_tokens" : 4096,
  "tools" : [ {
    "type" : "function",
    "function" : {
      "name" : "searchLegalKnowledge",
      "description" : "在法律知识库中搜索相关文档和案例。输入查询关键词，返回最相关的法律条文和合同条款。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "query" : {
            "type" : "string"
          },
          "maxResults" : {
            "type" : "integer"
          }
        },
        "required" : [ "query", "maxResults" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "analyzeContractClause",
      "description" : "分析特定合同条款的合法性和合理性。输入条款文本和类型，返回专业分析和改进建议。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "clauseText" : {
            "type" : "string"
          },
          "clauseType" : {
            "type" : "string"
          }
        },
        "required" : [ "clauseText", "clauseType" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "searchRiskInformation",
      "description" : "搜索特定类型的法律风险信息和防范措施。输入风险类型，返回相关的法律条文和专业建议。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "riskType" : {
            "type" : "string"
          }
        },
        "required" : [ "riskType" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "queryLegalArticle",
      "description" : "查询特定法律条文的详细内容和释义。输入法律名称和条文编号，返回条文原文和专业解释。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "lawName" : {
            "type" : "string"
          },
          "articleNumber" : {
            "type" : "string"
          }
        },
        "required" : [ "lawName", "articleNumber" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "calculatePenalty",
      "description" : "计算合同违约金和赔偿金额。输入合同价值、违约金比例和实际损失，返回计算结果和相关法律依据。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "contractValue" : {
            "type" : "number"
          },
          "penaltyRate" : {
            "type" : "number"
          },
          "actualLoss" : {
            "type" : "number"
          }
        },
        "required" : [ "contractValue", "penaltyRate", "actualLoss" ]
      }
    }
  } ]
}

2025-10-08 19:15:44.170 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 危险化学品销售法律风险
2025-10-08 19:15:44.170 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售法律风险 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-08 19:15:44.212 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-08 19:15:44.213 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 危险化学品销售法律风险
2025-10-08 19:15:44.213 [http-nio-8080-exec-6] INFO  d.l.h.client.log.LoggingHttpClient - HTTP request:
- method: POST
- url: https://api.deepseek.com/chat/completions
- headers: [Authorization: Beare...72], [User-Agent: langchain4j-openai], [Content-Type: application/json]
- body: {
  "model" : "deepseek-chat",
  "messages" : [ {
    "role" : "user",
    "content" : "/*\r\n * PDF合同审查报告生成专用提示词模板\r\n * 用于DeepSeek AI生成专业、详尽的合同分析报告内容\r\n */\r\n\r\n作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。\r\n\r\n## 合同基本信息\r\n- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx\r\n- 风险等级: 中等风险\r\n- 识别风险点数量: 10\r\n- 审查完成时间: 2025-10-08 19:14:37\r\n\r\n## 分析要求\r\n\r\n### 1. 执行摘要 (Executive Summary)\r\n请提供一个简洁但全面的执行摘要，包括：\r\n- 合同性质和类型的专业判断\r\n- 主要条款的关键要点总结\r\n- 整体风险评估和建议\r\n- 对决策者的核心建议\r\n要求：语言专业、逻辑清晰，控制在300-500字内。\r\n\r\n### 2. 深度合同分析 (Deep Contract Analysis)\r\n请从以下维度进行深入分析：\r\n\r\n#### 2.1 合同类型和法律性质分析\r\n- 确定合同的具体类型和法律分类\r\n- 分析适用的法律法规框架\r\n- 识别合同的核心法律关系\r\n\r\n#### 2.2 关键条款专业解读\r\n- 识别并解析合同中的核心条款\r\n- 分析条款的法律效力和约束力\r\n- 评估条款的公平性和合理性\r\n- 指出可能存在的歧义或漏洞\r\n\r\n#### 2.3 法律风险深度评估\r\n- 系统性识别潜在法律风险点\r\n- 评估风险发生的概率和影响程度\r\n- 分析风险的法律后果和责任归属\r\n- 提供风险量化评估（如适用）\r\n\r\n#### 2.4 合规性专业检查\r\n- 检查合同是否符合相关法律法规\r\n- 识别可能违反的法律条文\r\n- 评估监管风险和合规要求\r\n- 提出合规性改进建议\r\n\r\n#### 2.5 商业影响分析\r\n- 分析合同对各方商业利益的影响\r\n- 评估财务风险和商业风险\r\n- 识别可能的商业机会和威胁\r\n- 提供商业决策支持建议\r\n\r\n### 3. 专业改进建议 (Professional Improvement Recommendations)\r\n基于以上分析，请提供：\r\n- 具体的合同条款修改建议\r\n- 风险防范和控制措施\r\n- 谈判策略和要点提示\r\n- 替代方案和应急预案\r\n- 后续执行中的注意事项\r\n\r\n## 输出格式要求\r\n- 使用专业、准确的法律术语\r\n- 结构化输出，条理清晰\r\n- 每个建议都要有具体的操作指导\r\n- 避免模糊或不确定的表述\r\n- 提供可行的解决方案\r\n\r\n## 合同内容\r\nGF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )\r\n\r\n请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。\r\n"
  }, {
    "role" : "assistant",
    "content" : "我将为您生成一份专业、详尽的《危险化学品生产经营企业自建网站销售合同》审查报告。首先让我搜索相关的法律知识来支持分析。",
    "tool_calls" : [ {
      "id" : "call_00_6qbNvIIG37VOFc6NCvhLryBS",
      "type" : "function",
      "function" : {
        "name" : "searchLegalKnowledge",
        "arguments" : "{\"query\": \"危险化学品销售合同 法律风险 合规要求\", \"maxResults\": 10}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_6qbNvIIG37VOFc6NCvhLryBS",
    "content" : "找到 10 个相关法律文档：\n\n【文档 1】来源: 劳动法.pdf\n内容: 同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动合同...\n\n【文档 2】来源: 劳动法.pdf\n内容: 合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动合...\n\n【文档 3】来源: 劳动法.pdf\n内容: 动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动...\n\n【文档 4】来源: 劳动法.pdf\n内容: 同规定的义\n\n务。\n\n第十八条 下列劳动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可...\n\n【文档 5】来源: 合同模板\n内容: GF—2023—2611\n\n危险化学品生产经营企业自建网站\n销售合同（示范文本）\n\n国家市场监督管理总局\n中央网信办\n (\n制定\n)教育部 \t\t\t\t\t\t\t\t\t\t                     \n公安部                  \n应急管理部 \n国家邮政局\n\n二〇二三年十一月\n使用说明\n\n一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。\n二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。\n三、当事人可...\n\n【文档 6】来源: 民法典\n内容: 中华人民共和国劳动法\n\n（1994年 7月 5日第八届全国人民代表大会常务委员会第八次会议通过 根\n\n据 2009年 8 月 27 日第十一届全国人民代表大会常务委员会第十次会议《关于修\n\n改部分法律的决定》第一次修正 根据 2018年 12 月 29日第十三届全国人民代\n\n表大会常务委员会第七次会议《关于修改〈中华人民共和国劳动法〉等七部法律\n\n的决定》第二次修正）\n\n目 录\n\n第一章 总 则\n\n第二章 促进就业\n\n第三章 劳动合同和集体合同\n\n第四章 工作时间和休息休假\n\n第五章 工 资\n\n第六章 劳动安全卫生\n\n第七章 女职工和未成年工特殊保护\n\n第八章 职业培训\n\n第九章 社会保险和福...\n\n【文档 7】来源: 民法典\n内容: 2．按甲方　　％，乙方　　％的比例分配买受人违约金。\n按照《中华人民共和国拍卖法》第三十九条执行：乙方征得甲方的同意，将拍卖标的再行拍卖。\n（二）因甲方或乙方的原因致使拍卖标的不能实现交付的，按本合同第十五条第三款、第七款执行。\n第十一条　保密\n双方对保密事项的约定：　　　　　　　　　　　　　　。\n第十二条　保险\n双方对保险事项的约定：　　　　　　　　　　　　　　。\n第十三条　甲方权利和义务\n（一）拍卖开始前，甲方有权随时撤回拍卖标的，但撤回时应向乙方出具书面通知并支付已经发生的相关费用。\n（二）拍卖未成交的，甲方可变更保留价再次拍卖或者撤回委托。甲方在拍卖未成交后　　日内未作明确意思表示或变...\n\n【文档 8】来源: 民法典\n内容: （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。\n甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。\n乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。\n（四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。\n（五）甲方逾期交货的，应当每日按照合同价款的万分之                                  ...\n\n【文档 9】来源: 合同模板\n内容: 使用说明\n\n一、本合同示范文本由上海市市场监督管理局、上海市商务委员会、上海市拍卖行业协会共同制定，供委托人与拍卖人签订委托拍卖合同时参照使用。\n二、签订合同前，请仔细阅读合同内容。本合同有关术语解释如下：\n（一）拍卖标的是指委托人所有或者依法可以处分的物品或者财产权利。\n（二）保留价是指委托人确定的拍卖标的可以成交的最低价格。\n（三）增价拍卖是指价格由低向高的竞价方式。\n（四）减价拍卖是指价格由高向低的竞价方式。\n（五）密封式递价拍卖又称“投标式拍卖”，是指由拍卖人事先公布拍卖标的物的相关情况、参加拍卖的条件和注意事项，竞买人均在规定的时间内将密封的标书递交至拍卖人指定的地点，由拍卖人在公告...\n\n【文档 10】来源: 民法典\n内容: 1.本合同约定托管服务期限内，相关电梯需要依照《电梯监督检验和定期检验规则》《电梯自行检测规则》的要求进行载荷试验，试验费用为      元，由       承担。\n2.本合同约定托管服务期限内，相关电梯不需要依照《电梯监督检验和定期检验规则》《电梯自行检测规则》的要求进行载荷试验。\n（备注：依照《电梯监督检验和定期检验规则》、《电梯自行检测规则》等安全技术规范规定，在用电梯需要每6年进行一次125%载荷试验。）\n第十条 违约责任\n1.一方当事人未按约定履行义务给对方造成损失的，应当承担赔偿责任。\n2.一方当事人无法继续履行合同的，应当提前30日通知对方，并向对方支付合同总额20%的违约金。\n...\n\n"
  }, {
    "role" : "assistant",
    "content" : "现在让我搜索危险化学品相关的法律风险信息：",
    "tool_calls" : [ {
      "id" : "call_00_qDBqWzyQ5OpJ9WqMK9siJ2Y2",
      "type" : "function",
      "function" : {
        "name" : "searchRiskInformation",
        "arguments" : "{\"riskType\": \"危险化学品销售法律风险\"}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_qDBqWzyQ5OpJ9WqMK9siJ2Y2",
    "content" : "关于'危险化学品销售法律风险'的法律条文和风险防范信息：\n\n参考文献: 拍卖法.pdf\n相关条文: 法规定的条件的，由工商 行政管理部门注销登记，收缴营业执照。具体实施办法由国务院另行规定。 第六十九条 本法自１９９７年１月１日起施行。\n\n参考文献: 拍卖法.pdf\n相关条文: 法规定的条件的，由工商 行政管理部门注销登记，收缴营业执照。具体实施办法由国务院另行规定。 第六十九条 本法自１９９７年１月１日起施行。\n\n参考文献: 拍卖法.pdf\n相关条文: 法规定的条件；逾期未达到本法规定的条件的，由工商 行政管理部门注销登记，收缴营业执照。具体实施办法由国务院另行规定。 第六十九条 本法自１９９７年１月１日起施行。\n\n建议: 具体的风险防范措施应根据实际情况制定，建议结合具体合同条款咨询专业法律人士。"
  } ],
  "temperature" : 0.3,
  "stream" : false,
  "max_tokens" : 4096,
  "tools" : [ {
    "type" : "function",
    "function" : {
      "name" : "searchLegalKnowledge",
      "description" : "在法律知识库中搜索相关文档和案例。输入查询关键词，返回最相关的法律条文和合同条款。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "query" : {
            "type" : "string"
          },
          "maxResults" : {
            "type" : "integer"
          }
        },
        "required" : [ "query", "maxResults" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "analyzeContractClause",
      "description" : "分析特定合同条款的合法性和合理性。输入条款文本和类型，返回专业分析和改进建议。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "clauseText" : {
            "type" : "string"
          },
          "clauseType" : {
            "type" : "string"
          }
        },
        "required" : [ "clauseText", "clauseType" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "searchRiskInformation",
      "description" : "搜索特定类型的法律风险信息和防范措施。输入风险类型，返回相关的法律条文和专业建议。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "riskType" : {
            "type" : "string"
          }
        },
        "required" : [ "riskType" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "queryLegalArticle",
      "description" : "查询特定法律条文的详细内容和释义。输入法律名称和条文编号，返回条文原文和专业解释。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "lawName" : {
            "type" : "string"
          },
          "articleNumber" : {
            "type" : "string"
          }
        },
        "required" : [ "lawName", "articleNumber" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "calculatePenalty",
      "description" : "计算合同违约金和赔偿金额。输入合同价值、违约金比例和实际损失，返回计算结果和相关法律依据。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "contractValue" : {
            "type" : "number"
          },
          "penaltyRate" : {
            "type" : "number"
          },
          "actualLoss" : {
            "type" : "number"
          }
        },
        "required" : [ "contractValue", "penaltyRate", "actualLoss" ]
      }
    }
  } ]
}

2025-10-08 19:15:46.772 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 危险化学品安全管理条例, 条文: 第三十八条
2025-10-08 19:15:46.773 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品安全管理条例 第三十八条 条文 内容, 最大结果数: 2
2025-10-08 19:15:46.847 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-08 19:15:46.847 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-08 19:15:46.848 [http-nio-8080-exec-6] INFO  d.l.h.client.log.LoggingHttpClient - HTTP request:
- method: POST
- url: https://api.deepseek.com/chat/completions
- headers: [Authorization: Beare...72], [User-Agent: langchain4j-openai], [Content-Type: application/json]
- body: {
  "model" : "deepseek-chat",
  "messages" : [ {
    "role" : "user",
    "content" : "/*\r\n * PDF合同审查报告生成专用提示词模板\r\n * 用于DeepSeek AI生成专业、详尽的合同分析报告内容\r\n */\r\n\r\n作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。\r\n\r\n## 合同基本信息\r\n- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx\r\n- 风险等级: 中等风险\r\n- 识别风险点数量: 10\r\n- 审查完成时间: 2025-10-08 19:14:37\r\n\r\n## 分析要求\r\n\r\n### 1. 执行摘要 (Executive Summary)\r\n请提供一个简洁但全面的执行摘要，包括：\r\n- 合同性质和类型的专业判断\r\n- 主要条款的关键要点总结\r\n- 整体风险评估和建议\r\n- 对决策者的核心建议\r\n要求：语言专业、逻辑清晰，控制在300-500字内。\r\n\r\n### 2. 深度合同分析 (Deep Contract Analysis)\r\n请从以下维度进行深入分析：\r\n\r\n#### 2.1 合同类型和法律性质分析\r\n- 确定合同的具体类型和法律分类\r\n- 分析适用的法律法规框架\r\n- 识别合同的核心法律关系\r\n\r\n#### 2.2 关键条款专业解读\r\n- 识别并解析合同中的核心条款\r\n- 分析条款的法律效力和约束力\r\n- 评估条款的公平性和合理性\r\n- 指出可能存在的歧义或漏洞\r\n\r\n#### 2.3 法律风险深度评估\r\n- 系统性识别潜在法律风险点\r\n- 评估风险发生的概率和影响程度\r\n- 分析风险的法律后果和责任归属\r\n- 提供风险量化评估（如适用）\r\n\r\n#### 2.4 合规性专业检查\r\n- 检查合同是否符合相关法律法规\r\n- 识别可能违反的法律条文\r\n- 评估监管风险和合规要求\r\n- 提出合规性改进建议\r\n\r\n#### 2.5 商业影响分析\r\n- 分析合同对各方商业利益的影响\r\n- 评估财务风险和商业风险\r\n- 识别可能的商业机会和威胁\r\n- 提供商业决策支持建议\r\n\r\n### 3. 专业改进建议 (Professional Improvement Recommendations)\r\n基于以上分析，请提供：\r\n- 具体的合同条款修改建议\r\n- 风险防范和控制措施\r\n- 谈判策略和要点提示\r\n- 替代方案和应急预案\r\n- 后续执行中的注意事项\r\n\r\n## 输出格式要求\r\n- 使用专业、准确的法律术语\r\n- 结构化输出，条理清晰\r\n- 每个建议都要有具体的操作指导\r\n- 避免模糊或不确定的表述\r\n- 提供可行的解决方案\r\n\r\n## 合同内容\r\nGF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )\r\n\r\n请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。\r\n"
  }, {
    "role" : "assistant",
    "content" : "我将为您生成一份专业、详尽的《危险化学品生产经营企业自建网站销售合同》审查报告。首先让我搜索相关的法律知识来支持分析。",
    "tool_calls" : [ {
      "id" : "call_00_6qbNvIIG37VOFc6NCvhLryBS",
      "type" : "function",
      "function" : {
        "name" : "searchLegalKnowledge",
        "arguments" : "{\"query\": \"危险化学品销售合同 法律风险 合规要求\", \"maxResults\": 10}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_6qbNvIIG37VOFc6NCvhLryBS",
    "content" : "找到 10 个相关法律文档：\n\n【文档 1】来源: 劳动法.pdf\n内容: 同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动合同...\n\n【文档 2】来源: 劳动法.pdf\n内容: 合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动合...\n\n【文档 3】来源: 劳动法.pdf\n内容: 动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动...\n\n【文档 4】来源: 劳动法.pdf\n内容: 同规定的义\n\n务。\n\n第十八条 下列劳动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可...\n\n【文档 5】来源: 合同模板\n内容: GF—2023—2611\n\n危险化学品生产经营企业自建网站\n销售合同（示范文本）\n\n国家市场监督管理总局\n中央网信办\n (\n制定\n)教育部 \t\t\t\t\t\t\t\t\t\t                     \n公安部                  \n应急管理部 \n国家邮政局\n\n二〇二三年十一月\n使用说明\n\n一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。\n二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。\n三、当事人可...\n\n【文档 6】来源: 民法典\n内容: 中华人民共和国劳动法\n\n（1994年 7月 5日第八届全国人民代表大会常务委员会第八次会议通过 根\n\n据 2009年 8 月 27 日第十一届全国人民代表大会常务委员会第十次会议《关于修\n\n改部分法律的决定》第一次修正 根据 2018年 12 月 29日第十三届全国人民代\n\n表大会常务委员会第七次会议《关于修改〈中华人民共和国劳动法〉等七部法律\n\n的决定》第二次修正）\n\n目 录\n\n第一章 总 则\n\n第二章 促进就业\n\n第三章 劳动合同和集体合同\n\n第四章 工作时间和休息休假\n\n第五章 工 资\n\n第六章 劳动安全卫生\n\n第七章 女职工和未成年工特殊保护\n\n第八章 职业培训\n\n第九章 社会保险和福...\n\n【文档 7】来源: 民法典\n内容: 2．按甲方　　％，乙方　　％的比例分配买受人违约金。\n按照《中华人民共和国拍卖法》第三十九条执行：乙方征得甲方的同意，将拍卖标的再行拍卖。\n（二）因甲方或乙方的原因致使拍卖标的不能实现交付的，按本合同第十五条第三款、第七款执行。\n第十一条　保密\n双方对保密事项的约定：　　　　　　　　　　　　　　。\n第十二条　保险\n双方对保险事项的约定：　　　　　　　　　　　　　　。\n第十三条　甲方权利和义务\n（一）拍卖开始前，甲方有权随时撤回拍卖标的，但撤回时应向乙方出具书面通知并支付已经发生的相关费用。\n（二）拍卖未成交的，甲方可变更保留价再次拍卖或者撤回委托。甲方在拍卖未成交后　　日内未作明确意思表示或变...\n\n【文档 8】来源: 民法典\n内容: （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。\n甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。\n乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。\n（四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。\n（五）甲方逾期交货的，应当每日按照合同价款的万分之                                  ...\n\n【文档 9】来源: 合同模板\n内容: 使用说明\n\n一、本合同示范文本由上海市市场监督管理局、上海市商务委员会、上海市拍卖行业协会共同制定，供委托人与拍卖人签订委托拍卖合同时参照使用。\n二、签订合同前，请仔细阅读合同内容。本合同有关术语解释如下：\n（一）拍卖标的是指委托人所有或者依法可以处分的物品或者财产权利。\n（二）保留价是指委托人确定的拍卖标的可以成交的最低价格。\n（三）增价拍卖是指价格由低向高的竞价方式。\n（四）减价拍卖是指价格由高向低的竞价方式。\n（五）密封式递价拍卖又称“投标式拍卖”，是指由拍卖人事先公布拍卖标的物的相关情况、参加拍卖的条件和注意事项，竞买人均在规定的时间内将密封的标书递交至拍卖人指定的地点，由拍卖人在公告...\n\n【文档 10】来源: 民法典\n内容: 1.本合同约定托管服务期限内，相关电梯需要依照《电梯监督检验和定期检验规则》《电梯自行检测规则》的要求进行载荷试验，试验费用为      元，由       承担。\n2.本合同约定托管服务期限内，相关电梯不需要依照《电梯监督检验和定期检验规则》《电梯自行检测规则》的要求进行载荷试验。\n（备注：依照《电梯监督检验和定期检验规则》、《电梯自行检测规则》等安全技术规范规定，在用电梯需要每6年进行一次125%载荷试验。）\n第十条 违约责任\n1.一方当事人未按约定履行义务给对方造成损失的，应当承担赔偿责任。\n2.一方当事人无法继续履行合同的，应当提前30日通知对方，并向对方支付合同总额20%的违约金。\n...\n\n"
  }, {
    "role" : "assistant",
    "content" : "现在让我搜索危险化学品相关的法律风险信息：",
    "tool_calls" : [ {
      "id" : "call_00_qDBqWzyQ5OpJ9WqMK9siJ2Y2",
      "type" : "function",
      "function" : {
        "name" : "searchRiskInformation",
        "arguments" : "{\"riskType\": \"危险化学品销售法律风险\"}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_qDBqWzyQ5OpJ9WqMK9siJ2Y2",
    "content" : "关于'危险化学品销售法律风险'的法律条文和风险防范信息：\n\n参考文献: 拍卖法.pdf\n相关条文: 法规定的条件的，由工商 行政管理部门注销登记，收缴营业执照。具体实施办法由国务院另行规定。 第六十九条 本法自１９９７年１月１日起施行。\n\n参考文献: 拍卖法.pdf\n相关条文: 法规定的条件的，由工商 行政管理部门注销登记，收缴营业执照。具体实施办法由国务院另行规定。 第六十九条 本法自１９９７年１月１日起施行。\n\n参考文献: 拍卖法.pdf\n相关条文: 法规定的条件；逾期未达到本法规定的条件的，由工商 行政管理部门注销登记，收缴营业执照。具体实施办法由国务院另行规定。 第六十九条 本法自１９９７年１月１日起施行。\n\n建议: 具体的风险防范措施应根据实际情况制定，建议结合具体合同条款咨询专业法律人士。"
  }, {
    "role" : "assistant",
    "content" : "让我查询具体的危险化学品管理法规：",
    "tool_calls" : [ {
      "id" : "call_00_CSS7R0CXahTG1zjmgXsoL7OA",
      "type" : "function",
      "function" : {
        "name" : "queryLegalArticle",
        "arguments" : "{\"lawName\": \"危险化学品安全管理条例\", \"articleNumber\": \"第三十八条\"}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_CSS7R0CXahTG1zjmgXsoL7OA",
    "content" : "危险化学品安全管理条例 第三十八条 查询结果：\n\n来源: 中华人民共和国社会保险法.pdf\n内容: 3 — 第九十七条 外国人在中国境内就业的，参照本法规定参 加社会保险。 第九十八条 本法自 2011 年 7月 1日起施行。\n\n来源: 中华人民共和国社会保险法.pdf\n内容: 23 — 第九十七条 外国人在中国境内就业的，参照本法规定参 加社会保险。 第九十八条 本法自 2011 年 7月 1日起施行。\n\n注意: 以上内容仅供参考，具体适用请咨询专业法律人士。"
  } ],
  "temperature" : 0.3,
  "stream" : false,
  "max_tokens" : 4096,
  "tools" : [ {
    "type" : "function",
    "function" : {
      "name" : "searchLegalKnowledge",
      "description" : "在法律知识库中搜索相关文档和案例。输入查询关键词，返回最相关的法律条文和合同条款。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "query" : {
            "type" : "string"
          },
          "maxResults" : {
            "type" : "integer"
          }
        },
        "required" : [ "query", "maxResults" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "analyzeContractClause",
      "description" : "分析特定合同条款的合法性和合理性。输入条款文本和类型，返回专业分析和改进建议。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "clauseText" : {
            "type" : "string"
          },
          "clauseType" : {
            "type" : "string"
          }
        },
        "required" : [ "clauseText", "clauseType" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "searchRiskInformation",
      "description" : "搜索特定类型的法律风险信息和防范措施。输入风险类型，返回相关的法律条文和专业建议。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "riskType" : {
            "type" : "string"
          }
        },
        "required" : [ "riskType" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "queryLegalArticle",
      "description" : "查询特定法律条文的详细内容和释义。输入法律名称和条文编号，返回条文原文和专业解释。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "lawName" : {
            "type" : "string"
          },
          "articleNumber" : {
            "type" : "string"
          }
        },
        "required" : [ "lawName", "articleNumber" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "calculatePenalty",
      "description" : "计算合同违约金和赔偿金额。输入合同价值、违约金比例和实际损失，返回计算结果和相关法律依据。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "contractValue" : {
            "type" : "number"
          },
          "penaltyRate" : {
            "type" : "number"
          },
          "actualLoss" : {
            "type" : "number"
          }
        },
        "required" : [ "contractValue", "penaltyRate", "actualLoss" ]
      }
    }
  } ]
}

2025-10-08 19:15:54.717 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 合规义务条款
2025-10-08 19:15:54.717 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 合规义务条款 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-08 19:15:54.802 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-08 19:15:54.803 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 合规义务条款
2025-10-08 19:15:54.803 [http-nio-8080-exec-6] INFO  d.l.h.client.log.LoggingHttpClient - HTTP request:
- method: POST
- url: https://api.deepseek.com/chat/completions
- headers: [Authorization: Beare...72], [User-Agent: langchain4j-openai], [Content-Type: application/json]
- body: {
  "model" : "deepseek-chat",
  "messages" : [ {
    "role" : "user",
    "content" : "/*\r\n * PDF合同审查报告生成专用提示词模板\r\n * 用于DeepSeek AI生成专业、详尽的合同分析报告内容\r\n */\r\n\r\n作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。\r\n\r\n## 合同基本信息\r\n- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx\r\n- 风险等级: 中等风险\r\n- 识别风险点数量: 10\r\n- 审查完成时间: 2025-10-08 19:14:37\r\n\r\n## 分析要求\r\n\r\n### 1. 执行摘要 (Executive Summary)\r\n请提供一个简洁但全面的执行摘要，包括：\r\n- 合同性质和类型的专业判断\r\n- 主要条款的关键要点总结\r\n- 整体风险评估和建议\r\n- 对决策者的核心建议\r\n要求：语言专业、逻辑清晰，控制在300-500字内。\r\n\r\n### 2. 深度合同分析 (Deep Contract Analysis)\r\n请从以下维度进行深入分析：\r\n\r\n#### 2.1 合同类型和法律性质分析\r\n- 确定合同的具体类型和法律分类\r\n- 分析适用的法律法规框架\r\n- 识别合同的核心法律关系\r\n\r\n#### 2.2 关键条款专业解读\r\n- 识别并解析合同中的核心条款\r\n- 分析条款的法律效力和约束力\r\n- 评估条款的公平性和合理性\r\n- 指出可能存在的歧义或漏洞\r\n\r\n#### 2.3 法律风险深度评估\r\n- 系统性识别潜在法律风险点\r\n- 评估风险发生的概率和影响程度\r\n- 分析风险的法律后果和责任归属\r\n- 提供风险量化评估（如适用）\r\n\r\n#### 2.4 合规性专业检查\r\n- 检查合同是否符合相关法律法规\r\n- 识别可能违反的法律条文\r\n- 评估监管风险和合规要求\r\n- 提出合规性改进建议\r\n\r\n#### 2.5 商业影响分析\r\n- 分析合同对各方商业利益的影响\r\n- 评估财务风险和商业风险\r\n- 识别可能的商业机会和威胁\r\n- 提供商业决策支持建议\r\n\r\n### 3. 专业改进建议 (Professional Improvement Recommendations)\r\n基于以上分析，请提供：\r\n- 具体的合同条款修改建议\r\n- 风险防范和控制措施\r\n- 谈判策略和要点提示\r\n- 替代方案和应急预案\r\n- 后续执行中的注意事项\r\n\r\n## 输出格式要求\r\n- 使用专业、准确的法律术语\r\n- 结构化输出，条理清晰\r\n- 每个建议都要有具体的操作指导\r\n- 避免模糊或不确定的表述\r\n- 提供可行的解决方案\r\n\r\n## 合同内容\r\nGF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )\r\n\r\n请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。\r\n"
  }, {
    "role" : "assistant",
    "content" : "我将为您生成一份专业、详尽的《危险化学品生产经营企业自建网站销售合同》审查报告。首先让我搜索相关的法律知识来支持分析。",
    "tool_calls" : [ {
      "id" : "call_00_6qbNvIIG37VOFc6NCvhLryBS",
      "type" : "function",
      "function" : {
        "name" : "searchLegalKnowledge",
        "arguments" : "{\"query\": \"危险化学品销售合同 法律风险 合规要求\", \"maxResults\": 10}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_6qbNvIIG37VOFc6NCvhLryBS",
    "content" : "找到 10 个相关法律文档：\n\n【文档 1】来源: 劳动法.pdf\n内容: 同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动合同...\n\n【文档 2】来源: 劳动法.pdf\n内容: 合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动合...\n\n【文档 3】来源: 劳动法.pdf\n内容: 动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动...\n\n【文档 4】来源: 劳动法.pdf\n内容: 同规定的义\n\n务。\n\n第十八条 下列劳动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可...\n\n【文档 5】来源: 合同模板\n内容: GF—2023—2611\n\n危险化学品生产经营企业自建网站\n销售合同（示范文本）\n\n国家市场监督管理总局\n中央网信办\n (\n制定\n)教育部 \t\t\t\t\t\t\t\t\t\t                     \n公安部                  \n应急管理部 \n国家邮政局\n\n二〇二三年十一月\n使用说明\n\n一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。\n二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。\n三、当事人可...\n\n【文档 6】来源: 民法典\n内容: 中华人民共和国劳动法\n\n（1994年 7月 5日第八届全国人民代表大会常务委员会第八次会议通过 根\n\n据 2009年 8 月 27 日第十一届全国人民代表大会常务委员会第十次会议《关于修\n\n改部分法律的决定》第一次修正 根据 2018年 12 月 29日第十三届全国人民代\n\n表大会常务委员会第七次会议《关于修改〈中华人民共和国劳动法〉等七部法律\n\n的决定》第二次修正）\n\n目 录\n\n第一章 总 则\n\n第二章 促进就业\n\n第三章 劳动合同和集体合同\n\n第四章 工作时间和休息休假\n\n第五章 工 资\n\n第六章 劳动安全卫生\n\n第七章 女职工和未成年工特殊保护\n\n第八章 职业培训\n\n第九章 社会保险和福...\n\n【文档 7】来源: 民法典\n内容: 2．按甲方　　％，乙方　　％的比例分配买受人违约金。\n按照《中华人民共和国拍卖法》第三十九条执行：乙方征得甲方的同意，将拍卖标的再行拍卖。\n（二）因甲方或乙方的原因致使拍卖标的不能实现交付的，按本合同第十五条第三款、第七款执行。\n第十一条　保密\n双方对保密事项的约定：　　　　　　　　　　　　　　。\n第十二条　保险\n双方对保险事项的约定：　　　　　　　　　　　　　　。\n第十三条　甲方权利和义务\n（一）拍卖开始前，甲方有权随时撤回拍卖标的，但撤回时应向乙方出具书面通知并支付已经发生的相关费用。\n（二）拍卖未成交的，甲方可变更保留价再次拍卖或者撤回委托。甲方在拍卖未成交后　　日内未作明确意思表示或变...\n\n【文档 8】来源: 民法典\n内容: （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。\n甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。\n乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。\n（四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。\n（五）甲方逾期交货的，应当每日按照合同价款的万分之                                  ...\n\n【文档 9】来源: 合同模板\n内容: 使用说明\n\n一、本合同示范文本由上海市市场监督管理局、上海市商务委员会、上海市拍卖行业协会共同制定，供委托人与拍卖人签订委托拍卖合同时参照使用。\n二、签订合同前，请仔细阅读合同内容。本合同有关术语解释如下：\n（一）拍卖标的是指委托人所有或者依法可以处分的物品或者财产权利。\n（二）保留价是指委托人确定的拍卖标的可以成交的最低价格。\n（三）增价拍卖是指价格由低向高的竞价方式。\n（四）减价拍卖是指价格由高向低的竞价方式。\n（五）密封式递价拍卖又称“投标式拍卖”，是指由拍卖人事先公布拍卖标的物的相关情况、参加拍卖的条件和注意事项，竞买人均在规定的时间内将密封的标书递交至拍卖人指定的地点，由拍卖人在公告...\n\n【文档 10】来源: 民法典\n内容: 1.本合同约定托管服务期限内，相关电梯需要依照《电梯监督检验和定期检验规则》《电梯自行检测规则》的要求进行载荷试验，试验费用为      元，由       承担。\n2.本合同约定托管服务期限内，相关电梯不需要依照《电梯监督检验和定期检验规则》《电梯自行检测规则》的要求进行载荷试验。\n（备注：依照《电梯监督检验和定期检验规则》、《电梯自行检测规则》等安全技术规范规定，在用电梯需要每6年进行一次125%载荷试验。）\n第十条 违约责任\n1.一方当事人未按约定履行义务给对方造成损失的，应当承担赔偿责任。\n2.一方当事人无法继续履行合同的，应当提前30日通知对方，并向对方支付合同总额20%的违约金。\n...\n\n"
  }, {
    "role" : "assistant",
    "content" : "现在让我搜索危险化学品相关的法律风险信息：",
    "tool_calls" : [ {
      "id" : "call_00_qDBqWzyQ5OpJ9WqMK9siJ2Y2",
      "type" : "function",
      "function" : {
        "name" : "searchRiskInformation",
        "arguments" : "{\"riskType\": \"危险化学品销售法律风险\"}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_qDBqWzyQ5OpJ9WqMK9siJ2Y2",
    "content" : "关于'危险化学品销售法律风险'的法律条文和风险防范信息：\n\n参考文献: 拍卖法.pdf\n相关条文: 法规定的条件的，由工商 行政管理部门注销登记，收缴营业执照。具体实施办法由国务院另行规定。 第六十九条 本法自１９９７年１月１日起施行。\n\n参考文献: 拍卖法.pdf\n相关条文: 法规定的条件的，由工商 行政管理部门注销登记，收缴营业执照。具体实施办法由国务院另行规定。 第六十九条 本法自１９９７年１月１日起施行。\n\n参考文献: 拍卖法.pdf\n相关条文: 法规定的条件；逾期未达到本法规定的条件的，由工商 行政管理部门注销登记，收缴营业执照。具体实施办法由国务院另行规定。 第六十九条 本法自１９９７年１月１日起施行。\n\n建议: 具体的风险防范措施应根据实际情况制定，建议结合具体合同条款咨询专业法律人士。"
  }, {
    "role" : "assistant",
    "content" : "让我查询具体的危险化学品管理法规：",
    "tool_calls" : [ {
      "id" : "call_00_CSS7R0CXahTG1zjmgXsoL7OA",
      "type" : "function",
      "function" : {
        "name" : "queryLegalArticle",
        "arguments" : "{\"lawName\": \"危险化学品安全管理条例\", \"articleNumber\": \"第三十八条\"}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_CSS7R0CXahTG1zjmgXsoL7OA",
    "content" : "危险化学品安全管理条例 第三十八条 查询结果：\n\n来源: 中华人民共和国社会保险法.pdf\n内容: 3 — 第九十七条 外国人在中国境内就业的，参照本法规定参 加社会保险。 第九十八条 本法自 2011 年 7月 1日起施行。\n\n来源: 中华人民共和国社会保险法.pdf\n内容: 23 — 第九十七条 外国人在中国境内就业的，参照本法规定参 加社会保险。 第九十八条 本法自 2011 年 7月 1日起施行。\n\n注意: 以上内容仅供参考，具体适用请咨询专业法律人士。"
  }, {
    "role" : "assistant",
    "content" : "让我分析合同中的关键条款：",
    "tool_calls" : [ {
      "id" : "call_00_K8qO6bl1NV1kLgdY4brnKDcg",
      "type" : "function",
      "function" : {
        "name" : "analyzeContractClause",
        "arguments" : "{\"clauseText\": \"甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。\", \"clauseType\": \"合规义务条款\"}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_K8qO6bl1NV1kLgdY4brnKDcg",
    "content" : "'合规义务条款'条款分析：\n\n条款内容: 甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。\n\n相关法律依据：\n- 来源: 劳动法.pdf\n  内容: 合同规定的义\n\n务。\n\n第十八条 下列劳动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委...\n\n- 来源: 劳动法.pdf\n  内容: 同规定的义\n\n务。\n\n第十八条 下列劳动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员...\n\n- 来源: 劳动法.pdf\n  内容: 合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合...\n\n分析建议：\n- 确认条款表述是否明确，避免歧义\n- 检查是否符合相关法律法规的强制性规定\n\n重要提醒: 以上分析仅供参考，具体的合同条款设计建议咨询专业律师。"
  } ],
  "temperature" : 0.3,
  "stream" : false,
  "max_tokens" : 4096,
  "tools" : [ {
    "type" : "function",
    "function" : {
      "name" : "searchLegalKnowledge",
      "description" : "在法律知识库中搜索相关文档和案例。输入查询关键词，返回最相关的法律条文和合同条款。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "query" : {
            "type" : "string"
          },
          "maxResults" : {
            "type" : "integer"
          }
        },
        "required" : [ "query", "maxResults" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "analyzeContractClause",
      "description" : "分析特定合同条款的合法性和合理性。输入条款文本和类型，返回专业分析和改进建议。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "clauseText" : {
            "type" : "string"
          },
          "clauseType" : {
            "type" : "string"
          }
        },
        "required" : [ "clauseText", "clauseType" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "searchRiskInformation",
      "description" : "搜索特定类型的法律风险信息和防范措施。输入风险类型，返回相关的法律条文和专业建议。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "riskType" : {
            "type" : "string"
          }
        },
        "required" : [ "riskType" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "queryLegalArticle",
      "description" : "查询特定法律条文的详细内容和释义。输入法律名称和条文编号，返回条文原文和专业解释。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "lawName" : {
            "type" : "string"
          },
          "articleNumber" : {
            "type" : "string"
          }
        },
        "required" : [ "lawName", "articleNumber" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "calculatePenalty",
      "description" : "计算合同违约金和赔偿金额。输入合同价值、违约金比例和实际损失，返回计算结果和相关法律依据。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "contractValue" : {
            "type" : "number"
          },
          "penaltyRate" : {
            "type" : "number"
          },
          "actualLoss" : {
            "type" : "number"
          }
        },
        "required" : [ "contractValue", "penaltyRate", "actualLoss" ]
      }
    }
  } ]
}

2025-10-08 19:16:27.215 [HikariPool-1 housekeeper] WARN  c.zaxxer.hikari.pool.ProxyLeakTask - Connection leak detection triggered for org.postgresql.jdbc.PgConnection@75d0cac6 on thread http-nio-8080-exec-6, stack trace follows
java.lang.Exception: Apparent connection leak detected
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:127)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:46)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:126)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:156)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:405)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:604)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:373)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:138)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:165)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:223)
	at jdk.proxy2/jdk.proxy2.$Proxy211.findById(Unknown Source)
	at com.river.LegalAssistant.service.ContractReviewService.findById(ContractReviewService.java:641)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:716)
	at com.river.LegalAssistant.service.ContractReviewService$$SpringCGLIB$$1.findById(<generated>)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:561)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 19:16:50.332 [http-nio-8080-exec-6] WARN  dev.langchain4j.internal.RetryUtils - A retriable exception occurred. Remaining retries: 2 of 2
java.lang.RuntimeException: java.lang.InterruptedException
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:60)
	at dev.langchain4j.http.client.log.LoggingHttpClient.execute(LoggingHttpClient.java:48)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy209.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:568)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.generateEnhancedContent(ReportGenerationService.java:253)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:89)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:586)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.InterruptedException: null
	at java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:386)
	at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2073)
	at java.net.http/jdk.internal.net.http.HttpClientImpl.send(HttpClientImpl.java:931)
	at java.net.http/jdk.internal.net.http.HttpClientFacade.send(HttpClientFacade.java:133)
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:50)
	... 187 common frames omitted
2025-10-08 19:16:50.882 [http-nio-8080-exec-6] INFO  d.l.h.client.log.LoggingHttpClient - HTTP request:
- method: POST
- url: https://api.deepseek.com/chat/completions
- headers: [Authorization: Beare...72], [User-Agent: langchain4j-openai], [Content-Type: application/json]
- body: {
  "model" : "deepseek-chat",
  "messages" : [ {
    "role" : "user",
    "content" : "/*\r\n * PDF合同审查报告生成专用提示词模板\r\n * 用于DeepSeek AI生成专业、详尽的合同分析报告内容\r\n */\r\n\r\n作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。\r\n\r\n## 合同基本信息\r\n- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx\r\n- 风险等级: 中等风险\r\n- 识别风险点数量: 10\r\n- 审查完成时间: 2025-10-08 19:14:37\r\n\r\n## 分析要求\r\n\r\n### 1. 执行摘要 (Executive Summary)\r\n请提供一个简洁但全面的执行摘要，包括：\r\n- 合同性质和类型的专业判断\r\n- 主要条款的关键要点总结\r\n- 整体风险评估和建议\r\n- 对决策者的核心建议\r\n要求：语言专业、逻辑清晰，控制在300-500字内。\r\n\r\n### 2. 深度合同分析 (Deep Contract Analysis)\r\n请从以下维度进行深入分析：\r\n\r\n#### 2.1 合同类型和法律性质分析\r\n- 确定合同的具体类型和法律分类\r\n- 分析适用的法律法规框架\r\n- 识别合同的核心法律关系\r\n\r\n#### 2.2 关键条款专业解读\r\n- 识别并解析合同中的核心条款\r\n- 分析条款的法律效力和约束力\r\n- 评估条款的公平性和合理性\r\n- 指出可能存在的歧义或漏洞\r\n\r\n#### 2.3 法律风险深度评估\r\n- 系统性识别潜在法律风险点\r\n- 评估风险发生的概率和影响程度\r\n- 分析风险的法律后果和责任归属\r\n- 提供风险量化评估（如适用）\r\n\r\n#### 2.4 合规性专业检查\r\n- 检查合同是否符合相关法律法规\r\n- 识别可能违反的法律条文\r\n- 评估监管风险和合规要求\r\n- 提出合规性改进建议\r\n\r\n#### 2.5 商业影响分析\r\n- 分析合同对各方商业利益的影响\r\n- 评估财务风险和商业风险\r\n- 识别可能的商业机会和威胁\r\n- 提供商业决策支持建议\r\n\r\n### 3. 专业改进建议 (Professional Improvement Recommendations)\r\n基于以上分析，请提供：\r\n- 具体的合同条款修改建议\r\n- 风险防范和控制措施\r\n- 谈判策略和要点提示\r\n- 替代方案和应急预案\r\n- 后续执行中的注意事项\r\n\r\n## 输出格式要求\r\n- 使用专业、准确的法律术语\r\n- 结构化输出，条理清晰\r\n- 每个建议都要有具体的操作指导\r\n- 避免模糊或不确定的表述\r\n- 提供可行的解决方案\r\n\r\n## 合同内容\r\nGF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )\r\n\r\n请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。\r\n"
  }, {
    "role" : "assistant",
    "content" : "我将为您生成一份专业、详尽的《危险化学品生产经营企业自建网站销售合同》审查报告。首先让我搜索相关的法律知识来支持分析。",
    "tool_calls" : [ {
      "id" : "call_00_6qbNvIIG37VOFc6NCvhLryBS",
      "type" : "function",
      "function" : {
        "name" : "searchLegalKnowledge",
        "arguments" : "{\"query\": \"危险化学品销售合同 法律风险 合规要求\", \"maxResults\": 10}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_6qbNvIIG37VOFc6NCvhLryBS",
    "content" : "找到 10 个相关法律文档：\n\n【文档 1】来源: 劳动法.pdf\n内容: 同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动合同...\n\n【文档 2】来源: 劳动法.pdf\n内容: 合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动合...\n\n【文档 3】来源: 劳动法.pdf\n内容: 动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可以协商约定其他内容。\n\n第二十条 劳动...\n\n【文档 4】来源: 劳动法.pdf\n内容: 同规定的义\n\n务。\n\n第十八条 下列劳动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合同应当以书面形式订立，并具备以下条款：\n\n（一）劳动合同期限；\n\n（二）工作内容；\n\n（三）劳动保护和劳动条件；\n\n（四）劳动报酬；\n\n（五）劳动纪律；\n\n（六）劳动合同终止的条件；\n\n\n\n（七）违反劳动合同的责任。\n\n劳动合同除前款规定的必备条款外，当事人可...\n\n【文档 5】来源: 合同模板\n内容: GF—2023—2611\n\n危险化学品生产经营企业自建网站\n销售合同（示范文本）\n\n国家市场监督管理总局\n中央网信办\n (\n制定\n)教育部 \t\t\t\t\t\t\t\t\t\t                     \n公安部                  \n应急管理部 \n国家邮政局\n\n二〇二三年十一月\n使用说明\n\n一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。\n二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。\n三、当事人可...\n\n【文档 6】来源: 民法典\n内容: 中华人民共和国劳动法\n\n（1994年 7月 5日第八届全国人民代表大会常务委员会第八次会议通过 根\n\n据 2009年 8 月 27 日第十一届全国人民代表大会常务委员会第十次会议《关于修\n\n改部分法律的决定》第一次修正 根据 2018年 12 月 29日第十三届全国人民代\n\n表大会常务委员会第七次会议《关于修改〈中华人民共和国劳动法〉等七部法律\n\n的决定》第二次修正）\n\n目 录\n\n第一章 总 则\n\n第二章 促进就业\n\n第三章 劳动合同和集体合同\n\n第四章 工作时间和休息休假\n\n第五章 工 资\n\n第六章 劳动安全卫生\n\n第七章 女职工和未成年工特殊保护\n\n第八章 职业培训\n\n第九章 社会保险和福...\n\n【文档 7】来源: 民法典\n内容: 2．按甲方　　％，乙方　　％的比例分配买受人违约金。\n按照《中华人民共和国拍卖法》第三十九条执行：乙方征得甲方的同意，将拍卖标的再行拍卖。\n（二）因甲方或乙方的原因致使拍卖标的不能实现交付的，按本合同第十五条第三款、第七款执行。\n第十一条　保密\n双方对保密事项的约定：　　　　　　　　　　　　　　。\n第十二条　保险\n双方对保险事项的约定：　　　　　　　　　　　　　　。\n第十三条　甲方权利和义务\n（一）拍卖开始前，甲方有权随时撤回拍卖标的，但撤回时应向乙方出具书面通知并支付已经发生的相关费用。\n（二）拍卖未成交的，甲方可变更保留价再次拍卖或者撤回委托。甲方在拍卖未成交后　　日内未作明确意思表示或变...\n\n【文档 8】来源: 民法典\n内容: （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。\n甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。\n乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。\n（四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。\n（五）甲方逾期交货的，应当每日按照合同价款的万分之                                  ...\n\n【文档 9】来源: 合同模板\n内容: 使用说明\n\n一、本合同示范文本由上海市市场监督管理局、上海市商务委员会、上海市拍卖行业协会共同制定，供委托人与拍卖人签订委托拍卖合同时参照使用。\n二、签订合同前，请仔细阅读合同内容。本合同有关术语解释如下：\n（一）拍卖标的是指委托人所有或者依法可以处分的物品或者财产权利。\n（二）保留价是指委托人确定的拍卖标的可以成交的最低价格。\n（三）增价拍卖是指价格由低向高的竞价方式。\n（四）减价拍卖是指价格由高向低的竞价方式。\n（五）密封式递价拍卖又称“投标式拍卖”，是指由拍卖人事先公布拍卖标的物的相关情况、参加拍卖的条件和注意事项，竞买人均在规定的时间内将密封的标书递交至拍卖人指定的地点，由拍卖人在公告...\n\n【文档 10】来源: 民法典\n内容: 1.本合同约定托管服务期限内，相关电梯需要依照《电梯监督检验和定期检验规则》《电梯自行检测规则》的要求进行载荷试验，试验费用为      元，由       承担。\n2.本合同约定托管服务期限内，相关电梯不需要依照《电梯监督检验和定期检验规则》《电梯自行检测规则》的要求进行载荷试验。\n（备注：依照《电梯监督检验和定期检验规则》、《电梯自行检测规则》等安全技术规范规定，在用电梯需要每6年进行一次125%载荷试验。）\n第十条 违约责任\n1.一方当事人未按约定履行义务给对方造成损失的，应当承担赔偿责任。\n2.一方当事人无法继续履行合同的，应当提前30日通知对方，并向对方支付合同总额20%的违约金。\n...\n\n"
  }, {
    "role" : "assistant",
    "content" : "现在让我搜索危险化学品相关的法律风险信息：",
    "tool_calls" : [ {
      "id" : "call_00_qDBqWzyQ5OpJ9WqMK9siJ2Y2",
      "type" : "function",
      "function" : {
        "name" : "searchRiskInformation",
        "arguments" : "{\"riskType\": \"危险化学品销售法律风险\"}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_qDBqWzyQ5OpJ9WqMK9siJ2Y2",
    "content" : "关于'危险化学品销售法律风险'的法律条文和风险防范信息：\n\n参考文献: 拍卖法.pdf\n相关条文: 法规定的条件的，由工商 行政管理部门注销登记，收缴营业执照。具体实施办法由国务院另行规定。 第六十九条 本法自１９９７年１月１日起施行。\n\n参考文献: 拍卖法.pdf\n相关条文: 法规定的条件的，由工商 行政管理部门注销登记，收缴营业执照。具体实施办法由国务院另行规定。 第六十九条 本法自１９９７年１月１日起施行。\n\n参考文献: 拍卖法.pdf\n相关条文: 法规定的条件；逾期未达到本法规定的条件的，由工商 行政管理部门注销登记，收缴营业执照。具体实施办法由国务院另行规定。 第六十九条 本法自１９９７年１月１日起施行。\n\n建议: 具体的风险防范措施应根据实际情况制定，建议结合具体合同条款咨询专业法律人士。"
  }, {
    "role" : "assistant",
    "content" : "让我查询具体的危险化学品管理法规：",
    "tool_calls" : [ {
      "id" : "call_00_CSS7R0CXahTG1zjmgXsoL7OA",
      "type" : "function",
      "function" : {
        "name" : "queryLegalArticle",
        "arguments" : "{\"lawName\": \"危险化学品安全管理条例\", \"articleNumber\": \"第三十八条\"}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_CSS7R0CXahTG1zjmgXsoL7OA",
    "content" : "危险化学品安全管理条例 第三十八条 查询结果：\n\n来源: 中华人民共和国社会保险法.pdf\n内容: 3 — 第九十七条 外国人在中国境内就业的，参照本法规定参 加社会保险。 第九十八条 本法自 2011 年 7月 1日起施行。\n\n来源: 中华人民共和国社会保险法.pdf\n内容: 23 — 第九十七条 外国人在中国境内就业的，参照本法规定参 加社会保险。 第九十八条 本法自 2011 年 7月 1日起施行。\n\n注意: 以上内容仅供参考，具体适用请咨询专业法律人士。"
  }, {
    "role" : "assistant",
    "content" : "让我分析合同中的关键条款：",
    "tool_calls" : [ {
      "id" : "call_00_K8qO6bl1NV1kLgdY4brnKDcg",
      "type" : "function",
      "function" : {
        "name" : "analyzeContractClause",
        "arguments" : "{\"clauseText\": \"甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。\", \"clauseType\": \"合规义务条款\"}"
      }
    } ]
  }, {
    "role" : "tool",
    "tool_call_id" : "call_00_K8qO6bl1NV1kLgdY4brnKDcg",
    "content" : "'合规义务条款'条款分析：\n\n条款内容: 甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。\n\n相关法律依据：\n- 来源: 劳动法.pdf\n  内容: 合同规定的义\n\n务。\n\n第十八条 下列劳动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委...\n\n- 来源: 劳动法.pdf\n  内容: 同规定的义\n\n务。\n\n第十八条 下列劳动合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员...\n\n- 来源: 劳动法.pdf\n  内容: 合同无效：\n\n（一）违反法律、行政法规的劳动合同；\n\n（二）采取欺诈、威胁等手段订立的劳动合同。\n\n无效的劳动合同，从订立的时候起，就没有法律约束力。确认劳动合同部分\n\n无效的，如果不影响其余部分的效力，其余部分仍然有效。\n\n劳动合同的无效，由劳动争议仲裁委员会或者人民法院确认。\n\n第十九条 劳动合...\n\n分析建议：\n- 确认条款表述是否明确，避免歧义\n- 检查是否符合相关法律法规的强制性规定\n\n重要提醒: 以上分析仅供参考，具体的合同条款设计建议咨询专业律师。"
  } ],
  "temperature" : 0.3,
  "stream" : false,
  "max_tokens" : 4096,
  "tools" : [ {
    "type" : "function",
    "function" : {
      "name" : "searchLegalKnowledge",
      "description" : "在法律知识库中搜索相关文档和案例。输入查询关键词，返回最相关的法律条文和合同条款。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "query" : {
            "type" : "string"
          },
          "maxResults" : {
            "type" : "integer"
          }
        },
        "required" : [ "query", "maxResults" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "analyzeContractClause",
      "description" : "分析特定合同条款的合法性和合理性。输入条款文本和类型，返回专业分析和改进建议。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "clauseText" : {
            "type" : "string"
          },
          "clauseType" : {
            "type" : "string"
          }
        },
        "required" : [ "clauseText", "clauseType" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "searchRiskInformation",
      "description" : "搜索特定类型的法律风险信息和防范措施。输入风险类型，返回相关的法律条文和专业建议。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "riskType" : {
            "type" : "string"
          }
        },
        "required" : [ "riskType" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "queryLegalArticle",
      "description" : "查询特定法律条文的详细内容和释义。输入法律名称和条文编号，返回条文原文和专业解释。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "lawName" : {
            "type" : "string"
          },
          "articleNumber" : {
            "type" : "string"
          }
        },
        "required" : [ "lawName", "articleNumber" ]
      }
    }
  }, {
    "type" : "function",
    "function" : {
      "name" : "calculatePenalty",
      "description" : "计算合同违约金和赔偿金额。输入合同价值、违约金比例和实际损失，返回计算结果和相关法律依据。",
      "parameters" : {
        "type" : "object",
        "properties" : {
          "contractValue" : {
            "type" : "number"
          },
          "penaltyRate" : {
            "type" : "number"
          },
          "actualLoss" : {
            "type" : "number"
          }
        },
        "required" : [ "contractValue", "penaltyRate", "actualLoss" ]
      }
    }
  } ]
}

2025-10-08 19:33:17.592 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 27688 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 19:33:17.594 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 19:33:20.223 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 19:33:20.377 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@21202507
2025-10-08 19:33:20.437 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 19:33:20.456 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 19:33:20.465 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 19:33:20.556 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 19:33:20.558 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 19:33:21.037 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 19:33:22.140 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 19:33:22.141 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 19:33:22.163 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 19:33:22.163 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 19:33:22.163 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 19:33:22.163 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 19:33:22.163 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 19:33:22.163 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 19:33:22.163 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 19:33:22.199 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 19:33:22.330 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 19:33:22.330 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 19:33:23.073 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 19:33:23.104 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 19:33:23.106 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 19:33:23.110 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 19:33:23.110 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 19:33:23.111 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 19:33:23.142 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 19:33:23.320 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 19:33:23.322 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 19:33:23.323 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 19:33:23.323 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 19:33:23.510 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 19:33:23.517 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 19:33:23.519 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 19:33:23.519 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 19:33:23.519 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 19:33:23.526 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 19:33:23.526 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 19:33:23.553 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 19:33:23.553 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 19:33:23.553 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 19:33:23.553 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 19:33:23.553 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 19:33:23.553 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 19:33:23.553 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 19:33:23.564 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 19:33:23.579 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 19:33:23.579 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 19:33:23.590 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 19:33:23.592 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 19:33:23.594 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 19:33:23.594 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 19:33:23.596 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 19:33:23.596 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 19:33:23.656 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 19:33:24.146 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 19:33:24.224 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 19:33:24.226 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 19:33:24.254 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 19:33:24.386 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 19:33:24.620 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-08 19:33:24.928 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-08 19:33:25.082 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 19:33:25.179 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 19:33:25.990 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.858 seconds (process running for 9.148)
2025-10-08 19:33:25.996 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 19:33:25.997 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 19:33:26.101 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 19:33:41.980 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 19:33:41.985 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 19:33:42.012 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 19:33:42.018 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 9
2025-10-08 19:33:42.019 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 19:33:42.045 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f2d0b8e6, method=POST, uri=/api/v1/contracts/upload, status=202, duration=133ms
2025-10-08 19:33:42.052 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 19:33:42.052 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 19:33:42.089 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 19:33:42.092 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 19:33:42.097 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 19:33:42.098 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 19:33:42.106 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 19:33:42.107 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=9
2025-10-08 19:33:42.111 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=da210656, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=24ms
2025-10-08 19:33:42.175 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=9
2025-10-08 19:33:42.838 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 19:33:42.839 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-08 19:33:42.840 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=9, 文本长度: 7321
2025-10-08 19:33:42.840 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 19:33:42.844 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 19:33:50.557 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 19:33:50.557 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 9, 块数: 405
2025-10-08 19:33:50.558 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 9
2025-10-08 19:33:50.558 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 9
2025-10-08 19:33:50.986 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 9
2025-10-08 19:33:50.996 [http-nio-8080-exec-4] WARN  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f3b3f447, method=GET, uri=/api/v1/contracts/9/report, status=400, duration=13ms
2025-10-08 19:34:30.156 [http-nio-8080-exec-10] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 19:34:30.157 [http-nio-8080-exec-10] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 19:34:30.161 [http-nio-8080-exec-10] WARN  c.r.L.service.ContractReviewService - 文件哈希 454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd 已存在，返回现有审查记录
2025-10-08 19:34:30.163 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 10
2025-10-08 19:34:30.163 [Async-3] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-3
2025-10-08 19:34:30.163 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=52ca398b, method=POST, uri=/api/v1/contracts/upload, status=202, duration=27ms
2025-10-08 19:34:30.167 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 广州市既有住宅加装电梯委托管理合同.docx, 路径: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 19:34:30.168 [Async-3] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 广州市既有住宅加装电梯委托管理合同.docx, 类型: docx, 大小: 36076 bytes
2025-10-08 19:34:30.183 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 10
2025-10-08 19:34:30.185 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 10
2025-10-08 19:34:30.186 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 10
2025-10-08 19:34:30.187 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 19:34:30.187 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=573e1194, method=GET, uri=/api/v1/contracts/10/analyze-async, status=200, duration=5ms
2025-10-08 19:34:30.190 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 3641
2025-10-08 19:34:30.223 [Async-4] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 3641
2025-10-08 19:34:30.291 [Async-3] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 广州市既有住宅加装电梯委托管理合同.docx, 内容长度: 3641 字符
2025-10-08 19:34:30.292 [Async-3] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 广州市既有住宅加装电梯委托管理合同.docx, 内容长度: 3641
2025-10-08 19:34:30.292 [Async-3] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=10, 文本长度: 3641
2025-10-08 19:34:30.292 [Async-3] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3641 字符
2025-10-08 19:34:30.295 [Async-3] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 19:34:36.260 [Async-3] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 19:34:36.260 [Async-3] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 10, 块数: 403
2025-10-08 19:34:36.261 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 10
2025-10-08 19:34:36.261 [Async-3] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 10
2025-10-08 19:35:47.819 [Async-4] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 19:35:47.875 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 19:35:47.877 [http-nio-8080-exec-8] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=10
2025-10-08 19:35:48.934 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 10
2025-10-08 19:35:48.935 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 10
2025-10-08 19:35:48.936 [Async-5] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 10
2025-10-08 19:35:48.936 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3fa54058, method=GET, uri=/api/v1/contracts/10/analyze-async, status=200, duration=3ms
2025-10-08 19:35:48.936 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 19:35:48.938 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 3641
2025-10-08 19:35:48.938 [Async-5] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=10
2025-10-08 19:35:48.948 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=10
2025-10-08 19:36:09.134 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 10
2025-10-08 19:36:09.135 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 10
2025-10-08 19:36:09.136 [Async-6] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 10
2025-10-08 19:36:09.137 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=13847cc4, method=GET, uri=/api/v1/contracts/10/analyze-async, status=200, duration=4ms
2025-10-08 19:36:09.138 [Async-6] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 19:36:09.140 [Async-6] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 3641
2025-10-08 19:36:09.141 [Async-6] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=10
2025-10-08 19:36:09.157 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=10
2025-10-08 19:36:13.938 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 10
2025-10-08 19:36:13.939 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 10
2025-10-08 19:36:13.940 [Async-7] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 10
2025-10-08 19:36:13.941 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=04e9f74c, method=GET, uri=/api/v1/contracts/10/analyze-async, status=200, duration=4ms
2025-10-08 19:36:13.942 [Async-7] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=10
2025-10-08 19:36:13.944 [Async-7] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 3641
2025-10-08 19:36:13.944 [Async-7] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=10
2025-10-08 19:36:13.958 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=10
2025-10-08 19:36:18.009 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 10
2025-10-08 19:36:18.015 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 10
2025-10-08 19:36:18.015 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-08 19:36:18.193 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载中文字体：STSong-Light (UniGB-UCS2-H编码)
2025-10-08 19:36:18.243 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-08 19:36:18.244 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-08 19:36:18.244 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 10
2025-10-08 19:36:23.023 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 开始使用专用提示词生成PDF报告内容...
2025-10-08 19:36:23.024 [http-nio-8080-exec-5] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 3641, 问题: /*
 * PDF合同审查报告生成专用提示词模板
 * ..., 会话ID: default
2025-10-08 19:36:23.025 [http-nio-8080-exec-5] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 3641, 会话: default
2025-10-08 19:36:30.319 [http-nio-8080-exec-5] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 中华人民共和国特种设备安全法, 条文: 第三十四条
2025-10-08 19:36:30.319 [http-nio-8080-exec-5] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 中华人民共和国特种设备安全法 第三十四条 条文 内容, 最大结果数: 2
2025-10-08 19:36:30.386 [http-nio-8080-exec-5] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-08 19:36:30.387 [http-nio-8080-exec-5] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-08 19:36:30.387 [http-nio-8080-exec-5] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 电梯安全管理
2025-10-08 19:36:30.388 [http-nio-8080-exec-5] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 电梯安全管理 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-08 19:36:30.410 [http-nio-8080-exec-5] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-08 19:36:30.410 [http-nio-8080-exec-5] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 电梯安全管理
2025-10-08 19:36:30.410 [http-nio-8080-exec-5] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 责任条款
2025-10-08 19:36:30.410 [http-nio-8080-exec-5] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 责任条款 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-08 19:36:30.444 [http-nio-8080-exec-5] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-08 19:36:30.445 [http-nio-8080-exec-5] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 责任条款
2025-10-08 19:36:30.445 [http-nio-8080-exec-5] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 电梯委托管理合同 违约责任
2025-10-08 19:36:30.445 [http-nio-8080-exec-5] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 电梯委托管理合同 违约责任, 最大结果数: 5
2025-10-08 19:36:30.474 [http-nio-8080-exec-5] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-08 19:36:30.563 [http-nio-8080-exec-5] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 1 个结果
2025-10-08 19:36:30.563 [http-nio-8080-exec-5] INFO  c.r.L.service.VectorStoreService - 最终返回 5 个相似文档
2025-10-08 19:36:30.563 [http-nio-8080-exec-5] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 5 个结果
2025-10-08 19:37:18.023 [HikariPool-1 housekeeper] WARN  c.zaxxer.hikari.pool.ProxyLeakTask - Connection leak detection triggered for org.postgresql.jdbc.PgConnection@21202507 on thread http-nio-8080-exec-5, stack trace follows
java.lang.Exception: Apparent connection leak detected
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:127)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:46)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:126)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:156)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:405)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:604)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:373)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:138)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:165)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:223)
	at jdk.proxy2/jdk.proxy2.$Proxy211.findById(Unknown Source)
	at com.river.LegalAssistant.service.ContractReviewService.findById(ContractReviewService.java:641)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:716)
	at com.river.LegalAssistant.service.ContractReviewService$$SpringCGLIB$$1.findById(<generated>)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:561)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 19:37:32.453 [http-nio-8080-exec-5] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-08 19:37:32.453 [http-nio-8080-exec-5] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 3641, 问题: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了..., 会话ID: default
2025-10-08 19:37:32.454 [http-nio-8080-exec-5] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 3641, 会话: default
2025-10-08 19:37:49.724 [http-nio-8080-exec-5] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-08 19:37:49.725 [http-nio-8080-exec-5] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 3641, 问题: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合..., 会话ID: default
2025-10-08 19:37:49.725 [http-nio-8080-exec-5] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 3641, 会话: default
2025-10-08 19:38:22.865 [http-nio-8080-exec-5] WARN  dev.langchain4j.internal.RetryUtils - A retriable exception occurred. Remaining retries: 2 of 2
java.lang.RuntimeException: java.lang.InterruptedException
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:60)
	at dev.langchain4j.http.client.log.LoggingHttpClient.execute(LoggingHttpClient.java:48)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.guardrail.SynchronousChatExecutor.execute(SynchronousChatExecutor.java:32)
	at dev.langchain4j.guardrail.AbstractChatExecutor.execute(AbstractChatExecutor.java:45)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:372)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy209.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:568)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.generateEnhancedContent(ReportGenerationService.java:270)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:89)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:586)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.InterruptedException: null
	at java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:386)
	at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2073)
	at java.net.http/jdk.internal.net.http.HttpClientImpl.send(HttpClientImpl.java:931)
	at java.net.http/jdk.internal.net.http.HttpClientFacade.send(HttpClientFacade.java:133)
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:50)
	... 188 common frames omitted
2025-10-08 19:48:24.901 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 23644 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 19:48:24.903 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 19:48:27.388 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 19:48:27.529 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@755a90a6
2025-10-08 19:48:27.571 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 19:48:27.590 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 19:48:27.595 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 19:48:27.670 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 19:48:27.671 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 19:48:27.989 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 19:48:29.081 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 19:48:29.082 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 19:48:29.105 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 19:48:29.105 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 19:48:29.105 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 19:48:29.105 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 19:48:29.106 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 19:48:29.106 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 19:48:29.106 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 19:48:29.142 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 19:48:29.246 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 19:48:29.246 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 19:48:29.931 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 19:48:29.958 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 19:48:29.960 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 19:48:29.964 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 19:48:29.965 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 19:48:29.966 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 19:48:29.998 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 19:48:30.166 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 19:48:30.168 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 19:48:30.168 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 19:48:30.169 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 19:48:30.336 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 19:48:30.342 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 19:48:30.344 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 19:48:30.344 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 19:48:30.344 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 19:48:30.351 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 19:48:30.351 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 19:48:30.373 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 19:48:30.373 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 19:48:30.373 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 19:48:30.373 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 19:48:30.374 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 19:48:30.374 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 19:48:30.374 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 19:48:30.385 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 19:48:30.398 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 19:48:30.399 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 19:48:30.408 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 19:48:30.408 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 19:48:30.410 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 19:48:30.410 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 19:48:30.413 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 19:48:30.413 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 19:48:30.466 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 19:48:31.072 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 19:48:31.159 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 19:48:31.161 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 19:48:31.183 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 19:48:31.312 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 19:48:31.528 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-08 19:48:31.840 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-08 19:48:31.989 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 19:48:32.078 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 19:48:32.862 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.38 seconds (process running for 8.699)
2025-10-08 19:48:32.876 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 19:48:32.877 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 19:48:32.970 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 19:48:41.124 [http-nio-8080-exec-2] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 19:48:41.127 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 19:48:41.153 [http-nio-8080-exec-2] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 19:48:41.160 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 9
2025-10-08 19:48:41.160 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 19:48:41.175 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f8c0af3d, method=POST, uri=/api/v1/contracts/upload, status=202, duration=102ms
2025-10-08 19:48:41.183 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 19:48:41.184 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 19:48:41.204 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 19:48:41.207 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 19:48:41.211 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 19:48:41.212 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 19:48:41.216 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 19:48:41.219 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fbc900a4, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=17ms
2025-10-08 19:48:41.268 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-08 19:48:41.745 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 19:48:41.745 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-08 19:48:41.746 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=9, 文本长度: 7321
2025-10-08 19:48:41.746 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 19:48:41.748 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 19:48:48.898 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 19:48:48.898 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 9, 块数: 405
2025-10-08 19:48:48.899 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 9
2025-10-08 19:48:48.899 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 9
2025-10-08 19:49:54.965 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 19:49:55.035 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 19:49:55.043 [http-nio-8080-exec-4] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=9
2025-10-08 19:49:56.111 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 19:49:56.112 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 19:49:56.113 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 19:49:56.113 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2309a401, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=3ms
2025-10-08 19:49:56.119 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 19:49:56.121 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 19:49:56.122 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=9
2025-10-08 19:49:56.137 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=9
2025-10-08 19:50:44.714 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 9
2025-10-08 19:50:44.734 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 9
2025-10-08 19:50:44.734 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-08 19:50:44.912 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载中文字体：STSong-Light (UniGB-UCS2-H编码)
2025-10-08 19:50:44.954 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-08 19:50:44.954 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-08 19:50:44.955 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 9
2025-10-08 19:50:47.908 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始使用专用提示词生成PDF报告内容...
2025-10-08 19:50:47.908 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: /*
 * PDF合同审查报告生成专用提示词模板
 * ..., 会话ID: default
2025-10-08 19:50:47.909 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-08 19:50:52.636 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 危险化学品销售合同风险
2025-10-08 19:50:52.636 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同风险 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-08 19:50:52.715 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-08 19:50:52.715 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 危险化学品销售合同风险
2025-10-08 19:50:55.150 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 危险化学品销售合同 法律风险 防范措施
2025-10-08 19:50:55.150 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同 法律风险 防范措施, 最大结果数: 10
2025-10-08 19:50:55.184 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-08 19:50:55.382 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 6 个结果
2025-10-08 19:50:55.382 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 10 个相似文档
2025-10-08 19:50:55.382 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 10 个结果
2025-10-08 19:50:58.044 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 危险化学品安全管理条例, 条文: 第三十八条
2025-10-08 19:50:58.045 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品安全管理条例 第三十八条 条文 内容, 最大结果数: 2
2025-10-08 19:50:58.142 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-08 19:50:58.143 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-08 19:51:55.186 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-08 19:51:55.188 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了..., 会话ID: default
2025-10-08 19:51:55.188 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-08 19:52:12.388 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-08 19:52:12.389 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合..., 会话ID: default
2025-10-08 19:52:12.389 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-08 19:53:13.932 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-08 19:53:13.932 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违..., 会话ID: default
2025-10-08 19:53:13.932 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-08 19:53:44.729 [HikariPool-1 housekeeper] WARN  c.zaxxer.hikari.pool.ProxyLeakTask - Connection leak detection triggered for org.postgresql.jdbc.PgConnection@755a90a6 on thread http-nio-8080-exec-6, stack trace follows
java.lang.Exception: Apparent connection leak detected
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:127)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:46)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:126)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:156)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:405)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:604)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:373)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.ContractReviewService$$SpringCGLIB$$1.getReviewForReportGeneration(<generated>)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:561)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 19:54:05.191 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-08 19:54:05.191 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - PDF报告内容生成完成，耗时: 200236ms
2025-10-08 19:54:05.193 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - DeepSeek分析结果已保存到JSON文件: uploads\reports\9_analysis.json
2025-10-08 19:54:05.193 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-08 19:54:05.193 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-08 19:54:05.264 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 690 字符
2025-10-08 19:54:05.265 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 28 行，开始逐行渲染
2025-10-08 19:54:05.281 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 28, 已处理: 22
2025-10-08 19:54:05.281 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-08 19:54:05.326 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 正在渲染DeepSeek深度分析内容...
2025-10-08 19:54:05.327 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 2445 字符
2025-10-08 19:54:05.327 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 160 行，开始逐行渲染
2025-10-08 19:54:05.340 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 160, 已处理: 117
2025-10-08 19:54:05.340 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-08 19:54:05.341 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 2300 字符
2025-10-08 19:54:05.341 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 138 行，开始逐行渲染
2025-10-08 19:54:05.352 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 138, 已处理: 101
2025-10-08 19:54:05.353 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-08 19:54:05.353 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 2738 字符
2025-10-08 19:54:05.353 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 173 行，开始逐行渲染
2025-10-08 19:54:05.364 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 173, 已处理: 144
2025-10-08 19:54:05.364 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-08 19:54:05.366 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-08 19:54:05.374 [http-nio-8080-exec-6] ERROR c.r.L.s.ReportGenerationService - PDF报告生成失败，审查ID: 9
java.lang.NullPointerException: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.itextpdf.kernel.font.PdfType0Font.generateWidthsArray(PdfType0Font.java:921)
	at com.itextpdf.kernel.font.PdfType0Font.getCidFont(PdfType0Font.java:901)
	at com.itextpdf.kernel.font.PdfType0Font.flushFontData(PdfType0Font.java:785)
	at com.itextpdf.kernel.font.PdfType0Font.flush(PdfType0Font.java:696)
	at com.itextpdf.kernel.pdf.PdfDocument.flushFonts(PdfDocument.java:2319)
	at com.itextpdf.kernel.pdf.PdfDocument.close(PdfDocument.java:978)
	at com.itextpdf.layout.Document.close(Document.java:96)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:127)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:584)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 19:54:05.377 [http-nio-8080-exec-6] ERROR c.r.L.c.ContractReviewController - 生成PDF报告失败，审查ID: 9
java.io.IOException: PDF报告生成失败: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:135)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:584)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.NullPointerException: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.itextpdf.kernel.font.PdfType0Font.generateWidthsArray(PdfType0Font.java:921)
	at com.itextpdf.kernel.font.PdfType0Font.getCidFont(PdfType0Font.java:901)
	at com.itextpdf.kernel.font.PdfType0Font.flushFontData(PdfType0Font.java:785)
	at com.itextpdf.kernel.font.PdfType0Font.flush(PdfType0Font.java:696)
	at com.itextpdf.kernel.pdf.PdfDocument.flushFonts(PdfDocument.java:2319)
	at com.itextpdf.kernel.pdf.PdfDocument.close(PdfDocument.java:978)
	at com.itextpdf.layout.Document.close(Document.java:96)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:127)
	... 156 common frames omitted
2025-10-08 19:54:05.381 [http-nio-8080-exec-6] INFO  c.zaxxer.hikari.pool.ProxyLeakTask - Previously reported leaked connection org.postgresql.jdbc.PgConnection@755a90a6 on thread http-nio-8080-exec-6 was returned to the pool (unleaked)
2025-10-08 19:54:05.382 [http-nio-8080-exec-6] ERROR c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8e96ecbf, method=GET, uri=/api/v1/contracts/9/report, status=500, duration=200671ms
2025-10-08 19:54:22.807 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 19:54:22.813 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 20:00:26.151 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 26052 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 20:00:26.153 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 20:00:28.425 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 20:00:28.541 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@bddac1c
2025-10-08 20:00:28.590 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 20:00:28.607 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 20:00:28.613 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 20:00:28.688 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 20:00:28.689 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 20:00:29.020 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 20:00:30.020 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 20:00:30.021 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 20:00:30.040 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 20:00:30.040 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 20:00:30.041 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 20:00:30.041 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 20:00:30.041 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 20:00:30.041 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 20:00:30.041 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 20:00:30.080 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 20:00:30.168 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 20:00:30.169 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 20:00:30.829 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 20:00:30.859 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 20:00:30.861 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 20:00:30.865 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 20:00:30.866 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 20:00:30.867 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 20:00:30.899 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 20:00:31.075 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 20:00:31.078 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 20:00:31.078 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 20:00:31.078 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 20:00:31.325 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 20:00:31.333 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 20:00:31.335 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 20:00:31.335 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 20:00:31.336 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 20:00:31.344 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 20:00:31.344 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 20:00:31.367 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 20:00:31.369 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 20:00:31.369 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 20:00:31.369 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 20:00:31.369 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 20:00:31.369 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 20:00:31.369 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 20:00:31.382 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 20:00:31.396 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 20:00:31.397 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 20:00:31.407 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 20:00:31.408 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 20:00:31.410 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 20:00:31.410 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 20:00:31.412 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 20:00:31.412 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 20:00:31.474 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 20:00:31.931 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 20:00:32.029 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 20:00:32.031 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 20:00:32.052 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 20:00:32.172 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 20:00:32.384 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-08 20:00:32.689 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-08 20:00:32.836 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 20:00:32.921 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 20:00:33.701 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.941 seconds (process running for 8.235)
2025-10-08 20:00:33.707 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 20:00:33.709 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 20:00:33.799 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 20:00:50.173 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:00:50.177 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:00:50.202 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 20:00:50.208 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 9
2025-10-08 20:00:50.209 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 20:00:50.235 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=cf4f2f67, method=POST, uri=/api/v1/contracts/upload, status=202, duration=114ms
2025-10-08 20:00:50.248 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:00:50.255 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 20:00:50.262 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 20:00:50.265 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 20:00:50.270 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 20:00:50.271 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 20:00:50.274 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 20:00:50.275 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=9
2025-10-08 20:00:50.278 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c98c4760, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=19ms
2025-10-08 20:00:50.326 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=9
2025-10-08 20:00:50.761 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 20:00:50.762 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-08 20:00:50.762 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=9, 文本长度: 7321
2025-10-08 20:00:50.762 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 20:00:50.765 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 20:00:58.004 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 20:00:58.005 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 9, 块数: 405
2025-10-08 20:00:58.005 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 9
2025-10-08 20:00:58.006 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 9
2025-10-08 20:01:38.603 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 9
2025-10-08 20:01:38.644 [http-nio-8080-exec-6] WARN  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ab6204db, method=GET, uri=/api/v1/contracts/9/report, status=400, duration=43ms
2025-10-08 20:01:55.131 [http-nio-8080-exec-4] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f_农村土地经营权出租合同.docx
2025-10-08 20:01:55.131 [http-nio-8080-exec-4] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 农村土地经营权出租合同.docx
2025-10-08 20:01:55.135 [http-nio-8080-exec-4] WARN  c.r.L.service.ContractReviewService - 文件哈希 bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f 已存在，返回现有审查记录
2025-10-08 20:01:55.137 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 11
2025-10-08 20:01:55.137 [Async-3] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-3
2025-10-08 20:01:55.137 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e6441e16, method=POST, uri=/api/v1/contracts/upload, status=202, duration=23ms
2025-10-08 20:01:55.140 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 农村土地经营权出租合同.docx, 路径: F:\LegalAssistant\uploads\contracts\bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f_农村土地经营权出租合同.docx
2025-10-08 20:01:55.141 [Async-3] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 农村土地经营权出租合同.docx, 类型: docx, 大小: 30836 bytes
2025-10-08 20:01:55.162 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 11
2025-10-08 20:01:55.164 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 11
2025-10-08 20:01:55.165 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 11
2025-10-08 20:01:55.166 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=11
2025-10-08 20:01:55.166 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0d5d673c, method=GET, uri=/api/v1/contracts/11/analyze-async, status=200, duration=5ms
2025-10-08 20:01:55.170 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 3686
2025-10-08 20:01:55.172 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=11
2025-10-08 20:01:55.185 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=11
2025-10-08 20:01:55.295 [Async-3] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 农村土地经营权出租合同.docx, 内容长度: 3686 字符
2025-10-08 20:01:55.295 [Async-3] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 农村土地经营权出租合同.docx, 内容长度: 3686
2025-10-08 20:01:55.297 [Async-3] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=11, 文本长度: 3686
2025-10-08 20:01:55.297 [Async-3] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3686 字符
2025-10-08 20:01:55.300 [Async-3] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 20:02:01.436 [Async-3] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 20:02:01.436 [Async-3] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 11, 块数: 403
2025-10-08 20:02:01.437 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 11
2025-10-08 20:02:01.437 [Async-3] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 11
2025-10-08 20:02:24.271 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 20:02:24.274 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 20:02:32.345 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 36544 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 20:02:32.347 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 20:02:34.583 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 20:02:34.716 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1ab717f3
2025-10-08 20:02:34.759 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 20:02:34.782 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 20:02:34.789 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 20:02:34.867 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 20:02:34.868 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 20:02:35.216 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 20:02:36.188 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 20:02:36.188 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 20:02:36.209 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 20:02:36.210 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 20:02:36.210 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 20:02:36.210 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 20:02:36.210 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 20:02:36.210 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 20:02:36.211 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 20:02:36.247 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 20:02:36.335 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 20:02:36.335 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 20:02:37.005 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 20:02:37.031 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 20:02:37.033 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 20:02:37.036 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 20:02:37.037 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 20:02:37.038 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 20:02:37.069 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 20:02:37.252 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 20:02:37.255 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 20:02:37.255 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 20:02:37.256 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 20:02:37.445 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 20:02:37.453 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 20:02:37.455 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 20:02:37.455 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 20:02:37.456 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 20:02:37.462 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 20:02:37.463 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 20:02:37.487 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 20:02:37.488 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 20:02:37.488 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 20:02:37.488 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 20:02:37.488 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 20:02:37.488 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 20:02:37.488 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 20:02:37.501 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 20:02:37.519 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 20:02:37.520 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 20:02:37.530 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 20:02:37.531 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 20:02:37.533 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 20:02:37.533 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 20:02:37.534 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 20:02:37.534 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 20:02:37.580 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 20:02:37.985 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 20:02:38.095 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 20:02:38.096 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 20:02:38.116 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 20:02:38.235 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 20:02:38.450 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-08 20:02:38.760 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-08 20:02:38.919 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 20:02:39.007 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 20:02:39.829 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.001 seconds (process running for 8.273)
2025-10-08 20:02:39.834 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 20:02:39.835 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 20:02:39.920 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 20:03:05.340 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0ef4ad0f8392f4e8c55fd9f4b95d9bb83837cb1161ecf2aa87a8d2f1ec2b3014_上海市养老服务合同.doc
2025-10-08 20:03:05.345 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 上海市养老服务合同.doc
2025-10-08 20:03:05.395 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 12, 文件: 上海市养老服务合同.doc
2025-10-08 20:03:05.414 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 12
2025-10-08 20:03:05.414 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 20:03:05.434 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 上海市养老服务合同.doc, 路径: F:\LegalAssistant\uploads\contracts\0ef4ad0f8392f4e8c55fd9f4b95d9bb83837cb1161ecf2aa87a8d2f1ec2b3014_上海市养老服务合同.doc
2025-10-08 20:03:05.435 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 上海市养老服务合同.doc, 类型: doc, 大小: 77312 bytes
2025-10-08 20:03:05.442 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=dadd6077, method=POST, uri=/api/v1/contracts/upload, status=202, duration=170ms
2025-10-08 20:03:05.469 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 12
2025-10-08 20:03:05.472 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 12
2025-10-08 20:03:05.477 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 12
2025-10-08 20:03:05.478 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=12
2025-10-08 20:03:05.480 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:03:05.494 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9ccc5611, method=GET, uri=/api/v1/contracts/12/analyze-async, status=200, duration=29ms
2025-10-08 20:03:05.501 [Async-2] WARN  c.r.L.service.ContractReviewService - 合同文本内容为空，可能文件还在解析中: reviewId=12
2025-10-08 20:03:05.661 [Async-1] WARN  o.apache.poi.hwpf.model.PAPBinTable - Paragraph [6291; 6292) has no PAPX. Creating new one.
2025-10-08 20:03:05.662 [Async-1] WARN  o.apache.poi.hwpf.model.PAPBinTable - Paragraph [6615; 6616) has no PAPX. Creating new one.
2025-10-08 20:03:05.692 [Async-1] WARN  o.apache.poi.hwpf.model.SectionTable - Your document seemed to be mostly unicode, but the section definition was in bytes! Trying anyway, but things may well go wrong!
2025-10-08 20:03:05.762 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 上海市养老服务合同.doc, 内容长度: 6200 字符
2025-10-08 20:03:05.762 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 上海市养老服务合同.doc, 内容长度: 6200
2025-10-08 20:03:05.763 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=12, 文本长度: 6200
2025-10-08 20:03:05.763 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 6200 字符
2025-10-08 20:03:05.768 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 404 个文本块
2025-10-08 20:03:06.507 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=12
2025-10-08 20:03:06.509 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:03:07.522 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=12
2025-10-08 20:03:07.524 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:03:08.536 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=12
2025-10-08 20:03:08.538 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:03:09.552 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=12
2025-10-08 20:03:09.554 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:03:10.562 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=12
2025-10-08 20:03:10.563 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:03:11.566 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=12
2025-10-08 20:03:11.567 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:03:12.578 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=12
2025-10-08 20:03:12.580 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:03:13.583 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=12
2025-10-08 20:03:13.584 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:03:13.591 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，404 个向量块已存储
2025-10-08 20:03:13.591 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 12, 块数: 404
2025-10-08 20:03:13.592 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 12
2025-10-08 20:03:13.593 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 12
2025-10-08 20:03:14.601 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=12
2025-10-08 20:03:14.605 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 6200
2025-10-08 20:03:14.606 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 9秒, reviewId=12
2025-10-08 20:03:14.606 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，开始分析: reviewId=12, 文本长度: 6200
2025-10-08 20:03:14.613 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 6200
2025-10-08 20:04:24.613 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 20:04:24.654 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 20:04:24.662 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=12
2025-10-08 20:04:25.701 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 12
2025-10-08 20:04:25.701 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 12
2025-10-08 20:04:25.702 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 12
2025-10-08 20:04:25.702 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f07c6f5d, method=GET, uri=/api/v1/contracts/12/analyze-async, status=200, duration=2ms
2025-10-08 20:04:25.703 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=12
2025-10-08 20:04:25.705 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 6200
2025-10-08 20:04:25.705 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=12
2025-10-08 20:04:25.714 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=12
2025-10-08 20:04:46.643 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 12
2025-10-08 20:04:46.664 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 12
2025-10-08 20:04:46.664 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-08 20:04:46.853 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载中文字体：STSong-Light (UniGB-UCS2-H编码)
2025-10-08 20:04:46.947 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-08 20:04:46.974 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-08 20:04:46.982 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 12
2025-10-08 20:04:51.615 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始使用专用提示词生成PDF报告内容...
2025-10-08 20:04:51.617 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 6200, 问题: /*
 * PDF合同审查报告生成专用提示词模板
 * ..., 会话ID: default
2025-10-08 20:04:51.617 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 6200, 会话: default
2025-10-08 20:04:58.882 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 中华人民共和国民法典, 条文: 497
2025-10-08 20:04:58.883 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 中华人民共和国民法典 497 条文 内容, 最大结果数: 2
2025-10-08 20:04:59.027 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-08 20:04:59.028 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-08 20:04:59.028 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 中华人民共和国老年人权益保障法, 条文: 1
2025-10-08 20:04:59.029 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 中华人民共和国老年人权益保障法 1 条文 内容, 最大结果数: 2
2025-10-08 20:04:59.088 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-08 20:04:59.088 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-08 20:04:59.089 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 养老服务合同风险
2025-10-08 20:04:59.089 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 养老服务合同风险 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-08 20:04:59.122 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-08 20:04:59.123 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 养老服务合同风险
2025-10-08 20:04:59.123 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 养老服务合同 法律责任 风险防范
2025-10-08 20:04:59.123 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 养老服务合同 法律责任 风险防范, 最大结果数: 5
2025-10-08 20:04:59.152 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-08 20:04:59.240 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 1 个结果
2025-10-08 20:04:59.240 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 5 个相似文档
2025-10-08 20:04:59.240 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 5 个结果
2025-10-08 20:06:08.965 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-08 20:06:08.965 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 6200, 问题: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了..., 会话ID: default
2025-10-08 20:06:08.965 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 6200, 会话: default
2025-10-08 20:06:24.766 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-08 20:06:24.768 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 6200, 问题: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合..., 会话ID: default
2025-10-08 20:06:24.768 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 6200, 会话: default
2025-10-08 20:07:25.913 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-08 20:07:25.914 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 6200, 问题: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违..., 会话ID: default
2025-10-08 20:07:25.914 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 6200, 会话: default
2025-10-08 20:07:46.659 [HikariPool-1 housekeeper] WARN  c.zaxxer.hikari.pool.ProxyLeakTask - Connection leak detection triggered for org.postgresql.jdbc.PgConnection@1ab717f3 on thread http-nio-8080-exec-6, stack trace follows
java.lang.Exception: Apparent connection leak detected
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:127)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:46)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:126)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:156)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:405)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:604)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:373)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.ContractReviewService$$SpringCGLIB$$1.getReviewForReportGeneration(<generated>)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:561)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-08 20:08:00.622 [http-nio-8080-exec-6] WARN  dev.langchain4j.internal.RetryUtils - A retriable exception occurred. Remaining retries: 2 of 2
java.lang.RuntimeException: java.lang.InterruptedException
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:60)
	at dev.langchain4j.http.client.log.LoggingHttpClient.execute(LoggingHttpClient.java:48)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.guardrail.SynchronousChatExecutor.execute(SynchronousChatExecutor.java:32)
	at dev.langchain4j.guardrail.AbstractChatExecutor.execute(AbstractChatExecutor.java:45)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:372)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy209.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:568)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.generateEnhancedContent(ReportGenerationService.java:302)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:89)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:584)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.InterruptedException: null
	at java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:386)
	at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2073)
	at java.net.http/jdk.internal.net.http.HttpClientImpl.send(HttpClientImpl.java:931)
	at java.net.http/jdk.internal.net.http.HttpClientFacade.send(HttpClientFacade.java:133)
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:50)
	... 188 common frames omitted
2025-10-08 20:23:43.575 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 3628 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 20:23:43.576 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 20:23:46.088 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 20:23:46.242 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@4379fe2a
2025-10-08 20:23:46.302 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 20:23:46.321 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 20:23:46.326 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 20:23:46.410 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 20:23:46.413 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 20:23:46.841 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 20:23:48.000 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 20:23:48.002 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 20:23:48.023 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 20:23:48.023 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 20:23:48.023 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 20:23:48.023 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 20:23:48.025 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 20:23:48.025 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 20:23:48.025 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 20:23:48.066 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 20:23:48.204 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 20:23:48.204 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 20:23:48.916 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 20:23:48.953 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 20:23:48.954 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 20:23:48.957 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 20:23:48.958 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 20:23:48.958 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 20:23:48.989 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 20:23:49.152 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 20:23:49.155 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 20:23:49.155 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 20:23:49.156 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 20:23:49.352 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 20:23:49.361 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 20:23:49.363 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 20:23:49.363 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 20:23:49.363 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 20:23:49.369 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 20:23:49.369 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 20:23:49.393 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 20:23:49.393 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 20:23:49.393 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 20:23:49.393 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 20:23:49.393 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 20:23:49.393 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 20:23:49.393 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 20:23:49.406 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 20:23:49.421 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 20:23:49.421 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 20:23:49.432 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 20:23:49.432 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 20:23:49.435 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 20:23:49.435 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 20:23:49.436 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 20:23:49.437 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 20:23:49.492 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 20:23:50.039 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 20:23:50.139 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 20:23:50.141 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 20:23:50.170 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 20:23:50.297 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 20:23:50.592 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-08 20:23:50.976 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-08 20:23:51.196 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 20:23:51.296 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 20:23:52.106 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.99 seconds (process running for 9.301)
2025-10-08 20:23:52.113 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 20:23:52.114 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 20:23:52.222 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 20:24:24.667 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:24:24.673 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:24:24.701 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 20:24:24.709 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 9
2025-10-08 20:24:24.709 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 20:24:24.729 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d0b105ed, method=POST, uri=/api/v1/contracts/upload, status=202, duration=123ms
2025-10-08 20:24:24.735 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:24:24.735 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 20:24:24.756 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 20:24:24.760 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 20:24:24.766 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 20:24:24.767 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 20:24:24.770 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 20:24:24.776 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7ddb068d, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=22ms
2025-10-08 20:24:24.823 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-08 20:24:25.303 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 20:24:25.303 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-08 20:24:25.304 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=9, 文本长度: 7321
2025-10-08 20:24:25.304 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 20:24:25.306 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 20:24:32.766 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 20:24:32.767 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 9, 块数: 405
2025-10-08 20:24:32.767 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 9
2025-10-08 20:24:32.767 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 9
2025-10-08 20:25:44.878 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 20:25:44.956 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 20:25:44.966 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=9
2025-10-08 20:25:45.996 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 9
2025-10-08 20:25:45.997 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 9
2025-10-08 20:25:45.998 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 9
2025-10-08 20:25:45.998 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3a5f6a74, method=GET, uri=/api/v1/contracts/9/analyze-async, status=200, duration=2ms
2025-10-08 20:25:45.999 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=9
2025-10-08 20:25:46.000 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 20:25:46.001 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=9
2025-10-08 20:25:46.018 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=9
2025-10-08 20:27:09.589 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 20:27:09.592 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 20:33:02.465 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 24244 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 20:33:02.468 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 20:33:05.069 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 20:33:05.233 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@d3b0397
2025-10-08 20:33:05.294 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 20:33:05.313 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 20:33:05.319 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 20:33:05.409 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 20:33:05.412 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 20:33:05.881 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 20:33:07.044 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 20:33:07.047 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 20:33:07.065 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 20:33:07.066 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 20:33:07.066 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 20:33:07.066 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 20:33:07.066 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 20:33:07.066 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 20:33:07.066 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 20:33:07.100 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 20:33:07.236 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 20:33:07.236 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 20:33:08.203 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 20:33:08.235 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 20:33:08.238 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 20:33:08.242 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 20:33:08.243 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 20:33:08.244 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 20:33:08.288 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 20:33:08.481 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 20:33:08.485 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 20:33:08.486 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 20:33:08.487 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 20:33:08.704 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 20:33:08.711 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 20:33:08.713 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 20:33:08.713 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 20:33:08.713 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 20:33:08.723 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 20:33:08.723 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 20:33:08.749 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 20:33:08.749 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 20:33:08.750 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 20:33:08.750 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 20:33:08.750 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 20:33:08.750 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 20:33:08.750 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 20:33:08.761 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 20:33:08.777 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 20:33:08.778 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 20:33:08.789 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 20:33:08.790 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 20:33:08.792 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 20:33:08.792 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 20:33:08.793 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 20:33:08.794 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 20:33:08.859 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 20:33:09.341 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 20:33:09.441 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 20:33:09.443 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 20:33:09.467 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 20:33:09.590 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 20:33:09.871 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-08 20:33:10.235 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-08 20:33:10.453 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 20:33:10.595 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 20:33:11.469 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.478 seconds (process running for 9.78)
2025-10-08 20:33:11.476 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 20:33:11.477 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 20:33:11.581 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 20:33:16.295 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:33:16.300 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:33:16.352 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 13, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:33:16.360 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 13
2025-10-08 20:33:16.361 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 20:33:16.377 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:33:16.378 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 20:33:16.382 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7c3ba68f, method=POST, uri=/api/v1/contracts/upload, status=202, duration=143ms
2025-10-08 20:33:16.409 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 13
2025-10-08 20:33:16.411 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 13
2025-10-08 20:33:16.417 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 13
2025-10-08 20:33:16.418 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:33:16.421 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:33:16.433 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a1ffb8ea, method=GET, uri=/api/v1/contracts/13/analyze-async, status=200, duration=26ms
2025-10-08 20:33:16.439 [Async-2] WARN  c.r.L.service.ContractReviewService - 合同文本内容为空，可能文件还在解析中: reviewId=13
2025-10-08 20:33:16.899 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 20:33:16.900 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-08 20:33:16.900 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=13, 文本长度: 7321
2025-10-08 20:33:16.900 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 20:33:16.903 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 20:33:17.452 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:33:17.453 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:33:18.458 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:33:18.460 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:33:19.472 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:33:19.474 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:33:20.485 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:33:20.488 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:33:21.505 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:33:21.508 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:33:22.514 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:33:22.515 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:33:23.525 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:33:23.528 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:33:24.540 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 20:33:24.540 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 13, 块数: 405
2025-10-08 20:33:24.540 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 13
2025-10-08 20:33:24.541 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 13
2025-10-08 20:33:24.544 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:33:24.546 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:33:25.557 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:33:25.559 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 20:33:25.559 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 9秒, reviewId=13
2025-10-08 20:33:25.560 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，开始分析: reviewId=13, 文本长度: 7321
2025-10-08 20:33:25.573 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-08 20:34:38.550 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 20:34:38.597 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 20:34:38.613 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=13
2025-10-08 20:34:39.633 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 13
2025-10-08 20:34:39.634 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 13
2025-10-08 20:34:39.635 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 13
2025-10-08 20:34:39.635 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7cbda65a, method=GET, uri=/api/v1/contracts/13/analyze-async, status=200, duration=2ms
2025-10-08 20:34:39.636 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:34:39.638 [Async-3] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 20:34:39.639 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=13
2025-10-08 20:34:39.651 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=13
2025-10-08 20:35:35.895 [http-nio-8080-exec-6] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 20:35:35.896 [http-nio-8080-exec-6] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 20:35:35.901 [http-nio-8080-exec-6] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 14, 文件: 广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 20:35:35.903 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 14
2025-10-08 20:35:35.903 [Async-4] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-4
2025-10-08 20:35:35.904 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ca12731e, method=POST, uri=/api/v1/contracts/upload, status=202, duration=26ms
2025-10-08 20:35:35.906 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 广州市既有住宅加装电梯委托管理合同.docx, 路径: F:\LegalAssistant\uploads\contracts\454780187d36c4fce24a42ca24a270b4505e40a957c5e0093c3854211b8f36fd_广州市既有住宅加装电梯委托管理合同.docx
2025-10-08 20:35:35.906 [Async-4] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 广州市既有住宅加装电梯委托管理合同.docx, 类型: docx, 大小: 36076 bytes
2025-10-08 20:35:35.928 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 14
2025-10-08 20:35:35.929 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 14
2025-10-08 20:35:35.930 [Async-5] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 14
2025-10-08 20:35:35.931 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=14
2025-10-08 20:35:35.931 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=20a7ab34, method=GET, uri=/api/v1/contracts/14/analyze-async, status=200, duration=5ms
2025-10-08 20:35:35.933 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:35:35.940 [Async-5] WARN  c.r.L.service.ContractReviewService - 合同文本内容为空，可能文件还在解析中: reviewId=14
2025-10-08 20:35:36.037 [Async-4] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 广州市既有住宅加装电梯委托管理合同.docx, 内容长度: 3641 字符
2025-10-08 20:35:36.037 [Async-4] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 广州市既有住宅加装电梯委托管理合同.docx, 内容长度: 3641
2025-10-08 20:35:36.038 [Async-4] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=14, 文本长度: 3641
2025-10-08 20:35:36.038 [Async-4] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3641 字符
2025-10-08 20:35:36.040 [Async-4] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-08 20:35:36.955 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=14
2025-10-08 20:35:36.956 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:35:37.970 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=14
2025-10-08 20:35:37.972 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:35:38.984 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=14
2025-10-08 20:35:38.985 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:35:39.998 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=14
2025-10-08 20:35:39.999 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:35:41.011 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=14
2025-10-08 20:35:41.013 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:35:42.036 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=14
2025-10-08 20:35:42.069 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:35:43.086 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=14
2025-10-08 20:35:43.087 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-08 20:35:43.931 [Async-4] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-08 20:35:43.932 [Async-4] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 14, 块数: 403
2025-10-08 20:35:43.932 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 14
2025-10-08 20:35:43.932 [Async-4] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 14
2025-10-08 20:35:44.093 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=14
2025-10-08 20:35:44.096 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 3641
2025-10-08 20:35:44.096 [Async-5] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 8秒, reviewId=14
2025-10-08 20:35:44.097 [Async-5] INFO  c.r.L.service.ContractReviewService - 文件解析完成，开始分析: reviewId=14, 文本长度: 3641
2025-10-08 20:35:44.098 [Async-5] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 3641
2025-10-08 20:36:53.310 [Async-5] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 20:36:53.345 [Async-5] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 20:36:53.347 [http-nio-8080-exec-8] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=14
2025-10-08 20:36:54.372 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 14
2025-10-08 20:36:54.373 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 14
2025-10-08 20:36:54.373 [Async-6] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 14
2025-10-08 20:36:54.374 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f8d137ff, method=GET, uri=/api/v1/contracts/14/analyze-async, status=200, duration=3ms
2025-10-08 20:36:54.374 [Async-6] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=14
2025-10-08 20:36:54.376 [Async-6] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 3641
2025-10-08 20:36:54.377 [Async-6] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=14
2025-10-08 20:36:54.385 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=14
2025-10-08 20:39:54.320 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 20:39:54.324 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 20:40:03.366 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 3580 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 20:40:03.368 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 20:40:05.779 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 20:40:05.909 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@e0f2686
2025-10-08 20:40:05.953 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 20:40:05.973 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 20:40:05.979 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 20:40:06.066 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 20:40:06.068 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 20:40:06.429 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 20:40:07.538 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 20:40:07.539 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 20:40:07.562 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 20:40:07.562 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 20:40:07.562 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 20:40:07.562 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 20:40:07.562 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 20:40:07.563 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 20:40:07.563 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 20:40:07.600 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 20:40:07.696 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 20:40:07.697 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 20:40:08.450 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 20:40:08.504 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 20:40:08.507 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 20:40:08.511 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 20:40:08.513 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 20:40:08.513 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 20:40:08.548 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 20:40:08.731 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 20:40:08.733 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 20:40:08.733 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 20:40:08.734 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 20:40:08.926 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 20:40:08.935 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 20:40:08.937 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 20:40:08.938 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 20:40:08.938 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 20:40:08.944 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 20:40:08.944 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 20:40:08.971 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 20:40:08.972 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 20:40:08.972 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 20:40:08.972 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 20:40:08.972 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 20:40:08.973 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 20:40:08.973 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 20:40:08.986 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 20:40:09.005 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 20:40:09.006 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 20:40:09.019 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 20:40:09.019 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 20:40:09.021 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 20:40:09.022 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 20:40:09.024 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 20:40:09.025 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 20:40:09.079 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 20:40:09.585 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 20:40:09.689 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 20:40:09.692 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 20:40:09.717 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 20:40:09.845 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 20:40:10.050 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-08 20:40:10.371 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-08 20:40:10.559 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 20:40:10.653 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 20:40:11.520 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.578 seconds (process running for 8.862)
2025-10-08 20:40:11.526 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 20:40:11.527 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 20:40:11.621 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 20:47:11.637 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 20:47:11.640 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-08 20:47:23.019 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 27128 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-08 20:47:23.021 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-08 20:47:25.592 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-08 20:47:25.723 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@52bcfd10
2025-10-08 20:47:25.769 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-08 20:47:25.789 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-08 20:47:25.794 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-08 20:47:25.931 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 10
2025-10-08 20:47:25.934 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-08 20:47:26.324 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-08 20:47:27.469 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-08 20:47:27.471 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-08 20:47:27.496 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-08 20:47:27.497 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-08 20:47:27.497 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-08 20:47:27.497 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-08 20:47:27.497 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-08 20:47:27.497 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-08 20:47:27.497 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-08 20:47:27.534 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-08 20:47:27.634 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-08 20:47:27.635 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-08 20:47:28.356 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-08 20:47:28.384 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-08 20:47:28.388 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-08 20:47:28.392 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-08 20:47:28.392 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-08 20:47:28.393 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-08 20:47:28.427 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-08 20:47:28.608 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-08 20:47:28.610 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-08 20:47:28.611 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-08 20:47:28.611 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-08 20:47:28.804 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-08 20:47:28.814 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-08 20:47:28.816 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-08 20:47:28.816 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-08 20:47:28.816 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-08 20:47:28.823 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-08 20:47:28.823 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-08 20:47:28.847 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-08 20:47:28.848 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-08 20:47:28.848 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-08 20:47:28.849 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-08 20:47:28.849 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-08 20:47:28.849 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-08 20:47:28.850 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-08 20:47:28.863 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-08 20:47:28.880 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-08 20:47:28.881 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-08 20:47:28.894 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-08 20:47:28.894 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-08 20:47:28.896 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-08 20:47:28.897 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-08 20:47:28.899 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-08 20:47:28.899 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-08 20:47:28.961 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-08 20:47:29.461 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-08 20:47:29.562 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-08 20:47:29.564 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-08 20:47:29.586 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-08 20:47:29.727 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-08 20:47:29.956 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置JSON消息转换器，禁用非ASCII字符转义
2025-10-08 20:47:30.294 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-08 20:47:30.487 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-08 20:47:30.581 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-08 20:47:31.503 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.892 seconds (process running for 9.174)
2025-10-08 20:47:31.509 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-08 20:47:31.510 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-08 20:47:31.617 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-08 20:47:41.084 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:47:41.091 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:47:41.131 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 20:47:41.141 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 13
2025-10-08 20:47:41.141 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-08 20:47:41.167 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e21c65b9, method=POST, uri=/api/v1/contracts/upload, status=202, duration=167ms
2025-10-08 20:47:41.172 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:47:41.173 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 20:47:41.196 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 13
2025-10-08 20:47:41.199 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 13
2025-10-08 20:47:41.208 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 13
2025-10-08 20:47:41.209 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:47:41.214 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 20:47:41.215 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=13
2025-10-08 20:47:41.218 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=42e8872d, method=GET, uri=/api/v1/contracts/13/analyze-async, status=200, duration=25ms
2025-10-08 20:47:41.273 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=13
2025-10-08 20:47:41.939 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 20:47:41.939 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-08 20:47:41.940 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=13, 文本长度: 7321
2025-10-08 20:47:41.941 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 20:47:41.948 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 20:47:50.671 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 20:47:50.672 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 13, 块数: 405
2025-10-08 20:47:50.672 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 13
2025-10-08 20:47:50.672 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 13
2025-10-08 20:47:52.578 [http-nio-8080-exec-4] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:47:52.578 [http-nio-8080-exec-4] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:47:52.583 [http-nio-8080-exec-4] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-08 20:47:52.585 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 13
2025-10-08 20:47:52.585 [Async-3] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-3
2025-10-08 20:47:52.586 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d424d28a, method=POST, uri=/api/v1/contracts/upload, status=202, duration=28ms
2025-10-08 20:47:52.587 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-08 20:47:52.588 [Async-3] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-08 20:47:52.610 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 13
2025-10-08 20:47:52.612 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 13
2025-10-08 20:47:52.614 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 13
2025-10-08 20:47:52.614 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5a1488ae, method=GET, uri=/api/v1/contracts/13/analyze-async, status=200, duration=5ms
2025-10-08 20:47:52.614 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:47:52.619 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 20:47:52.657 [Async-3] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-08 20:47:52.658 [Async-3] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-08 20:47:52.659 [Async-3] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=13, 文本长度: 7321
2025-10-08 20:47:52.659 [Async-3] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-08 20:47:52.661 [Async-3] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-08 20:47:52.662 [Async-4] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-08 20:47:59.773 [Async-3] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-08 20:47:59.774 [Async-3] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 13, 块数: 405
2025-10-08 20:47:59.774 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 13
2025-10-08 20:47:59.775 [Async-3] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 13
2025-10-08 20:49:05.430 [Async-4] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-08 20:49:05.484 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同异步分析完成，风险等级: MEDIUM
2025-10-08 20:49:05.487 [http-nio-8080-exec-6] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=13
2025-10-08 20:49:06.503 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 13
2025-10-08 20:49:06.504 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 13
2025-10-08 20:49:06.505 [Async-5] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同，审查ID: 13
2025-10-08 20:49:06.506 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=06278ab4, method=GET, uri=/api/v1/contracts/13/analyze-async, status=200, duration=3ms
2025-10-08 20:49:06.506 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=13
2025-10-08 20:49:06.508 [Async-5] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-08 20:49:06.509 [Async-5] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，返回现有结果: reviewId=13
2025-10-08 20:49:06.520 [http-nio-8080-exec-9] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=13
2025-10-08 20:49:17.419 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-08 20:49:17.423 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
