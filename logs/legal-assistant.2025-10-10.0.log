2025-10-10 14:34:35.396 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 37096 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 14:34:35.404 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 14:34:38.013 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 14:34:38.233 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3958db82
2025-10-10 14:34:38.313 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 14:34:38.334 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 14:34:38.340 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 14:34:38.432 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 14:34:38.435 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 14:34:38.886 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 14:34:40.405 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 14:34:40.457 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 14:34:40.458 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 14:34:40.478 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 14:34:40.479 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 14:34:40.479 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 14:34:40.479 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 14:34:40.479 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 14:34:40.479 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 14:34:40.479 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 14:34:40.507 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 14:34:40.654 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 14:34:40.654 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 14:34:41.135 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 14:34:41.163 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 14:34:41.164 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 14:34:41.168 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 14:34:41.169 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 14:34:41.169 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 14:34:41.197 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 14:34:41.341 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 14:34:41.343 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 14:34:41.344 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 14:34:41.344 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 14:34:41.538 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 14:34:41.545 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 14:34:41.548 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 14:34:41.548 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 14:34:41.548 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 14:34:41.555 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 14:34:41.555 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 14:34:41.583 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 14:34:41.583 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 14:34:41.583 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 14:34:41.583 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 14:34:41.584 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 14:34:41.584 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 14:34:41.584 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 14:34:41.595 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 14:34:41.603 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 14:34:41.615 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 14:34:41.615 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 14:34:41.624 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 14:34:41.625 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 14:34:41.628 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 14:34:41.628 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 14:34:41.629 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 14:34:41.630 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 14:34:41.681 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 14:34:42.800 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 14:34:42.899 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 14:34:42.901 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 14:34:42.925 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 14:34:42.928 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 14:34:43.067 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 14:34:43.278 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 14:34:43.558 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 14:34:43.700 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 14:34:43.797 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 14:34:44.618 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.614 seconds (process running for 9.891)
2025-10-10 14:34:44.624 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 14:34:44.625 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 14:34:44.737 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 开始自动索引...
2025-10-10 14:34:44.738 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始批量索引目录: uploads/law, 递归: false
2025-10-10 14:34:44.739 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 发现 6 个文档待索引
2025-10-10 14:34:44.739 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\刑法.pdf
2025-10-10 14:34:44.740 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\刑法.pdf
2025-10-10 14:34:44.740 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\劳动法.pdf
2025-10-10 14:34:44.741 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\劳动法.pdf
2025-10-10 14:34:44.742 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\宪法.pdf
2025-10-10 14:34:44.743 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\宪法.pdf
2025-10-10 14:34:44.743 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\民事诉讼法.pdf
2025-10-10 14:34:48.880 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档索引完成: F:\LegalAssistant\uploads\law\民事诉讼法.pdf, 片段数: 20, 耗时: 4137ms
2025-10-10 14:34:48.881 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\民法典.pdf
2025-10-10 14:34:48.882 [http-nio-8080-exec-1] INFO  c.r.L.c.AuthenticationController - 用户登录请求: river
2025-10-10 14:34:48.882 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\民法典.pdf
2025-10-10 14:34:48.882 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\环境保护法.pdf
2025-10-10 14:34:48.883 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\环境保护法.pdf
2025-10-10 14:34:48.883 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 批量索引完成: 总计 6 个文档, 成功 6 个, 生成 20 个片段, 耗时 4145ms
2025-10-10 14:34:48.883 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 自动索引完成 - 总文档: 6, 成功: 6, 总片段: 20, 耗时: 4145ms
2025-10-10 14:34:48.884 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 法律文档索引完成，AI聊天功能现在可以使用这些文档进行问答
2025-10-10 14:34:49.086 [http-nio-8080-exec-1] INFO  c.r.L.c.AuthenticationController - 用户 river 登录成功
2025-10-10 14:34:49.100 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=20ae334c, method=POST, uri=/api/v1/auth/login, status=200, duration=246ms
2025-10-10 14:34:49.434 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=31805f51, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=40ms
2025-10-10 14:34:53.388 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=224344cd, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=7ms
2025-10-10 14:34:57.958 [http-nio-8080-exec-4] INFO  c.r.L.service.ChatHistoryService - 获取用户 5 的所有会话
2025-10-10 14:34:57.975 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ca266168, method=GET, uri=/api/v1/chat/sessions, status=200, duration=18ms
2025-10-10 14:35:02.989 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=572c3213, method=GET, uri=/api/v1/users/5/stats, status=200, duration=76ms
2025-10-10 14:35:09.531 [http-nio-8080-exec-2] INFO  c.r.L.c.AuthenticationController - 用户登出
2025-10-10 14:35:09.533 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=14c0026f, method=POST, uri=/api/v1/auth/logout, status=200, duration=2ms
2025-10-10 14:35:14.324 [http-nio-8080-exec-7] INFO  c.r.L.c.AuthenticationController - 用户登录请求: admin
2025-10-10 14:35:14.399 [http-nio-8080-exec-7] INFO  c.r.L.c.AuthenticationController - 用户 admin 登录成功
2025-10-10 14:35:14.401 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c1051ad1, method=POST, uri=/api/v1/auth/login, status=200, duration=78ms
2025-10-10 14:35:14.475 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d7f8f6b0, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=11ms
2025-10-10 14:35:16.324 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=03ac1d4c, method=GET, uri=/api/v1/users, status=200, duration=7ms
2025-10-10 14:35:19.768 [http-nio-8080-exec-8] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-10 14:35:19.773 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a344bde9, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=23ms
2025-10-10 14:35:36.528 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8c0f42b0, method=GET, uri=/api/v1/users/1/stats, status=200, duration=19ms
2025-10-10 14:36:23.750 [http-nio-8080-exec-6] INFO  c.r.L.c.KnowledgeBaseController - 管理员删除单个文档: 23
2025-10-10 14:36:23.753 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 开始删除文档: 23
2025-10-10 14:36:23.755 [http-nio-8080-exec-6] WARN  c.r.L.service.KnowledgeBaseService - 删除文档块功能需要根据具体的VectorStore实现来完成: F:\LegalAssistant\uploads\law\民事诉讼法.pdf
2025-10-10 14:36:23.773 [http-nio-8080-exec-6] INFO  c.r.L.service.KnowledgeBaseService - 文档删除成功: 民事诉讼法.pdf (ID: 23)
2025-10-10 14:36:23.791 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=40916c22, method=DELETE, uri=/api/v1/knowledge-base/documents/23, status=200, duration=50ms
2025-10-10 14:36:23.898 [http-nio-8080-exec-3] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=8
2025-10-10 14:36:23.904 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=300e943b, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=44ms
2025-10-10 14:36:34.135 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=502c94b1, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=8ms
2025-10-10 14:36:45.478 [http-nio-8080-exec-5] INFO  c.r.L.service.ContractReviewService - 删除审查记录: 15
2025-10-10 14:36:45.521 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 用户 admin 删除了审查记录 15
2025-10-10 14:36:45.523 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bd47d471, method=DELETE, uri=/api/v1/contracts/15, status=200, duration=54ms
2025-10-10 14:36:51.471 [http-nio-8080-exec-2] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-10 14:36:51.483 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9a3eda7f, method=GET, uri=/api/v1/chat/sessions, status=200, duration=13ms
2025-10-10 14:36:53.610 [http-nio-8080-exec-7] INFO  c.r.L.service.ChatHistoryService - 用户 1 获取会话 session_1760018506076_0uolseobk 的消息
2025-10-10 14:36:53.619 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c24ca645, method=GET, uri=/api/v1/chat/sessions/session_1760018506076_0uolseobk, status=200, duration=10ms
2025-10-10 14:37:02.702 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=513cec3e, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=5ms
2025-10-10 14:42:39.946 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 14:42:39.949 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 14:42:55.109 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 35084 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 14:42:55.110 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 14:42:57.657 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 14:42:57.803 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1443539
2025-10-10 14:42:57.860 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 14:42:57.883 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 14:42:57.889 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 14:42:57.976 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 14:42:57.978 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 14:42:58.453 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 14:42:59.920 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 14:42:59.972 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 14:42:59.973 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 14:42:59.992 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 14:42:59.992 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 14:42:59.993 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 14:42:59.993 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 14:42:59.994 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 14:42:59.994 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 14:42:59.994 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 14:43:00.024 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 14:43:00.146 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 14:43:00.146 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 14:43:00.571 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 14:43:00.597 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 14:43:00.600 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 14:43:00.603 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 14:43:00.604 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 14:43:00.605 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 14:43:00.633 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 14:43:00.817 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 14:43:00.819 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 14:43:00.820 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 14:43:00.820 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 14:43:01.031 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 14:43:01.039 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 14:43:01.040 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 14:43:01.040 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 14:43:01.040 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 14:43:01.047 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 14:43:01.047 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 14:43:01.072 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 14:43:01.072 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 14:43:01.072 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 14:43:01.072 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 14:43:01.072 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 14:43:01.073 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 14:43:01.073 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 14:43:01.085 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 14:43:01.092 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 14:43:01.104 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 14:43:01.105 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 14:43:01.124 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 14:43:01.125 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 14:43:01.127 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 14:43:01.127 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 14:43:01.129 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 14:43:01.129 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 14:43:01.177 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 14:43:01.586 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 14:43:01.705 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 14:43:01.707 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 14:43:01.731 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 14:43:01.733 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 14:43:01.892 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 14:43:02.198 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 14:43:02.723 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 14:43:02.884 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 14:43:02.966 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 14:43:03.701 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.021 seconds (process running for 9.306)
2025-10-10 14:43:03.707 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 14:43:03.709 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 14:43:03.802 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 开始自动索引...
2025-10-10 14:43:03.803 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始批量索引目录: uploads/law, 递归: false
2025-10-10 14:43:03.804 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 发现 6 个文档待索引
2025-10-10 14:43:03.804 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\刑法.pdf
2025-10-10 14:43:03.806 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\刑法.pdf
2025-10-10 14:43:03.806 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\劳动法.pdf
2025-10-10 14:43:03.808 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\劳动法.pdf
2025-10-10 14:43:03.808 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\宪法.pdf
2025-10-10 14:43:03.809 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\宪法.pdf
2025-10-10 14:43:03.809 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\民事诉讼法.pdf
2025-10-10 14:43:06.660 [http-nio-8080-exec-1] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-10 14:43:06.738 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fe6cbc24, method=GET, uri=/api/v1/chat/sessions, status=200, duration=104ms
2025-10-10 14:43:07.255 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档索引完成: F:\LegalAssistant\uploads\law\民事诉讼法.pdf, 片段数: 20, 耗时: 3446ms
2025-10-10 14:43:07.256 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\民法典.pdf
2025-10-10 14:43:07.259 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\民法典.pdf
2025-10-10 14:43:07.259 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 开始索引文档: F:\LegalAssistant\uploads\law\环境保护法.pdf
2025-10-10 14:43:07.261 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 文档已存在于数据库中，跳过索引: F:\LegalAssistant\uploads\law\环境保护法.pdf
2025-10-10 14:43:07.261 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.s.DocumentIndexingService - 批量索引完成: 总计 6 个文档, 成功 6 个, 生成 20 个片段, 耗时 3458ms
2025-10-10 14:43:07.262 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 自动索引完成 - 总文档: 6, 成功: 6, 总片段: 20, 耗时: 3458ms
2025-10-10 14:43:07.262 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 法律文档索引完成，AI聊天功能现在可以使用这些文档进行问答
2025-10-10 14:43:17.345 [http-nio-8080-exec-2] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 14:43:17.346 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 14:43:17.367 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 16, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 14:43:17.377 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 16
2025-10-10 14:43:17.377 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-10 14:43:17.386 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e339a700, method=POST, uri=/api/v1/contracts/upload, status=202, duration=95ms
2025-10-10 14:43:17.394 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 14:43:17.395 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-10 14:43:17.417 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 16
2025-10-10 14:43:17.424 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 16
2025-10-10 14:43:17.432 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同（四步流程版），审查ID: 16
2025-10-10 14:43:17.433 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=16
2025-10-10 14:43:17.437 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 14:43:17.442 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=dd4e714e, method=GET, uri=/api/v1/contracts/16/analyze-async, status=200, duration=26ms
2025-10-10 14:43:18.045 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-10 14:43:18.045 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-10 14:43:18.046 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=16, 文本长度: 7321
2025-10-10 14:43:18.046 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-10 14:43:18.050 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-10 14:43:18.453 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=16
2025-10-10 14:43:18.455 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 14:43:19.471 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=16
2025-10-10 14:43:19.472 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 14:43:20.484 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=16
2025-10-10 14:43:20.485 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 14:43:21.495 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=16
2025-10-10 14:43:21.497 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 14:43:22.508 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=16
2025-10-10 14:43:22.510 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 14:43:23.523 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=16
2025-10-10 14:43:23.524 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 14:43:24.538 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=16
2025-10-10 14:43:24.539 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 14:43:25.555 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=16
2025-10-10 14:43:25.556 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 14:43:26.074 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-10 14:43:26.077 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 16, 块数: 405
2025-10-10 14:43:26.077 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 16
2025-10-10 14:43:26.077 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 16
2025-10-10 14:43:26.562 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=16
2025-10-10 14:43:26.564 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-10 14:43:26.564 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 9秒, reviewId=16
2025-10-10 14:43:26.566 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤1完成：文档解析成功, reviewId=16
2025-10-10 14:43:26.575 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-10 14:45:00.120 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-10 14:45:00.123 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤2完成：风险识别成功, reviewId=16
2025-10-10 14:45:00.125 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤3完成：条款分析成功, reviewId=16
2025-10-10 14:45:00.165 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤4完成：报告生成并保存成功, reviewId=16
2025-10-10 14:45:00.199 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析流程全部完成, reviewId=16
2025-10-10 14:45:00.212 [http-nio-8080-exec-4] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=16
2025-10-10 14:45:16.086 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 16
2025-10-10 14:45:16.105 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 16
2025-10-10 14:45:16.105 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 14:45:16.279 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载中文字体：STSong-Light (UniGB-UCS2-H编码)
2025-10-10 14:45:16.347 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 14:45:16.347 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 14:45:16.347 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 16
2025-10-10 14:45:22.204 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始使用专用提示词生成PDF报告内容...
2025-10-10 14:45:22.205 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: /*
 * PDF合同审查报告生成专用提示词模板
 * ..., 会话ID: default
2025-10-10 14:45:22.206 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-10 14:45:26.402 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 危险化学品销售合同
2025-10-10 14:45:26.402 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 14:45:26.639 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 14:45:26.639 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 危险化学品销售合同
2025-10-10 14:45:29.762 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 危险化学品销售 合同 法律风险 防范措施
2025-10-10 14:45:29.762 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售 合同 法律风险 防范措施, 最大结果数: 10
2025-10-10 14:45:29.833 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 14:45:29.911 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 6 个结果
2025-10-10 14:45:29.912 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 10 个相似文档
2025-10-10 14:45:29.912 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 10 个结果
2025-10-10 14:45:33.039 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 危险化学品安全管理条例, 条文: 第三十八条
2025-10-10 14:45:33.040 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品安全管理条例 第三十八条 条文 内容, 最大结果数: 2
2025-10-10 14:45:33.105 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-10 14:45:33.106 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-10 14:45:35.691 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 民法典, 条文: 第五百九十五条
2025-10-10 14:45:35.691 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 民法典 第五百九十五条 条文 内容, 最大结果数: 2
2025-10-10 14:45:35.767 [http-nio-8080-exec-6] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-10 14:45:35.767 [http-nio-8080-exec-6] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-10 14:46:44.765 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 14:46:44.766 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了..., 会话ID: default
2025-10-10 14:46:44.766 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-10 14:47:05.304 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 14:47:05.305 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合..., 会话ID: default
2025-10-10 14:47:05.305 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-10 14:48:08.843 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 14:48:08.844 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违..., 会话ID: default
2025-10-10 14:48:08.844 [http-nio-8080-exec-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-10 14:48:16.090 [HikariPool-1 housekeeper] WARN  c.zaxxer.hikari.pool.ProxyLeakTask - Connection leak detection triggered for org.postgresql.jdbc.PgConnection@1443539 on thread http-nio-8080-exec-6, stack trace follows
java.lang.Exception: Apparent connection leak detected
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:127)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:46)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:126)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:156)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:532)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:405)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:604)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:373)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.ContractReviewService$$SpringCGLIB$$1.getReviewForReportGeneration(<generated>)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:616)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-10 14:48:30.400 [http-nio-8080-exec-6] WARN  dev.langchain4j.internal.RetryUtils - A retriable exception occurred. Remaining retries: 2 of 2
java.lang.RuntimeException: java.lang.InterruptedException
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:60)
	at dev.langchain4j.http.client.log.LoggingHttpClient.execute(LoggingHttpClient.java:48)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.guardrail.SynchronousChatExecutor.execute(SynchronousChatExecutor.java:32)
	at dev.langchain4j.guardrail.AbstractChatExecutor.execute(AbstractChatExecutor.java:45)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:372)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:568)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.generateEnhancedContent(ReportGenerationService.java:302)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:89)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:639)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.InterruptedException: null
	at java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:386)
	at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2073)
	at java.net.http/jdk.internal.net.http.HttpClientImpl.send(HttpClientImpl.java:931)
	at java.net.http/jdk.internal.net.http.HttpClientFacade.send(HttpClientFacade.java:133)
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:50)
	... 192 common frames omitted
2025-10-10 15:08:58.390 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 38236 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 15:08:58.396 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 15:09:00.845 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 15:09:00.996 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@2fca9fae
2025-10-10 15:09:01.054 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 15:09:01.072 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 15:09:01.078 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 15:09:01.154 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 15:09:01.157 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 15:09:01.572 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 15:09:03.037 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 15:09:03.093 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 15:09:03.094 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 15:09:03.114 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 15:09:03.115 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 15:09:03.115 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 15:09:03.115 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 15:09:03.115 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 15:09:03.115 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 15:09:03.115 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 15:09:03.141 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 15:09:03.270 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 15:09:03.271 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 15:09:03.710 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 15:09:03.743 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 15:09:03.744 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 15:09:03.747 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 15:09:03.748 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 15:09:03.749 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 15:09:03.780 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 15:09:03.941 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 15:09:03.943 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 15:09:03.943 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 15:09:03.943 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 15:09:04.123 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 15:09:04.131 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 15:09:04.133 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 15:09:04.134 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 15:09:04.134 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 15:09:04.142 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 15:09:04.142 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 15:09:04.169 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 15:09:04.169 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 15:09:04.169 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 15:09:04.169 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 15:09:04.170 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 15:09:04.170 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 15:09:04.170 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 15:09:04.181 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 15:09:04.189 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 15:09:04.201 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 15:09:04.201 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 15:09:04.210 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 15:09:04.210 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 15:09:04.212 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 15:09:04.213 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 15:09:04.214 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 15:09:04.214 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 15:09:04.273 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 15:09:04.713 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 15:09:04.813 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 15:09:04.815 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 15:09:04.841 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 15:09:04.842 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 15:09:04.960 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 15:09:05.179 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 15:09:05.463 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 15:09:05.614 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 15:09:05.704 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 15:09:06.476 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.471 seconds (process running for 8.742)
2025-10-10 15:09:06.481 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 15:09:06.482 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 15:09:06.569 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 15:16:18.185 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:16:18.191 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:16:18.231 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-10 15:16:18.240 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 16
2025-10-10 15:16:18.241 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-10 15:16:18.265 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7d139283, method=POST, uri=/api/v1/contracts/upload, status=202, duration=156ms
2025-10-10 15:16:18.272 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:16:18.272 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-10 15:16:18.295 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 16
2025-10-10 15:16:18.298 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 16
2025-10-10 15:16:18.306 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同（四步流程版），审查ID: 16
2025-10-10 15:16:18.307 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=16
2025-10-10 15:16:18.312 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-10 15:16:18.313 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，直接返回结果: reviewId=16
2025-10-10 15:16:18.316 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8bca74e6, method=GET, uri=/api/v1/contracts/16/analyze-async, status=200, duration=25ms
2025-10-10 15:16:18.373 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=16
2025-10-10 15:16:18.988 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-10 15:16:18.988 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-10 15:16:18.989 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=16, 文本长度: 7321
2025-10-10 15:16:18.989 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-10 15:16:18.994 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-10 15:16:27.190 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-10 15:16:27.191 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 16, 块数: 405
2025-10-10 15:16:27.192 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 16
2025-10-10 15:16:27.192 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 16
2025-10-10 15:16:29.489 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 16
2025-10-10 15:16:29.509 [http-nio-8080-exec-8] WARN  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c7b1f093, method=GET, uri=/api/v1/contracts/16/report, status=400, duration=26ms
2025-10-10 15:23:38.240 [http-nio-8080-exec-9] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:23:38.241 [http-nio-8080-exec-9] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:23:38.245 [http-nio-8080-exec-9] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-10 15:23:38.247 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 16
2025-10-10 15:23:38.248 [Async-3] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-3
2025-10-10 15:23:38.249 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c47cf4f3, method=POST, uri=/api/v1/contracts/upload, status=202, duration=29ms
2025-10-10 15:23:38.252 [Async-3] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:23:38.252 [Async-3] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-10 15:23:38.270 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 16
2025-10-10 15:23:38.272 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 16
2025-10-10 15:23:38.274 [Async-4] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同（四步流程版），审查ID: 16
2025-10-10 15:23:38.275 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=662f1f86, method=GET, uri=/api/v1/contracts/16/analyze-async, status=200, duration=6ms
2025-10-10 15:23:38.276 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=16
2025-10-10 15:23:38.279 [Async-4] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-10 15:23:38.305 [Async-4] INFO  c.r.L.service.ContractReviewService - 步骤1完成：文档解析成功, reviewId=16
2025-10-10 15:23:38.321 [Async-4] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-10 15:23:38.340 [Async-3] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-10 15:23:38.340 [Async-3] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-10 15:23:38.341 [Async-3] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=16, 文本长度: 7321
2025-10-10 15:23:38.342 [Async-3] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-10 15:23:38.344 [Async-3] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-10 15:23:45.566 [Async-3] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-10 15:23:45.567 [Async-3] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 16, 块数: 405
2025-10-10 15:23:45.567 [Async-3] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 16
2025-10-10 15:23:45.567 [Async-3] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 16
2025-10-10 15:25:07.609 [Async-4] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-10 15:25:07.613 [Async-4] INFO  c.r.L.service.ContractReviewService - 步骤2完成：风险识别成功, reviewId=16
2025-10-10 15:25:07.616 [Async-4] INFO  c.r.L.service.ContractReviewService - 步骤3完成：条款分析成功, reviewId=16
2025-10-10 15:25:07.687 [Async-4] INFO  c.r.L.service.ContractReviewService - 步骤4完成：报告生成并保存成功, reviewId=16
2025-10-10 15:25:07.703 [Async-4] INFO  c.r.L.service.ContractReviewService - 合同异步分析流程全部完成, reviewId=16
2025-10-10 15:25:07.708 [http-nio-8080-exec-7] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=16
2025-10-10 15:33:50.120 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 15:33:50.122 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 15:34:23.497 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 3824 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 15:34:23.498 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 15:34:26.105 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 15:34:26.258 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3c717ef2
2025-10-10 15:34:26.323 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 15:34:26.344 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 15:34:26.350 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 15:34:26.435 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 15:34:26.438 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 15:34:26.909 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 15:34:28.588 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 15:34:28.645 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 15:34:28.646 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 15:34:28.666 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 15:34:28.667 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 15:34:28.667 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 15:34:28.667 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 15:34:28.667 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 15:34:28.667 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 15:34:28.667 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 15:34:28.699 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 15:34:28.836 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 15:34:28.837 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 15:34:29.336 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 15:34:29.366 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 15:34:29.368 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 15:34:29.372 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 15:34:29.373 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 15:34:29.373 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 15:34:29.407 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 15:34:29.593 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 15:34:29.595 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 15:34:29.595 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 15:34:29.595 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 15:34:29.788 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 15:34:29.796 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 15:34:29.798 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 15:34:29.798 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 15:34:29.798 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 15:34:29.806 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 15:34:29.806 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 15:34:29.831 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 15:34:29.831 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 15:34:29.831 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 15:34:29.831 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 15:34:29.831 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 15:34:29.832 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 15:34:29.832 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 15:34:29.843 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 15:34:29.851 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 15:34:29.863 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 15:34:29.865 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 15:34:29.875 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 15:34:29.875 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 15:34:29.877 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 15:34:29.877 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 15:34:29.879 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 15:34:29.879 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 15:34:29.930 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 15:34:30.387 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 15:34:30.511 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 15:34:30.514 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 15:34:30.554 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 15:34:30.556 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 15:34:30.713 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 15:34:30.963 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 15:34:31.333 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 15:34:31.510 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 15:34:31.609 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 15:34:32.498 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.473 seconds (process running for 9.8)
2025-10-10 15:34:32.505 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 15:34:32.507 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 15:34:32.608 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 15:34:42.574 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:34:42.578 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:34:42.614 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 17, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:34:42.630 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 17
2025-10-10 15:34:42.630 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-10 15:34:42.646 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:34:42.646 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-10 15:34:42.650 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c459acc8, method=POST, uri=/api/v1/contracts/upload, status=202, duration=131ms
2025-10-10 15:34:42.670 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 17
2025-10-10 15:34:42.672 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 17
2025-10-10 15:34:42.681 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同（四步流程版），审查ID: 17
2025-10-10 15:34:42.681 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=17
2025-10-10 15:34:42.684 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:34:42.688 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6599a5ab, method=GET, uri=/api/v1/contracts/17/analyze-async, status=200, duration=20ms
2025-10-10 15:34:43.111 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-10 15:34:43.111 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-10 15:34:43.112 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=17, 文本长度: 7321
2025-10-10 15:34:43.112 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-10 15:34:43.116 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-10 15:34:43.712 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=17
2025-10-10 15:34:43.715 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:34:44.717 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=17
2025-10-10 15:34:44.719 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:34:45.735 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=17
2025-10-10 15:34:45.736 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:34:46.744 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=17
2025-10-10 15:34:46.746 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:34:47.753 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=17
2025-10-10 15:34:47.755 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:34:48.766 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=17
2025-10-10 15:34:48.768 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:34:49.779 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=17
2025-10-10 15:34:49.781 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:34:50.668 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-10 15:34:50.669 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 17, 块数: 405
2025-10-10 15:34:50.669 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 17
2025-10-10 15:34:50.669 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 17
2025-10-10 15:34:50.783 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=17
2025-10-10 15:34:50.785 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-10 15:34:50.786 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 8秒, reviewId=17
2025-10-10 15:34:50.787 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤1完成：文档解析成功, reviewId=17
2025-10-10 15:34:50.794 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-10 15:36:18.170 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-10 15:36:18.175 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤2完成：风险识别成功, reviewId=17
2025-10-10 15:36:18.176 [Async-2] INFO  c.r.L.service.AgentService - 开始分析合同关键条款，内容长度: 7321
2025-10-10 15:36:29.650 [Async-2] INFO  c.r.L.service.AgentService - 关键条款分析完成，响应长度: 375
2025-10-10 15:36:29.651 [Async-2] ERROR c.r.L.service.ContractReviewService - 关键条款分析失败，使用风险条款作为后备数据
com.fasterxml.jackson.core.JsonParseException: Unrecognized token '我理解您需要对合同进行全面的条款分析': was expecting (JSON String, Number, Array, Object or token 'null', 'true' or 'false')
 at [Source: REDACTED (`StreamReadFeature.INCLUDE_SOURCE_IN_LOCATION` disabled); line: 1, column: 19]
	at com.fasterxml.jackson.core.JsonParser._constructError(JsonParser.java:2572)
	at com.fasterxml.jackson.core.JsonParser._constructReadException(JsonParser.java:2598)
	at com.fasterxml.jackson.core.JsonParser._constructReadException(JsonParser.java:2606)
	at com.fasterxml.jackson.core.base.ParserMinimalBase._reportError(ParserMinimalBase.java:765)
	at com.fasterxml.jackson.core.json.ReaderBasedJsonParser._reportInvalidToken(ReaderBasedJsonParser.java:3018)
	at com.fasterxml.jackson.core.json.ReaderBasedJsonParser._handleOddValue(ReaderBasedJsonParser.java:2052)
	at com.fasterxml.jackson.core.json.ReaderBasedJsonParser.nextToken(ReaderBasedJsonParser.java:780)
	at com.fasterxml.jackson.databind.ObjectMapper._readTreeAndClose(ObjectMapper.java:4934)
	at com.fasterxml.jackson.databind.ObjectMapper.readTree(ObjectMapper.java:3280)
	at com.river.LegalAssistant.service.ContractReviewService.analyzeContractAsync(ContractReviewService.java:416)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:113)
	at org.springframework.util.concurrent.FutureUtils.lambda$toSupplier$0(FutureUtils.java:74)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at org.springframework.security.concurrent.DelegatingSecurityContextRunnable.run(DelegatingSecurityContextRunnable.java:94)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-10 15:36:29.655 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤3完成：条款分析成功, reviewId=17
2025-10-10 15:36:29.686 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤4完成：报告生成并保存成功, reviewId=17
2025-10-10 15:36:29.715 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析流程全部完成, reviewId=17
2025-10-10 15:36:29.729 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=17
2025-10-10 15:36:55.760 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 17
2025-10-10 15:36:55.779 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 17
2025-10-10 15:36:55.779 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 15:36:55.954 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载中文字体：STSong-Light (UniGB-UCS2-H编码)
2025-10-10 15:36:56.013 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 15:36:56.014 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 15:36:56.014 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 17
2025-10-10 15:36:56.014 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 17
2025-10-10 15:37:00.688 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始使用专用提示词生成PDF报告内容...
2025-10-10 15:37:00.690 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了..., 会话ID: default
2025-10-10 15:37:00.690 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: /*
 * PDF合同审查报告生成专用提示词模板
 * ..., 会话ID: default
2025-10-10 15:37:00.690 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合..., 会话ID: default
2025-10-10 15:37:00.690 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-10 15:37:00.690 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违..., 会话ID: default
2025-10-10 15:37:00.691 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-10 15:37:00.691 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-10 15:37:00.691 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-10 15:37:04.775 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 危险化学品销售合同
2025-10-10 15:37:04.776 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 15:37:04.869 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 15:37:04.870 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 危险化学品销售合同
2025-10-10 15:37:05.309 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 危险化学品销售合同
2025-10-10 15:37:05.310 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 15:37:05.349 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 15:37:05.349 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 危险化学品销售合同
2025-10-10 15:37:07.967 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 危险化学品销售资质许可证安全管理条例
2025-10-10 15:37:07.967 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售资质许可证安全管理条例, 最大结果数: 5
2025-10-10 15:37:08.006 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 15:37:08.102 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 1 个结果
2025-10-10 15:37:08.103 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 5 个相似文档
2025-10-10 15:37:08.103 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 5 个结果
2025-10-10 15:37:08.657 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 危险化学品安全管理条例 销售资质 许可证
2025-10-10 15:37:08.659 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品安全管理条例 销售资质 许可证, 最大结果数: 5
2025-10-10 15:37:08.691 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 15:37:08.760 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 1 个结果
2025-10-10 15:37:08.760 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 最终返回 5 个相似文档
2025-10-10 15:37:08.761 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 5 个结果
2025-10-10 15:37:11.749 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 危险化学品安全管理条例, 条文: 第三十八条
2025-10-10 15:37:11.749 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品安全管理条例 第三十八条 条文 内容, 最大结果数: 2
2025-10-10 15:37:11.814 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-10 15:37:11.814 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-10 15:37:12.640 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 15:37:19.103 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 危险化学品经营法律风险
2025-10-10 15:37:19.103 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品经营法律风险 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 15:37:19.175 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 15:37:19.175 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 危险化学品经营法律风险
2025-10-10 15:37:58.087 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 15:38:04.003 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 15:38:10.867 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 15:38:10.867 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - PDF报告内容生成完成，耗时: 74853ms
2025-10-10 15:38:10.870 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - DeepSeek分析结果已保存到JSON文件: uploads\reports\17_analysis.json
2025-10-10 15:38:10.870 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 15:38:10.870 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 15:38:10.950 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 411 字符
2025-10-10 15:38:10.950 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 19 行，开始逐行渲染
2025-10-10 15:38:10.963 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 19, 已处理: 14
2025-10-10 15:38:10.964 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 15:38:10.987 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 正在渲染DeepSeek深度分析内容...
2025-10-10 15:38:10.987 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 1990 字符
2025-10-10 15:38:10.987 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 111 行，开始逐行渲染
2025-10-10 15:38:10.999 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 111, 已处理: 72
2025-10-10 15:38:11.000 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 15:38:11.000 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 1922 字符
2025-10-10 15:38:11.000 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 148 行，开始逐行渲染
2025-10-10 15:38:11.026 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 148, 已处理: 113
2025-10-10 15:38:11.026 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 15:38:11.027 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 1836 字符
2025-10-10 15:38:11.029 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 99 行，开始逐行渲染
2025-10-10 15:38:11.057 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 99, 已处理: 73
2025-10-10 15:38:11.057 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 15:38:11.062 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 15:38:11.075 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 17, 文件大小: 27992 bytes
2025-10-10 15:38:11.075 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 17, 文件大小: 27992 bytes
2025-10-10 15:38:11.077 [http-nio-8080-exec-6] WARN  o.a.coyote.http11.Http11Processor - The HTTP response header [Content-Disposition] with value [attachment; filename="《危险化学品生产经营企业自建网站销售合同（示范文本）》_审查报告_20251010_153811.pdf"] has been removed from the response because it is invalid
java.lang.IllegalArgumentException: The Unicode character [《] at code point [12,298] cannot be encoded as it is outside the permitted range of 0 to 255
	at org.apache.tomcat.util.buf.MessageBytes.toBytesSimple(MessageBytes.java:310)
	at org.apache.tomcat.util.buf.MessageBytes.toBytes(MessageBytes.java:283)
	at org.apache.coyote.http11.Http11OutputBuffer.write(Http11OutputBuffer.java:400)
	at org.apache.coyote.http11.Http11OutputBuffer.sendHeader(Http11OutputBuffer.java:379)
	at org.apache.coyote.http11.Http11Processor.writeHeaders(Http11Processor.java:1048)
	at org.apache.coyote.http11.Http11Processor.prepareResponse(Http11Processor.java:1035)
	at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:377)
	at org.apache.coyote.Response.action(Response.java:208)
	at org.apache.coyote.http11.Http11OutputBuffer.doWrite(Http11OutputBuffer.java:187)
	at org.apache.coyote.Response.doWrite(Response.java:633)
	at org.apache.catalina.connector.OutputBuffer.realWriteBytes(OutputBuffer.java:329)
	at org.apache.catalina.connector.OutputBuffer.appendByteArray(OutputBuffer.java:746)
	at org.apache.catalina.connector.OutputBuffer.append(OutputBuffer.java:667)
	at org.apache.catalina.connector.OutputBuffer.writeBytes(OutputBuffer.java:376)
	at org.apache.catalina.connector.OutputBuffer.write(OutputBuffer.java:354)
	at org.apache.catalina.connector.CoyoteOutputStream.write(CoyoteOutputStream.java:103)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.write(OnCommittedResponseWrapper.java:639)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.write(StandardServletAsyncWebRequest.java:398)
	at java.base/java.io.OutputStream.write(OutputStream.java:124)
	at org.springframework.util.StreamUtils.copy(StreamUtils.java:117)
	at org.springframework.http.converter.ByteArrayHttpMessageConverter.writeInternal(ByteArrayHttpMessageConverter.java:67)
	at org.springframework.http.converter.ByteArrayHttpMessageConverter.writeInternal(ByteArrayHttpMessageConverter.java:38)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:300)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-10 15:38:11.081 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=74d2e591, method=GET, uri=/api/v1/contracts/17/report, status=200, duration=75324ms
2025-10-10 15:40:16.041 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 15:40:16.046 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 15:52:05.299 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 24460 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 15:52:05.300 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 15:52:08.118 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 15:52:08.388 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@16a15261
2025-10-10 15:52:08.450 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 15:52:08.469 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 15:52:08.475 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 15:52:08.553 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 15:52:08.556 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 15:52:09.044 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 15:52:10.617 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 15:52:10.673 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 15:52:10.675 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 15:52:10.695 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 15:52:10.695 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 15:52:10.696 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 15:52:10.696 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 15:52:10.696 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 15:52:10.696 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 15:52:10.696 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 15:52:10.732 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 15:52:10.868 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 15:52:10.868 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 15:52:11.386 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 15:52:11.416 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 15:52:11.418 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 15:52:11.422 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 15:52:11.423 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 15:52:11.424 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 15:52:11.458 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 15:52:11.638 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 15:52:11.640 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 15:52:11.641 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 15:52:11.641 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 15:52:11.826 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 15:52:11.833 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 15:52:11.835 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 15:52:11.835 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 15:52:11.836 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 15:52:11.843 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 15:52:11.843 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 15:52:11.872 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 15:52:11.872 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 15:52:11.872 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 15:52:11.873 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 15:52:11.873 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 15:52:11.873 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 15:52:11.873 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 15:52:11.885 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 15:52:11.892 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 15:52:11.904 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 15:52:11.905 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 15:52:11.914 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 15:52:11.914 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 15:52:11.917 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 15:52:11.917 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 15:52:11.918 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 15:52:11.918 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 15:52:11.977 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 15:52:12.498 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 15:52:12.633 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 15:52:12.635 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 15:52:12.665 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 15:52:12.667 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 15:52:12.812 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 15:52:13.046 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 15:52:13.376 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 15:52:13.538 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 15:52:13.645 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 15:52:14.536 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.673 seconds (process running for 9.965)
2025-10-10 15:52:14.542 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 15:52:14.544 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 15:52:14.640 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 15:52:36.073 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:52:36.079 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:52:36.142 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 18, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:52:36.153 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 18
2025-10-10 15:52:36.153 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-10 15:52:36.177 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 15:52:36.178 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-10 15:52:36.183 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2dc3337f, method=POST, uri=/api/v1/contracts/upload, status=202, duration=185ms
2025-10-10 15:52:36.214 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 18
2025-10-10 15:52:36.218 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 18
2025-10-10 15:52:36.219 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - SSE连接已建立: reviewId=18
2025-10-10 15:52:36.222 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同（四步流程版），审查ID: 18
2025-10-10 15:52:36.224 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=18
2025-10-10 15:52:36.228 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:52:36.235 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8ceb3d0f, method=GET, uri=/api/v1/contracts/18/analyze-async, status=200, duration=24ms
2025-10-10 15:52:36.918 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-10 15:52:36.918 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-10 15:52:36.919 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=18, 文本长度: 7321
2025-10-10 15:52:36.919 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-10 15:52:36.924 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-10 15:52:37.274 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=18
2025-10-10 15:52:37.276 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:52:38.281 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=18
2025-10-10 15:52:38.283 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:52:39.296 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=18
2025-10-10 15:52:39.298 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:52:40.312 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=18
2025-10-10 15:52:40.314 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:52:41.327 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=18
2025-10-10 15:52:41.328 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:52:42.338 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=18
2025-10-10 15:52:42.340 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:52:43.351 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=18
2025-10-10 15:52:43.353 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:52:44.365 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=18
2025-10-10 15:52:44.366 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 15:52:44.632 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-10 15:52:44.633 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 18, 块数: 405
2025-10-10 15:52:44.633 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 18
2025-10-10 15:52:44.634 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 18
2025-10-10 15:52:45.375 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=18
2025-10-10 15:52:45.377 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-10 15:52:45.378 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 9秒, reviewId=18
2025-10-10 15:52:45.379 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤1完成：文档解析成功, reviewId=18
2025-10-10 15:52:45.394 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-10 15:54:11.886 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-10 15:54:11.889 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤2完成：风险识别成功, reviewId=18
2025-10-10 15:54:11.890 [Async-2] INFO  c.r.L.service.AgentService - 开始分析合同关键条款，内容长度: 7321
2025-10-10 15:54:19.238 [Async-2] WARN  c.r.L.service.AgentService - 响应中未找到有效的JSON结构，原始响应: 我需要先看到具体的合同内容才能进行分析。您提到要分析合同并提取关键条款，但还没有提供合同文本。

请您提供需要分析的合同全文或相关条款内容，我将按照您要求的格式进行详细分析，包括：

1. 合同标的
2. 双方权利义务  
3. 履行期限
4. 价款支付
5. 违约责任
6. 争议解决
7. 其他重要条款

对于每个条款，我会提供内容摘录、分析评价、重要性评级和改进建议，并给出整体完整性评分和评估
2025-10-10 15:54:19.238 [Async-2] INFO  c.r.L.service.AgentService - 关键条款分析完成，原始响应长度: 222, 清理后长度: 29
2025-10-10 15:54:19.240 [Async-2] WARN  c.r.L.service.ContractReviewService - 关键条款分析返回错误: AI返回的不是有效的JSON格式
2025-10-10 15:54:19.242 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤3完成：条款分析成功, reviewId=18
2025-10-10 15:54:19.297 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤4完成：报告生成并保存成功, reviewId=18
2025-10-10 15:54:19.334 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析流程全部完成, reviewId=18
2025-10-10 15:54:19.342 [http-nio-8080-exec-4] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=18
2025-10-10 15:57:01.106 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 15:57:01.112 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 16:04:38.502 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 30556 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 16:04:38.503 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 16:04:41.040 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 16:04:41.242 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5a464be7
2025-10-10 16:04:41.319 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 16:04:41.339 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 16:04:41.344 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 16:04:41.424 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 16:04:41.426 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 16:04:41.849 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 16:04:43.284 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 16:04:43.333 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 16:04:43.335 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 16:04:43.359 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 16:04:43.359 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 16:04:43.359 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 16:04:43.359 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 16:04:43.359 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 16:04:43.359 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 16:04:43.359 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 16:04:43.387 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 16:04:43.525 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 16:04:43.526 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 16:04:43.950 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 16:04:43.982 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 16:04:43.984 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 16:04:43.988 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 16:04:43.988 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 16:04:43.989 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 16:04:44.020 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 16:04:44.175 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 16:04:44.176 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 16:04:44.177 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 16:04:44.177 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 16:04:44.362 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 16:04:44.368 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 16:04:44.370 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 16:04:44.370 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 16:04:44.370 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 16:04:44.376 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 16:04:44.377 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 16:04:44.401 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 16:04:44.401 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 16:04:44.401 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 16:04:44.401 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 16:04:44.402 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 16:04:44.402 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 16:04:44.402 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 16:04:44.412 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 16:04:44.420 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 16:04:44.432 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 16:04:44.432 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 16:04:44.442 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 16:04:44.442 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 16:04:44.444 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 16:04:44.444 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 16:04:44.446 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 16:04:44.446 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 16:04:44.502 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 16:04:45.300 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 16:04:45.406 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 16:04:45.408 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 16:04:45.440 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 16:04:45.446 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 16:04:45.569 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 16:04:45.781 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 16:04:46.064 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 16:04:46.204 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 16:04:46.300 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 16:04:47.093 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.043 seconds (process running for 9.365)
2025-10-10 16:04:47.099 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 16:04:47.101 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 16:04:47.189 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 16:05:01.220 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 16:05:01.226 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 16:05:01.285 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 19, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 16:05:01.294 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 19
2025-10-10 16:05:01.294 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-10 16:05:01.314 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 16:05:01.315 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-10 16:05:01.322 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=da71da07, method=POST, uri=/api/v1/contracts/upload, status=202, duration=169ms
2025-10-10 16:05:01.347 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 19
2025-10-10 16:05:01.350 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 19
2025-10-10 16:05:01.351 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - SSE连接已建立: reviewId=19
2025-10-10 16:05:01.355 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同（四步流程版），审查ID: 19
2025-10-10 16:05:01.356 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=19
2025-10-10 16:05:01.359 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:05:01.363 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=dcb74729, method=GET, uri=/api/v1/contracts/19/analyze-async, status=200, duration=20ms
2025-10-10 16:05:02.046 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-10 16:05:02.046 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-10 16:05:02.047 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=19, 文本长度: 7321
2025-10-10 16:05:02.048 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-10 16:05:02.053 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-10 16:05:02.403 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=19
2025-10-10 16:05:02.404 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:05:03.414 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=19
2025-10-10 16:05:03.416 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:05:04.424 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=19
2025-10-10 16:05:04.426 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:05:05.439 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=19
2025-10-10 16:05:05.441 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:05:06.450 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=19
2025-10-10 16:05:06.451 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:05:07.462 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=19
2025-10-10 16:05:07.463 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:05:08.475 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=19
2025-10-10 16:05:08.476 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:05:09.487 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=19
2025-10-10 16:05:09.489 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:05:10.459 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-10 16:05:10.461 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 19, 块数: 405
2025-10-10 16:05:10.461 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 19
2025-10-10 16:05:10.462 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 19
2025-10-10 16:05:10.492 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=19
2025-10-10 16:05:10.497 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-10 16:05:10.498 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 9秒, reviewId=19
2025-10-10 16:05:10.500 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤1完成：文档解析成功, reviewId=19
2025-10-10 16:05:10.514 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-10 16:05:52.029 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=c13ab2e7, method=GET, uri=/api/v1/doc.html, status=200, duration=4ms
2025-10-10 16:05:52.112 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e9460b82, method=GET, uri=/api/v1/webjars/css/app.1824bac3.css, status=200, duration=12ms
2025-10-10 16:05:52.112 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=11e33c73, method=GET, uri=/api/v1/webjars/css/chunk-vendors.f24a310a.css, status=200, duration=10ms
2025-10-10 16:05:52.116 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7d9e77ce, method=GET, uri=/api/v1/webjars/js/app.c31badf5.js, status=200, duration=14ms
2025-10-10 16:05:52.138 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d6524c0f, method=GET, uri=/api/v1/webjars/js/chunk-vendors.d51cf6f8.js, status=200, duration=32ms
2025-10-10 16:05:52.242 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7f5220df, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=3ms
2025-10-10 16:05:52.243 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d029a85f, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=4ms
2025-10-10 16:05:52.243 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9365ee5b, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=4ms
2025-10-10 16:05:52.244 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=6834c86c, method=GET, uri=/api/v1/webjars/js/chunk-0d102d5a.b2bddffc.js, status=200, duration=3ms
2025-10-10 16:05:52.247 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e87ac7ba, method=GET, uri=/api/v1/webjars/js/chunk-0fd67716.d57e2c41.js, status=200, duration=6ms
2025-10-10 16:05:52.252 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e8fc4a4d, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=2ms
2025-10-10 16:05:52.255 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a06d8106, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=4ms
2025-10-10 16:05:52.255 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=54194f67, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=4ms
2025-10-10 16:05:52.255 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e901ca38, method=GET, uri=/api/v1/webjars/js/chunk-2d0da532.591ad7fc.js, status=200, duration=3ms
2025-10-10 16:05:52.266 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a28914a9, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=3ms
2025-10-10 16:05:52.267 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4b932695, method=GET, uri=/api/v1/webjars/js/chunk-589faee0.5bfd1708.js, status=200, duration=4ms
2025-10-10 16:05:52.268 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ae7c2358, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=3ms
2025-10-10 16:05:52.269 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ef8b64b8, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=11ms
2025-10-10 16:05:52.270 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=abdc69cc, method=GET, uri=/api/v1/webjars/js/chunk-260d712a.390177fe.js, status=200, duration=21ms
2025-10-10 16:05:52.275 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f0740c68, method=GET, uri=/api/v1/webjars/js/chunk-735c675c.5b409314.js, status=200, duration=10ms
2025-10-10 16:05:52.281 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a0c8b45b, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=8ms
2025-10-10 16:05:52.468 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bfe94959, method=GET, uri=/api/v1/v3/api-docs/swagger-config, status=200, duration=14ms
2025-10-10 16:05:53.397 [http-nio-8080-exec-2] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 918 ms
2025-10-10 16:05:53.420 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a14402df, method=GET, uri=/api/v1/v3/api-docs, status=200, duration=945ms
2025-10-10 16:06:03.488 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=11b3d3cf, method=GET, uri=/api/v1/webjars/css/chunk-41ae0dec.999bc9fd.css, status=200, duration=12ms
2025-10-10 16:06:03.488 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d99d4d84, method=GET, uri=/api/v1/webjars/js/chunk-069eb437.355c4fb0.js, status=200, duration=11ms
2025-10-10 16:06:03.489 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=fe7dcdb6, method=GET, uri=/api/v1/webjars/css/chunk-cdc6d52e.9612b987.css, status=200, duration=12ms
2025-10-10 16:06:03.489 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e1f95664, method=GET, uri=/api/v1/webjars/js/chunk-adb9e944.2c7f24fe.js, status=200, duration=12ms
2025-10-10 16:06:03.490 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1e164dd3, method=GET, uri=/api/v1/webjars/js/chunk-41ae0dec.7cdc472b.js, status=200, duration=14ms
2025-10-10 16:06:03.499 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=a2a0258e, method=GET, uri=/api/v1/webjars/js/chunk-cdc6d52e.5c46a8aa.js, status=200, duration=5ms
2025-10-10 16:06:03.544 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ac7f936b, method=GET, uri=/api/v1/webjars/js/chunk-2d0af44e.392afcd6.js, status=200, duration=5ms
2025-10-10 16:06:03.546 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=71791d4f, method=GET, uri=/api/v1/webjars/js/chunk-3ec4aaa8.a79d19f8.js, status=200, duration=4ms
2025-10-10 16:06:03.547 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b954f5ff, method=GET, uri=/api/v1/webjars/js/chunk-3b888a65.8737ce4f.js, status=200, duration=8ms
2025-10-10 16:06:03.548 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f072d969, method=GET, uri=/api/v1/webjars/js/chunk-2d0bd799.eb48b7f1.js, status=200, duration=4ms
2025-10-10 16:06:29.739 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-10 16:06:29.742 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤2完成：风险识别成功, reviewId=19
2025-10-10 16:06:29.743 [Async-2] INFO  c.r.L.service.AgentService - 开始分析合同关键条款，内容长度: 7321
2025-10-10 16:06:39.019 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 合同标的
2025-10-10 16:06:39.019 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 合同标的 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 16:06:39.080 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:06:39.081 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 合同标的
2025-10-10 16:06:56.775 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 双方权利义务
2025-10-10 16:06:56.776 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 双方权利义务 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 16:06:56.856 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:06:56.856 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 双方权利义务
2025-10-10 16:07:06.597 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 履行期限
2025-10-10 16:07:06.598 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 履行期限 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 16:07:06.689 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:07:06.689 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 履行期限
2025-10-10 16:07:25.516 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 价款支付
2025-10-10 16:07:25.517 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 价款支付 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 16:07:25.719 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:07:25.719 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 价款支付
2025-10-10 16:07:44.494 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 违约责任
2025-10-10 16:07:44.494 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 违约责任 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 16:07:44.529 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:07:44.529 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 违约责任
2025-10-10 16:07:51.041 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 争议解决
2025-10-10 16:07:51.041 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 争议解决 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 16:07:51.111 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:07:51.111 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 争议解决
2025-10-10 16:08:02.619 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 其他重要条款
2025-10-10 16:08:02.621 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 其他重要条款 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 16:08:02.685 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:08:02.685 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 其他重要条款
2025-10-10 16:08:51.571 [Async-2] INFO  c.r.L.service.AgentService - JSON格式验证成功，包含 7 个关键条款
2025-10-10 16:08:51.571 [Async-2] INFO  c.r.L.service.AgentService - 关键条款分析完成，原始响应长度: 2479, 清理后长度: 2479
2025-10-10 16:08:51.571 [Async-2] INFO  c.r.L.service.ContractReviewService - 关键条款分析成功，识别出 7 个关键条款
2025-10-10 16:08:51.571 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤3完成：条款分析成功, reviewId=19
2025-10-10 16:08:51.607 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤4完成：报告生成并保存成功, reviewId=19
2025-10-10 16:08:51.637 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析流程全部完成, reviewId=19
2025-10-10 16:08:51.647 [http-nio-8080-exec-10] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=19
2025-10-10 16:09:23.036 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 19
2025-10-10 16:09:23.051 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 19
2025-10-10 16:09:23.051 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 16:09:23.226 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载中文字体：STSong-Light (UniGB-UCS2-H编码)
2025-10-10 16:09:23.277 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 16:09:23.278 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 16:09:23.278 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 19
2025-10-10 16:09:23.278 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 19
2025-10-10 16:09:28.539 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 开始使用专用提示词生成PDF报告内容...
2025-10-10 16:09:28.540 [ForkJoinPool.commonPool-worker-6] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了..., 会话ID: default
2025-10-10 16:09:28.540 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: /*
 * PDF合同审查报告生成专用提示词模板
 * ..., 会话ID: default
2025-10-10 16:09:28.540 [ForkJoinPool.commonPool-worker-7] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合..., 会话ID: default
2025-10-10 16:09:28.540 [ForkJoinPool.commonPool-worker-6] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-10 16:09:28.540 [ForkJoinPool.commonPool-worker-8] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 7321, 问题: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违..., 会话ID: default
2025-10-10 16:09:28.540 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-10 16:09:28.540 [ForkJoinPool.commonPool-worker-7] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-10 16:09:28.541 [ForkJoinPool.commonPool-worker-8] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 7321, 会话: default
2025-10-10 16:09:48.295 [ForkJoinPool.commonPool-worker-6] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 16:09:50.245 [ForkJoinPool.commonPool-worker-7] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 16:09:51.987 [ForkJoinPool.commonPool-worker-8] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 16:09:52.154 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 16:09:52.154 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - PDF报告内容生成完成，耗时: 28875ms
2025-10-10 16:09:52.156 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - DeepSeek分析结果已保存到JSON文件: uploads\reports\19_analysis.json
2025-10-10 16:09:52.156 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 16:09:52.156 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 16:09:52.230 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 719 字符
2025-10-10 16:09:52.230 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 34 行，开始逐行渲染
2025-10-10 16:09:52.245 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 34, 已处理: 27
2025-10-10 16:09:52.245 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:09:52.265 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 正在渲染DeepSeek深度分析内容...
2025-10-10 16:09:52.265 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 839 字符
2025-10-10 16:09:52.265 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 35 行，开始逐行渲染
2025-10-10 16:09:52.270 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 35, 已处理: 25
2025-10-10 16:09:52.271 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:09:52.271 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 822 字符
2025-10-10 16:09:52.271 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 34 行，开始逐行渲染
2025-10-10 16:09:52.276 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 34, 已处理: 24
2025-10-10 16:09:52.276 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:09:52.277 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 738 字符
2025-10-10 16:09:52.277 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 22 行，开始逐行渲染
2025-10-10 16:09:52.278 [http-nio-8080-exec-5] WARN  c.r.L.service.MarkdownToPdfRenderer - 处理第 6 行时出错: Range [157, 111) out of bounds for length 153, 跳过该行
2025-10-10 16:09:52.279 [http-nio-8080-exec-5] WARN  c.r.L.service.MarkdownToPdfRenderer - 处理第 9 行时出错: Range [134, 99) out of bounds for length 99, 跳过该行
2025-10-10 16:09:52.280 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 22, 已处理: 14
2025-10-10 16:09:52.281 [http-nio-8080-exec-5] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:09:52.284 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 16:09:52.293 [http-nio-8080-exec-5] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 19, 文件大小: 17716 bytes
2025-10-10 16:09:52.294 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 19, 文件大小: 17716 bytes, 文件名: _危险化学品生产经营企业自建网站销售合同（示范文本）__审查报告_20251010_160952.pdf
2025-10-10 16:09:52.295 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5c00324b, method=GET, uri=/api/v1/contracts/19/report, status=200, duration=29260ms
2025-10-10 16:18:27.800 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 16:18:27.802 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 16:32:28.443 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 17136 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 16:32:28.445 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 16:32:30.834 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 16:32:30.993 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@73e63b4d
2025-10-10 16:32:31.050 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 16:32:31.070 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 16:32:31.078 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 16:32:31.161 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 16:32:31.164 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 16:32:31.624 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 16:32:33.166 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 16:32:33.217 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 16:32:33.218 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 16:32:33.239 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 16:32:33.239 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 16:32:33.239 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 16:32:33.239 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 16:32:33.240 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 16:32:33.240 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 16:32:33.240 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 16:32:33.268 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 16:32:33.401 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 16:32:33.401 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 16:32:33.845 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 16:32:33.872 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 16:32:33.874 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 16:32:33.878 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 16:32:33.878 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 16:32:33.879 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 16:32:33.911 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 16:32:34.102 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 16:32:34.104 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 16:32:34.104 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 16:32:34.104 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 16:32:34.316 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 16:32:34.324 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 16:32:34.326 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 16:32:34.326 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 16:32:34.326 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 16:32:34.333 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 16:32:34.333 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 16:32:34.355 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 16:32:34.355 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 16:32:34.355 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 16:32:34.355 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 16:32:34.357 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 16:32:34.357 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 16:32:34.357 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 16:32:34.367 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 16:32:34.376 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 16:32:34.389 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 16:32:34.389 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 16:32:34.398 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 16:32:34.399 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 16:32:34.401 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 16:32:34.401 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 16:32:34.403 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 16:32:34.403 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 16:32:34.456 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 16:32:34.853 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 16:32:34.955 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 16:32:34.957 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 16:32:34.978 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 16:32:34.980 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 16:32:35.096 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 16:32:35.305 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 16:32:35.627 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 16:32:35.786 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 16:32:35.873 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 16:32:36.694 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.667 seconds (process running for 8.947)
2025-10-10 16:32:36.701 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 16:32:36.702 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 16:32:36.790 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 16:33:05.662 [http-nio-8080-exec-2] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f_农村土地经营权出租合同.docx
2025-10-10 16:33:05.668 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 农村土地经营权出租合同.docx
2025-10-10 16:33:05.719 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 20, 文件: 农村土地经营权出租合同.docx
2025-10-10 16:33:05.738 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 20
2025-10-10 16:33:05.738 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-10 16:33:05.760 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 农村土地经营权出租合同.docx, 路径: F:\LegalAssistant\uploads\contracts\bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f_农村土地经营权出租合同.docx
2025-10-10 16:33:05.761 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 农村土地经营权出租合同.docx, 类型: docx, 大小: 30836 bytes
2025-10-10 16:33:05.767 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=e16d513f, method=POST, uri=/api/v1/contracts/upload, status=202, duration=170ms
2025-10-10 16:33:05.796 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 20
2025-10-10 16:33:05.799 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 20
2025-10-10 16:33:05.800 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - SSE连接已建立: reviewId=20
2025-10-10 16:33:05.804 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同（四步流程版），审查ID: 20
2025-10-10 16:33:05.806 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=20
2025-10-10 16:33:05.809 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:33:05.815 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=78bf9629, method=GET, uri=/api/v1/contracts/20/analyze-async, status=200, duration=23ms
2025-10-10 16:33:06.506 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 农村土地经营权出租合同.docx, 内容长度: 3686 字符
2025-10-10 16:33:06.506 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 农村土地经营权出租合同.docx, 内容长度: 3686
2025-10-10 16:33:06.507 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=20, 文本长度: 3686
2025-10-10 16:33:06.507 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3686 字符
2025-10-10 16:33:06.512 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-10 16:33:06.839 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=20
2025-10-10 16:33:06.841 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:33:07.848 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=20
2025-10-10 16:33:07.850 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:33:08.865 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=20
2025-10-10 16:33:08.867 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:33:09.874 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=20
2025-10-10 16:33:09.877 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:33:10.884 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=20
2025-10-10 16:33:10.887 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:33:11.896 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=20
2025-10-10 16:33:11.897 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:33:12.909 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=20
2025-10-10 16:33:12.910 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 16:33:13.840 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-10 16:33:13.840 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 20, 块数: 403
2025-10-10 16:33:13.841 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 20
2025-10-10 16:33:13.841 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 20
2025-10-10 16:33:13.914 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=20
2025-10-10 16:33:13.917 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 3686
2025-10-10 16:33:13.917 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 8秒, reviewId=20
2025-10-10 16:33:13.919 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤1完成：文档解析成功, reviewId=20
2025-10-10 16:33:13.932 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 3686
2025-10-10 16:34:30.982 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-10 16:34:30.985 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤2完成：风险识别成功, reviewId=20
2025-10-10 16:34:30.986 [Async-2] INFO  c.r.L.service.AgentService - 开始分析合同关键条款，内容长度: 3686
2025-10-10 16:34:35.615 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租合同 法律要求 关键条款
2025-10-10 16:34:35.616 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租合同 法律要求 关键条款, 最大结果数: 5
2025-10-10 16:34:35.814 [Async-2] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 16:34:35.913 [Async-2] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 1 个结果
2025-10-10 16:34:35.914 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 5 个相似文档
2025-10-10 16:34:35.914 [Async-2] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 5 个结果
2025-10-10 16:34:39.457 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 农村土地经营权出租
2025-10-10 16:34:39.457 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 16:34:39.644 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:34:39.645 [Async-2] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 农村土地经营权出租
2025-10-10 16:35:28.096 [Async-2] INFO  c.r.L.service.AgentService - JSON格式验证成功，包含 7 个关键条款
2025-10-10 16:35:28.096 [Async-2] INFO  c.r.L.service.AgentService - 关键条款分析完成，原始响应长度: 2435, 清理后长度: 2395
2025-10-10 16:35:28.097 [Async-2] INFO  c.r.L.service.ContractReviewService - 关键条款分析成功，识别出 7 个关键条款
2025-10-10 16:35:28.097 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤3完成：条款分析成功, reviewId=20
2025-10-10 16:35:28.130 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤4完成：报告生成并保存成功, reviewId=20
2025-10-10 16:35:28.154 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析流程全部完成, reviewId=20
2025-10-10 16:35:28.163 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=20
2025-10-10 16:36:35.762 [http-nio-8080-exec-6] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 20
2025-10-10 16:36:35.781 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 20
2025-10-10 16:36:35.781 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 16:36:35.887 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载中文字体：STSong-Light (UniGB-UCS2-H编码)
2025-10-10 16:36:35.915 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 16:36:35.916 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 16:36:35.916 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 20
2025-10-10 16:36:35.916 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 20
2025-10-10 16:36:39.279 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始使用专用提示词生成PDF报告内容...
2025-10-10 16:36:39.280 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 3686, 问题: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了..., 会话ID: default
2025-10-10 16:36:39.280 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 3686, 问题: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合..., 会话ID: default
2025-10-10 16:36:39.280 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 3686, 问题: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违..., 会话ID: default
2025-10-10 16:36:39.280 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 3686, 问题: /*
 * PDF合同审查报告生成专用提示词模板
 * ..., 会话ID: default
2025-10-10 16:36:39.280 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 3686, 会话: default
2025-10-10 16:36:39.281 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 3686, 会话: default
2025-10-10 16:36:39.280 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 3686, 会话: default
2025-10-10 16:36:39.280 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 3686, 会话: default
2025-10-10 16:36:57.756 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 16:37:23.415 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 16:37:25.158 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 16:37:32.322 [ForkJoinPool.commonPool-worker-5] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 16:37:32.323 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - PDF报告内容生成完成，耗时: 56407ms
2025-10-10 16:37:32.325 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - DeepSeek分析结果已保存到JSON文件: uploads\reports\20_analysis.json
2025-10-10 16:37:32.325 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 16:37:32.325 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 16:37:32.378 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 649 字符
2025-10-10 16:37:32.378 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 23 行，开始逐行渲染
2025-10-10 16:37:32.388 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 23, 已处理: 17
2025-10-10 16:37:32.388 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:37:32.389 [http-nio-8080-exec-6] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用原文本: ─────────────────────────────────────
2025-10-10 16:37:32.400 [http-nio-8080-exec-6] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用原文本: ──────────────────────────────────────────────────
2025-10-10 16:37:32.401 [http-nio-8080-exec-6] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用原文本: ──────────────────────────────────────────────────
2025-10-10 16:37:32.403 [http-nio-8080-exec-6] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用原文本: ──────────────────────────────────────────────────
2025-10-10 16:37:32.404 [http-nio-8080-exec-6] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用原文本: ──────────────────────────────────────────────────
2025-10-10 16:37:32.405 [http-nio-8080-exec-6] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用原文本: ──────────────────────────────────────────────────
2025-10-10 16:37:32.407 [http-nio-8080-exec-6] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用原文本: ──────────────────────────────────────────────────
2025-10-10 16:37:32.408 [http-nio-8080-exec-6] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用原文本: ──────────────────────────────────────────────────
2025-10-10 16:37:32.410 [http-nio-8080-exec-6] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用原文本: ──────────────────────────────────────────────────
2025-10-10 16:37:32.411 [http-nio-8080-exec-6] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用原文本: ──────────────────────────────────────────────────
2025-10-10 16:37:32.412 [http-nio-8080-exec-6] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用原文本: ──────────────────────────────────────────────────
2025-10-10 16:37:32.413 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 正在渲染DeepSeek深度分析内容...
2025-10-10 16:37:32.413 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 1689 字符
2025-10-10 16:37:32.413 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 105 行，开始逐行渲染
2025-10-10 16:37:32.423 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 105, 已处理: 77
2025-10-10 16:37:32.423 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:37:32.423 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 2010 字符
2025-10-10 16:37:32.423 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 125 行，开始逐行渲染
2025-10-10 16:37:32.433 [http-nio-8080-exec-6] WARN  c.r.L.service.MarkdownToPdfRenderer - 处理第 122 行时出错: Range [29, 19) out of bounds for length 19, 跳过该行
2025-10-10 16:37:32.434 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 125, 已处理: 93
2025-10-10 16:37:32.434 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:37:32.434 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 1666 字符
2025-10-10 16:37:32.435 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 96 行，开始逐行渲染
2025-10-10 16:37:32.441 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 96, 已处理: 69
2025-10-10 16:37:32.441 [http-nio-8080-exec-6] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:37:32.441 [http-nio-8080-exec-6] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用原文本: ─────────────────────────────────────
2025-10-10 16:37:32.444 [http-nio-8080-exec-6] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用原文本: ══════════════════════════════════════════════════
2025-10-10 16:37:32.445 [http-nio-8080-exec-6] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 16:37:32.451 [http-nio-8080-exec-6] ERROR c.r.L.s.ReportGenerationService - PDF报告生成失败，审查ID: 20
java.lang.NullPointerException: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.itextpdf.kernel.font.PdfType0Font.generateWidthsArray(PdfType0Font.java:921)
	at com.itextpdf.kernel.font.PdfType0Font.getCidFont(PdfType0Font.java:901)
	at com.itextpdf.kernel.font.PdfType0Font.flushFontData(PdfType0Font.java:785)
	at com.itextpdf.kernel.font.PdfType0Font.flush(PdfType0Font.java:696)
	at com.itextpdf.kernel.pdf.PdfDocument.flushFonts(PdfDocument.java:2319)
	at com.itextpdf.kernel.pdf.PdfDocument.close(PdfDocument.java:978)
	at com.itextpdf.layout.Document.close(Document.java:96)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:130)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:631)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-10 16:37:32.462 [http-nio-8080-exec-6] ERROR c.r.L.c.ContractReviewController - 生成PDF报告失败，审查ID: 20
java.io.IOException: PDF报告生成失败: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:138)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:631)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.NullPointerException: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.itextpdf.kernel.font.PdfType0Font.generateWidthsArray(PdfType0Font.java:921)
	at com.itextpdf.kernel.font.PdfType0Font.getCidFont(PdfType0Font.java:901)
	at com.itextpdf.kernel.font.PdfType0Font.flushFontData(PdfType0Font.java:785)
	at com.itextpdf.kernel.font.PdfType0Font.flush(PdfType0Font.java:696)
	at com.itextpdf.kernel.pdf.PdfDocument.flushFonts(PdfDocument.java:2319)
	at com.itextpdf.kernel.pdf.PdfDocument.close(PdfDocument.java:978)
	at com.itextpdf.layout.Document.close(Document.java:96)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:130)
	... 160 common frames omitted
2025-10-10 16:37:32.467 [http-nio-8080-exec-6] ERROR c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=46fffe84, method=GET, uri=/api/v1/contracts/20/report, status=500, duration=56707ms
2025-10-10 16:38:54.804 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 16:38:54.806 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 16:41:51.149 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 12692 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 16:41:51.151 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 16:41:53.736 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 16:41:53.974 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@36ec4071
2025-10-10 16:41:54.016 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 16:41:54.034 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 16:41:54.039 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 16:41:54.120 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 16:41:54.122 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 16:41:54.477 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 16:41:55.889 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 16:41:55.950 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 16:41:55.951 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 16:41:55.971 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 16:41:55.971 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 16:41:55.972 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 16:41:55.972 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 16:41:55.972 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 16:41:55.972 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 16:41:55.972 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 16:41:56.003 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 16:41:56.091 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 16:41:56.092 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 16:41:56.521 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 16:41:56.553 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 16:41:56.555 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 16:41:56.559 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 16:41:56.560 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 16:41:56.561 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 16:41:56.590 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 16:41:56.763 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 16:41:56.765 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 16:41:56.765 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 16:41:56.766 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 16:41:56.925 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 16:41:56.942 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 16:41:56.943 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 16:41:56.944 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 16:41:56.944 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 16:41:56.950 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 16:41:56.950 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 16:41:56.972 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 16:41:56.972 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 16:41:56.972 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 16:41:56.972 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 16:41:56.974 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 16:41:56.974 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 16:41:56.974 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 16:41:56.985 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 16:41:56.994 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 16:41:57.005 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 16:41:57.006 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 16:41:57.016 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 16:41:57.016 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 16:41:57.018 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 16:41:57.018 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 16:41:57.020 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 16:41:57.020 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 16:41:57.071 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 16:41:57.474 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 16:41:57.587 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 16:41:57.589 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 16:41:57.610 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 16:41:57.612 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 16:41:57.758 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 16:41:57.978 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 16:41:58.306 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 16:41:58.472 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 16:41:58.567 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 16:41:59.434 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.747 seconds (process running for 9.048)
2025-10-10 16:41:59.439 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 16:41:59.440 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 16:41:59.532 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 16:42:04.725 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 20
2025-10-10 16:42:04.775 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 20
2025-10-10 16:42:04.775 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 16:42:04.908 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载中文字体：STSong-Light (UniGB-UCS2-H编码)
2025-10-10 16:42:04.945 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 16:42:04.946 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 16:42:04.946 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 20
2025-10-10 16:42:04.946 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 20
2025-10-10 16:42:11.231 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始使用专用提示词生成PDF报告内容...
2025-10-10 16:42:11.232 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 3686, 问题: /*
 * PDF合同审查报告生成专用提示词模板
 * ..., 会话ID: default
2025-10-10 16:42:11.232 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 3686, 问题: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了..., 会话ID: default
2025-10-10 16:42:11.232 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 3686, 问题: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合..., 会话ID: default
2025-10-10 16:42:11.232 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.AgentService - 处理合同分析请求，内容长度: 3686, 问题: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违..., 会话ID: default
2025-10-10 16:42:11.232 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 3686, 会话: default
2025-10-10 16:42:11.232 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 3686, 会话: default
2025-10-10 16:42:11.232 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 3686, 会话: default
2025-10-10 16:42:11.233 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.AgentService - 使用DEEPSEEK高级服务 (deepseek-chat)处理合同分析，内容长度: 3686, 会话: default
2025-10-10 16:42:15.430 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租 合同 法律风险
2025-10-10 16:42:15.431 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 合同 法律风险, 最大结果数: 10
2025-10-10 16:42:15.771 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租 合同 法律风险
2025-10-10 16:42:15.771 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 合同 法律风险, 最大结果数: 10
2025-10-10 16:42:15.868 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租 合同 法律风险
2025-10-10 16:42:15.868 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 合同 法律风险, 最大结果数: 10
2025-10-10 16:42:16.163 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 16:42:16.163 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 16:42:16.163 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 16:42:16.255 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 6 个结果
2025-10-10 16:42:16.256 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 最终返回 10 个相似文档
2025-10-10 16:42:16.256 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 10 个结果
2025-10-10 16:42:16.264 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 6 个结果
2025-10-10 16:42:16.265 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 10 个相似文档
2025-10-10 16:42:16.265 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 10 个结果
2025-10-10 16:42:16.272 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 6 个结果
2025-10-10 16:42:16.273 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 10 个相似文档
2025-10-10 16:42:16.273 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 10 个结果
2025-10-10 16:42:16.324 [ForkJoinPool.commonPool-worker-4] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$6(ReportGenerationService.java:488)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.http.client.log.LoggingHttpClient.execute(LoggingHttpClient.java:48)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 16:42:16.326 [ForkJoinPool.commonPool-worker-4] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 16:42:16.326 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 16:42:16.326 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.AgentService - 简化模式处理合同分析，内容长度: 3686
2025-10-10 16:42:16.327 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违法违规可能性）
2. 履约风险（合同执行风险）
3. 财务风险（经济损失可能性）
4. 诉讼风险（争议和纠纷可能性）
5. 监管风险（监管部门处罚风险）

对每类风险请提供：
- 风险等级评估（高/中/低）
- 可能的法律后果
- 防范措施建议

请提供专业、详细的风险评估报告。
2025-10-10 16:42:16.327 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违法违规可能性）
2. 履约风险（合同执行风险）
3. 财务风险（经济损失可能性）
4. 诉讼风险（争议和纠纷可能性）
5. 监管风险（监管部门处罚风险）

对每类风险请提供：
- 风险等级评估（高/中/低）
- 可能的法律后果
- 防范措施建议

请提供专业、详细的风险评估报告。, 最大结果数: 3
2025-10-10 16:42:16.368 [ForkJoinPool.commonPool-worker-2] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$4(ReportGenerationService.java:460)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.http.client.log.LoggingHttpClient.execute(LoggingHttpClient.java:48)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 16:42:16.369 [ForkJoinPool.commonPool-worker-2] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 16:42:16.369 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 16:42:16.369 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 简化模式处理合同分析，内容长度: 3686
2025-10-10 16:42:16.369 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。
2025-10-10 16:42:16.370 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。, 最大结果数: 3
2025-10-10 16:42:16.371 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:42:16.371 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 16:42:16.371 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违法违规可能性）
2. 履约风险（合同执行风险）
3. 财务风险（经济损失可能性）
4. 诉讼风险（争议和纠纷可能性）
5. 监管风险（监管部门处罚风险）

对每类风险请提供：
- 风险等级评估（高/中/低）
- 可能的法律后果
- 防范措施建议

请提供专业、详细的风险评估报告。
2025-10-10 16:42:16.372 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违法违规可能性）
2. 履约风险（合同执行风险）
3. 财务风险（经济损失可能性）
4. 诉讼风险（争议和纠纷可能性）
5. 监管风险（监管部门处罚风险）

对每类风险请提供：
- 风险等级评估（高/中/低）
- 可能的法律后果
- 防范措施建议

请提供专业、详细的风险评估报告。 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 16:42:16.398 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:42:16.399 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 16:42:16.399 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。
2025-10-10 16:42:16.399 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 16:42:16.415 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:42:16.415 [ForkJoinPool.commonPool-worker-1] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$3(ReportGenerationService.java:446)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.http.client.log.LoggingHttpClient.execute(LoggingHttpClient.java:48)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 16:42:16.415 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违法违规可能性）
2. 履约风险（合同执行风险）
3. 财务风险（经济损失可能性）
4. 诉讼风险（争议和纠纷可能性）
5. 监管风险（监管部门处罚风险）

对每类风险请提供：
- 风险等级评估（高/中/低）
- 可能的法律后果
- 防范措施建议

请提供专业、详细的风险评估报告。
2025-10-10 16:42:16.416 [ForkJoinPool.commonPool-worker-1] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 16:42:16.416 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 16:42:16.416 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 简化模式处理合同分析，内容长度: 3686
2025-10-10 16:42:16.417 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 16:35:28

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 16:42:16.418 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 16:35:28

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。
, 最大结果数: 3
2025-10-10 16:42:16.433 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:42:16.434 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。
2025-10-10 16:42:16.587 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(0个),尝试LangChain4j向量存储作为补充
2025-10-10 16:42:16.761 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 3 个结果
2025-10-10 16:42:16.762 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:42:16.762 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 16:42:16.762 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 16:35:28

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 16:42:16.763 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 16:35:28

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。
 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 16:42:16.895 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(0个),尝试LangChain4j向量存储作为补充
2025-10-10 16:42:17.088 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 3 个结果
2025-10-10 16:42:17.089 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:42:17.089 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 16:35:28

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 16:42:22.525 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 合同分析响应生成成功，服务: DEEPSEEK高级服务 (deepseek-chat), 会话: default
2025-10-10 16:42:22.526 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - PDF报告内容生成完成，耗时: 17580ms
2025-10-10 16:42:22.527 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - DeepSeek分析结果已保存到JSON文件: uploads\reports\20_analysis.json
2025-10-10 16:42:22.528 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 16:42:22.528 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 16:42:22.583 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 3140 字符
2025-10-10 16:42:22.583 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 59 行，开始逐行渲染
2025-10-10 16:42:22.603 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 59, 已处理: 38
2025-10-10 16:42:22.604 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:42:22.623 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 正在渲染DeepSeek深度分析内容...
2025-10-10 16:42:22.623 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 12332 字符
2025-10-10 16:42:22.624 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 309 行，开始逐行渲染
2025-10-10 16:42:22.659 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 309, 已处理: 205
2025-10-10 16:42:22.659 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:42:22.659 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 3202 字符
2025-10-10 16:42:22.660 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 67 行，开始逐行渲染
2025-10-10 16:42:22.664 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 67, 已处理: 46
2025-10-10 16:42:22.664 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:42:22.665 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 401 字符
2025-10-10 16:42:22.665 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 19 行，开始逐行渲染
2025-10-10 16:42:22.666 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 19, 已处理: 12
2025-10-10 16:42:22.667 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:42:22.669 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 16:42:22.676 [http-nio-8080-exec-1] ERROR c.r.L.s.ReportGenerationService - PDF报告生成失败，审查ID: 20
java.lang.NullPointerException: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.itextpdf.kernel.font.PdfType0Font.generateWidthsArray(PdfType0Font.java:921)
	at com.itextpdf.kernel.font.PdfType0Font.getCidFont(PdfType0Font.java:901)
	at com.itextpdf.kernel.font.PdfType0Font.flushFontData(PdfType0Font.java:785)
	at com.itextpdf.kernel.font.PdfType0Font.flush(PdfType0Font.java:696)
	at com.itextpdf.kernel.pdf.PdfDocument.flushFonts(PdfDocument.java:2319)
	at com.itextpdf.kernel.pdf.PdfDocument.close(PdfDocument.java:978)
	at com.itextpdf.layout.Document.close(Document.java:96)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:130)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:631)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-10 16:42:22.680 [http-nio-8080-exec-1] ERROR c.r.L.c.ContractReviewController - 生成PDF报告失败，审查ID: 20
java.io.IOException: PDF报告生成失败: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:138)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:631)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.NullPointerException: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.itextpdf.kernel.font.PdfType0Font.generateWidthsArray(PdfType0Font.java:921)
	at com.itextpdf.kernel.font.PdfType0Font.getCidFont(PdfType0Font.java:901)
	at com.itextpdf.kernel.font.PdfType0Font.flushFontData(PdfType0Font.java:785)
	at com.itextpdf.kernel.font.PdfType0Font.flush(PdfType0Font.java:696)
	at com.itextpdf.kernel.pdf.PdfDocument.flushFonts(PdfDocument.java:2319)
	at com.itextpdf.kernel.pdf.PdfDocument.close(PdfDocument.java:978)
	at com.itextpdf.layout.Document.close(Document.java:96)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:130)
	... 160 common frames omitted
2025-10-10 16:42:22.694 [http-nio-8080-exec-1] ERROR c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=51ef7907, method=GET, uri=/api/v1/contracts/20/report, status=500, duration=17996ms
2025-10-10 16:42:50.713 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 16:42:50.716 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 16:54:52.902 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 35348 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 16:54:52.903 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 16:54:55.220 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 16:54:55.361 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@61c0fb12
2025-10-10 16:54:55.405 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 16:54:55.424 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 16:54:55.429 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 16:54:55.514 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 16:54:55.517 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 16:54:55.874 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 16:54:57.284 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 16:54:57.331 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 16:54:57.333 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 16:54:57.353 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 16:54:57.354 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 16:54:57.354 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 16:54:57.354 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 16:54:57.354 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 16:54:57.354 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 16:54:57.354 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 16:54:57.381 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 16:54:57.472 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 16:54:57.472 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 16:54:57.908 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 16:54:57.942 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 16:54:57.944 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 16:54:57.948 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 16:54:57.948 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 16:54:57.949 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 16:54:57.981 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 16:54:58.151 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 16:54:58.154 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 16:54:58.154 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 16:54:58.155 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 16:54:58.321 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 16:54:58.329 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 16:54:58.330 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 16:54:58.331 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 16:54:58.331 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 16:54:58.337 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 16:54:58.337 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 16:54:58.359 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 16:54:58.359 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 16:54:58.359 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 16:54:58.360 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 16:54:58.360 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 16:54:58.360 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 16:54:58.360 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 16:54:58.382 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 16:54:58.391 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 16:54:58.403 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 16:54:58.403 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 16:54:58.413 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 16:54:58.413 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 16:54:58.416 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 16:54:58.416 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 16:54:58.417 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 16:54:58.418 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 16:54:58.467 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 16:54:58.868 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 16:54:58.976 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 16:54:58.978 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 16:54:58.999 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 16:54:59.001 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 16:54:59.122 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 16:54:59.331 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 16:54:59.662 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 16:54:59.822 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 16:54:59.921 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 16:55:00.731 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.221 seconds (process running for 8.504)
2025-10-10 16:55:00.737 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 16:55:00.738 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 16:55:00.826 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 16:55:44.919 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 20
2025-10-10 16:55:44.969 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 20
2025-10-10 16:55:44.969 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 16:55:45.079 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载中文字体：STSong-Light (UniGB-UCS2-H编码)
2025-10-10 16:55:45.108 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 16:55:45.108 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 16:55:45.109 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 20
2025-10-10 16:55:45.109 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 20
2025-10-10 16:55:55.644 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租 法律风险 合同条款
2025-10-10 16:55:55.645 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 法律风险 合同条款, 最大结果数: 10
2025-10-10 16:55:56.366 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 16:55:56.444 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 6 个结果
2025-10-10 16:55:56.444 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 10 个相似文档
2025-10-10 16:55:56.445 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 10 个结果
2025-10-10 16:55:57.031 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租合同 法律风险 条款
2025-10-10 16:55:57.031 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租合同 法律风险 条款, 最大结果数: 10
2025-10-10 16:55:57.063 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 16:55:57.136 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 6 个结果
2025-10-10 16:55:57.136 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 最终返回 10 个相似文档
2025-10-10 16:55:57.136 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 10 个结果
2025-10-10 16:56:00.190 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 土地经营权出租
2025-10-10 16:56:00.190 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 土地经营权出租 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 16:56:00.244 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:56:00.245 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 土地经营权出租
2025-10-10 16:56:00.412 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 农村土地经营权出租
2025-10-10 16:56:00.413 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 16:56:00.446 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 16:56:00.446 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 农村土地经营权出租
2025-10-10 16:56:41.475 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 16:56:41.475 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 16:56:41.527 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 413 字符
2025-10-10 16:56:41.528 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 21 行，开始逐行渲染
2025-10-10 16:56:41.539 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 21, 已处理: 15
2025-10-10 16:56:41.539 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:56:41.561 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 1606 字符
2025-10-10 16:56:41.562 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 88 行，开始逐行渲染
2025-10-10 16:56:41.573 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 88, 已处理: 66
2025-10-10 16:56:41.573 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:56:41.574 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 1522 字符
2025-10-10 16:56:41.574 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 102 行，开始逐行渲染
2025-10-10 16:56:41.583 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 102, 已处理: 78
2025-10-10 16:56:41.584 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:56:41.584 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 420 字符
2025-10-10 16:56:41.585 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 22 行，开始逐行渲染
2025-10-10 16:56:41.587 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 22, 已处理: 17
2025-10-10 16:56:41.587 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 16:56:41.591 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 16:56:41.599 [http-nio-8080-exec-1] ERROR c.r.L.s.ReportGenerationService - PDF报告生成失败，审查ID: 20
java.lang.NullPointerException: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.itextpdf.kernel.font.PdfType0Font.generateWidthsArray(PdfType0Font.java:921)
	at com.itextpdf.kernel.font.PdfType0Font.getCidFont(PdfType0Font.java:901)
	at com.itextpdf.kernel.font.PdfType0Font.flushFontData(PdfType0Font.java:785)
	at com.itextpdf.kernel.font.PdfType0Font.flush(PdfType0Font.java:696)
	at com.itextpdf.kernel.pdf.PdfDocument.flushFonts(PdfDocument.java:2319)
	at com.itextpdf.kernel.pdf.PdfDocument.close(PdfDocument.java:978)
	at com.itextpdf.layout.Document.close(Document.java:96)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:130)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:631)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-10 16:56:41.605 [http-nio-8080-exec-1] ERROR c.r.L.c.ContractReviewController - 生成PDF报告失败，审查ID: 20
java.io.IOException: PDF报告生成失败: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:138)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:631)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.NullPointerException: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.itextpdf.kernel.font.PdfType0Font.generateWidthsArray(PdfType0Font.java:921)
	at com.itextpdf.kernel.font.PdfType0Font.getCidFont(PdfType0Font.java:901)
	at com.itextpdf.kernel.font.PdfType0Font.flushFontData(PdfType0Font.java:785)
	at com.itextpdf.kernel.font.PdfType0Font.flush(PdfType0Font.java:696)
	at com.itextpdf.kernel.pdf.PdfDocument.flushFonts(PdfDocument.java:2319)
	at com.itextpdf.kernel.pdf.PdfDocument.close(PdfDocument.java:978)
	at com.itextpdf.layout.Document.close(Document.java:96)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:130)
	... 160 common frames omitted
2025-10-10 16:56:41.618 [http-nio-8080-exec-1] ERROR c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0cce4c9c, method=GET, uri=/api/v1/contracts/20/report, status=500, duration=56728ms
2025-10-10 16:57:28.639 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 16:57:28.643 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 17:04:01.649 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 35424 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 17:04:01.651 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 17:04:04.115 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 17:04:04.269 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@8aafd70
2025-10-10 17:04:04.327 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 17:04:04.347 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 17:04:04.352 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 17:04:04.430 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 17:04:04.433 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 17:04:04.863 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 17:04:06.311 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 17:04:06.365 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 17:04:06.366 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 17:04:06.387 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 17:04:06.388 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 17:04:06.388 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 17:04:06.388 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 17:04:06.388 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 17:04:06.388 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 17:04:06.388 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 17:04:06.417 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 17:04:06.546 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 17:04:06.546 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 17:04:07.010 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 17:04:07.037 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 17:04:07.039 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 17:04:07.043 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 17:04:07.044 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 17:04:07.044 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 17:04:07.072 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 17:04:07.236 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 17:04:07.238 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 17:04:07.239 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 17:04:07.239 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 17:04:07.422 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 17:04:07.429 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 17:04:07.431 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 17:04:07.431 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 17:04:07.431 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 17:04:07.438 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 17:04:07.439 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 17:04:07.463 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 17:04:07.463 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 17:04:07.464 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 17:04:07.464 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 17:04:07.464 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 17:04:07.464 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 17:04:07.464 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 17:04:07.475 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 17:04:07.483 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 17:04:07.495 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 17:04:07.496 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 17:04:07.507 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 17:04:07.507 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 17:04:07.510 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 17:04:07.510 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 17:04:07.511 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 17:04:07.512 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 17:04:07.562 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 17:04:08.028 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 17:04:08.130 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 17:04:08.132 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 17:04:08.161 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 17:04:08.163 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 17:04:08.293 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 17:04:08.502 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 17:04:08.808 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 17:04:08.956 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 17:04:09.065 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 17:04:09.837 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.653 seconds (process running for 8.954)
2025-10-10 17:04:09.844 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 17:04:09.846 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 17:04:09.943 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 17:04:13.427 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 20
2025-10-10 17:04:13.476 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 20
2025-10-10 17:04:13.476 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 17:04:13.540 [http-nio-8080-exec-1] WARN  c.r.L.s.ReportGenerationService - STSong-Light字体加载失败: Cannot embed Type0 font with CID font program based on non-generic predefined CMap., 尝试其他字体
2025-10-10 17:04:13.661 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载中文字体：MSung-Light (UniCNS-UCS2-H编码)
2025-10-10 17:04:13.697 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 17:04:13.697 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 17:04:13.697 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 20
2025-10-10 17:04:13.697 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 20
2025-10-10 17:04:23.119 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租 合同 风险
2025-10-10 17:04:23.121 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 合同 风险, 最大结果数: 10
2025-10-10 17:04:24.310 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 17:04:24.398 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 6 个结果
2025-10-10 17:04:24.399 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 10 个相似文档
2025-10-10 17:04:24.400 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 10 个结果
2025-10-10 17:04:24.400 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 土地租赁合同风险
2025-10-10 17:04:24.401 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 土地租赁合同风险 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 17:04:24.470 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:04:24.470 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 土地租赁合同风险
2025-10-10 17:04:25.371 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 农村土地经营权出租
2025-10-10 17:04:25.371 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 17:04:25.406 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:04:25.407 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 农村土地经营权出租
2025-10-10 17:04:28.498 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 农村土地经营权出租
2025-10-10 17:04:28.499 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 17:04:28.527 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:04:28.527 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 农村土地经营权出租
2025-10-10 17:04:28.695 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 中华人民共和国农村土地承包法, 条文: 第三十六条
2025-10-10 17:04:28.695 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 中华人民共和国农村土地承包法 第三十六条 条文 内容, 最大结果数: 2
2025-10-10 17:04:28.744 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-10 17:04:28.745 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-10 17:04:29.653 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 中华人民共和国农村土地承包法, 条文: 第三十六条
2025-10-10 17:04:29.653 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 中华人民共和国农村土地承包法 第三十六条 条文 内容, 最大结果数: 2
2025-10-10 17:04:29.697 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-10 17:04:29.697 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-10 17:04:29.697 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 中华人民共和国民法典, 条文: 第七百零三条
2025-10-10 17:04:29.697 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 中华人民共和国民法典 第七百零三条 条文 内容, 最大结果数: 2
2025-10-10 17:04:29.726 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-10 17:04:29.727 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-10 17:05:01.092 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 17:05:01.092 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 17:05:01.154 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 1222 字符
2025-10-10 17:05:01.154 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 64 行，开始逐行渲染
2025-10-10 17:05:01.173 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 64, 已处理: 50
2025-10-10 17:05:01.174 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:05:01.193 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 749 字符
2025-10-10 17:05:01.193 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 44 行，开始逐行渲染
2025-10-10 17:05:01.198 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 44, 已处理: 32
2025-10-10 17:05:01.198 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:05:01.199 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 410 字符
2025-10-10 17:05:01.199 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 20 行，开始逐行渲染
2025-10-10 17:05:01.201 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 20, 已处理: 15
2025-10-10 17:05:01.201 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:05:01.202 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 1148 字符
2025-10-10 17:05:01.203 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 55 行，开始逐行渲染
2025-10-10 17:05:01.209 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 55, 已处理: 42
2025-10-10 17:05:01.210 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:05:01.213 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 17:05:01.223 [http-nio-8080-exec-1] ERROR c.r.L.s.ReportGenerationService - PDF报告生成失败，审查ID: 20
java.lang.NullPointerException: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.itextpdf.kernel.font.PdfType0Font.generateWidthsArray(PdfType0Font.java:921)
	at com.itextpdf.kernel.font.PdfType0Font.getCidFont(PdfType0Font.java:901)
	at com.itextpdf.kernel.font.PdfType0Font.flushFontData(PdfType0Font.java:785)
	at com.itextpdf.kernel.font.PdfType0Font.flush(PdfType0Font.java:696)
	at com.itextpdf.kernel.pdf.PdfDocument.flushFonts(PdfDocument.java:2319)
	at com.itextpdf.kernel.pdf.PdfDocument.close(PdfDocument.java:978)
	at com.itextpdf.layout.Document.close(Document.java:96)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:130)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:631)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-10 17:05:01.229 [http-nio-8080-exec-1] ERROR c.r.L.c.ContractReviewController - 生成PDF报告失败，审查ID: 20
java.io.IOException: PDF报告生成失败: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:138)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:631)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.NullPointerException: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.itextpdf.kernel.font.PdfType0Font.generateWidthsArray(PdfType0Font.java:921)
	at com.itextpdf.kernel.font.PdfType0Font.getCidFont(PdfType0Font.java:901)
	at com.itextpdf.kernel.font.PdfType0Font.flushFontData(PdfType0Font.java:785)
	at com.itextpdf.kernel.font.PdfType0Font.flush(PdfType0Font.java:696)
	at com.itextpdf.kernel.pdf.PdfDocument.flushFonts(PdfDocument.java:2319)
	at com.itextpdf.kernel.pdf.PdfDocument.close(PdfDocument.java:978)
	at com.itextpdf.layout.Document.close(Document.java:96)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:130)
	... 160 common frames omitted
2025-10-10 17:05:01.243 [http-nio-8080-exec-1] ERROR c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=5b5a0eeb, method=GET, uri=/api/v1/contracts/20/report, status=500, duration=47846ms
2025-10-10 17:06:18.402 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 17:06:18.405 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 17:12:43.304 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 33696 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 17:12:43.305 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 17:12:45.752 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 17:12:45.912 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5d8112e6
2025-10-10 17:12:45.972 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 17:12:45.997 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 17:12:46.003 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 17:12:46.084 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 17:12:46.086 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 17:12:46.533 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 17:12:47.974 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 17:12:48.039 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 17:12:48.046 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 17:12:48.072 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 17:12:48.072 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 17:12:48.072 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 17:12:48.072 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 17:12:48.072 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 17:12:48.072 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 17:12:48.072 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 17:12:48.106 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 17:12:48.239 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 17:12:48.240 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 17:12:48.682 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 17:12:48.711 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 17:12:48.714 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 17:12:48.718 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 17:12:48.719 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 17:12:48.720 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 17:12:48.754 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 17:12:48.922 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 17:12:48.924 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 17:12:48.925 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 17:12:48.925 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 17:12:49.138 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 17:12:49.150 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 17:12:49.153 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 17:12:49.153 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 17:12:49.153 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 17:12:49.161 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 17:12:49.163 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 17:12:49.188 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 17:12:49.189 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 17:12:49.189 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 17:12:49.189 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 17:12:49.189 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 17:12:49.190 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 17:12:49.190 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 17:12:49.202 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 17:12:49.210 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 17:12:49.227 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 17:12:49.227 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 17:12:49.241 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 17:12:49.241 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 17:12:49.244 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 17:12:49.244 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 17:12:49.246 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 17:12:49.246 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 17:12:49.313 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 17:12:49.789 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 17:12:49.940 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 17:12:49.942 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 17:12:49.977 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 17:12:49.979 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 17:12:50.099 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 17:12:50.309 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 17:12:50.591 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 17:12:50.759 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 17:12:50.868 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 17:12:51.652 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.794 seconds (process running for 9.088)
2025-10-10 17:12:51.657 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 17:12:51.658 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 17:12:51.750 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 17:12:54.641 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 20
2025-10-10 17:12:54.693 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 20
2025-10-10 17:12:54.693 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 17:12:54.757 [http-nio-8080-exec-1] WARN  c.r.L.s.ReportGenerationService - STSong-Light字体加载失败: Cannot embed Type0 font with CID font program based on non-generic predefined CMap., 尝试其他字体
2025-10-10 17:12:54.758 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 跳过MSung-Light字体（繁体中文字体），直接尝试系统字体
2025-10-10 17:12:54.857 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统中文字体：SimSun/SimHei
2025-10-10 17:12:54.893 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 17:12:54.893 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 17:12:54.893 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 20
2025-10-10 17:12:54.894 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 20
2025-10-10 17:13:02.699 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租 法律风险 合同条款
2025-10-10 17:13:02.699 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 法律风险 合同条款, 最大结果数: 10
2025-10-10 17:13:03.694 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 17:13:03.778 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 6 个结果
2025-10-10 17:13:03.779 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 10 个相似文档
2025-10-10 17:13:03.779 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 10 个结果
2025-10-10 17:13:06.544 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 农村土地经营权出租
2025-10-10 17:13:06.546 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 17:13:06.584 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:13:06.584 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 农村土地经营权出租
2025-10-10 17:13:09.064 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 中华人民共和国农村土地承包法, 条文: 第三十六条
2025-10-10 17:13:09.064 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 中华人民共和国农村土地承包法 第三十六条 条文 内容, 最大结果数: 2
2025-10-10 17:13:09.094 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-10 17:13:09.094 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-10 17:14:12.709 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 17:14:12.710 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 17:14:12.802 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 356 字符
2025-10-10 17:14:12.802 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 1 行，开始逐行渲染
2025-10-10 17:14:12.804 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 1, 已处理: 1
2025-10-10 17:14:12.804 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:14:12.827 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 2731 字符
2025-10-10 17:14:12.828 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 1 行，开始逐行渲染
2025-10-10 17:14:12.828 [http-nio-8080-exec-1] WARN  c.r.L.service.MarkdownToPdfRenderer - 处理第 0 行时出错: Range [285, 257) out of bounds for length 2655, 跳过该行
2025-10-10 17:14:12.828 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 1, 已处理: 0
2025-10-10 17:14:12.829 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:14:12.829 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 371 字符
2025-10-10 17:14:12.829 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 1 行，开始逐行渲染
2025-10-10 17:14:12.830 [http-nio-8080-exec-1] WARN  c.r.L.service.MarkdownToPdfRenderer - 处理第 0 行时出错: Range [146, 129) out of bounds for length 344, 跳过该行
2025-10-10 17:14:12.830 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 1, 已处理: 0
2025-10-10 17:14:12.830 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:14:12.831 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 453 字符
2025-10-10 17:14:12.831 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 1 行，开始逐行渲染
2025-10-10 17:14:12.831 [http-nio-8080-exec-1] WARN  c.r.L.service.MarkdownToPdfRenderer - 处理第 0 行时出错: Range [170, 130) out of bounds for length 436, 跳过该行
2025-10-10 17:14:12.831 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 1, 已处理: 0
2025-10-10 17:14:12.831 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:14:12.839 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 17:14:12.872 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 20, 文件大小: 187698 bytes
2025-10-10 17:14:12.873 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 20, 文件大小: 187698 bytes, 文件名: 农村土地经营权出租合同_审查报告_20251010_171412.pdf
2025-10-10 17:14:12.880 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b738d70a, method=GET, uri=/api/v1/contracts/20/report, status=200, duration=78268ms
2025-10-10 17:15:18.440 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 17:15:18.444 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 17:26:59.993 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 28464 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 17:26:59.994 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 17:27:02.688 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 17:27:02.954 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5d8112e6
2025-10-10 17:27:03.018 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 17:27:03.040 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 17:27:03.048 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 17:27:03.133 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 17:27:03.135 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 17:27:03.591 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 17:27:05.125 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 17:27:05.180 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 17:27:05.181 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 17:27:05.203 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 17:27:05.203 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 17:27:05.204 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 17:27:05.204 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 17:27:05.204 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 17:27:05.204 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 17:27:05.204 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 17:27:05.239 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 17:27:05.376 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 17:27:05.377 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 17:27:05.858 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 17:27:05.889 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 17:27:05.891 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 17:27:05.895 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 17:27:05.896 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 17:27:05.897 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 17:27:05.927 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 17:27:06.104 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 17:27:06.106 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 17:27:06.107 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 17:27:06.107 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 17:27:06.302 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 17:27:06.309 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 17:27:06.311 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 17:27:06.312 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 17:27:06.312 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 17:27:06.321 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 17:27:06.321 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 17:27:06.356 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 17:27:06.356 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 17:27:06.356 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 17:27:06.356 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 17:27:06.356 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 17:27:06.357 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 17:27:06.357 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 17:27:06.369 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 17:27:06.378 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 17:27:06.391 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 17:27:06.392 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 17:27:06.403 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 17:27:06.403 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 17:27:06.406 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 17:27:06.406 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 17:27:06.407 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 17:27:06.407 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 17:27:06.472 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 17:27:06.963 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 17:27:07.070 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 17:27:07.072 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 17:27:07.096 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 17:27:07.098 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 17:27:07.220 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 17:27:07.440 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 17:27:07.724 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 17:27:07.879 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 17:27:07.985 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 17:27:08.862 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.333 seconds (process running for 9.653)
2025-10-10 17:27:08.869 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 17:27:08.870 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 17:27:08.968 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 17:27:45.489 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f_农村土地经营权出租合同.docx
2025-10-10 17:27:45.495 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 农村土地经营权出租合同.docx
2025-10-10 17:27:45.554 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 21, 文件: 农村土地经营权出租合同.docx
2025-10-10 17:27:45.564 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 21
2025-10-10 17:27:45.565 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-10 17:27:45.585 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 农村土地经营权出租合同.docx, 路径: F:\LegalAssistant\uploads\contracts\bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f_农村土地经营权出租合同.docx
2025-10-10 17:27:45.586 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 农村土地经营权出租合同.docx, 类型: docx, 大小: 30836 bytes
2025-10-10 17:27:45.593 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=60ccecf8, method=POST, uri=/api/v1/contracts/upload, status=202, duration=171ms
2025-10-10 17:27:45.628 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 21
2025-10-10 17:27:45.632 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 21
2025-10-10 17:27:45.634 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - SSE连接已建立: reviewId=21
2025-10-10 17:27:45.638 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同（四步流程版），审查ID: 21
2025-10-10 17:27:45.638 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=21
2025-10-10 17:27:45.641 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 17:27:45.646 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=777fae2e, method=GET, uri=/api/v1/contracts/21/analyze-async, status=200, duration=22ms
2025-10-10 17:27:46.312 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 农村土地经营权出租合同.docx, 内容长度: 3686 字符
2025-10-10 17:27:46.312 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 农村土地经营权出租合同.docx, 内容长度: 3686
2025-10-10 17:27:46.313 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=21, 文本长度: 3686
2025-10-10 17:27:46.313 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3686 字符
2025-10-10 17:27:46.318 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-10 17:27:46.676 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=21
2025-10-10 17:27:46.678 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 17:27:47.680 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=21
2025-10-10 17:27:47.682 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 17:27:48.691 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=21
2025-10-10 17:27:48.694 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 17:27:49.706 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=21
2025-10-10 17:27:49.709 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 17:27:50.718 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=21
2025-10-10 17:27:50.720 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 17:27:51.732 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=21
2025-10-10 17:27:51.734 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 17:27:52.744 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=21
2025-10-10 17:27:52.746 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 17:27:53.742 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-10 17:27:53.743 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 21, 块数: 403
2025-10-10 17:27:53.744 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 21
2025-10-10 17:27:53.744 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 21
2025-10-10 17:27:53.748 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=21
2025-10-10 17:27:53.749 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 17:27:54.758 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=21
2025-10-10 17:27:54.760 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 3686
2025-10-10 17:27:54.761 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 9秒, reviewId=21
2025-10-10 17:27:54.763 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤1完成：文档解析成功, reviewId=21
2025-10-10 17:27:54.779 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 3686
2025-10-10 17:29:12.529 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-10 17:29:12.532 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤2完成：风险识别成功, reviewId=21
2025-10-10 17:29:12.534 [Async-2] INFO  c.r.L.service.AgentService - 开始分析合同关键条款，内容长度: 3686
2025-10-10 17:29:19.422 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 合同标的
2025-10-10 17:29:19.423 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 合同标的 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 17:29:19.480 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:29:19.480 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 合同标的
2025-10-10 17:29:35.571 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 双方权利义务
2025-10-10 17:29:35.573 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 双方权利义务 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 17:29:35.634 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:29:35.635 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 双方权利义务
2025-10-10 17:29:41.510 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 履行期限
2025-10-10 17:29:41.511 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 履行期限 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 17:29:41.575 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:29:41.576 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 履行期限
2025-10-10 17:29:52.774 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 价款支付
2025-10-10 17:29:52.774 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 价款支付 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 17:29:52.807 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:29:52.807 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 价款支付
2025-10-10 17:30:04.755 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 违约责任
2025-10-10 17:30:04.756 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 违约责任 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 17:30:04.808 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:30:04.808 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 违约责任
2025-10-10 17:30:09.363 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 争议解决
2025-10-10 17:30:09.363 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 争议解决 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 17:30:09.433 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:30:09.434 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 争议解决
2025-10-10 17:30:18.744 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 其他重要条款
2025-10-10 17:30:18.745 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 其他重要条款 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 17:30:18.810 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:30:18.810 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 其他重要条款
2025-10-10 17:31:00.965 [Async-2] INFO  c.r.L.service.AgentService - JSON格式验证成功，包含 7 个关键条款
2025-10-10 17:31:00.965 [Async-2] INFO  c.r.L.service.AgentService - 关键条款分析完成，原始响应长度: 2348, 清理后长度: 2348
2025-10-10 17:31:00.966 [Async-2] INFO  c.r.L.service.ContractReviewService - 关键条款分析成功，识别出 7 个关键条款
2025-10-10 17:31:00.966 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤3完成：条款分析成功, reviewId=21
2025-10-10 17:31:01.005 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤4完成：报告生成并保存成功, reviewId=21
2025-10-10 17:31:01.040 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析流程全部完成, reviewId=21
2025-10-10 17:31:01.053 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=21
2025-10-10 17:31:14.856 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 21
2025-10-10 17:31:14.872 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 21
2025-10-10 17:31:14.872 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 17:31:15.058 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载中文字体：STSong-Light (UniGB-UCS2-H编码, 非嵌入模式)
2025-10-10 17:31:15.111 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 17:31:15.111 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 17:31:15.111 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 21
2025-10-10 17:31:15.112 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 21
2025-10-10 17:31:43.369 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 17:31:43.370 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 17:31:43.438 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 720 字符
2025-10-10 17:31:43.438 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 1 行，开始逐行渲染
2025-10-10 17:31:43.438 [http-nio-8080-exec-4] WARN  c.r.L.service.MarkdownToPdfRenderer - 处理第 0 行时出错: Range [185, 136) out of bounds for length 713, 跳过该行
2025-10-10 17:31:43.438 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 1, 已处理: 0
2025-10-10 17:31:43.439 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:31:43.467 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 944 字符
2025-10-10 17:31:43.467 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 1 行，开始逐行渲染
2025-10-10 17:31:43.469 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 1, 已处理: 1
2025-10-10 17:31:43.470 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:31:43.471 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 769 字符
2025-10-10 17:31:43.471 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 1 行，开始逐行渲染
2025-10-10 17:31:43.471 [http-nio-8080-exec-4] WARN  c.r.L.service.MarkdownToPdfRenderer - 处理第 0 行时出错: Range [221, 170) out of bounds for length 762, 跳过该行
2025-10-10 17:31:43.471 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 1, 已处理: 0
2025-10-10 17:31:43.471 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:31:43.472 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 700 字符
2025-10-10 17:31:43.472 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 1 行，开始逐行渲染
2025-10-10 17:31:43.472 [http-nio-8080-exec-4] WARN  c.r.L.service.MarkdownToPdfRenderer - 处理第 0 行时出错: Range [186, 137) out of bounds for length 693, 跳过该行
2025-10-10 17:31:43.473 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 1, 已处理: 0
2025-10-10 17:31:43.473 [http-nio-8080-exec-4] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:31:43.487 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 17:31:43.495 [http-nio-8080-exec-4] ERROR c.r.L.s.ReportGenerationService - PDF报告生成失败，审查ID: 21
java.lang.NullPointerException: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.itextpdf.kernel.font.PdfType0Font.generateWidthsArray(PdfType0Font.java:921)
	at com.itextpdf.kernel.font.PdfType0Font.getCidFont(PdfType0Font.java:901)
	at com.itextpdf.kernel.font.PdfType0Font.flushFontData(PdfType0Font.java:785)
	at com.itextpdf.kernel.font.PdfType0Font.flush(PdfType0Font.java:696)
	at com.itextpdf.kernel.pdf.PdfDocument.flushFonts(PdfDocument.java:2319)
	at com.itextpdf.kernel.pdf.PdfDocument.close(PdfDocument.java:978)
	at com.itextpdf.layout.Document.close(Document.java:96)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:130)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:631)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-10 17:31:43.502 [http-nio-8080-exec-4] ERROR c.r.L.c.ContractReviewController - 生成PDF报告失败，审查ID: 21
java.io.IOException: PDF报告生成失败: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:138)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:631)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.NullPointerException: Cannot invoke "com.itextpdf.io.font.otf.Glyph.getWidth()" because "glyph" is null
	at com.itextpdf.kernel.font.PdfType0Font.generateWidthsArray(PdfType0Font.java:921)
	at com.itextpdf.kernel.font.PdfType0Font.getCidFont(PdfType0Font.java:901)
	at com.itextpdf.kernel.font.PdfType0Font.flushFontData(PdfType0Font.java:785)
	at com.itextpdf.kernel.font.PdfType0Font.flush(PdfType0Font.java:696)
	at com.itextpdf.kernel.pdf.PdfDocument.flushFonts(PdfDocument.java:2319)
	at com.itextpdf.kernel.pdf.PdfDocument.close(PdfDocument.java:978)
	at com.itextpdf.layout.Document.close(Document.java:96)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:130)
	... 160 common frames omitted
2025-10-10 17:31:43.507 [http-nio-8080-exec-4] ERROR c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=4bfc43ad, method=GET, uri=/api/v1/contracts/21/report, status=500, duration=28653ms
2025-10-10 17:32:14.283 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 17:32:14.287 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 17:54:29.275 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 33908 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 17:54:29.277 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 17:54:31.650 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 17:54:31.799 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@522f74a1
2025-10-10 17:54:31.850 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 17:54:31.871 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 17:54:31.876 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 17:54:31.955 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 17:54:31.957 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 17:54:32.403 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 17:54:33.865 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 17:54:33.915 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 17:54:33.917 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 17:54:33.939 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 17:54:33.940 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 17:54:33.940 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 17:54:33.940 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 17:54:33.940 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 17:54:33.940 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 17:54:33.940 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 17:54:33.970 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 17:54:34.078 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 17:54:34.078 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 17:54:34.539 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 17:54:34.572 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 17:54:34.574 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 17:54:34.578 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 17:54:34.578 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 17:54:34.579 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 17:54:34.612 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 17:54:34.804 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 17:54:34.806 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 17:54:34.807 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 17:54:34.807 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 17:54:34.973 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 17:54:34.987 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 17:54:34.989 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 17:54:34.989 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 17:54:34.990 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 17:54:34.996 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 17:54:34.996 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 17:54:35.019 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 17:54:35.019 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 17:54:35.020 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 17:54:35.020 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 17:54:35.020 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 17:54:35.020 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 17:54:35.020 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 17:54:35.031 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 17:54:35.040 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 17:54:35.051 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 17:54:35.052 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 17:54:35.062 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 17:54:35.063 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 17:54:35.065 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 17:54:35.065 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 17:54:35.066 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 17:54:35.067 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 17:54:35.113 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 17:54:35.496 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 17:54:35.607 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 17:54:35.609 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 17:54:35.630 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 17:54:35.632 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 17:54:35.786 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 17:54:36.004 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 17:54:36.302 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 17:54:36.494 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 17:54:36.653 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 17:54:37.747 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.912 seconds (process running for 9.203)
2025-10-10 17:54:37.756 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 17:54:37.758 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 17:54:37.879 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 17:54:43.508 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 21
2025-10-10 17:54:43.559 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 21
2025-10-10 17:54:43.559 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 17:54:43.646 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 成功从resources目录加载中文字体: fonts/FangZhengFangSong-GBK-1.ttf
2025-10-10 17:54:43.678 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 17:54:43.678 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 17:54:43.678 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 21
2025-10-10 17:54:43.678 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 21
2025-10-10 17:54:50.258 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 农村土地经营权流转
2025-10-10 17:54:50.258 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权流转 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 17:54:50.342 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 农村土地经营权流转
2025-10-10 17:54:50.342 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权流转 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 17:54:51.018 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:54:51.018 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:54:51.019 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 农村土地经营权流转
2025-10-10 17:54:51.019 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 农村土地经营权流转
2025-10-10 17:54:51.129 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 农村土地经营权流转
2025-10-10 17:54:51.130 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权流转 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 17:54:51.133 [ForkJoinPool.commonPool-worker-1] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$3(ReportGenerationService.java:540)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.http.client.log.LoggingHttpClient.execute(LoggingHttpClient.java:48)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 17:54:51.134 [ForkJoinPool.commonPool-worker-2] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$4(ReportGenerationService.java:554)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.http.client.log.LoggingHttpClient.execute(LoggingHttpClient.java:48)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 17:54:51.136 [ForkJoinPool.commonPool-worker-1] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 17:54:51.137 [ForkJoinPool.commonPool-worker-2] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 17:54:51.137 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 17:54:51.137 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 17:54:51.137 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。
2025-10-10 17:54:51.137 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 17:54:51.137 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。, 最大结果数: 3
2025-10-10 17:54:51.139 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。
, 最大结果数: 3
2025-10-10 17:54:51.283 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(0个),尝试LangChain4j向量存储作为补充
2025-10-10 17:54:51.291 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:54:51.291 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 农村土地经营权流转
2025-10-10 17:54:51.304 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:54:51.305 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 17:54:51.305 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。
2025-10-10 17:54:51.306 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 17:54:51.350 [ForkJoinPool.commonPool-worker-3] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$5(ReportGenerationService.java:568)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.http.client.log.LoggingHttpClient.execute(LoggingHttpClient.java:48)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 17:54:51.351 [ForkJoinPool.commonPool-worker-3] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 17:54:51.351 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 17:54:51.351 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。
2025-10-10 17:54:51.351 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。, 最大结果数: 3
2025-10-10 17:54:51.431 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:54:51.431 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。
2025-10-10 17:54:51.444 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:54:51.445 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 17:54:51.445 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。
2025-10-10 17:54:51.445 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 17:54:51.477 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:54:51.477 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。
2025-10-10 17:54:51.489 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 3 个结果
2025-10-10 17:54:51.489 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:54:51.489 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 17:54:51.489 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 17:54:51.490 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。
 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 17:54:51.618 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(0个),尝试LangChain4j向量存储作为补充
2025-10-10 17:54:51.786 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 3 个结果
2025-10-10 17:54:51.787 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 17:54:51.787 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 17:54:57.743 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 17:54:57.743 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 17:54:57.803 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 3140 字符
2025-10-10 17:54:57.803 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 1 行，开始逐行渲染
2025-10-10 17:54:57.849 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 1, 已处理: 1
2025-10-10 17:54:57.849 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:54:57.863 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 12332 字符
2025-10-10 17:54:57.865 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 1 行，开始逐行渲染
2025-10-10 17:54:57.902 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 1, 已处理: 1
2025-10-10 17:54:57.902 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:54:57.902 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 451 字符
2025-10-10 17:54:57.903 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 1 行，开始逐行渲染
2025-10-10 17:54:57.905 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 1, 已处理: 1
2025-10-10 17:54:57.905 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:54:57.906 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - 开始渲染Markdown内容，总长度: 3136 字符
2025-10-10 17:54:57.906 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown分割为 1 行，开始逐行渲染
2025-10-10 17:54:57.924 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown处理完成，总行数: 1, 已处理: 1
2025-10-10 17:54:57.925 [http-nio-8080-exec-1] INFO  c.r.L.service.MarkdownToPdfRenderer - Markdown渲染完成
2025-10-10 17:54:57.930 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 17:54:57.980 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 21, 文件大小: 342971 bytes
2025-10-10 17:54:57.980 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 农村土地经营权出租合同_审查报告_20251010_175457.pdf
2025-10-10 17:54:57.981 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 21, 文件大小: 342971 bytes, 文件名: 农村土地经营权出租合同_审查报告_20251010_175457.pdf
2025-10-10 17:54:57.989 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bc5cadca, method=GET, uri=/api/v1/contracts/21/report, status=200, duration=14507ms
2025-10-10 17:55:40.380 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 17:55:40.384 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 18:03:04.982 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 36604 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 18:03:04.985 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 18:03:07.760 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 18:03:07.907 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5d8112e6
2025-10-10 18:03:07.965 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 18:03:07.986 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 18:03:07.993 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 18:03:08.077 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 18:03:08.079 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 18:03:08.526 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 18:03:10.124 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 18:03:10.183 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 18:03:10.184 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 18:03:10.211 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 18:03:10.211 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 18:03:10.212 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 18:03:10.212 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 18:03:10.212 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 18:03:10.212 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 18:03:10.212 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 18:03:10.254 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 18:03:10.391 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 18:03:10.391 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 18:03:10.987 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 18:03:11.019 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 18:03:11.021 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 18:03:11.026 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 18:03:11.027 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 18:03:11.028 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 18:03:11.060 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 18:03:11.260 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 18:03:11.262 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 18:03:11.263 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 18:03:11.263 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 18:03:11.479 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 18:03:11.488 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 18:03:11.491 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 18:03:11.491 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 18:03:11.491 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 18:03:11.499 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 18:03:11.499 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 18:03:11.528 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 18:03:11.529 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 18:03:11.529 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 18:03:11.529 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 18:03:11.529 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 18:03:11.530 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 18:03:11.530 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 18:03:11.543 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 18:03:11.551 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 18:03:11.565 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 18:03:11.566 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 18:03:11.577 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 18:03:11.577 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 18:03:11.579 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 18:03:11.580 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 18:03:11.581 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 18:03:11.582 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 18:03:11.637 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 18:03:12.106 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 18:03:12.230 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 18:03:12.232 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 18:03:12.257 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 18:03:12.258 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 18:03:12.404 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 18:03:12.662 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 18:03:13.000 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 18:03:13.174 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 18:03:13.281 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 18:03:14.149 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.607 seconds (process running for 9.9)
2025-10-10 18:03:14.156 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 18:03:14.157 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 18:03:14.252 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 18:03:17.866 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 21
2025-10-10 18:03:17.920 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 21
2025-10-10 18:03:17.921 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 18:03:18.034 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统字体: C:/Windows/Fonts/simsun.ttc,0 (宋体优先)
2025-10-10 18:03:18.068 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 18:03:18.068 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 18:03:18.069 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 21
2025-10-10 18:03:18.069 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 21
2025-10-10 18:03:34.037 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 18:03:34.037 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 18:03:34.160 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 18:03:34.215 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 21, 文件大小: 171902 bytes
2025-10-10 18:03:34.215 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 农村土地经营权出租合同_审查报告_20251010_180334.pdf
2025-10-10 18:03:34.215 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 21, 文件大小: 171902 bytes, 文件名: 农村土地经营权出租合同_审查报告_20251010_180334.pdf
2025-10-10 18:03:34.223 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=32927809, method=GET, uri=/api/v1/contracts/21/report, status=200, duration=16387ms
2025-10-10 18:04:53.853 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 18:04:53.856 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 18:13:21.849 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 29092 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 18:13:21.850 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 18:13:24.856 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 18:13:25.024 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5d8112e6
2025-10-10 18:13:25.093 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 18:13:25.116 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 18:13:25.123 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 18:13:25.210 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 18:13:25.214 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 18:13:25.723 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 18:13:27.467 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 18:13:27.527 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 18:13:27.528 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 18:13:27.557 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 18:13:27.557 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 18:13:27.557 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 18:13:27.558 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 18:13:27.558 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 18:13:27.558 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 18:13:27.558 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 18:13:27.591 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 18:13:27.736 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 18:13:27.737 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 18:13:28.243 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 18:13:28.274 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 18:13:28.277 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 18:13:28.281 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 18:13:28.282 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 18:13:28.283 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 18:13:28.315 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 18:13:28.504 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 18:13:28.507 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 18:13:28.508 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 18:13:28.508 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 18:13:28.736 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 18:13:28.744 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 18:13:28.747 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 18:13:28.747 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 18:13:28.747 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 18:13:28.755 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 18:13:28.756 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 18:13:28.782 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 18:13:28.782 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 18:13:28.782 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 18:13:28.783 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 18:13:28.783 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 18:13:28.783 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 18:13:28.783 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 18:13:28.794 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 18:13:28.804 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 18:13:28.817 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 18:13:28.817 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 18:13:28.829 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 18:13:28.829 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 18:13:28.832 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 18:13:28.832 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 18:13:28.834 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 18:13:28.834 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 18:13:28.897 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 18:13:29.398 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 18:13:29.514 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 18:13:29.517 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 18:13:29.554 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 18:13:29.556 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 18:13:29.689 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 18:13:29.928 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 18:13:30.296 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 18:13:30.470 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 18:13:30.579 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 18:13:31.452 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 10.122 seconds (process running for 10.452)
2025-10-10 18:13:31.458 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 18:13:31.460 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 18:13:31.572 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 18:13:37.351 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 21
2025-10-10 18:13:37.404 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 21
2025-10-10 18:13:37.404 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 18:13:37.473 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统字体: C:/Windows/Fonts/STSONG.TTF (华文宋体优先，PDF兼容性最佳)
2025-10-10 18:13:37.521 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 18:13:37.521 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 18:13:37.521 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 21
2025-10-10 18:13:37.522 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 21
2025-10-10 18:13:46.499 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租 法律风险 合规要求
2025-10-10 18:13:46.499 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 法律风险 合规要求, 最大结果数: 10
2025-10-10 18:13:46.876 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租 法律风险 合规要求
2025-10-10 18:13:46.876 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 法律风险 合规要求, 最大结果数: 10
2025-10-10 18:13:47.155 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租 法律风险 合规要求
2025-10-10 18:13:47.155 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 法律风险 合规要求, 最大结果数: 10
2025-10-10 18:13:47.716 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 18:13:47.716 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 18:13:47.716 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 18:13:47.845 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 6 个结果
2025-10-10 18:13:47.845 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 10 个相似文档
2025-10-10 18:13:47.845 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 10 个结果
2025-10-10 18:13:47.850 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 6 个结果
2025-10-10 18:13:47.850 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 10 个相似文档
2025-10-10 18:13:47.851 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 10 个结果
2025-10-10 18:13:47.856 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 6 个结果
2025-10-10 18:13:47.856 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 最终返回 10 个相似文档
2025-10-10 18:13:47.856 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 10 个结果
2025-10-10 18:13:47.912 [ForkJoinPool.commonPool-worker-1] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$3(ReportGenerationService.java:531)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.http.client.log.LoggingHttpClient.execute(LoggingHttpClient.java:48)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 18:13:47.914 [ForkJoinPool.commonPool-worker-1] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 18:13:47.914 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 18:13:47.914 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 18:13:47.916 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。
, 最大结果数: 3
2025-10-10 18:13:47.958 [ForkJoinPool.commonPool-worker-2] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$4(ReportGenerationService.java:550)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.http.client.log.LoggingHttpClient.execute(LoggingHttpClient.java:48)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 18:13:47.959 [ForkJoinPool.commonPool-worker-2] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 18:13:47.959 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 18:13:47.960 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。
2025-10-10 18:13:47.960 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。, 最大结果数: 3
2025-10-10 18:13:48.004 [ForkJoinPool.commonPool-worker-3] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$5(ReportGenerationService.java:568)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.http.client.log.LoggingHttpClient.execute(LoggingHttpClient.java:48)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 18:13:48.006 [ForkJoinPool.commonPool-worker-3] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 18:13:48.007 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 18:13:48.007 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。
2025-10-10 18:13:48.007 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。, 最大结果数: 3
2025-10-10 18:13:48.094 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(0个),尝试LangChain4j向量存储作为补充
2025-10-10 18:13:48.107 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 18:13:48.108 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 18:13:48.108 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。
2025-10-10 18:13:48.108 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 18:13:48.124 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 18:13:48.124 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 18:13:48.124 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。
2025-10-10 18:13:48.124 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 18:13:48.258 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 18:13:48.258 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 请为以下合同生成一个专业的执行摘要，要求：

1. 简洁明了，控制在300-500字内
2. 包括合同性质、主要条款、关键风险点
3. 提供明确的风险等级判断和核心建议
4. 语言专业，适合高管阅读

合同文件: 农村土地经营权出租合同.docx

请基于以上要求生成执行摘要。
2025-10-10 18:13:48.277 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 18:13:48.277 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。
2025-10-10 18:13:48.305 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 3 个结果
2025-10-10 18:13:48.306 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 18:13:48.306 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 18:13:48.306 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 18:13:48.307 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。
 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 18:13:48.448 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(0个),尝试LangChain4j向量存储作为补充
2025-10-10 18:13:48.637 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 3 个结果
2025-10-10 18:13:48.637 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 18:13:48.637 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 18:13:51.666 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 18:13:51.666 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 18:13:51.873 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 18:13:51.921 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 21, 文件大小: 454482 bytes
2025-10-10 18:13:51.922 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 农村土地经营权出租合同_审查报告_20251010_181351.pdf
2025-10-10 18:13:51.922 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 21, 文件大小: 454482 bytes, 文件名: 农村土地经营权出租合同_审查报告_20251010_181351.pdf
2025-10-10 18:13:51.931 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=64fb30c7, method=GET, uri=/api/v1/contracts/21/report, status=200, duration=14611ms
2025-10-10 18:14:41.030 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 18:14:41.038 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 18:25:04.055 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 9600 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 18:25:04.056 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 18:25:06.410 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 18:25:06.540 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@36ec4071
2025-10-10 18:25:06.584 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 18:25:06.604 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 18:25:06.610 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 18:25:06.691 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 18:25:06.694 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 18:25:07.045 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 18:25:08.502 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 18:25:08.553 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 18:25:08.554 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 18:25:08.576 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 18:25:08.577 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 18:25:08.577 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 18:25:08.577 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 18:25:08.577 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 18:25:08.577 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 18:25:08.577 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 18:25:08.606 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 18:25:08.693 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 18:25:08.694 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 18:25:09.231 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 18:25:09.267 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 18:25:09.270 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 18:25:09.274 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 18:25:09.275 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 18:25:09.276 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 18:25:09.311 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 18:25:09.484 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 18:25:09.486 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 18:25:09.487 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 18:25:09.487 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 18:25:09.673 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 18:25:09.681 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 18:25:09.683 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 18:25:09.683 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 18:25:09.684 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 18:25:09.691 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 18:25:09.691 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 18:25:09.715 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 18:25:09.715 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 18:25:09.715 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 18:25:09.716 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 18:25:09.716 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 18:25:09.716 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 18:25:09.716 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 18:25:09.728 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 18:25:09.736 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 18:25:09.749 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 18:25:09.750 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 18:25:09.760 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 18:25:09.760 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 18:25:09.763 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 18:25:09.763 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 18:25:09.764 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 18:25:09.764 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 18:25:09.817 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 18:25:10.213 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 18:25:10.321 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 18:25:10.321 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 18:25:10.344 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 18:25:10.346 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 18:25:10.470 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 18:25:10.678 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 18:25:10.959 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 18:25:11.112 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 18:25:11.202 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 18:25:11.980 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.319 seconds (process running for 8.587)
2025-10-10 18:25:11.986 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 18:25:11.987 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 18:25:12.075 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 18:25:13.996 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 21
2025-10-10 18:25:14.049 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 21
2025-10-10 18:25:14.050 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 18:25:14.104 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统字体: C:/Windows/Fonts/STSONG.TTF (华文宋体优先，PDF兼容性最佳)
2025-10-10 18:25:14.135 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 18:25:14.135 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 18:25:14.135 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 21
2025-10-10 18:25:14.135 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 21
2025-10-10 18:25:22.082 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租合同 法律风险 审查要点
2025-10-10 18:25:22.083 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租合同 法律风险 审查要点, 最大结果数: 5
2025-10-10 18:25:22.805 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 18:25:22.888 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 1 个结果
2025-10-10 18:25:22.889 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 5 个相似文档
2025-10-10 18:25:22.889 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 5 个结果
2025-10-10 18:25:24.921 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 农村土地经营权出租
2025-10-10 18:25:24.921 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 18:25:24.955 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 18:25:24.955 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 农村土地经营权出租
2025-10-10 18:25:28.486 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 农村土地承包法, 条文: 第三十二条
2025-10-10 18:25:28.486 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地承包法 第三十二条 条文 内容, 最大结果数: 2
2025-10-10 18:25:28.534 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-10 18:25:28.534 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-10 18:26:09.060 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 18:26:09.060 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 18:26:09.170 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 18:26:09.216 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 21, 文件大小: 314666 bytes
2025-10-10 18:26:09.216 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 农村土地经营权出租合同分析报告.pdf
2025-10-10 18:26:09.217 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 21, 文件大小: 314666 bytes, 文件名: 农村土地经营权出租合同分析报告.pdf
2025-10-10 18:26:09.225 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=127cfc40, method=GET, uri=/api/v1/contracts/21/report, status=200, duration=55257ms
2025-10-10 18:27:31.643 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 18:27:31.649 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 18:34:14.119 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 22644 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 18:34:14.121 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 18:34:16.483 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 18:34:16.605 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@7ca0b05e
2025-10-10 18:34:16.648 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 18:34:16.670 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 18:34:16.676 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 18:34:16.758 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 18:34:16.760 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 18:34:17.137 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 18:34:18.640 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 18:34:18.689 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 18:34:18.690 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 18:34:18.710 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 18:34:18.711 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 18:34:18.711 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 18:34:18.711 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 18:34:18.711 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 18:34:18.711 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 18:34:18.712 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 18:34:18.740 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 18:34:18.829 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 18:34:18.830 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 18:34:19.276 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 18:34:19.306 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 18:34:19.308 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 18:34:19.311 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 18:34:19.312 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 18:34:19.313 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 18:34:19.345 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 18:34:19.522 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 18:34:19.524 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 18:34:19.524 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 18:34:19.525 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 18:34:19.769 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 18:34:19.776 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 18:34:19.778 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 18:34:19.778 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 18:34:19.779 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 18:34:19.786 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 18:34:19.786 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 18:34:19.810 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 18:34:19.811 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 18:34:19.811 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 18:34:19.811 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 18:34:19.811 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 18:34:19.812 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 18:34:19.812 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 18:34:19.825 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 18:34:19.834 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 18:34:19.846 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 18:34:19.846 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 18:34:19.858 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 18:34:19.858 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 18:34:19.860 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 18:34:19.860 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 18:34:19.861 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 18:34:19.862 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 18:34:19.914 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 18:34:20.321 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 18:34:20.444 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 18:34:20.446 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 18:34:20.471 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 18:34:20.473 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 18:34:20.606 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 18:34:20.827 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 18:34:21.177 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 18:34:21.336 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 18:34:21.433 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 18:34:22.224 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.498 seconds (process running for 8.775)
2025-10-10 18:34:22.230 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 18:34:22.231 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 18:34:22.324 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 18:34:24.986 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 21
2025-10-10 18:34:25.039 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 21
2025-10-10 18:34:25.040 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 18:34:25.097 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统字体: C:/Windows/Fonts/STSONG.TTF (华文宋体优先，PDF兼容性最佳)
2025-10-10 18:34:25.130 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 18:34:25.130 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 18:34:25.130 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 21
2025-10-10 18:34:25.130 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 21
2025-10-10 18:34:35.541 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租合同 法律风险 审查要点
2025-10-10 18:34:35.541 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租合同 法律风险 审查要点, 最大结果数: 5
2025-10-10 18:34:35.942 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 农村土地经营权出租 合同风险 法律要求
2025-10-10 18:34:35.942 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 农村土地经营权出租 合同风险 法律要求, 最大结果数: 5
2025-10-10 18:34:36.282 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 18:34:36.282 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 18:34:36.371 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 1 个结果
2025-10-10 18:34:36.371 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 最终返回 5 个相似文档
2025-10-10 18:34:36.372 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 5 个结果
2025-10-10 18:34:36.377 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 1 个结果
2025-10-10 18:34:36.377 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 5 个相似文档
2025-10-10 18:34:36.377 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 5 个结果
2025-10-10 18:34:36.482 [ForkJoinPool.commonPool-worker-3] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$5(ReportGenerationService.java:545)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 18:34:36.484 [ForkJoinPool.commonPool-worker-3] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 18:34:36.485 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 18:34:36.485 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。
2025-10-10 18:34:36.485 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。, 最大结果数: 3
2025-10-10 18:34:36.519 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 18:34:36.520 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 18:34:36.520 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。
2025-10-10 18:34:36.520 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 18:34:36.531 [ForkJoinPool.commonPool-worker-1] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$3(ReportGenerationService.java:508)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 18:34:36.532 [ForkJoinPool.commonPool-worker-1] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 18:34:36.532 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 18:34:36.533 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 18:34:36.534 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。
, 最大结果数: 3
2025-10-10 18:34:36.554 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 18:34:36.554 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 基于合同分析结果，请提供具体、可操作的改进建议：

1. 合同条款修改建议（具体到条款内容）
2. 风险防范措施（可执行的具体步骤）
3. 谈判要点和策略建议
4. 执行过程中的注意事项
5. 应急预案和替代方案

当前已识别 10 个风险点

请提供专业、实用的改进建议。
2025-10-10 18:34:36.675 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(0个),尝试LangChain4j向量存储作为补充
2025-10-10 18:34:36.845 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 3 个结果
2025-10-10 18:34:36.845 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 18:34:36.846 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 18:34:36.846 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 18:34:36.847 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。
 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 18:34:36.977 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(0个),尝试LangChain4j向量存储作为补充
2025-10-10 18:34:37.142 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 3 个结果
2025-10-10 18:34:37.143 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 18:34:37.143 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 农村土地经营权出租合同.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 17:31:00

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2021—2606 合同编号： 农村土地经营权出租合同 （示范文本） ( 2 ) ( 1 ) 农 业 农 村 部 制定 国家市场监督管理总局 二〇二一年九月 使用说明 一、本合同为示范文本，由农业农村部与国家市场监督管理总局联合制定，供农村土地 （耕地）经营权出租（含转包）的当事人签订合同时参照使用。 二、合同签订前，双方当事人应当仔细阅读本合同内容，特别是其中具有选择性、补充性、填充性、修改性的内容；对合同中的专业用词理解不一致的，可向当地农业农村部门或农村经营管理部门咨询。 三、合同签订前，工商企业等社会资本通过出租取得土地经营权的，应当依法履行资格审查、项目审核和风险防范等相关程序。 四、本合同文本中相关条款后留有空白行，供双方自行约定或者补充约定。双方当事人依法可以对文本条款的内容进行修改、增补或者删减。合同签订生效后 , 未被修改的文本印刷文字视为双方同意内容。 五、双方当事人应当结合具体情况选择本合同协议条款中所提供的选择项，同意的在选择项前的□打√，不同意的打 ×。 六、本合同文本中涉及到的选择、填写内容以手写项为优先。 七、当事人订立合同的，应当在合同书上签字、盖章或者按指印。 八、本合同文本“当事人”部分，自然人填写身份证号码，农村集体经济组织填写农业农村部门赋予的统一社会信用代码，其他市场主体填写市场监督管理部门赋予的统一社会信用代码。 九、本合同编号由县级以上农业农村部门或农村经营管理部门指导乡（镇）人民政府农村土地承包管理部门按统一规则填写。 根据《中华人民共和国民法典》《中华人民共和国农村土地承包法》和《农村土地经营权流转管理办法》等相关法律法规，本着平等、自愿、公平、诚信、有偿的原则，经甲乙双方协商一致，就土地经营权出租事宜，签订本合同。 一、当事人 甲方（出租方）： □社会信用代码 : □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □农村集体经 济组织□公司□其他 : 乙方（承租方）： □社会信用代码： □身份证号码 : 法定代表人（负责人 / 农户代表人）： 身份证号码： 联系地址： 联系电话： 经营主体类型：□自然人 □农村承包经营户 □农民专业合作社 □家庭农场 □公司 □其 他 : 二、租赁物 （一）经自愿协商，甲方将 亩土地经营权（具体见下表及附图）出租给乙方。 序号 村 （组） 地块名称 地块代码 坐落（四至） 面积 （亩） 质量等级 土地类型 承包合同代码 备注 东 南 西 北 1 2 3 （二）出租土地上的附属建筑和资产情况现状描述： 。出租土地上的附属建筑和资产的处置方式描述（可另附件）： 。 三、出租土地用途 出租土地用途为 。 四、租赁期限 租赁期限自 年 月 日起至 年 月 日止。 五、出租土地交付时间 甲方应于 年 月 日前完成土地交付。 六、租金及支付方式 （一）租金标准 双方当事人选择第 种租金标准。 1. 现金。即每亩每年人民币 元（大写： ）。 2. 实物或实物折资计价。即每亩每年 公斤（大写： ）□小麦□玉米□稻谷□其他 : 或者同等实物按照□市场价□国家最低收购价为标准折合成货币。 3. 其他： 。租金变动：根据当地土地流转价格水平，每 年调整一次租金。具体调整方式： 。 （二）租金支付 双方当事人选择第 种方式支付租金。 1. 一次性支付。乙方须于 年 月 日前支付租金 元 （大写： ）。 2. 分期支付。乙方须于每年 月 日前支付（□当 □后一）年租金 元 （大写： ）。 3. 其他： 。 （三）付款方式 双方当事人选择第 种付款方式。 1. 现金 2. 银行汇款 甲方账户名称： 银行账号： 开户行： 3. 其他： 。 七、甲方的权利和义务 （一）甲方的权利 1. 要求乙方按合同约定支付租金； 2. 监督乙方按合同约定的用途依法合理利用和保护出租土地； 3. 制止乙方损害出租土地和农业资源的行为； 4. 租赁期限届满后收回土地经营权； 5. 其他 : 。 （二）甲方的义务 1. 按照合同约定交付出租土地； 2. 合同生效后 日内依据《中华人民共和国农村土地承包法》第三十六条的规定向发包方备案； 3. 不得干涉和妨碍乙方依法进行的农业生产经营活动； 4. 其他 : 。 八、乙方的权利和义务 （一）乙方的权利 1. 要求甲方按照合同约定交付出租土地； 2. 在合同约定的期限内占有农村土地，自主开展农业生产经营并取得收益； 3. 经甲方同意，乙方依法投资改良土壤，建设农业生产附属、配套设施，并有权按照合同约定对其投资部分获得合理补偿； 4. 租赁期限届满，有权在同等条件下优先承租； 5. 其他 : 。 （二）乙方的义务 1. 按照合同约定及时接受出租土地并按照约定向甲方支付租金； 2. 在法律法规政策规定和合同约定允许范围内合理利用出租土地，确保农地农用，符合当地粮食生产等产业规划，不得弃耕抛荒，不得破坏农业综合生产能力和农业生态环境； 3. 依据有关法律法规保护出租土地，禁止改变出租土地的农业用途，禁止占用出租土地建窑、建坟或者擅自在出租土地上建房、挖砂、采石、采矿、取土等，禁止占用出租的永久基本农田发展林果业和挖塘养鱼； 4. 其他 : 。 九、其他约定 （一）甲方同意乙方依法 □投资改良土壤 □建设农业生产附属、配套设施 □以土地经营权融资担保 □再流转土地经营权 □其他 : 。 （二）该出租土地的财政补贴等归属： 。 （三）乙方向 □缴纳 □不缴纳 风险保障金 元（大写： ），合同到期后的处理： 。 （四）本合同期限内，出租土地被依法征收、征用、占用时，有关地上附着物及青苗补偿费的归属： 。 （五）其他事项： 。 十、合同变更、解除和终止 （一）合同有效期间，因不可抗力因素致使合同全部不能履行时，本合同自动终止，甲方将合同终止日至租赁到期日的期限内已收取的租金退还给乙方；致使合同部分不能履行的，其他部分继续履行，租金可以作相应调整。 （二）如乙方在合同期满后需要继续经营该出租土地，必须在合同期满前 日内书面向甲方提出申请。如乙方不再继续经营的，必须在合同期满前 日内书面通知甲方，并在合同期满后 日内将原出租的土地交还给甲方。 （三）合同到期或者未到期由甲方依法提前收回出租土地时，乙方依法投资建设的农业生产附属、配套设施处置方式： □由甲方无偿处置。 □经有资质的第三方评估后，由甲方支付价款购买。 □经双方协商后，由甲方支付价款购买。 □由乙方恢复原状。 □其他 : 。 十一、违约责任 （一）任何一方违约给对方造成损失的，违约方应承担赔偿责任。 （二）甲方应按合同规定按时向乙方交付土地，逾期一日应向乙方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，乙方 有权解除合同，甲方应当赔偿损失。 （三）甲方出租的土地存在权属纠纷或经济纠纷，致使合同全部或部分不能履行的，甲方应当赔偿损失。 （四）甲方违反合同约定擅自干涉和破坏乙方的生产经营 , 致使乙方无法进行正常的生产经营活动的，乙方有权解除合同，甲方应当赔偿损失。 （五）乙方应按照合同规定按时足额向甲方支付租金，逾期一日乙方应向甲方支付年租金的万分之 （大写： ）作为违约金。逾期超过 日，甲方有权解除合同，乙方应当赔偿损失。 （六）乙方擅自改变出租土地的农业用途、弃耕抛荒连续两年以上、给出租土地造成严重损害或者严重破坏土地生态环境的，甲方有权解除合同、收回该土地经营权，并要求乙方赔偿损失。 （七）合同期限届满的，乙方应当按照合同约定将原出租土地交还给甲方，逾期一日应向甲方支付年租金的万分之 （大写： ）作为违约金。 十二、合同争议解决方式 本合同发生争议的，甲乙双方可以协商解决，也可以请求村民委员会、乡（镇）人民政府等调解解决。当事人不愿协商、调解或者协商、调解不成的，可以依据《中华人民共和国农村土地承包法》第五十五条的规定向农村土地承包仲裁委员会申请仲裁，也可以直接向人民法院起诉。 十三、附则 （一）本合同未尽事宜，经甲方、乙方协商一致后可签订补充协议。补充协议与本合同具有同等法律效力。 补充条款（可另附件）： 。 （二）本合同自甲乙双方签字、盖章或者按指印之日起生效。本合同一式 份，由甲方、 乙方、农村集体经济组织、乡（镇）人民政府农村土地承包管理部门、 ，各执一份。 甲方： 乙方： 法定代表人（负责人 / 农户代表人）签字： 法定代表人（负责人 / 农户代表人）签字： 签订时间： 年 月 日 签订时间： 年 月 日签订地点： 签订地点： 附件清单： 序号 附件名称 是否具备 页数 备注 1 甲方、乙方的证件复印件 2 出租土地的权属证明 3 出租土地四至范围附图 4 其他（例如：附属建筑及设施清单、村民会议决议书及公示材料、代办授权委托书和证件复印件等） 共计 份 ， 页 。

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 18:34:42.702 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 18:34:42.702 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 18:34:42.762 [http-nio-8080-exec-1] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用安全回退策略: ─────────────────────────────────────
2025-10-10 18:34:42.782 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - AI分析内容过长(12332 字符)，截取摘要部分
2025-10-10 18:34:42.799 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 改进建议内容过长(3136 字符)，截取摘要部分
2025-10-10 18:34:42.814 [http-nio-8080-exec-1] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用安全回退策略: ─────────────────────────────────────
2025-10-10 18:34:42.821 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 18:34:42.886 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 21, 文件大小: 365321 bytes
2025-10-10 18:34:42.886 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 农村土地经营权出租合同分析报告.pdf
2025-10-10 18:34:42.887 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 21, 文件大小: 365321 bytes, 文件名: 农村土地经营权出租合同分析报告.pdf
2025-10-10 18:34:42.897 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=9105d58b, method=GET, uri=/api/v1/contracts/21/report, status=200, duration=17941ms
2025-10-10 18:37:13.084 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 18:37:13.088 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 20:13:16.076 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 4172 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 20:13:16.078 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 20:13:18.771 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 20:13:18.936 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@36ec4071
2025-10-10 20:13:18.998 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 20:13:19.018 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 20:13:19.024 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 20:13:19.105 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 20:13:19.107 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 20:13:19.580 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 20:13:21.162 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 20:13:21.220 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 20:13:21.222 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 20:13:21.242 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 20:13:21.242 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 20:13:21.242 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 20:13:21.242 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 20:13:21.243 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 20:13:21.243 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 20:13:21.243 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 20:13:21.273 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 20:13:21.410 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 20:13:21.410 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 20:13:21.910 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 20:13:21.938 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 20:13:21.941 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 20:13:21.944 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 20:13:21.945 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 20:13:21.945 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 20:13:21.977 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 20:13:22.151 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 20:13:22.153 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 20:13:22.154 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 20:13:22.154 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 20:13:22.348 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 20:13:22.356 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 20:13:22.358 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 20:13:22.358 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 20:13:22.358 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 20:13:22.365 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 20:13:22.366 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 20:13:22.390 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 20:13:22.390 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 20:13:22.390 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 20:13:22.391 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 20:13:22.391 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 20:13:22.391 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 20:13:22.391 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 20:13:22.402 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 20:13:22.411 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 20:13:22.422 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 20:13:22.422 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 20:13:22.433 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 20:13:22.434 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 20:13:22.436 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 20:13:22.436 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 20:13:22.438 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 20:13:22.438 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 20:13:22.498 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 20:13:23.177 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 20:13:23.310 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 20:13:23.312 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 20:13:23.340 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 20:13:23.342 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 20:13:23.467 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 20:13:23.721 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 20:13:24.044 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 20:13:24.204 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 20:13:24.309 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 20:13:25.198 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.601 seconds (process running for 9.907)
2025-10-10 20:13:25.204 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 20:13:25.205 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 20:13:25.309 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 20:14:13.022 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 20:14:13.028 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 20:14:13.086 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 22, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 20:14:13.097 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 22
2025-10-10 20:14:13.097 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-10 20:14:13.119 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 20:14:13.119 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-10 20:14:13.124 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=df1e263f, method=POST, uri=/api/v1/contracts/upload, status=202, duration=169ms
2025-10-10 20:14:13.153 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 22
2025-10-10 20:14:13.157 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 22
2025-10-10 20:14:13.158 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - SSE连接已建立: reviewId=22
2025-10-10 20:14:13.160 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同（四步流程版），审查ID: 22
2025-10-10 20:14:13.161 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=22
2025-10-10 20:14:13.164 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 20:14:13.168 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f6c81076, method=GET, uri=/api/v1/contracts/22/analyze-async, status=200, duration=18ms
2025-10-10 20:14:13.805 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-10 20:14:13.805 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-10 20:14:13.806 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=22, 文本长度: 7321
2025-10-10 20:14:13.806 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-10 20:14:13.812 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-10 20:14:14.198 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=22
2025-10-10 20:14:14.202 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 20:14:15.208 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=22
2025-10-10 20:14:15.211 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 20:14:16.215 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=22
2025-10-10 20:14:16.216 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 20:14:17.229 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=22
2025-10-10 20:14:17.232 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 20:14:18.241 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=22
2025-10-10 20:14:18.244 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 20:14:19.252 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=22
2025-10-10 20:14:19.254 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 20:14:20.264 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=22
2025-10-10 20:14:20.265 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 20:14:21.275 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=22
2025-10-10 20:14:21.276 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 20:14:22.010 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-10 20:14:22.011 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 22, 块数: 405
2025-10-10 20:14:22.011 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 22
2025-10-10 20:14:22.012 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 22
2025-10-10 20:14:22.285 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=22
2025-10-10 20:14:22.288 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-10 20:14:22.289 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 9秒, reviewId=22
2025-10-10 20:14:22.290 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤1完成：文档解析成功, reviewId=22
2025-10-10 20:14:22.303 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-10 20:15:26.905 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-10 20:15:26.907 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤2完成：风险识别成功, reviewId=22
2025-10-10 20:15:26.909 [Async-2] INFO  c.r.L.service.AgentService - 开始分析合同关键条款，内容长度: 7321
2025-10-10 20:15:37.153 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 标的条款
2025-10-10 20:15:37.154 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 标的条款 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:15:37.378 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:15:37.379 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 标的条款
2025-10-10 20:15:53.895 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 权利义务条款
2025-10-10 20:15:53.895 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 权利义务条款 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:15:54.097 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:15:54.097 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 权利义务条款
2025-10-10 20:16:03.512 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 履行期限条款
2025-10-10 20:16:03.513 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 履行期限条款 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:16:03.572 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:16:03.573 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 履行期限条款
2025-10-10 20:16:22.457 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 价款支付条款
2025-10-10 20:16:22.457 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 价款支付条款 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:16:22.525 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:16:22.525 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 价款支付条款
2025-10-10 20:16:39.967 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 违约责任条款
2025-10-10 20:16:39.968 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 违约责任条款 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:16:39.993 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:16:39.993 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 违约责任条款
2025-10-10 20:16:46.316 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 争议解决条款
2025-10-10 20:16:46.317 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 争议解决条款 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:16:46.426 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:16:46.426 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 争议解决条款
2025-10-10 20:16:56.864 [Async-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 其他重要条款
2025-10-10 20:16:56.864 [Async-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 其他重要条款 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:16:56.967 [Async-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:16:56.968 [Async-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 其他重要条款
2025-10-10 20:17:45.101 [Async-2] INFO  c.r.L.service.AgentService - JSON格式验证成功，包含 7 个关键条款
2025-10-10 20:17:45.102 [Async-2] INFO  c.r.L.service.AgentService - 关键条款分析完成，原始响应长度: 2577, 清理后长度: 2577
2025-10-10 20:17:45.102 [Async-2] INFO  c.r.L.service.ContractReviewService - 关键条款分析成功，识别出 7 个关键条款
2025-10-10 20:17:45.102 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤3完成：条款分析成功, reviewId=22
2025-10-10 20:17:45.126 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤4完成：报告生成并保存成功, reviewId=22
2025-10-10 20:17:45.148 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析流程全部完成, reviewId=22
2025-10-10 20:17:45.157 [http-nio-8080-exec-4] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=22
2025-10-10 20:18:03.134 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 22
2025-10-10 20:18:03.149 [http-nio-8080-exec-7] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 22
2025-10-10 20:18:03.149 [http-nio-8080-exec-7] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 20:18:03.257 [http-nio-8080-exec-7] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统字体: C:/Windows/Fonts/STSONG.TTF (华文宋体优先，PDF兼容性最佳)
2025-10-10 20:18:03.301 [http-nio-8080-exec-7] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 20:18:03.301 [http-nio-8080-exec-7] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 20:18:03.301 [http-nio-8080-exec-7] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 22
2025-10-10 20:18:03.301 [http-nio-8080-exec-7] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 22
2025-10-10 20:18:58.391 [http-nio-8080-exec-7] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】AI深度分析 验证通过，清洗后长度: 2181
2025-10-10 20:18:58.392 [http-nio-8080-exec-7] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】执行摘要 验证通过，清洗后长度: 779
2025-10-10 20:18:58.392 [http-nio-8080-exec-7] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】改进建议 验证通过，清洗后长度: 1040
2025-10-10 20:18:58.393 [http-nio-8080-exec-7] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】风险评估 验证通过，清洗后长度: 1513
2025-10-10 20:18:58.393 [http-nio-8080-exec-7] INFO  c.r.L.util.ReportContentValidator - 【报告完整性验证通过】所有必要内容齐全
2025-10-10 20:18:58.395 [http-nio-8080-exec-7] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 20:18:58.395 [http-nio-8080-exec-7] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 20:18:58.465 [http-nio-8080-exec-7] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用安全回退策略: ─────────────────────────────────────
2025-10-10 20:18:58.498 [http-nio-8080-exec-7] WARN  c.r.L.s.ReportGenerationService - 文本清理导致内容丢失，使用安全回退策略: ─────────────────────────────────────
2025-10-10 20:18:58.506 [http-nio-8080-exec-7] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 20:18:58.554 [http-nio-8080-exec-7] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 22, 文件大小: 378842 bytes
2025-10-10 20:18:58.554 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 20:18:58.554 [http-nio-8080-exec-7] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 22, 文件大小: 378842 bytes, 文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 20:18:58.557 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=02ccae3c, method=GET, uri=/api/v1/contracts/22/report, status=200, duration=55424ms
2025-10-10 20:36:42.103 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 20:36:42.109 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 20:36:57.009 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 15840 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 20:36:57.010 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 20:36:59.185 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 20:36:59.306 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1adec8d
2025-10-10 20:36:59.347 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 20:36:59.368 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 20:36:59.375 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 20:36:59.451 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 20:36:59.453 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 20:36:59.768 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 20:37:01.091 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 20:37:01.139 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 20:37:01.140 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 20:37:01.158 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 20:37:01.158 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 20:37:01.158 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 20:37:01.158 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 20:37:01.158 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 20:37:01.158 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 20:37:01.158 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 20:37:01.184 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 20:37:01.277 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 20:37:01.277 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 20:37:01.684 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 20:37:01.710 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 20:37:01.712 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 20:37:01.715 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 20:37:01.716 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 20:37:01.716 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 20:37:01.743 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 20:37:01.898 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 20:37:01.899 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 20:37:01.900 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 20:37:01.900 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 20:37:02.072 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 20:37:02.078 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 20:37:02.080 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 20:37:02.080 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 20:37:02.080 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 20:37:02.086 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 20:37:02.086 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 20:37:02.108 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 20:37:02.108 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 20:37:02.108 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 20:37:02.108 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 20:37:02.108 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 20:37:02.109 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 20:37:02.109 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 20:37:02.120 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 20:37:02.128 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 20:37:02.139 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 20:37:02.139 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 20:37:02.148 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 20:37:02.148 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 20:37:02.150 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 20:37:02.151 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 20:37:02.153 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 20:37:02.153 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 20:37:02.200 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 20:37:02.589 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 20:37:02.694 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 20:37:02.695 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 20:37:02.721 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 20:37:02.722 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 20:37:02.848 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 20:37:03.039 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 20:37:03.324 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 20:37:03.461 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 20:37:03.550 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 20:37:04.265 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.64 seconds (process running for 7.895)
2025-10-10 20:37:04.271 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 20:37:04.272 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 20:37:04.356 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 20:37:17.842 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 22
2025-10-10 20:37:17.888 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 22
2025-10-10 20:37:17.888 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 20:37:17.962 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统字体: C:/Windows/Fonts/STSONG.TTF (华文宋体优先，PDF兼容性最佳)
2025-10-10 20:37:17.991 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 20:37:17.991 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 20:37:17.991 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 22
2025-10-10 20:37:17.991 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 22
2025-10-10 20:37:25.610 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 危险化学品销售合同
2025-10-10 20:37:25.610 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 20:37:25.789 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 危险化学品销售合同
2025-10-10 20:37:25.789 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:37:25.810 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 危险化学品销售合同
2025-10-10 20:37:25.810 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 20:37:26.338 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:37:26.338 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:37:26.338 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:37:26.338 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 危险化学品销售合同
2025-10-10 20:37:26.338 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 危险化学品销售合同
2025-10-10 20:37:26.338 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 危险化学品销售合同
2025-10-10 20:37:26.423 [ForkJoinPool.commonPool-worker-1] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$3(ReportGenerationService.java:510)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 20:37:26.427 [ForkJoinPool.commonPool-worker-1] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 20:37:26.427 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 20:37:26.428 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 20:17:45

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 20:37:26.429 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 20:17:45

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。
, 最大结果数: 3
2025-10-10 20:37:26.451 [ForkJoinPool.commonPool-worker-3] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$5(ReportGenerationService.java:547)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 20:37:26.452 [ForkJoinPool.commonPool-worker-2] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$4(ReportGenerationService.java:529)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 20:37:26.453 [ForkJoinPool.commonPool-worker-3] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 20:37:26.454 [ForkJoinPool.commonPool-worker-2] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 20:37:26.454 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 20:37:26.454 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 20:37:26.454 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 【重要】请基于合同分析，提供2-3条最关键、最紧急的优先改进建议：

## 要求
1. 每条建议必须具体、可操作
2. 优先级从高到低排列
3. 每条建议包含：
   - 具体问题描述
   - 修改或谈判建议
   - 预期效果

## 示例格式
**第一优先：** [问题] → [建议] → [效果]

当前已识别 10 个风险点，请从中提炼最关键的改进建议。

请直接输出建议内容，使用Markdown格式，不要包含任何提示词或模板标记。
2025-10-10 20:37:26.454 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 【重要】请为以下合同生成一份专业的执行摘要，必须严格包含以下四个部分：

## 1. 合同性质和目的的专业判断
   - 明确合同类型（如买卖合同、服务合同等）
   - 说明合同的主要目的和交易内容

## 2. 整体风险等级结论及理由
   - 给出明确的风险等级（高风险/中等风险/低风险）
   - 说明判断依据和主要风险因素

## 3. 最核心的2-3个风险点提示
   - 列出最重要的风险点
   - 每个风险点需简要说明影响

## 4. 给决策者的核心行动建议
   - 提供明确的行动建议（如"建议立即补充缺失条款后再签署"或"可签署，但需关注履约过程"）
   - 建议应具体、可执行

【格式要求】
- 总字数控制在400-600字
- 语言专业、简洁，面向高管
- 使用Markdown格式，清晰分段
- 不要包含任何提示词、模板标记或AI身份说明

合同文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
已识别风险点: 10 个

请严格按照以上4个部分生成执行摘要，直接输出内容，不要包含任何元信息。
2025-10-10 20:37:26.454 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 【重要】请基于合同分析，提供2-3条最关键、最紧急的优先改进建议：

## 要求
1. 每条建议必须具体、可操作
2. 优先级从高到低排列
3. 每条建议包含：
   - 具体问题描述
   - 修改或谈判建议
   - 预期效果

## 示例格式
**第一优先：** [问题] → [建议] → [效果]

当前已识别 10 个风险点，请从中提炼最关键的改进建议。

请直接输出建议内容，使用Markdown格式，不要包含任何提示词或模板标记。, 最大结果数: 3
2025-10-10 20:37:26.455 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 【重要】请为以下合同生成一份专业的执行摘要，必须严格包含以下四个部分：

## 1. 合同性质和目的的专业判断
   - 明确合同类型（如买卖合同、服务合同等）
   - 说明合同的主要目的和交易内容

## 2. 整体风险等级结论及理由
   - 给出明确的风险等级（高风险/中等风险/低风险）
   - 说明判断依据和主要风险因素

## 3. 最核心的2-3个风险点提示
   - 列出最重要的风险点
   - 每个风险点需简要说明影响

## 4. 给决策者的核心行动建议
   - 提供明确的行动建议（如"建议立即补充缺失条款后再签署"或"可签署，但需关注履约过程"）
   - 建议应具体、可执行

【格式要求】
- 总字数控制在400-600字
- 语言专业、简洁，面向高管
- 使用Markdown格式，清晰分段
- 不要包含任何提示词、模板标记或AI身份说明

合同文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
已识别风险点: 10 个

请严格按照以上4个部分生成执行摘要，直接输出内容，不要包含任何元信息。, 最大结果数: 3
2025-10-10 20:37:26.587 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:37:26.588 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 20:37:26.588 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 20:17:45

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 20:37:26.590 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 20:17:45

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。
 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:37:26.612 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:37:26.612 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 20:37:26.612 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 【重要】请基于合同分析，提供2-3条最关键、最紧急的优先改进建议：

## 要求
1. 每条建议必须具体、可操作
2. 优先级从高到低排列
3. 每条建议包含：
   - 具体问题描述
   - 修改或谈判建议
   - 预期效果

## 示例格式
**第一优先：** [问题] → [建议] → [效果]

当前已识别 10 个风险点，请从中提炼最关键的改进建议。

请直接输出建议内容，使用Markdown格式，不要包含任何提示词或模板标记。
2025-10-10 20:37:26.612 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 【重要】请基于合同分析，提供2-3条最关键、最紧急的优先改进建议：

## 要求
1. 每条建议必须具体、可操作
2. 优先级从高到低排列
3. 每条建议包含：
   - 具体问题描述
   - 修改或谈判建议
   - 预期效果

## 示例格式
**第一优先：** [问题] → [建议] → [效果]

当前已识别 10 个风险点，请从中提炼最关键的改进建议。

请直接输出建议内容，使用Markdown格式，不要包含任何提示词或模板标记。 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:37:26.623 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:37:26.624 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 20:37:26.624 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 【重要】请为以下合同生成一份专业的执行摘要，必须严格包含以下四个部分：

## 1. 合同性质和目的的专业判断
   - 明确合同类型（如买卖合同、服务合同等）
   - 说明合同的主要目的和交易内容

## 2. 整体风险等级结论及理由
   - 给出明确的风险等级（高风险/中等风险/低风险）
   - 说明判断依据和主要风险因素

## 3. 最核心的2-3个风险点提示
   - 列出最重要的风险点
   - 每个风险点需简要说明影响

## 4. 给决策者的核心行动建议
   - 提供明确的行动建议（如"建议立即补充缺失条款后再签署"或"可签署，但需关注履约过程"）
   - 建议应具体、可执行

【格式要求】
- 总字数控制在400-600字
- 语言专业、简洁，面向高管
- 使用Markdown格式，清晰分段
- 不要包含任何提示词、模板标记或AI身份说明

合同文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
已识别风险点: 10 个

请严格按照以上4个部分生成执行摘要，直接输出内容，不要包含任何元信息。
2025-10-10 20:37:26.624 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 【重要】请为以下合同生成一份专业的执行摘要，必须严格包含以下四个部分：

## 1. 合同性质和目的的专业判断
   - 明确合同类型（如买卖合同、服务合同等）
   - 说明合同的主要目的和交易内容

## 2. 整体风险等级结论及理由
   - 给出明确的风险等级（高风险/中等风险/低风险）
   - 说明判断依据和主要风险因素

## 3. 最核心的2-3个风险点提示
   - 列出最重要的风险点
   - 每个风险点需简要说明影响

## 4. 给决策者的核心行动建议
   - 提供明确的行动建议（如"建议立即补充缺失条款后再签署"或"可签署，但需关注履约过程"）
   - 建议应具体、可执行

【格式要求】
- 总字数控制在400-600字
- 语言专业、简洁，面向高管
- 使用Markdown格式，清晰分段
- 不要包含任何提示词、模板标记或AI身份说明

合同文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
已识别风险点: 10 个

请严格按照以上4个部分生成执行摘要，直接输出内容，不要包含任何元信息。 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:37:26.731 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:37:26.731 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 20:17:45

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 20:37:26.751 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:37:26.751 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 【重要】请为以下合同生成一份专业的执行摘要，必须严格包含以下四个部分：

## 1. 合同性质和目的的专业判断
   - 明确合同类型（如买卖合同、服务合同等）
   - 说明合同的主要目的和交易内容

## 2. 整体风险等级结论及理由
   - 给出明确的风险等级（高风险/中等风险/低风险）
   - 说明判断依据和主要风险因素

## 3. 最核心的2-3个风险点提示
   - 列出最重要的风险点
   - 每个风险点需简要说明影响

## 4. 给决策者的核心行动建议
   - 提供明确的行动建议（如"建议立即补充缺失条款后再签署"或"可签署，但需关注履约过程"）
   - 建议应具体、可执行

【格式要求】
- 总字数控制在400-600字
- 语言专业、简洁，面向高管
- 使用Markdown格式，清晰分段
- 不要包含任何提示词、模板标记或AI身份说明

合同文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
已识别风险点: 10 个

请严格按照以上4个部分生成执行摘要，直接输出内容，不要包含任何元信息。
2025-10-10 20:37:26.765 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:37:26.766 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 【重要】请基于合同分析，提供2-3条最关键、最紧急的优先改进建议：

## 要求
1. 每条建议必须具体、可操作
2. 优先级从高到低排列
3. 每条建议包含：
   - 具体问题描述
   - 修改或谈判建议
   - 预期效果

## 示例格式
**第一优先：** [问题] → [建议] → [效果]

当前已识别 10 个风险点，请从中提炼最关键的改进建议。

请直接输出建议内容，使用Markdown格式，不要包含任何提示词或模板标记。
2025-10-10 20:37:46.448 [http-nio-8080-exec-1] ERROR c.r.L.s.ReportGenerationService - DeepSeek增强内容生成失败: null
java.lang.InterruptedException: null
	at java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:386)
	at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2096)
	at com.river.LegalAssistant.service.ReportGenerationService.generateEnhancedContent(ReportGenerationService.java:583)
	at com.river.LegalAssistant.service.ReportGenerationService.generateEnhancedContentWithFallback(ReportGenerationService.java:396)
	at com.river.LegalAssistant.service.ReportGenerationService.generateContractReviewReport(ReportGenerationService.java:94)
	at com.river.LegalAssistant.controller.ContractReviewController.generateReport(ContractReviewController.java:631)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.proceed(AuthorizationManagerBeforeMethodInterceptor.java:269)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.attemptAuthorization(AuthorizationManagerBeforeMethodInterceptor.java:264)
	at org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor.invoke(AuthorizationManagerBeforeMethodInterceptor.java:197)
	at org.springframework.security.config.annotation.method.configuration.DeferringMethodInterceptor.invoke(DeferringMethodInterceptor.java:44)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.controller.ContractReviewController$$SpringCGLIB$$0.generateReport(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-10 20:37:46.451 [http-nio-8080-exec-1] WARN  c.r.L.s.ReportGenerationService - ⚠ 增强内容生成失败，将使用基础报告模式: null
2025-10-10 20:37:46.452 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 20:37:46.536 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 20:37:46.567 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 22, 文件大小: 184152 bytes
2025-10-10 20:37:46.568 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 20:37:46.568 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 22, 文件大小: 184152 bytes, 文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 20:37:46.580 [http-nio-8080-exec-1] ERROR c.r.L.e.GlobalExceptionHandler - 未处理的异常
org.springframework.web.context.request.async.AsyncRequestNotUsableException: ServletOutputStream failed to write: java.nio.channels.ClosedChannelException
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleHttpServletResponse.handleIOException(StandardServletAsyncWebRequest.java:343)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.write(StandardServletAsyncWebRequest.java:401)
	at java.base/java.io.OutputStream.write(OutputStream.java:124)
	at org.springframework.util.StreamUtils.copy(StreamUtils.java:117)
	at org.springframework.http.converter.ByteArrayHttpMessageConverter.writeInternal(ByteArrayHttpMessageConverter.java:67)
	at org.springframework.http.converter.ByteArrayHttpMessageConverter.writeInternal(ByteArrayHttpMessageConverter.java:38)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:300)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.apache.catalina.connector.ClientAbortException: java.nio.channels.ClosedChannelException
	at org.apache.catalina.connector.OutputBuffer.realWriteBytes(OutputBuffer.java:341)
	at org.apache.catalina.connector.OutputBuffer.appendByteArray(OutputBuffer.java:746)
	at org.apache.catalina.connector.OutputBuffer.append(OutputBuffer.java:667)
	at org.apache.catalina.connector.OutputBuffer.writeBytes(OutputBuffer.java:376)
	at org.apache.catalina.connector.OutputBuffer.write(OutputBuffer.java:354)
	at org.apache.catalina.connector.CoyoteOutputStream.write(CoyoteOutputStream.java:103)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.write(OnCommittedResponseWrapper.java:639)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.write(StandardServletAsyncWebRequest.java:398)
	... 149 common frames omitted
Caused by: java.nio.channels.ClosedChannelException: null
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1343)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.writeBlocking(SocketWrapperBase.java:589)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:533)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.doWrite(Http11OutputBuffer.java:548)
	at org.apache.coyote.http11.filters.IdentityOutputFilter.doWrite(IdentityOutputFilter.java:73)
	at org.apache.coyote.http11.Http11OutputBuffer.doWrite(Http11OutputBuffer.java:193)
	at org.apache.coyote.Response.doWrite(Response.java:633)
	at org.apache.catalina.connector.OutputBuffer.realWriteBytes(OutputBuffer.java:329)
	... 156 common frames omitted
2025-10-10 20:37:46.585 [http-nio-8080-exec-1] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.river.LegalAssistant.exception.GlobalExceptionHandler#handleGeneralException(Exception)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.river.LegalAssistant.dto.ApiResponse] with preset Content-Type 'application/pdf;charset=UTF-8'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:319)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:432)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:74)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:175)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1358)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-10 20:37:46.588 [http-nio-8080-exec-1] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.context.request.async.AsyncRequestNotUsableException: ServletOutputStream failed to write: java.nio.channels.ClosedChannelException]
2025-10-10 20:37:46.589 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2179dfc0, method=GET, uri=/api/v1/contracts/22/report, status=200, duration=28773ms
2025-10-10 20:37:48.671 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 20:37:48.674 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 20:45:06.670 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 22108 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 20:45:06.671 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 20:45:08.915 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 20:45:09.036 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@237bdbcb
2025-10-10 20:45:09.080 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 20:45:09.099 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 20:45:09.104 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 20:45:09.177 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 20:45:09.178 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 20:45:09.510 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 20:45:10.825 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 20:45:10.871 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 20:45:10.872 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 20:45:10.897 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 20:45:10.897 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 20:45:10.897 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 20:45:10.897 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 20:45:10.897 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 20:45:10.898 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 20:45:10.898 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 20:45:10.928 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 20:45:11.023 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 20:45:11.023 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 20:45:11.429 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 20:45:11.454 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 20:45:11.456 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 20:45:11.464 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 20:45:11.466 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 20:45:11.467 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 20:45:11.497 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 20:45:11.652 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 20:45:11.654 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 20:45:11.655 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 20:45:11.655 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 20:45:11.832 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 20:45:11.839 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 20:45:11.840 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 20:45:11.841 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 20:45:11.841 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 20:45:11.846 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 20:45:11.848 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 20:45:11.868 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 20:45:11.869 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 20:45:11.869 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 20:45:11.869 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 20:45:11.869 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 20:45:11.870 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 20:45:11.870 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 20:45:11.881 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 20:45:11.889 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 20:45:11.902 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 20:45:11.903 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 20:45:11.913 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 20:45:11.914 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 20:45:11.916 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 20:45:11.916 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 20:45:11.918 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 20:45:11.918 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 20:45:11.966 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 20:45:12.330 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 20:45:12.432 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 20:45:12.433 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 20:45:12.453 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 20:45:12.455 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 20:45:12.581 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 20:45:12.769 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 20:45:13.061 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 20:45:13.212 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 20:45:13.296 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 20:45:13.994 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.714 seconds (process running for 7.978)
2025-10-10 20:45:13.999 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 20:45:14.000 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 20:45:14.102 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 20:45:17.868 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 22
2025-10-10 20:45:17.920 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 22
2025-10-10 20:45:17.921 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 20:45:17.995 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统字体: C:/Windows/Fonts/STSONG.TTF (华文宋体优先，PDF兼容性最佳)
2025-10-10 20:45:18.024 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 20:45:18.025 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 20:45:18.025 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 22
2025-10-10 20:45:18.025 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 22
2025-10-10 20:45:27.374 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 危险化学品销售合同风险
2025-10-10 20:45:27.374 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同风险 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 20:45:28.112 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:45:28.112 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 危险化学品销售合同风险
2025-10-10 20:45:30.534 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 危险化学品安全管理条例, 条文: 38
2025-10-10 20:45:30.534 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品安全管理条例 38 条文 内容, 最大结果数: 2
2025-10-10 20:45:30.534 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 危险化学品安全管理条例, 条文: 第三十八条
2025-10-10 20:45:30.535 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品安全管理条例 第三十八条 条文 内容, 最大结果数: 2
2025-10-10 20:45:30.580 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-10 20:45:30.581 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-10 20:45:30.599 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-10 20:45:30.599 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-10 20:45:30.599 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 危险化学品销售
2025-10-10 20:45:30.599 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 20:45:30.616 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律条文查询工具，法律: 危险化学品安全管理条例, 条文: 第三十八条
2025-10-10 20:45:30.616 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品安全管理条例 第三十八条 条文 内容, 最大结果数: 2
2025-10-10 20:45:30.629 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:45:30.629 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 危险化学品销售
2025-10-10 20:45:30.629 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 危险化学品销售合同 资质要求 法律责任
2025-10-10 20:45:30.630 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同 资质要求 法律责任, 最大结果数: 5
2025-10-10 20:45:30.643 [ForkJoinPool.commonPool-worker-2] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$4(ReportGenerationService.java:526)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 20:45:30.645 [ForkJoinPool.commonPool-worker-2] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 20:45:30.645 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 20:45:30.646 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 【重要】请为以下合同生成一份专业的执行摘要，必须严格包含以下四个部分：

## 1. 合同性质和目的的专业判断
   - 明确合同类型（如买卖合同、服务合同等）
   - 说明合同的主要目的和交易内容

## 2. 整体风险等级结论及理由
   - 给出明确的风险等级（高风险/中等风险/低风险）
   - 说明判断依据和主要风险因素

## 3. 最核心的2-3个风险点提示
   - 列出最重要的风险点
   - 每个风险点需简要说明影响

## 4. 给决策者的核心行动建议
   - 提供明确的行动建议（如"建议立即补充缺失条款后再签署"或"可签署，但需关注履约过程"）
   - 建议应具体、可执行

【格式要求】
- 总字数控制在400-600字
- 语言专业、简洁，面向高管
- 使用Markdown格式，清晰分段
- 不要包含任何提示词、模板标记或AI身份说明

合同文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
已识别风险点: 10 个

请严格按照以上4个部分生成执行摘要，直接输出内容，不要包含任何元信息。
2025-10-10 20:45:30.646 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 【重要】请为以下合同生成一份专业的执行摘要，必须严格包含以下四个部分：

## 1. 合同性质和目的的专业判断
   - 明确合同类型（如买卖合同、服务合同等）
   - 说明合同的主要目的和交易内容

## 2. 整体风险等级结论及理由
   - 给出明确的风险等级（高风险/中等风险/低风险）
   - 说明判断依据和主要风险因素

## 3. 最核心的2-3个风险点提示
   - 列出最重要的风险点
   - 每个风险点需简要说明影响

## 4. 给决策者的核心行动建议
   - 提供明确的行动建议（如"建议立即补充缺失条款后再签署"或"可签署，但需关注履约过程"）
   - 建议应具体、可执行

【格式要求】
- 总字数控制在400-600字
- 语言专业、简洁，面向高管
- 使用Markdown格式，清晰分段
- 不要包含任何提示词、模板标记或AI身份说明

合同文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
已识别风险点: 10 个

请严格按照以上4个部分生成执行摘要，直接输出内容，不要包含任何元信息。, 最大结果数: 3
2025-10-10 20:45:30.647 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 2 个相似文档
2025-10-10 20:45:30.647 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律条文查询完成
2025-10-10 20:45:30.647 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用风险信息搜索工具，风险类型: 危险化学品销售
2025-10-10 20:45:30.647 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 20:45:30.662 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 20:45:30.695 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:45:30.695 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 20:45:30.696 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 【重要】请为以下合同生成一份专业的执行摘要，必须严格包含以下四个部分：

## 1. 合同性质和目的的专业判断
   - 明确合同类型（如买卖合同、服务合同等）
   - 说明合同的主要目的和交易内容

## 2. 整体风险等级结论及理由
   - 给出明确的风险等级（高风险/中等风险/低风险）
   - 说明判断依据和主要风险因素

## 3. 最核心的2-3个风险点提示
   - 列出最重要的风险点
   - 每个风险点需简要说明影响

## 4. 给决策者的核心行动建议
   - 提供明确的行动建议（如"建议立即补充缺失条款后再签署"或"可签署，但需关注履约过程"）
   - 建议应具体、可执行

【格式要求】
- 总字数控制在400-600字
- 语言专业、简洁，面向高管
- 使用Markdown格式，清晰分段
- 不要包含任何提示词、模板标记或AI身份说明

合同文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
已识别风险点: 10 个

请严格按照以上4个部分生成执行摘要，直接输出内容，不要包含任何元信息。
2025-10-10 20:45:30.697 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 【重要】请为以下合同生成一份专业的执行摘要，必须严格包含以下四个部分：

## 1. 合同性质和目的的专业判断
   - 明确合同类型（如买卖合同、服务合同等）
   - 说明合同的主要目的和交易内容

## 2. 整体风险等级结论及理由
   - 给出明确的风险等级（高风险/中等风险/低风险）
   - 说明判断依据和主要风险因素

## 3. 最核心的2-3个风险点提示
   - 列出最重要的风险点
   - 每个风险点需简要说明影响

## 4. 给决策者的核心行动建议
   - 提供明确的行动建议（如"建议立即补充缺失条款后再签署"或"可签署，但需关注履约过程"）
   - 建议应具体、可执行

【格式要求】
- 总字数控制在400-600字
- 语言专业、简洁，面向高管
- 使用Markdown格式，清晰分段
- 不要包含任何提示词、模板标记或AI身份说明

合同文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
已识别风险点: 10 个

请严格按照以上4个部分生成执行摘要，直接输出内容，不要包含任何元信息。 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:45:30.710 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:45:30.711 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 风险信息搜索完成，风险类型: 危险化学品销售
2025-10-10 20:45:30.711 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 危险化学品销售合同 资质审查 法律责任
2025-10-10 20:45:30.711 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同 资质审查 法律责任, 最大结果数: 5
2025-10-10 20:45:30.756 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:45:30.756 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 【重要】请为以下合同生成一份专业的执行摘要，必须严格包含以下四个部分：

## 1. 合同性质和目的的专业判断
   - 明确合同类型（如买卖合同、服务合同等）
   - 说明合同的主要目的和交易内容

## 2. 整体风险等级结论及理由
   - 给出明确的风险等级（高风险/中等风险/低风险）
   - 说明判断依据和主要风险因素

## 3. 最核心的2-3个风险点提示
   - 列出最重要的风险点
   - 每个风险点需简要说明影响

## 4. 给决策者的核心行动建议
   - 提供明确的行动建议（如"建议立即补充缺失条款后再签署"或"可签署，但需关注履约过程"）
   - 建议应具体、可执行

【格式要求】
- 总字数控制在400-600字
- 语言专业、简洁，面向高管
- 使用Markdown格式，清晰分段
- 不要包含任何提示词、模板标记或AI身份说明

合同文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
已识别风险点: 10 个

请严格按照以上4个部分生成执行摘要，直接输出内容，不要包含任何元信息。
2025-10-10 20:45:30.765 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 20:45:30.795 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 1 个结果
2025-10-10 20:45:30.795 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 最终返回 5 个相似文档
2025-10-10 20:45:30.795 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 5 个结果
2025-10-10 20:45:30.838 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 1 个结果
2025-10-10 20:45:30.839 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 5 个相似文档
2025-10-10 20:45:30.839 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 5 个结果
2025-10-10 20:45:30.855 [ForkJoinPool.commonPool-worker-4] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$6(ReportGenerationService.java:554)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 20:45:30.856 [ForkJoinPool.commonPool-worker-4] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 20:45:30.856 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 20:45:30.856 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违法违规可能性）
2. 履约风险（合同执行风险）
3. 财务风险（经济损失可能性）
4. 诉讼风险（争议和纠纷可能性）
5. 监管风险（监管部门处罚风险）

对每类风险请提供：
- 风险等级评估（高/中/低）
- 可能的法律后果
- 防范措施建议

请提供专业、详细的风险评估报告。
2025-10-10 20:45:30.856 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违法违规可能性）
2. 履约风险（合同执行风险）
3. 财务风险（经济损失可能性）
4. 诉讼风险（争议和纠纷可能性）
5. 监管风险（监管部门处罚风险）

对每类风险请提供：
- 风险等级评估（高/中/低）
- 可能的法律后果
- 防范措施建议

请提供专业、详细的风险评估报告。, 最大结果数: 3
2025-10-10 20:45:30.894 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:45:30.894 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 20:45:30.894 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违法违规可能性）
2. 履约风险（合同执行风险）
3. 财务风险（经济损失可能性）
4. 诉讼风险（争议和纠纷可能性）
5. 监管风险（监管部门处罚风险）

对每类风险请提供：
- 风险等级评估（高/中/低）
- 可能的法律后果
- 防范措施建议

请提供专业、详细的风险评估报告。
2025-10-10 20:45:30.895 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违法违规可能性）
2. 履约风险（合同执行风险）
3. 财务风险（经济损失可能性）
4. 诉讼风险（争议和纠纷可能性）
5. 监管风险（监管部门处罚风险）

对每类风险请提供：
- 风险等级评估（高/中/低）
- 可能的法律后果
- 防范措施建议

请提供专业、详细的风险评估报告。 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:45:30.897 [ForkJoinPool.commonPool-worker-1] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$3(ReportGenerationService.java:512)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 20:45:30.899 [ForkJoinPool.commonPool-worker-1] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 20:45:30.899 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 20:45:30.899 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用法律知识库搜索工具，查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 20:17:45

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 20:45:30.901 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 20:17:45

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。
, 最大结果数: 3
2025-10-10 20:45:30.933 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:45:30.934 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: 请对合同进行系统性的法律风险评估：

1. 法律合规风险（违法违规可能性）
2. 履约风险（合同执行风险）
3. 财务风险（经济损失可能性）
4. 诉讼风险（争议和纠纷可能性）
5. 监管风险（监管部门处罚风险）

对每类风险请提供：
- 风险等级评估（高/中/低）
- 可能的法律后果
- 防范措施建议

请提供专业、详细的风险评估报告。
2025-10-10 20:45:31.041 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:45:31.041 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 法律知识库搜索完成，返回 3 个结果
2025-10-10 20:45:31.041 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - Agent调用合同条款分析工具，条款类型: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 20:17:45

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 20:45:31.044 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 20:17:45

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。
 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:45:31.168 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:45:31.169 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.LegalTools - 合同条款分析完成，条款类型: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 20:17:45

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 合同内容
GF—2023—2611 危险化学品生产经营企业自建网站 销售合同（示范文本） 国家市场监督管理总局 中央网信办 ( 制定 )教育部 公安部 应急管理部 国家邮政局 二〇二三年十一月 使用说明 一、本合同文本为示范文本，仅供危险化学品生产经营企业通过本企业网站向其他企业销售危险化学品时参照使用。 二、双方当事人在签约之前应当仔细阅读本合同文本全部内容，结合具体情况确定具有选择性、补充性、填充性、修改性的内容，相应内容以手写项为优先，并承担合同订立、履行所产生的法律后果。 三、当事人可以对本合同文本条款内容进行修改、增补或删除，但不得违反法律、行政法规的强制性规定，不得违背公序良俗。 四、名词解释 1.危险化学品：是指列入《危险化学品目录》，具有毒害、腐蚀、爆炸、燃烧、助燃等性质，对人体、设施、环境具有危害的剧毒化学品和其他化学品。 2.剧毒化学品：是指《危险化学品目录》中备注为“剧毒”，具有剧烈急性毒性危害的化学品，包括人工合成的化学品及其混合物和天然毒素，还包括具有急性毒性易造成公共安全危害的化学品。 3.易制爆危险化学品：是指列入公安部确定、公布的易制爆危险化学品名录，可用于制造爆炸物品的化学品。 4.易制毒化学品：是指国家规定管制的可用于制造毒品的主要原料和化学配剂。易制毒化学品的分类和品种目录，参见《易制毒化学品管理条例》。 五、本合同文本中所列目录、名录如遇国家调整更新的，以更新后的为准。 特别提示 一、对出卖人的提示 （一）出卖人应当具备销售危险化学品的相应资质，并在其网站主页的显著位置持续公示。 （二）出卖人应当在其网站主页的显著位置持续公示买受人购买相关危险化学品应当具备的资质、资格条件。 （三）出卖人销售剧毒化学品、易制爆危险化学品时，应当查验买受人是否持有《危险化学品安全管理条例》第三十八条第一款、第二款规定的相关许可证件或者证明文件，不得向不具有相关许可证件或者证明文件的单位销售剧毒化学品、易制爆危险化学品。对持剧毒化学品购买许可证购买剧毒化学品的，应当按照许可证载明的品种、数量销售。禁止向个人销售剧毒化学品（属于剧毒化学品的农药除外）和易制爆危险化学品。销售属于危险化学品的易制毒化学品时，应当查验买受人是否持有《易制毒化学品管理条例》第十七条、第十八条第一款规定的相关许可证件或者证明文件。 （四）出卖人应当教育、引导和督促从业人员严格遵守相关法律法规和相关规范要求，对买受人尽到安全提示、说明及资质审查义务。 （五）出卖人应当建立健全风险防控机制，积极防范安全事故。 （六）出卖人不得在本企业网站以外的互联网应用服务中发布危险化学品销售信息及建立相关链接。 二、对买受人的提示 （一）危险化学品具有一定的危害性，买受人应当增强对危险化学品交易、使用风险的了解和认知，应当配合出卖人查验其购买资质。 （二）买受人可以在出卖人本企业网站主页的显著位置查询、核实其互联网信息服务经营许可证编号或者备案编号、从事危险化学品活动的合法资质和营业执照等材料。 （三）买受人不得使用现金或者实物进行剧毒化学品、易制爆危险化学品、易制毒化学品交易，但是法律法规另有规定的除外。 合同编号： 危险化学品生产经营企业自建网站销售合同 （示范文本） 甲方（出卖人）： 通讯地址： 联系电话： 经营场所： 邮政编码： 电子邮箱： 互联网信息服务许可或者备案信息： 网站（含APP等）名称和网址： 统一社会信用代码： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 乙方（买受人）： □统一社会信用代码： □住所地： □通讯地址： □经营场所： 联系电话： 邮政编码： 电子邮箱： □危险化学品安全生产许可证书编号： □危险化学品经营许可证书编号： □危险化学品安全使用许可证书编号： 法定代表人： 联系电话： 委托代理人： 联系地址： 联系电话： 开户银行： 账号： 依照《中华人民共和国民法典》《中华人民共和国电子商务法》《危险化学品安全管理条例》及其他相关法律法规的规定，结合危险化学品销售的特点，甲、乙双方在平等、自愿的基础上，经友好协商，就甲方通过本企业网站向乙方销售危险化学品的有关事宜达成以下协议： 第一条 资质 甲、乙方应当为依照中华人民共和国法律法规、依法办理登记注册并领取营业执照及取得其他生产、经营、使用许可并有效存续的法人、非法人组织。 （一）甲方网站应当具备： 1.营业执照以及相关许可证信息； 2.互联网信息服务许可或者备案信息； 3.平台（网站、APP、微信公众号等）名称； 4.经营地址、邮政编码、电话号码、电子邮箱等联系信息； 5.法律法规规定其他应当披露的信息。 甲方应当确保披露的内容清晰、真实、全面、可被识别和易于获取。若上述信息发生任何变更或更新时，应当在十个工作日内完成更新公示。 （二）合同签订前，乙方须向甲方提交： 1.营业执照以及相关许可证信息； 2.依据法律法规规定其购买危险化学品所必需的文件或证明。 乙方主体信息及证明文件发生变更或更新时，乙方应当在十个工作日内将变更情况报送甲方，甲方应当在十个工作日内进行核验，完成更新，乙方对相关信息的真实性负责。 第二条 危险化学品明细 标的物 名称 规格型号 生产 厂家 质量 标准 计量 单位 数量（±【 】‰） 含税单价（元） 含税总价（元） 用途 总金额： 元（人民币大写： ）（其中不含税金额： 元，税率： ，税额： 元）。 说明：生产企业产品技术规格更新时，以交易时生产企业所执行的质量标准为准。新产品以供方生产企业发布的临时产品技术规格为准。如产品为非一等品/合格品/优等品产品，可以参照产品的批次质量证书上的说明或产品交付时的实际检测指标。 第三条 质量要求 （一）甲方交付的产品应当符合质量、安全、健康、环保等方面法律法规和标准的规定。 （二）甲方应当按照约定的质量标准交付标的物。甲方提供有关标的物质量说明的，交付的标的物应当符合该说明的质量要求。 （三）甲方依照乙方的指示向第三人交付标的物，甲方和乙方约定的检验标准与乙方和第三人约定的检验标准不一致的，以甲方和乙方约定的检验标准为准。 （四）其他要求： 。 第四条 付款 双方以约定价格和最终确认的交货数量进行结算。若发生争议，双方首先结算无争议部分货款。 （一）甲方收款信息： 账户名： 开户银行： 收款账号： （二）双方约定按第 项执行： 1.一次性支付：□签约时□交货时□其他： 2.分期付款： 自本合同签订之日起 日内，乙方向甲方支付合同总金额的 %，即 元，作为首付款，余款分 期分别于 支付。 3.赊销： 甲方授予乙方每月赊销额度为 万元，并有权对赊销额度进行调整，但应当提前 日通知乙方。乙方应当在每月 日全额结清赊销欠款。乙方赊欠金额超出赊销额度后，双方按照 协商处理。 （三）双方约定按第 项执行： 1.汇票：使用银行承兑汇票进行支付的，银行承兑汇票支付比例为 。到期银行承兑汇票不能兑付的，甲方可从乙方预付款中扣收等额资金或在资金到位的情况下将票据无条件退还给乙方。 2.银行转账：按照结算方式载明的开户银行及账号支付。 3.国内信用证支付：乙方使用 银行开具的 （即期，远期写明具体时间） 日信用证支付货款，甲方办理信用证业务所发生的相关费用由乙方承担。 4.其他： 。 （四）乙方支付的货款高于甲方实际交货数量的应付货款时，可以： □作为余款使用 □按乙方申请退回 □其他： 。 （五）发票：乙方按照合同约定，结清所有/各期货款和相关费用后 日内，甲方开具销售增值税专用发票。电子发票与纸质发票具有同等法律效力。 第五条 包装 （一）危险化学品包装应当符合《危险化学品安全管理条例》及其他法律法规的规定以及国家标准（GB）、行业标准的要求，与化学品安全技术说明书、化学品安全标签所列的要求一致，包装物、容器的材质以及包装的型式、规格、方法和单件质量（重量），应当与所包装的危险化学品的性质和用途相适应。 （二）甲方应当妥善包装及保管产品，提供的包装应当符合相应运输方式的安全需要，应当防止运输和/或储存过程中发生损坏和污染（包括但不限于潮湿、雨水、生锈、腐蚀和震动）造成的损坏，确保该产品完好无损地到达目的地。 （三）甲方应当在危险化学品包装（包括外包装件）上粘贴或者拴挂与包装内危险化学品相符的化学品安全标签，化学品安全技术说明书和化学品安全标签所载明的内容应当符合国家标准的要求；应当在危险化学品的包装和文件上标记明显的警告；包装箱内应当放置危险化学品的操作及维护手册。 （四）依照法律法规的规定或者按照甲、乙双方的约定，包装物在有效使用年限届满后应予回收的，甲、乙双方共同负有自行或者委托第三人对包装物予以回收的义务，费用由 承担。 第六条 交货 （一）交货方式： □甲方送货：甲方将产品送至双方约定的交货地点，以产品送至交货地点并交付给乙方或者乙方指定的收货人为交付完成。 □乙方自提：由乙方自派运输工具到双方约定的交货地点提货，以货物装入乙方承运工具时为交付完成。 甲、乙双方应当保证送货（提货）承运人具备相应运输资质，不得通过寄递方式送货（提货）。 （二）交货时间： □甲方应当于 年 月 日前，将货物一次性交货完毕。 □甲方应当按照约定时间分 批交货。 （三）交货地点： 。 （四）运输方式： 。 （五）运输过程中可能发生的额外费用由 方承担。 （六）涉及库转业务的，甲、乙双方另行约定。 第七条 所有权及风险转移 （一）甲方送货的，所有权及标的物毁损、灭失的风险自甲方送至交货地点并交付给乙方或者乙方指定的收货人时起转移给乙方。 （二）乙方自提的，所有权和标的物毁损、灭失的风险自货物装入乙方承运工具时转移给乙方。 （三）因乙方原因致使标的物未按照约定的期限交付的，乙方应当自违反约定时起承担标的物毁损、灭失的风险。 （四）甲方未按照约定交付有关标的物的单证和资料的，不影响标的物毁损、灭失风险的转移。 （五）甲方交付的标的物不符合质量要求致使不能实现合同目的，乙方拒绝接受标的物或者解除合同的，标的物毁损、灭失的风险由甲方承担。 第八条 验收 （一）验收期限： □甲方送货： 。 □乙方自提： 。 □其他： 。 （二）数量验收标准： 1.甲、乙双方确认，发货数量和验收数量的计量均以 为准；允差约定为± ‰，超出允差的部分，多退少补。 2.甲、乙双方对交货数量有异议，甲方配送的，应当在卸货前提出；乙方自提的，应当在承运人离开提货点前提出。 3.甲方多交产品的，乙方可以接受或者拒绝接收多交的部分。乙方接受的，按照约定的价格支付价款。乙方拒绝接受的应当立即通知甲方，由甲方负责处理多交的部分；甲方对乙方拒绝接受多交部分的产品，可以请求乙方代为保管，但甲方应当承担乙方代为保管期间的合理费用，代为保管期间非因乙方故意或者重大过失造成的损失由甲方承担。 （三）质量验收： 1.产品的质量以本合同所约定的为准，甲、乙双方应当： □共同封存货样备查。 □其他： 。 2.乙方在接收甲方产品同时，应当及时对产品包装、规格和重量等外观瑕疵进行检验和确认，如认为与合同约定不符，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。 3.乙方对产品的质量有异议，由双方将该产品送往 质检机构进行检验并与封存货样比对，或双方约定按以下方式处理： 。 （四）乙方收货后，对产品的名称、包装、使用说明书、产品合格证、商标或品牌、规格型号、生产厂家产生异议，甲方配送的，应当在卸货前提出；乙方自提的，须在承运人离开提货点前提出。双方应当协商达成解决方案，并以书面方式进行确认。 第九条 保险 （一）承运人责任险由 投保。 （二）货物运输保险由 投保。 （三）其他： 。 第十条 甲、乙双方权利义务 （一）甲方有权要求乙方提供统一社会信用代码、地址、联系方式、行政许可等真实信息，进行核验、登记，建立登记档案。 （二）甲方应当建立危险化学品销售台账，如实记录购买单位的名称、地址、经办人的姓名、身份证号码以及所购买的危险化学品的品种、数量、用途、日期等情况；应当保存销售记录以及经办人的身份证明复印件、相关许可证件复印件或者证明文件，期限不少于1年。甲、乙双方应当在销售、购买剧毒化学品、易制爆化学品后5日内，将所销售、购买的剧毒化学品、易制爆危险化学品的品种、数量以及流向信息报所在地县级人民政府公安机关备案，并输入计算机系统。 （三）甲方应当向乙方提供化学品安全技术说明书、化学品安全标签，如果发生任何修改或更新，上述文件应当及时重新发送；在首次供货的情况下，货物在发运之前必须发送上述文件。 （四）甲方应当保证本合同项下的产品不违反国家对危险化学品的生产、经营、使用的禁止或限制性规定。 （五）甲方应当保证相关工作人员具备相应资格，符合行业标准。 （六）甲方保证产品不侵犯任何第三方的知识产权。 （七）乙方保证知晓本合同项下危险化学品的危险性，熟悉使用、储存危险化学品的方法、程序，拥有法律法规规定的生产、使用、储存危险化学品的设备。乙方有权要求甲方提供危险化学品的包装、储存、标签、使用、危险处理信息。 （八）乙方保证接触、管理危险化学品人员有相关资质，并在认真阅读化学品安全技术说明书后接触危险化学品。 （九）乙方保证所购产品用于本合同第二条载明的用途。 第十一条 违约责任 （一）甲方交付的标的物不符合质量要求，致使不能实现合同目的的，乙方可以拒绝接受或者解除合同；导致乙方或第三方受到损失的，甲方应当承担相应责任。 （二）甲方送货的产品，如乙方无正当理由拒绝接货，乙方应当承担因此而造成的损失、运输及保管费用。 （三）甲方分批交付产品的，甲方对其中一批产品不交付或者交付不符合约定，致使该批产品不能实现合同目的的，乙方可以就该批产品解除。 甲方不交付其中一批产品或者交付不符合约定，致使之后其他各批产品的交付不能实现合同目的的，乙方可以就该批以及之后其他各批产品解除。 乙方如果就其中一批产品解除，该批产品与其他各批产品相互依存的，可以就已经交付和未交付的各批产品解除。 （四）甲方提前或部分交货导致乙方利益受损的，乙方可以拒绝接受；乙方接受的，甲方应当承担因提前或部分交货给乙方增加的费用。 （五）甲方逾期交货的，应当每日按照合同价款的万分之 向乙方支付违约金，但因乙方原因导致的迟延除外；迟延超过 日的，乙方有权解除合同，要求甲方退还已支付的货款并赔偿损失。 （六）乙方逾期付款的，应当每日按照逾期部分价款的万分之 向甲方支付违约金。乙方逾期超过 日，甲方有权解除合同，并要求乙方赔偿损失。 （七）按合同约定由乙方自行提货，但乙方未按规定日期提货的，每迟延一日，应当按照合同价款的万分之 向甲方支付违约金，但因甲方原因导致乙方不能按时提货的除外。迟延超过 日的，甲方有权解除合同，并要求乙方赔偿损失。 （八）任何一方违反本合同的规定，守约方有权要求违约方在 日内纠正违约行为。 第十二条 合同变更、终止 （一）本合同经甲、乙双方协商一致可以变更。 （二）本合同在下列情形下可以终止： 1.甲、乙双方协商一致同意终止的。 2.因国家政策、法律法规等原因应行政机关要求甲方终止服务的。 3.一方违反资质审查、保密、健康安全和环保等规定，致使合同无法履行的。 4. 。 （三）本合同的权利义务关系终止，不影响合同中结算和清理条款的效力。 （四）本合同的终止，并不影响守约方所享有的法律规定的其他任何权利或救济。 第十三条 不可抗力 （一）本合同中，不可抗力是指不能预见、不能避免并不能克服的客观情况。受不可抗力影响的一方应当及时向对方通报不能履行或不能完全履行的理由，以减轻给对方造成的损失，在提供不可抗力证明材料后，允许延期履行、部分履行或者不履行合同，并根据情况可部分或全部免予承担违约责任。 （二）任何一方由于不可抗力的原因不能履行合同的，应当及时通知对方，并在 日内向对方提供发生不可抗力的证明材料。 第十四条 保密义务 （一）一方对于在履行本合同期间所获知的其他方的商业秘密负有保密义务。非经相对方书面同意，不得披露、使用或允许他人使用该保密信息。按照政府有关部门及其工作人员根据法律法规要求提供有关资料或者情况，不视为违反保密义务。 （二）本保密义务不因本合同终止而失效。 第十五条 通知、送达 （一）甲、乙双方因履行本合同而相互发出或者提供的所有通知、文件、资料，均以合同首部所列明的地址、电子邮箱送达。一方如果迁址或者变更电话、电子邮箱，应当书面通知对方，否则一方按照原信息所发送的通知等文件视为送达。 （二）甲、乙双方确认本合同首部所列明的地址、电话的适用范围同样包括在本合同争议进入诉讼/仲裁、执行程序的相关文件和法律文书的送达，除非对方向法院/仲裁机构或执行部门另行提供确定了新的送达方式。 第十六条 法律适用及争议解决 （一）本合同之订立、生效、解释、变更、终止、执行与争议解决均适用中华人民共和国的法律法规。 （二）甲、乙双方因合同内容或因履行本合同发生任何争议，甲、乙双方应当进行友好协商；协商不成的，任何一方均可通过以下第 种方式解决： 1.向 人民法院提起民事诉讼。 2.向 仲裁委员会提起仲裁。 第十七条 附则 （一）本合同自甲、乙双方签名（盖章）之日起成立。 （二）本合同附件为本合同不可分割的组成部分，与本合同具有同等效力。 （三）本合同部分条款的无效或变更不影响其他条款的效力。 （四）双方可以书面形式对本合同进行变更或补充，补充合同与本合同具有同等效力。 （五）本合同一式 份，其中甲方 份，乙方 份，具有同等效力。 第十八条 其他 甲方（签名/盖章）： 乙方（签名/盖章）： 法定代表人： 法定代表人： 委托代理人： 委托代理人： 年 月 日 年 月 日 ( 1 )

请基于以上要求，生成专业、详尽的合同审查报告内容。确保分析的深度和专业性，为企业决策提供有价值的法律支持。

2025-10-10 20:45:59.334 [http-nio-8080-exec-1] WARN  c.r.L.util.ReportContentValidator - 【内容验证失败】AI深度分析 包含无效关键词（如'我无法分析'等），判定为生成失败
2025-10-10 20:45:59.335 [http-nio-8080-exec-1] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】执行摘要 验证通过，清洗后长度: 3782
2025-10-10 20:45:59.336 [http-nio-8080-exec-1] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】改进建议 验证通过，清洗后长度: 1380
2025-10-10 20:45:59.336 [http-nio-8080-exec-1] WARN  c.r.L.util.ReportContentValidator - 【内容验证失败】风险评估 包含无效关键词（如'我无法分析'等），判定为生成失败
2025-10-10 20:45:59.336 [http-nio-8080-exec-1] WARN  c.r.L.s.ReportGenerationService - 【内容验证】AI深度分析内容验证失败，将使用降级方案
2025-10-10 20:45:59.336 [http-nio-8080-exec-1] WARN  c.r.L.util.ReportContentValidator - 【报告完整性验证通过但有警告】发现 1 个警告
2025-10-10 20:45:59.337 [http-nio-8080-exec-1] WARN  c.r.L.util.ReportContentValidator -   - 警告: AI深度分析内容过短（少于200字符），可能生成不完整
2025-10-10 20:45:59.338 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 20:45:59.339 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 20:45:59.466 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 20:45:59.511 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 22, 文件大小: 366609 bytes
2025-10-10 20:45:59.512 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 20:45:59.512 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 22, 文件大小: 366609 bytes, 文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 20:45:59.520 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f519d06a, method=GET, uri=/api/v1/contracts/22/report, status=200, duration=41679ms
2025-10-10 20:48:41.032 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 20:48:41.038 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 20:54:40.988 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 13940 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 20:54:40.989 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 20:54:43.492 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 20:54:43.631 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1c41931a
2025-10-10 20:54:43.674 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 20:54:43.694 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 20:54:43.700 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 20:54:43.882 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 20:54:43.884 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 20:54:44.261 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 20:54:45.752 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 20:54:45.805 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 20:54:45.806 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 20:54:45.828 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 20:54:45.828 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 20:54:45.828 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 20:54:45.829 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 20:54:45.829 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 20:54:45.829 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 20:54:45.829 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 20:54:45.857 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 20:54:45.958 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 20:54:45.958 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 20:54:46.432 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 20:54:46.462 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 20:54:46.464 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 20:54:46.467 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 20:54:46.468 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 20:54:46.469 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 20:54:46.500 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 20:54:46.688 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 20:54:46.691 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 20:54:46.691 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 20:54:46.691 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 20:54:46.897 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 20:54:46.906 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 20:54:46.908 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 20:54:46.908 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 20:54:46.908 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 20:54:46.916 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 20:54:46.916 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 20:54:46.943 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 20:54:46.944 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 20:54:46.944 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 20:54:46.944 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 20:54:46.944 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 20:54:46.944 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 20:54:46.944 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 20:54:46.956 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 20:54:46.964 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 20:54:46.977 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 20:54:46.977 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 20:54:46.988 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 20:54:46.989 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 20:54:46.991 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 20:54:46.992 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 20:54:46.993 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 20:54:46.994 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 20:54:47.072 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 20:54:47.626 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 20:54:47.766 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 20:54:47.772 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 20:54:47.796 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 20:54:47.798 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 20:54:47.925 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 20:54:48.153 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 20:54:48.471 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 20:54:48.702 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 20:54:48.794 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 20:54:49.746 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.209 seconds (process running for 9.494)
2025-10-10 20:54:49.751 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 20:54:49.753 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 20:54:49.845 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 20:54:53.221 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 22
2025-10-10 20:54:53.273 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 22
2025-10-10 20:54:53.273 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 20:54:53.324 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统字体: C:/Windows/Fonts/STSONG.TTF (华文宋体优先，PDF兼容性最佳)
2025-10-10 20:54:53.356 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 20:54:53.356 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 20:54:53.356 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 22
2025-10-10 20:54:53.356 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 22
2025-10-10 20:55:02.844 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 20:55:03.903 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:55:06.326 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售 合同 法律要求, 最大结果数: 5
2025-10-10 20:55:06.358 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 危险化学品销售合同 法律风险 条文 防范措施 建议, 最大结果数: 3
2025-10-10 20:55:06.361 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - Spring AI向量存储结果不足(4个),尝试LangChain4j向量存储作为补充
2025-10-10 20:55:06.393 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:55:06.456 [ForkJoinPool.commonPool-worker-1] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$3(ReportGenerationService.java:512)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 20:55:06.458 [ForkJoinPool.commonPool-worker-1] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 20:55:06.458 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 20:55:06.459 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 20:17:45

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 重要说明
请基于用户提供的合同内容，生成专业、详尽的审查报告。
你可以使用工具搜索相关法律法规和案例，确保分析的深度和专业性，为企业决策提供有价值的法律支持。
, 最大结果数: 3
2025-10-10 20:55:06.544 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:55:06.544 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: /*
 * PDF合同审查报告生成专用提示词模板
 * 用于DeepSeek AI生成专业、详尽的合同分析报告内容
 */

作为一名资深的法律顾问和合同专家，请为以下合同生成专业、详尽的审查报告内容。

## 合同基本信息
- 合同文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
- 风险等级: 中等风险
- 识别风险点数量: 10
- 审查完成时间: 2025-10-10 20:17:45

## 分析要求

### 1. 执行摘要 (Executive Summary)
请提供一个简洁但全面的执行摘要，包括：
- 合同性质和类型的专业判断
- 主要条款的关键要点总结
- 整体风险评估和建议
- 对决策者的核心建议
要求：语言专业、逻辑清晰，控制在300-500字内。

### 2. 深度合同分析 (Deep Contract Analysis)
请从以下维度进行深入分析：

#### 2.1 合同类型和法律性质分析
- 确定合同的具体类型和法律分类
- 分析适用的法律法规框架
- 识别合同的核心法律关系

#### 2.2 关键条款专业解读
- 识别并解析合同中的核心条款
- 分析条款的法律效力和约束力
- 评估条款的公平性和合理性
- 指出可能存在的歧义或漏洞

#### 2.3 法律风险深度评估
- 系统性识别潜在法律风险点
- 评估风险发生的概率和影响程度
- 分析风险的法律后果和责任归属
- 提供风险量化评估（如适用）

#### 2.4 合规性专业检查
- 检查合同是否符合相关法律法规
- 识别可能违反的法律条文
- 评估监管风险和合规要求
- 提出合规性改进建议

#### 2.5 商业影响分析
- 分析合同对各方商业利益的影响
- 评估财务风险和商业风险
- 识别可能的商业机会和威胁
- 提供商业决策支持建议

### 3. 专业改进建议 (Professional Improvement Recommendations)
基于以上分析，请提供：
- 具体的合同条款修改建议
- 风险防范和控制措施
- 谈判策略和要点提示
- 替代方案和应急预案
- 后续执行中的注意事项

## 输出格式要求
- 使用专业、准确的法律术语
- 结构化输出，条理清晰
- 每个建议都要有具体的操作指导
- 避免模糊或不确定的表述
- 提供可行的解决方案

## 重要说明
请基于用户提供的合同内容，生成专业、详尽的审查报告。
你可以使用工具搜索相关法律法规和案例，确保分析的深度和专业性，为企业决策提供有价值的法律支持。
 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:55:06.569 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 从LangChain4j向量存储补充 1 个结果
2025-10-10 20:55:06.570 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 5 个相似文档
2025-10-10 20:55:06.609 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:55:06.628 [ForkJoinPool.commonPool-worker-2] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$4(ReportGenerationService.java:526)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 20:55:06.629 [ForkJoinPool.commonPool-worker-2] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 20:55:06.629 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 20:55:06.629 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 【重要】请为以下合同生成一份专业的执行摘要，必须严格包含以下四个部分：

## 1. 合同性质和目的的专业判断
   - 明确合同类型（如买卖合同、服务合同等）
   - 说明合同的主要目的和交易内容

## 2. 整体风险等级结论及理由
   - 给出明确的风险等级（高风险/中等风险/低风险）
   - 说明判断依据和主要风险因素

## 3. 最核心的2-3个风险点提示
   - 列出最重要的风险点
   - 每个风险点需简要说明影响

## 4. 给决策者的核心行动建议
   - 提供明确的行动建议（如"建议立即补充缺失条款后再签署"或"可签署，但需关注履约过程"）
   - 建议应具体、可执行

【格式要求】
- 总字数控制在400-600字
- 语言专业、简洁，面向高管
- 使用Markdown格式，清晰分段
- 不要包含任何提示词、模板标记或AI身份说明

合同文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
已识别风险点: 10 个

请严格按照以上4个部分生成执行摘要，直接输出内容，不要包含任何元信息。, 最大结果数: 3
2025-10-10 20:55:06.675 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:55:06.675 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 搜索相似文档,查询: 【重要】请为以下合同生成一份专业的执行摘要，必须严格包含以下四个部分：

## 1. 合同性质和目的的专业判断
   - 明确合同类型（如买卖合同、服务合同等）
   - 说明合同的主要目的和交易内容

## 2. 整体风险等级结论及理由
   - 给出明确的风险等级（高风险/中等风险/低风险）
   - 说明判断依据和主要风险因素

## 3. 最核心的2-3个风险点提示
   - 列出最重要的风险点
   - 每个风险点需简要说明影响

## 4. 给决策者的核心行动建议
   - 提供明确的行动建议（如"建议立即补充缺失条款后再签署"或"可签署，但需关注履约过程"）
   - 建议应具体、可执行

【格式要求】
- 总字数控制在400-600字
- 语言专业、简洁，面向高管
- 使用Markdown格式，清晰分段
- 不要包含任何提示词、模板标记或AI身份说明

合同文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
已识别风险点: 10 个

请严格按照以上4个部分生成执行摘要，直接输出内容，不要包含任何元信息。 合同条款 法律规定 标准条款, 最大结果数: 3
2025-10-10 20:55:06.719 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.service.VectorStoreService - 最终返回 3 个相似文档
2025-10-10 20:55:09.766 [http-nio-8080-exec-1] WARN  c.r.L.util.ReportContentValidator - 【内容验证失败】AI深度分析 包含无效关键词（如'我无法分析'等），判定为生成失败
2025-10-10 20:55:09.771 [http-nio-8080-exec-1] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】执行摘要 验证通过，清洗后长度: 3782
2025-10-10 20:55:09.772 [http-nio-8080-exec-1] WARN  c.r.L.util.ReportContentValidator - 【内容验证失败】改进建议 疑似为提示词模板，判定为生成失败
2025-10-10 20:55:09.772 [http-nio-8080-exec-1] WARN  c.r.L.util.ReportContentValidator - 【内容验证失败】风险评估 疑似为提示词模板，判定为生成失败
2025-10-10 20:55:09.772 [http-nio-8080-exec-1] WARN  c.r.L.s.ReportGenerationService - 【内容验证】AI深度分析内容验证失败，将使用降级方案
2025-10-10 20:55:09.773 [http-nio-8080-exec-1] WARN  c.r.L.util.ReportContentValidator - 【报告完整性验证通过但有警告】发现 1 个警告
2025-10-10 20:55:09.773 [http-nio-8080-exec-1] WARN  c.r.L.util.ReportContentValidator -   - 警告: AI深度分析内容过短（少于200字符），可能生成不完整
2025-10-10 20:55:09.777 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 20:55:09.777 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 20:55:09.917 [http-nio-8080-exec-1] WARN  c.r.L.s.ReportGenerationService - 改进建议内容验证失败，包含错误信息，将跳过AI建议部分
2025-10-10 20:55:09.923 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 20:55:09.967 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 22, 文件大小: 336440 bytes
2025-10-10 20:55:09.967 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 20:55:09.968 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 22, 文件大小: 336440 bytes, 文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 20:55:09.976 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b5a701e6, method=GET, uri=/api/v1/contracts/22/report, status=200, duration=16788ms
2025-10-10 20:56:52.053 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 20:56:52.056 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 21:03:50.771 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 11252 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 21:03:50.772 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 21:03:53.318 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 21:03:53.475 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@20d92f1e
2025-10-10 21:03:53.532 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 21:03:53.553 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 21:03:53.560 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 21:03:53.670 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 21:03:53.672 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 21:03:54.123 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 21:03:55.603 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 21:03:55.658 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 21:03:55.660 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 21:03:55.681 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 21:03:55.681 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 21:03:55.682 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 21:03:55.682 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 21:03:55.682 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 21:03:55.682 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 21:03:55.682 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 21:03:55.710 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 21:03:55.849 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 21:03:55.850 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 21:03:56.352 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 21:03:56.380 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 21:03:56.383 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 21:03:56.386 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 21:03:56.387 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 21:03:56.388 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 21:03:56.417 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 21:03:56.578 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 21:03:56.579 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 21:03:56.581 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 21:03:56.581 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 21:03:56.760 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 21:03:56.767 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 21:03:56.769 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 21:03:56.769 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 21:03:56.769 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 21:03:56.777 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 21:03:56.778 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 21:03:56.809 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 21:03:56.809 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 21:03:56.809 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 21:03:56.810 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 21:03:56.810 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 21:03:56.810 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 21:03:56.810 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 21:03:56.822 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 21:03:56.830 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 21:03:56.843 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 21:03:56.843 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 21:03:56.854 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 21:03:56.854 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 21:03:56.857 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 21:03:56.857 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 21:03:56.858 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 21:03:56.859 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 21:03:56.909 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 21:03:57.363 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 21:03:57.465 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 21:03:57.467 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 21:03:57.511 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 21:03:57.514 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 21:03:57.640 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 21:03:57.863 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 21:03:58.163 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 21:03:58.305 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 21:03:58.400 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 21:03:59.185 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.814 seconds (process running for 9.079)
2025-10-10 21:03:59.191 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 21:03:59.192 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 21:03:59.284 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 21:04:02.952 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 22
2025-10-10 21:04:03.025 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 22
2025-10-10 21:04:03.025 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 21:04:03.110 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统字体: C:/Windows/Fonts/STSONG.TTF (华文宋体优先，PDF兼容性最佳)
2025-10-10 21:04:03.150 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 21:04:03.150 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 21:04:03.150 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 22
2025-10-10 21:04:03.152 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 22
2025-10-10 21:04:18.298 [ForkJoinPool.commonPool-worker-4] ERROR c.r.L.service.AgentService - 合同分析处理失败，会话ID: default
dev.langchain4j.exception.InvalidRequestException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapHttpStatusCode(ExceptionMapper.java:71)
	at dev.langchain4j.internal.ExceptionMapper$DefaultExceptionMapper.mapException(ExceptionMapper.java:44)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:31)
	at dev.langchain4j.internal.RetryUtils.lambda$withRetryMappingExceptions$1(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils$RetryPolicy.withRetry(RetryUtils.java:204)
	at dev.langchain4j.internal.RetryUtils.withRetry(RetryUtils.java:259)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:322)
	at dev.langchain4j.internal.RetryUtils.withRetryMappingExceptions(RetryUtils.java:305)
	at dev.langchain4j.model.openai.OpenAiChatModel.doChat(OpenAiChatModel.java:149)
	at dev.langchain4j.model.chat.ChatModel.chat(ChatModel.java:46)
	at dev.langchain4j.service.tool.ToolService.executeInferenceAndToolsLoop(ToolService.java:297)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:383)
	at dev.langchain4j.service.DefaultAiServices$1.invoke(DefaultAiServices.java:227)
	at jdk.proxy2/jdk.proxy2.$Proxy213.analyzeContractMatter(Unknown Source)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:781)
	at com.river.LegalAssistant.service.AgentService.analyzeContractMatter(AgentService.java:527)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:355)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.river.LegalAssistant.service.AgentService$$SpringCGLIB$$0.analyzeContractMatter(<generated>)
	at com.river.LegalAssistant.service.ReportGenerationService.lambda$generateEnhancedContent$6(ReportGenerationService.java:554)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1768)
	at java.base/java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1760)
	at java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:387)
	at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1312)
	at java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1843)
	at java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1808)
	at java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:188)
Caused by: dev.langchain4j.exception.HttpException: {"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
	at dev.langchain4j.http.client.jdk.JdkHttpClient.execute(JdkHttpClient.java:53)
	at dev.langchain4j.model.openai.internal.SyncRequestExecutor.execute(SyncRequestExecutor.java:20)
	at dev.langchain4j.model.openai.internal.RequestExecutor.executeRaw(RequestExecutor.java:44)
	at dev.langchain4j.model.openai.OpenAiChatModel.lambda$doChat$0(OpenAiChatModel.java:150)
	at dev.langchain4j.internal.ExceptionMapper.withExceptionMapper(ExceptionMapper.java:29)
	... 32 common frames omitted
2025-10-10 21:04:18.302 [ForkJoinPool.commonPool-worker-4] WARN  c.r.L.service.AgentService - 合同分析处理失败，尝试降级处理：{"error":{"message":"An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. (insufficient tool messages following tool_calls message)","type":"invalid_request_error","param":null,"code":"invalid_request_error"}}
2025-10-10 21:04:18.303 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.service.AgentService - 使用OLLAMA基础服务进行降级处理
2025-10-10 21:04:33.972 [http-nio-8080-exec-1] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】AI深度分析 验证通过，清洗后长度: 266
2025-10-10 21:04:33.973 [http-nio-8080-exec-1] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】执行摘要 验证通过，清洗后长度: 995
2025-10-10 21:04:33.974 [http-nio-8080-exec-1] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】改进建议 验证通过，清洗后长度: 231
2025-10-10 21:04:33.975 [http-nio-8080-exec-1] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】风险评估 验证通过，清洗后长度: 2981
2025-10-10 21:04:33.975 [http-nio-8080-exec-1] INFO  c.r.L.util.ReportContentValidator - 【报告完整性验证通过】所有必要内容齐全
2025-10-10 21:04:33.977 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 21:04:33.977 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 21:04:34.094 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 风险评估内容过长(2981 字符)，截取摘要部分
2025-10-10 21:04:34.118 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 21:04:34.160 [http-nio-8080-exec-1] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 22, 文件大小: 347177 bytes
2025-10-10 21:04:34.162 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 21:04:34.162 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 22, 文件大小: 347177 bytes, 文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 21:04:34.172 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3a374db9, method=GET, uri=/api/v1/contracts/22/report, status=200, duration=31252ms
2025-10-10 21:05:38.719 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 21:05:38.723 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 21:10:57.127 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 4692 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 21:10:57.129 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 21:11:00.167 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 21:11:00.336 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1443539
2025-10-10 21:11:00.407 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 21:11:00.430 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 21:11:00.437 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 21:11:00.523 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 21:11:00.526 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 21:11:01.073 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 21:11:02.823 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 21:11:02.902 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 21:11:02.904 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 21:11:02.928 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 21:11:02.928 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 21:11:02.928 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 21:11:02.928 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 21:11:02.929 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 21:11:02.929 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 21:11:02.929 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 21:11:02.964 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 21:11:03.114 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 21:11:03.114 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 21:11:03.632 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 21:11:03.666 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 21:11:03.668 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 21:11:03.678 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 21:11:03.680 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 21:11:03.681 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 21:11:03.716 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 21:11:03.907 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 21:11:03.910 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 21:11:03.910 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 21:11:03.911 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 21:11:04.132 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 21:11:04.141 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 21:11:04.144 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 21:11:04.144 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 21:11:04.144 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 21:11:04.152 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 21:11:04.152 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 21:11:04.179 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 21:11:04.179 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 21:11:04.180 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 21:11:04.180 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 21:11:04.180 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 21:11:04.180 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 21:11:04.180 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 21:11:04.194 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 21:11:04.204 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 21:11:04.216 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 21:11:04.217 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 21:11:04.229 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 21:11:04.229 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 21:11:04.232 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 21:11:04.232 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 21:11:04.234 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 21:11:04.234 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 21:11:04.323 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 21:11:04.848 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 21:11:04.967 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 21:11:04.969 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 21:11:04.999 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 21:11:05.000 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 21:11:05.137 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 21:11:05.378 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 21:11:05.741 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 21:11:05.915 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 21:11:06.023 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 21:11:06.951 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 10.302 seconds (process running for 10.597)
2025-10-10 21:11:06.958 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 21:11:06.959 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 21:11:07.074 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 21:11:18.444 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 21:11:18.449 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 21:11:18.485 [http-nio-8080-exec-1] WARN  c.r.L.service.ContractReviewService - 文件哈希 0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b 已存在，返回现有审查记录
2025-10-10 21:11:18.496 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 22
2025-10-10 21:11:18.496 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-10 21:11:18.519 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=08110ac6, method=POST, uri=/api/v1/contracts/upload, status=202, duration=152ms
2025-10-10 21:11:18.526 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 21:11:18.527 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-10 21:11:18.546 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 22
2025-10-10 21:11:18.549 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 22
2025-10-10 21:11:18.551 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - SSE连接已建立: reviewId=22
2025-10-10 21:11:18.553 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同（四步流程版），审查ID: 22
2025-10-10 21:11:18.554 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=22
2025-10-10 21:11:18.559 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-10 21:11:18.560 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=303b65a2, method=GET, uri=/api/v1/contracts/22/analyze-async, status=200, duration=18ms
2025-10-10 21:11:18.560 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同已分析完成，直接返回结果: reviewId=22
2025-10-10 21:11:18.619 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - SSE连接完成: reviewId=22
2025-10-10 21:11:19.302 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-10 21:11:19.302 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-10 21:11:19.302 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=22, 文本长度: 7321
2025-10-10 21:11:19.302 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-10 21:11:19.308 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-10 21:11:28.639 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-10 21:11:28.639 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 22, 块数: 405
2025-10-10 21:11:28.640 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 22
2025-10-10 21:11:28.640 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 22
2025-10-10 21:11:53.221 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 22
2025-10-10 21:11:53.235 [http-nio-8080-exec-5] WARN  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=be98a55f, method=GET, uri=/api/v1/contracts/22/report, status=400, duration=16ms
2025-10-10 21:12:23.146 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 21:12:23.150 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 21:12:39.408 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 12200 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 21:12:39.409 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 21:12:41.642 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 21:12:41.765 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@2faae7f6
2025-10-10 21:12:41.808 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 21:12:41.826 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 21:12:41.832 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 21:12:41.908 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 21:12:41.910 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 21:12:42.241 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 21:12:43.558 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 21:12:43.602 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 21:12:43.604 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 21:12:43.631 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 21:12:43.631 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 21:12:43.631 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 21:12:43.631 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 21:12:43.632 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 21:12:43.632 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 21:12:43.632 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 21:12:43.662 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 21:12:43.753 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 21:12:43.753 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 21:12:44.160 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 21:12:44.186 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 21:12:44.188 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 21:12:44.191 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 21:12:44.192 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 21:12:44.193 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 21:12:44.219 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 21:12:44.379 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 21:12:44.381 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 21:12:44.381 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 21:12:44.381 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 21:12:44.557 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 21:12:44.573 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 21:12:44.576 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 21:12:44.576 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 21:12:44.577 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 21:12:44.583 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 21:12:44.583 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 21:12:44.607 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 21:12:44.607 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 21:12:44.607 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 21:12:44.608 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 21:12:44.608 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 21:12:44.608 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 21:12:44.608 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 21:12:44.622 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 21:12:44.630 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 21:12:44.642 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 21:12:44.644 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 21:12:44.654 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 21:12:44.654 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 21:12:44.656 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 21:12:44.656 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 21:12:44.658 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 21:12:44.658 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 21:12:44.708 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 21:12:45.087 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 21:12:45.184 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 21:12:45.186 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 21:12:45.207 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 21:12:45.209 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 21:12:45.335 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 21:12:45.533 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 21:12:45.822 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 21:12:45.972 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 21:12:46.057 [main] WARN  o.s.b.a.t.ThymeleafAutoConfiguration$DefaultTemplateResolverConfiguration - Cannot find template location: classpath:/templates/ (please add some templates, check your Thymeleaf configuration, or set spring.thymeleaf.check-template-location=false)
2025-10-10 21:12:46.804 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 7.793 seconds (process running for 8.064)
2025-10-10 21:12:46.810 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 21:12:46.811 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 21:12:46.899 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 21:12:52.226 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 21:12:52.230 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 21:12:52.269 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 23, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 21:12:52.277 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 23
2025-10-10 21:12:52.277 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-10 21:12:52.292 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 21:12:52.294 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-10 21:12:52.298 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d29fb4bd, method=POST, uri=/api/v1/contracts/upload, status=202, duration=123ms
2025-10-10 21:12:52.315 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 23
2025-10-10 21:12:52.318 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 23
2025-10-10 21:12:52.318 [http-nio-8080-exec-3] INFO  c.r.L.c.ContractReviewController - SSE连接已建立: reviewId=23
2025-10-10 21:12:52.320 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同（四步流程版），审查ID: 23
2025-10-10 21:12:52.321 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=23
2025-10-10 21:12:52.323 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:12:52.325 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=0a96a5b1, method=GET, uri=/api/v1/contracts/23/analyze-async, status=200, duration=11ms
2025-10-10 21:12:52.736 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-10 21:12:52.736 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-10 21:12:52.737 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=23, 文本长度: 7321
2025-10-10 21:12:52.737 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-10 21:12:52.740 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-10 21:12:53.347 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=23
2025-10-10 21:12:53.349 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:12:54.362 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=23
2025-10-10 21:12:54.363 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:12:55.373 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=23
2025-10-10 21:12:55.375 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:12:56.389 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=23
2025-10-10 21:12:56.392 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:12:57.400 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=23
2025-10-10 21:12:57.402 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:12:58.411 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=23
2025-10-10 21:12:58.413 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:12:59.424 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=23
2025-10-10 21:12:59.426 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:13:00.274 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-10 21:13:00.275 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 23, 块数: 405
2025-10-10 21:13:00.275 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 23
2025-10-10 21:13:00.275 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 23
2025-10-10 21:13:00.442 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=23
2025-10-10 21:13:00.444 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-10 21:13:00.444 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 8秒, reviewId=23
2025-10-10 21:13:00.446 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤1完成：文档解析成功, reviewId=23
2025-10-10 21:13:00.455 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-10 21:14:18.632 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-10 21:14:18.635 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤2完成：风险识别成功, reviewId=23
2025-10-10 21:14:18.637 [Async-2] INFO  c.r.L.service.AgentService - 开始分析合同关键条款，内容长度: 7321
2025-10-10 21:16:15.637 [Async-2] INFO  c.r.L.service.AgentService - JSON格式验证成功，包含 7 个关键条款
2025-10-10 21:16:15.638 [Async-2] INFO  c.r.L.service.AgentService - 关键条款分析完成，原始响应长度: 2378, 清理后长度: 2378
2025-10-10 21:16:15.638 [Async-2] INFO  c.r.L.service.ContractReviewService - 关键条款分析成功，识别出 7 个关键条款
2025-10-10 21:16:15.638 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤3完成：条款分析成功, reviewId=23
2025-10-10 21:16:15.659 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤4完成：分析结果保存成功, reviewId=23
2025-10-10 21:16:15.676 [Async-2] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 23
2025-10-10 21:16:15.677 [Async-2] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 21:16:15.757 [Async-2] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统字体: C:/Windows/Fonts/STSONG.TTF (华文宋体优先，PDF兼容性最佳)
2025-10-10 21:16:15.795 [Async-2] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 21:16:15.795 [Async-2] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 21:16:15.796 [Async-2] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 23
2025-10-10 21:16:15.796 [Async-2] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 23
2025-10-10 21:18:04.840 [Async-2] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】AI深度分析 验证通过，清洗后长度: 4066
2025-10-10 21:18:04.841 [Async-2] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】执行摘要 验证通过，清洗后长度: 1041
2025-10-10 21:18:04.841 [Async-2] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】改进建议 验证通过，清洗后长度: 1623
2025-10-10 21:18:04.841 [Async-2] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】风险评估 验证通过，清洗后长度: 933
2025-10-10 21:18:04.842 [Async-2] INFO  c.r.L.util.ReportContentValidator - 【报告完整性验证通过】所有必要内容齐全
2025-10-10 21:18:04.843 [Async-2] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 21:18:04.844 [Async-2] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 21:18:04.939 [Async-2] INFO  c.r.L.s.ReportGenerationService - AI分析内容过长(4066 字符)，截取摘要部分
2025-10-10 21:18:04.983 [Async-2] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 21:18:05.033 [Async-2] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 23, 文件大小: 420316 bytes
2025-10-10 21:18:05.036 [Async-2] INFO  c.r.L.service.ContractReviewService - PDF报告已保存到文件系统: F:\LegalAssistant\uploads\reports\23_report.pdf
2025-10-10 21:18:05.050 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤5完成：PDF报告生成并保存成功, reviewId=23, 文件大小: 420316 bytes
2025-10-10 21:18:05.063 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析流程全部完成, reviewId=23
2025-10-10 21:18:05.074 [http-nio-8080-exec-2] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=23
2025-10-10 21:18:12.636 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求生成PDF报告，审查ID: 23
2025-10-10 21:18:12.647 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 23
2025-10-10 21:18:12.647 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 21:18:12.647 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统字体: C:/Windows/Fonts/STSONG.TTF (华文宋体优先，PDF兼容性最佳)
2025-10-10 21:18:12.648 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 21:18:12.648 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 21:18:12.648 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 23
2025-10-10 21:18:12.648 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 23
2025-10-10 21:19:14.185 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=64d35503, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=24ms
2025-10-10 21:19:16.944 [http-nio-8080-exec-7] INFO  c.r.L.service.ChatHistoryService - 获取用户 1 的所有会话
2025-10-10 21:19:16.967 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d340561f, method=GET, uri=/api/v1/chat/sessions, status=200, duration=24ms
2025-10-10 21:19:19.281 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=47e75d72, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=6ms
2025-10-10 21:19:24.059 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=48023c48, method=GET, uri=/api/v1/users, status=200, duration=7ms
2025-10-10 21:19:25.157 [http-nio-8080-exec-9] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-10 21:19:25.162 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=1df55542, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=19ms
2025-10-10 21:19:49.511 [http-nio-8080-exec-4] WARN  c.r.L.s.ReportGenerationService - ⚠ 增强内容生成失败，将使用基础报告模式: AI服务调用被中断
2025-10-10 21:19:49.511 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 21:19:49.522 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 21:19:49.539 [http-nio-8080-exec-4] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 23, 文件大小: 192423 bytes
2025-10-10 21:19:49.539 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 21:19:49.539 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - PDF报告生成成功，审查ID: 23, 文件大小: 192423 bytes, 文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 21:19:49.543 [http-nio-8080-exec-4] ERROR c.r.L.e.GlobalExceptionHandler - 未处理的异常
org.springframework.web.context.request.async.AsyncRequestNotUsableException: ServletOutputStream failed to write: java.nio.channels.ClosedChannelException
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleHttpServletResponse.handleIOException(StandardServletAsyncWebRequest.java:343)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.write(StandardServletAsyncWebRequest.java:401)
	at java.base/java.io.OutputStream.write(OutputStream.java:124)
	at org.springframework.util.StreamUtils.copy(StreamUtils.java:117)
	at org.springframework.http.converter.ByteArrayHttpMessageConverter.writeInternal(ByteArrayHttpMessageConverter.java:67)
	at org.springframework.http.converter.ByteArrayHttpMessageConverter.writeInternal(ByteArrayHttpMessageConverter.java:38)
	at org.springframework.http.converter.AbstractHttpMessageConverter.write(AbstractHttpMessageConverter.java:235)
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:300)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.apache.catalina.connector.ClientAbortException: java.nio.channels.ClosedChannelException
	at org.apache.catalina.connector.OutputBuffer.realWriteBytes(OutputBuffer.java:341)
	at org.apache.catalina.connector.OutputBuffer.appendByteArray(OutputBuffer.java:746)
	at org.apache.catalina.connector.OutputBuffer.append(OutputBuffer.java:667)
	at org.apache.catalina.connector.OutputBuffer.writeBytes(OutputBuffer.java:376)
	at org.apache.catalina.connector.OutputBuffer.write(OutputBuffer.java:354)
	at org.apache.catalina.connector.CoyoteOutputStream.write(CoyoteOutputStream.java:103)
	at org.springframework.security.web.util.OnCommittedResponseWrapper$SaveContextServletOutputStream.write(OnCommittedResponseWrapper.java:639)
	at org.springframework.web.context.request.async.StandardServletAsyncWebRequest$LifecycleServletOutputStream.write(StandardServletAsyncWebRequest.java:398)
	... 149 common frames omitted
Caused by: java.nio.channels.ClosedChannelException: null
	at org.apache.tomcat.util.net.NioEndpoint$NioSocketWrapper.doWrite(NioEndpoint.java:1343)
	at org.apache.tomcat.util.net.SocketWrapperBase.doWrite(SocketWrapperBase.java:764)
	at org.apache.tomcat.util.net.SocketWrapperBase.writeBlocking(SocketWrapperBase.java:589)
	at org.apache.tomcat.util.net.SocketWrapperBase.write(SocketWrapperBase.java:533)
	at org.apache.coyote.http11.Http11OutputBuffer$SocketOutputBuffer.doWrite(Http11OutputBuffer.java:548)
	at org.apache.coyote.http11.filters.IdentityOutputFilter.doWrite(IdentityOutputFilter.java:73)
	at org.apache.coyote.http11.Http11OutputBuffer.doWrite(Http11OutputBuffer.java:193)
	at org.apache.coyote.Response.doWrite(Response.java:633)
	at org.apache.catalina.connector.OutputBuffer.realWriteBytes(OutputBuffer.java:329)
	... 156 common frames omitted
2025-10-10 21:19:49.549 [http-nio-8080-exec-4] WARN  o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Failure in @ExceptionHandler com.river.LegalAssistant.exception.GlobalExceptionHandler#handleGeneralException(Exception)
org.springframework.http.converter.HttpMessageNotWritableException: No converter for [class com.river.LegalAssistant.dto.ApiResponse] with preset Content-Type 'application/pdf;charset=UTF-8'
	at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:319)
	at org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor.handleReturnValue(HttpEntityMethodProcessor.java:245)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:432)
	at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:74)
	at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:175)
	at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:80)
	at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1358)
	at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1161)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1106)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RateLimitFilter.doFilter(RateLimitFilter.java:82)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at com.river.LegalAssistant.filter.RequestTrackingFilter.doFilter(RequestTrackingFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
	at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at com.river.LegalAssistant.filter.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:81)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
	at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
	at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
	at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:113)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:384)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-10 21:19:49.553 [http-nio-8080-exec-4] WARN  o.s.w.s.m.s.DefaultHandlerExceptionResolver - Resolved [org.springframework.web.context.request.async.AsyncRequestNotUsableException: ServletOutputStream failed to write: java.nio.channels.ClosedChannelException]
2025-10-10 21:19:49.553 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=85380cd2, method=GET, uri=/api/v1/contracts/23/report, status=200, duration=96918ms
2025-10-10 21:19:51.639 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 21:19:51.643 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 21:53:39.197 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 35660 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 21:53:39.199 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 21:53:41.543 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 21:53:41.666 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3d9cba2
2025-10-10 21:53:41.710 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 21:53:41.728 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 21:53:41.735 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 21:53:41.812 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 21:53:41.814 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 21:53:42.173 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 21:53:43.585 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 21:53:43.634 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 21:53:43.635 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 21:53:43.659 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 21:53:43.659 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 21:53:43.659 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 21:53:43.660 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 21:53:43.660 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 21:53:43.660 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 21:53:43.660 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 21:53:43.696 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 21:53:43.786 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 21:53:43.787 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 21:53:44.244 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 21:53:44.275 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 21:53:44.277 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 21:53:44.281 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 21:53:44.281 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 21:53:44.282 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 21:53:44.311 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 21:53:44.484 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 21:53:44.486 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 21:53:44.486 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 21:53:44.487 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 21:53:44.684 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 21:53:44.692 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 21:53:44.694 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 21:53:44.694 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 21:53:44.695 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 21:53:44.701 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 21:53:44.701 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 21:53:44.726 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 21:53:44.726 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 21:53:44.726 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 21:53:44.727 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 21:53:44.727 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 21:53:44.727 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 21:53:44.727 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 21:53:44.740 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 21:53:44.748 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 21:53:44.761 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 21:53:44.762 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 21:53:44.773 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 21:53:44.774 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 21:53:44.776 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 21:53:44.776 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 21:53:44.778 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 21:53:44.778 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 21:53:44.827 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 21:53:45.221 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 21:53:45.352 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 21:53:45.354 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 21:53:45.375 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 21:53:45.377 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 21:53:45.495 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 21:53:45.695 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 21:53:46.006 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 21:53:46.159 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 21:53:47.083 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 8.296 seconds (process running for 8.613)
2025-10-10 21:53:47.089 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 21:53:47.091 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 21:53:47.190 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 21:53:57.664 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求下载PDF报告，审查ID: 23
2025-10-10 21:53:57.694 [http-nio-8080-exec-1] WARN  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b3bd09de, method=GET, uri=/api/v1/contracts/23/report, status=404, duration=74ms
2025-10-10 21:54:09.323 [http-nio-8080-exec-3] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 21:54:09.325 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 21:54:09.358 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 24, 文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 21:54:09.376 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 24
2025-10-10 21:54:09.376 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-10 21:54:09.388 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 路径: F:\LegalAssistant\uploads\contracts\0b0e8e2a4601b55fa602df155d13f17a9bbcc9dc8b7199b0646500369166ec4b_《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx
2025-10-10 21:54:09.389 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 类型: docx, 大小: 38784 bytes
2025-10-10 21:54:09.392 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=14280284, method=POST, uri=/api/v1/contracts/upload, status=202, duration=99ms
2025-10-10 21:54:09.417 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 24
2025-10-10 21:54:09.419 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 24
2025-10-10 21:54:09.420 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接已建立: reviewId=24
2025-10-10 21:54:09.423 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同（四步流程版），审查ID: 24
2025-10-10 21:54:09.424 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=24
2025-10-10 21:54:09.426 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:54:09.430 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=2fe1162f, method=GET, uri=/api/v1/contracts/24/analyze-async, status=200, duration=16ms
2025-10-10 21:54:10.008 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321 字符
2025-10-10 21:54:10.008 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 《危险化学品生产经营企业自建网站销售合同（示范文本）》.docx, 内容长度: 7321
2025-10-10 21:54:10.009 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=24, 文本长度: 7321
2025-10-10 21:54:10.010 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 7321 字符
2025-10-10 21:54:10.014 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 405 个文本块
2025-10-10 21:54:10.458 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=24
2025-10-10 21:54:10.461 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:54:11.476 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=24
2025-10-10 21:54:11.478 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:54:12.492 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=24
2025-10-10 21:54:12.494 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:54:13.507 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=24
2025-10-10 21:54:13.509 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:54:14.517 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=24
2025-10-10 21:54:14.518 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:54:15.529 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=24
2025-10-10 21:54:15.531 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:54:16.538 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=24
2025-10-10 21:54:16.540 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 21:54:17.342 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，405 个向量块已存储
2025-10-10 21:54:17.342 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 24, 块数: 405
2025-10-10 21:54:17.342 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 24
2025-10-10 21:54:17.342 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 24
2025-10-10 21:54:17.544 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=24
2025-10-10 21:54:17.545 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 7321
2025-10-10 21:54:17.546 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 8秒, reviewId=24
2025-10-10 21:54:17.547 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤1完成：文档解析成功, reviewId=24
2025-10-10 21:54:17.554 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 7321
2025-10-10 21:55:38.315 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-10 21:55:38.321 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤2完成：风险识别成功, reviewId=24
2025-10-10 21:55:38.322 [Async-2] INFO  c.r.L.service.AgentService - 开始分析合同关键条款，内容长度: 7321
2025-10-10 21:57:36.395 [Async-2] INFO  c.r.L.service.AgentService - JSON格式验证成功，包含 7 个关键条款
2025-10-10 21:57:36.396 [Async-2] INFO  c.r.L.service.AgentService - 关键条款分析完成，原始响应长度: 2381, 清理后长度: 2381
2025-10-10 21:57:36.396 [Async-2] INFO  c.r.L.service.ContractReviewService - 关键条款分析成功，识别出 7 个关键条款
2025-10-10 21:57:36.396 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤3完成：条款分析成功, reviewId=24
2025-10-10 21:57:36.427 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤4完成：分析结果保存成功, reviewId=24
2025-10-10 21:57:36.452 [Async-2] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 24
2025-10-10 21:57:36.452 [Async-2] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 21:57:36.529 [Async-2] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统字体: C:/Windows/Fonts/STSONG.TTF (华文宋体优先，PDF兼容性最佳)
2025-10-10 21:57:36.569 [Async-2] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 21:57:36.569 [Async-2] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 21:57:36.570 [Async-2] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 24
2025-10-10 21:57:36.570 [Async-2] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容，审查ID: 24
2025-10-10 21:59:25.193 [Async-2] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】AI深度分析 验证通过，清洗后长度: 4052
2025-10-10 21:59:25.193 [Async-2] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】执行摘要 验证通过，清洗后长度: 956
2025-10-10 21:59:25.194 [Async-2] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】改进建议 验证通过，清洗后长度: 1825
2025-10-10 21:59:25.195 [Async-2] INFO  c.r.L.util.ReportContentValidator - 【内容验证成功】风险评估 验证通过，清洗后长度: 1022
2025-10-10 21:59:25.195 [Async-2] INFO  c.r.L.util.ReportContentValidator - 【报告完整性验证通过】所有必要内容齐全
2025-10-10 21:59:25.197 [Async-2] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 21:59:25.197 [Async-2] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 21:59:25.280 [Async-2] INFO  c.r.L.s.ReportGenerationService - AI分析内容过长(4052 字符)，截取摘要部分
2025-10-10 21:59:25.322 [Async-2] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 21:59:25.376 [Async-2] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 24, 文件大小: 416942 bytes
2025-10-10 21:59:25.379 [Async-2] INFO  c.r.L.service.ContractReviewService - PDF报告已保存到文件系统: F:\LegalAssistant\uploads\reports\24_report.pdf
2025-10-10 21:59:25.393 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤5完成：PDF报告生成并保存成功, reviewId=24, 文件大小: 416942 bytes
2025-10-10 21:59:25.407 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析流程全部完成, reviewId=24
2025-10-10 21:59:25.417 [http-nio-8080-exec-7] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=24
2025-10-10 22:00:35.452 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求下载PDF报告，审查ID: 24
2025-10-10 22:00:35.469 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 从缓存读取PDF报告，审查ID: 24, 文件大小: 416942 bytes
2025-10-10 22:00:35.469 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 22:00:35.470 [http-nio-8080-exec-4] INFO  c.r.L.c.ContractReviewController - PDF报告准备下载 [缓存]，审查ID: 24, 文件大小: 416942 bytes, 文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 22:00:35.474 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=f348c778, method=GET, uri=/api/v1/contracts/24/report, status=200, duration=23ms
2025-10-10 22:00:53.778 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求下载PDF报告，审查ID: 24
2025-10-10 22:00:53.783 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 从缓存读取PDF报告，审查ID: 24, 文件大小: 416942 bytes
2025-10-10 22:00:53.784 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 22:00:53.784 [http-nio-8080-exec-8] INFO  c.r.L.c.ContractReviewController - PDF报告准备下载 [缓存]，审查ID: 24, 文件大小: 416942 bytes, 文件名: 《危险化学品生产经营企业自建网站销售合同（示范文本）》分析报告.pdf
2025-10-10 22:00:53.785 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3b7b281a, method=GET, uri=/api/v1/contracts/24/report, status=200, duration=8ms
2025-10-10 22:01:03.296 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 22:01:03.299 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 22:13:21.735 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 29464 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 22:13:21.736 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 22:13:24.280 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 22:13:24.488 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@6c167296
2025-10-10 22:13:24.561 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 22:13:24.581 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 22:13:24.587 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 22:13:24.669 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 22:13:24.672 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 22:13:25.106 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 22:13:26.556 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 22:13:26.610 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 22:13:26.612 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 22:13:26.632 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 22:13:26.633 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 22:13:26.633 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 22:13:26.633 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 22:13:26.633 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 22:13:26.634 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 22:13:26.634 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 22:13:26.664 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 22:13:26.804 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 22:13:26.804 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 22:13:27.258 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 22:13:27.287 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 22:13:27.289 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 22:13:27.292 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 22:13:27.293 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 22:13:27.294 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 22:13:27.321 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 22:13:27.475 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 22:13:27.479 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 22:13:27.479 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 22:13:27.480 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 22:13:27.652 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 22:13:27.659 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 22:13:27.661 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 22:13:27.661 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 22:13:27.661 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 22:13:27.667 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 22:13:27.667 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 22:13:27.692 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 22:13:27.693 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 22:13:27.693 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 22:13:27.693 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 22:13:27.693 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 22:13:27.693 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 22:13:27.693 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 22:13:27.706 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 22:13:27.715 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 22:13:27.726 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 22:13:27.726 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 22:13:27.743 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 22:13:27.743 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 22:13:27.747 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 22:13:27.747 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 22:13:27.750 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 22:13:27.751 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 22:13:27.821 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 22:13:28.705 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 22:13:28.849 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 22:13:28.852 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 22:13:28.879 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 22:13:28.880 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 22:13:29.004 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 22:13:29.216 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 22:13:29.511 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 22:13:29.655 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 22:13:30.507 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.247 seconds (process running for 9.562)
2025-10-10 22:13:30.512 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 22:13:30.514 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 22:13:30.607 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 22:13:42.902 [http-nio-8080-exec-1] INFO  c.r.L.service.FileStorageService - 文件已存在，跳过保存: F:\LegalAssistant\uploads\contracts\bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f_农村土地经营权出租合同.docx
2025-10-10 22:13:42.909 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 创建待处理审查记录，用户: admin, 文件: 农村土地经营权出租合同.docx
2025-10-10 22:13:42.969 [http-nio-8080-exec-1] INFO  c.r.L.service.ContractReviewService - 待处理审查记录已创建 - ID: 25, 文件: 农村土地经营权出租合同.docx
2025-10-10 22:13:42.979 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始异步处理合同文件，审查ID: 25
2025-10-10 22:13:42.979 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理线程: Async-1
2025-10-10 22:13:43.000 [Async-1] INFO  c.r.L.service.ContractReviewService - 开始解析文件: 农村土地经营权出租合同.docx, 路径: F:\LegalAssistant\uploads\contracts\bf28389098fa937be57de5fa649c01f7b136b425a044e3dfd55d13dd1412502f_农村土地经营权出租合同.docx
2025-10-10 22:13:43.001 [Async-1] INFO  c.r.L.service.DocumentParserService - 开始解析文档: 农村土地经营权出租合同.docx, 类型: docx, 大小: 30836 bytes
2025-10-10 22:13:43.007 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=3aeeb3d5, method=POST, uri=/api/v1/contracts/upload, status=202, duration=174ms
2025-10-10 22:13:43.037 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 开始异步合同分析，审查ID: 25
2025-10-10 22:13:43.039 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - 用户 admin 通过JWT验证，开始处理合同分析，reviewId: 25
2025-10-10 22:13:43.040 [http-nio-8080-exec-5] INFO  c.r.L.c.ContractReviewController - SSE连接已建立: reviewId=25
2025-10-10 22:13:43.043 [Async-2] INFO  c.r.L.service.ContractReviewService - 开始异步分析合同（四步流程版），审查ID: 25
2025-10-10 22:13:43.044 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=25
2025-10-10 22:13:43.046 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 22:13:43.053 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=bd3302cb, method=GET, uri=/api/v1/contracts/25/analyze-async, status=200, duration=19ms
2025-10-10 22:13:43.685 [Async-1] INFO  c.r.L.service.DocumentParserService - 文档解析成功: 农村土地经营权出租合同.docx, 内容长度: 3686 字符
2025-10-10 22:13:43.685 [Async-1] INFO  c.r.L.service.ContractReviewService - 文件解析成功: 农村土地经营权出租合同.docx, 内容长度: 3686
2025-10-10 22:13:43.686 [Async-1] INFO  c.r.L.service.ContractReviewService - 文档解析完成，文本内容已保存: reviewId=25, 文本长度: 3686
2025-10-10 22:13:43.686 [Async-1] INFO  c.r.L.service.EtlService - 开始处理文本内容，长度: 3686 字符
2025-10-10 22:13:43.689 [Async-1] INFO  c.r.L.service.EtlService - 文本分块完成，生成 403 个文本块
2025-10-10 22:13:44.069 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=25
2025-10-10 22:13:44.072 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 22:13:45.084 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=25
2025-10-10 22:13:45.085 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 22:13:46.090 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=25
2025-10-10 22:13:46.092 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 22:13:47.100 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=25
2025-10-10 22:13:47.103 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 22:13:48.114 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=25
2025-10-10 22:13:48.116 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 22:13:49.126 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=25
2025-10-10 22:13:49.128 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 22:13:50.138 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=25
2025-10-10 22:13:50.140 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 22:13:51.152 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=25
2025-10-10 22:13:51.154 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 0
2025-10-10 22:13:51.606 [Async-1] INFO  c.r.L.service.EtlService - 文本内容处理完成，403 个向量块已存储
2025-10-10 22:13:51.606 [Async-1] INFO  c.r.L.service.ContractReviewService - 已成功将合同内容添加到AI知识库，审查ID: 25, 块数: 403
2025-10-10 22:13:51.607 [Async-1] INFO  c.r.L.service.ContractReviewService - 合同文件处理完成，审查ID: 25
2025-10-10 22:13:51.607 [Async-1] INFO  c.r.L.service.ContractReviewService - 异步处理合同文件方法结束，审查ID: 25
2025-10-10 22:13:52.162 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新审查记录（新事务）: reviewId=25
2025-10-10 22:13:52.164 [Async-2] INFO  c.r.L.service.ContractReviewService - 刷新完成，文本内容长度: 3686
2025-10-10 22:13:52.164 [Async-2] INFO  c.r.L.service.ContractReviewService - 文件解析完成，等待时间: 9秒, reviewId=25
2025-10-10 22:13:52.166 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤1完成：文档解析成功, reviewId=25
2025-10-10 22:13:52.180 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 进行结构化合同风险分析，内容长度: 3686
2025-10-10 22:14:54.931 [Async-2] INFO  c.r.LegalAssistant.service.AiService - 结构化风险分析完成，识别出 10 个风险维度
2025-10-10 22:14:54.934 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤2完成：风险识别成功, reviewId=25
2025-10-10 22:14:54.935 [Async-2] INFO  c.r.L.service.AgentService - 开始分析合同关键条款，内容长度: 3686
2025-10-10 22:16:42.315 [Async-2] INFO  c.r.L.service.AgentService - JSON格式验证成功，包含 7 个关键条款
2025-10-10 22:16:42.315 [Async-2] INFO  c.r.L.service.AgentService - 关键条款分析完成，原始响应长度: 2460, 清理后长度: 2460
2025-10-10 22:16:42.315 [Async-2] INFO  c.r.L.service.ContractReviewService - 关键条款分析成功，识别出 7 个关键条款
2025-10-10 22:16:42.315 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤3完成：条款分析成功, reviewId=25
2025-10-10 22:16:42.343 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤4完成：分析结果保存成功, reviewId=25
2025-10-10 22:16:42.362 [Async-2] INFO  c.r.L.s.ReportGenerationService - 开始生成PDF报告，审查ID: 25
2025-10-10 22:16:42.362 [Async-2] INFO  c.r.L.s.ReportGenerationService - 初始化PDF中文字体支持...
2025-10-10 22:16:42.443 [Async-2] INFO  c.r.L.s.ReportGenerationService - ✓ 成功加载系统字体: C:/Windows/Fonts/STSONG.TTF (华文宋体优先，PDF兼容性最佳)
2025-10-10 22:16:42.481 [Async-2] INFO  c.r.L.s.ReportGenerationService - ✓ PDF文档字体设置成功
2025-10-10 22:16:42.481 [Async-2] INFO  c.r.L.s.ReportGenerationService - 准备生成增强内容...
2025-10-10 22:16:42.481 [Async-2] INFO  c.r.L.s.ReportGenerationService - 使用DeepSeek生成增强报告内容（带降级处理），审查ID: 25
2025-10-10 22:16:42.481 [Async-2] INFO  c.r.L.s.ReportGenerationService - 使用结构化方式生成增强报告内容，审查ID: 25
2025-10-10 22:16:46.907 [Async-2] INFO  c.r.L.s.ReportGenerationService - 开始使用结构化内容生成器生成报告，合同内容长度: 3686
2025-10-10 22:16:46.908 [ForkJoinPool.commonPool-worker-2] INFO  c.r.L.s.StructuredContentGenerator - 生成执行摘要结构化内容，审查ID: 25
2025-10-10 22:16:46.908 [ForkJoinPool.commonPool-worker-3] INFO  c.r.L.s.StructuredContentGenerator - 生成深度分析结构化内容，审查ID: 25
2025-10-10 22:16:46.908 [ForkJoinPool.commonPool-worker-4] INFO  c.r.L.s.StructuredContentGenerator - 生成改进建议结构化内容，审查ID: 25
2025-10-10 22:17:34.567 [Async-2] INFO  c.r.L.s.ReportGenerationService - 结构化内容生成成功
2025-10-10 22:17:34.567 [Async-2] INFO  c.r.L.s.ReportGenerationService - 结构化内容生成完成，耗时: 52086ms
2025-10-10 22:17:34.568 [Async-2] INFO  c.r.L.util.ReportContentValidator - 【报告完整性验证通过】所有必要内容齐全
2025-10-10 22:17:34.569 [Async-2] INFO  c.r.L.s.ReportGenerationService - ✓ 增强内容生成成功
2025-10-10 22:17:34.569 [Async-2] INFO  c.r.L.s.ReportGenerationService - 开始添加报告各部分内容...
2025-10-10 22:17:34.693 [Async-2] INFO  c.r.L.s.ReportGenerationService - 所有PDF内容添加完成
2025-10-10 22:17:34.767 [Async-2] INFO  c.r.L.s.ReportGenerationService - PDF报告生成成功，审查ID: 25, 文件大小: 341043 bytes
2025-10-10 22:17:34.772 [Async-2] INFO  c.r.L.service.ContractReviewService - PDF报告已保存到文件系统: F:\LegalAssistant\uploads\reports\25_report.pdf
2025-10-10 22:17:34.788 [Async-2] INFO  c.r.L.service.ContractReviewService - 步骤5完成：PDF报告生成并保存成功, reviewId=25, 文件大小: 341043 bytes
2025-10-10 22:17:34.802 [Async-2] INFO  c.r.L.service.ContractReviewService - 合同异步分析流程全部完成, reviewId=25
2025-10-10 22:17:34.811 [http-nio-8080-exec-3] INFO  c.r.L.service.ContractReviewService - SSE连接完成: reviewId=25
2025-10-10 22:25:08.928 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 22:25:08.932 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-10 23:10:45.473 [main] INFO  c.r.L.LegalAssistantApplication - Starting LegalAssistantApplication using Java 21.0.5 with PID 39344 (F:\LegalAssistant\target\classes started by river in F:\LegalAssistant)
2025-10-10 23:10:45.474 [main] INFO  c.r.L.LegalAssistantApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-10 23:10:48.120 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-10 23:10:48.285 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1256925b
2025-10-10 23:10:48.343 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-10 23:10:48.364 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/legal_assistant (PostgreSQL 17.6)
2025-10-10 23:10:48.370 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.6 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 16.
2025-10-10 23:10:48.458 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 11
2025-10-10 23:10:48.461 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-10-10 23:10:48.913 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-10 23:10:50.609 [main] INFO  c.g.x.k.s.c.Knife4jAutoConfiguration - init CorsFilter...
2025-10-10 23:10:50.667 [main] INFO  c.r.L.service.PromptTemplateService - 开始初始化提示词模板服务...
2025-10-10 23:10:50.668 [main] INFO  c.r.L.service.PromptTemplateService - 提示词模板服务初始化完成，共加载 7 个模板
2025-10-10 23:10:50.689 [main] INFO  c.r.L.config.OllamaConfig - === Ollama 配置初始化 ===
2025-10-10 23:10:50.689 [main] INFO  c.r.L.config.OllamaConfig - 使用本地 Ollama 服务，不依赖任何云端 AI 服务
2025-10-10 23:10:50.689 [main] INFO  c.r.L.config.OllamaConfig - 确保 Ollama 服务运行在 http://localhost:11434
2025-10-10 23:10:50.689 [main] INFO  c.r.L.config.OllamaConfig - 推荐模型:
2025-10-10 23:10:50.689 [main] INFO  c.r.L.config.OllamaConfig -   - 聊天模型: qwen2:1.5b, llama3.2:3b
2025-10-10 23:10:50.690 [main] INFO  c.r.L.config.OllamaConfig -   - 嵌入模型: nomic-embed-text
2025-10-10 23:10:50.690 [main] INFO  c.r.L.config.OllamaConfig - ========================
2025-10-10 23:10:50.716 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 嵌入模型: nomic-embed-text
2025-10-10 23:10:50.851 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j PGVector 嵌入存储（独立表）
2025-10-10 23:10:50.851 [main] INFO  c.r.L.config.LangChain4jConfig - 连接 PGVector 数据库: localhost:5432/legal_assistant, 表: langchain4j_embeddings, 维度: 768
2025-10-10 23:10:51.343 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化主要聊天客户端，优先使用DeepSeek模型
2025-10-10 23:10:51.370 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆存储库（内存存储）
2025-10-10 23:10:51.372 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建Ollama聊天记忆，最大消息数: 15
2025-10-10 23:10:51.377 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆存储库（内存存储）
2025-10-10 23:10:51.377 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建DeepSeek聊天记忆，最大消息数: 30
2025-10-10 23:10:51.378 [main] INFO  c.r.L.service.ChatMemoryService - 聊天记忆服务初始化完成
2025-10-10 23:10:51.409 [main] INFO  c.r.LegalAssistant.config.AiConfig - 设置 Ollama Embedding 模型为主要嵌入模型
2025-10-10 23:10:51.586 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Using the vector table name: vector_store. Is empty: false
2025-10-10 23:10:51.588 [main] INFO  o.s.a.v.pgvector.PgVectorStore - Initializing PGVectorStore schema for table: vector_store in schema: public
2025-10-10 23:10:51.589 [main] INFO  o.s.a.v.pgvector.PgVectorStore - vectorTableValidationsEnabled false
2025-10-10 23:10:51.589 [main] DEBUG o.s.a.v.pgvector.PgVectorStore - Skipping the schema initialization for the table: public.vector_store
2025-10-10 23:10:51.785 [main] INFO  c.r.L.config.AsyncConfig - 初始化支持SecurityContext的异步执行器
2025-10-10 23:10:51.792 [main] INFO  c.r.L.service.AgentService - 混合AI法律顾问代理服务启动
2025-10-10 23:10:51.794 [main] INFO  c.r.L.service.AgentService - 正在初始化混合AI法律顾问代理服务...
2025-10-10 23:10:51.794 [main] INFO  c.r.L.service.AgentService - 配置：混合模式=true, 基础提供者=ollama, 高级提供者=deepseek, 自动降级=true
2025-10-10 23:10:51.795 [main] INFO  c.r.L.service.AgentService - 初始化基础AI服务：ollama (qwen2:1.5b)
2025-10-10 23:10:51.802 [main] INFO  c.r.L.service.AgentService - 基础AI服务初始化成功：qwen2:1.5b
2025-10-10 23:10:51.802 [main] INFO  c.r.L.service.AgentService - 初始化高级AI服务：deepseek (deepseek-chat)
2025-10-10 23:10:51.828 [main] INFO  c.r.L.service.AgentService - 高级AI服务初始化成功：deepseek-chat
2025-10-10 23:10:51.828 [main] INFO  c.r.L.service.AgentService - === 混合AI法律顾问服务初始化完成 ===
2025-10-10 23:10:51.828 [main] INFO  c.r.L.service.AgentService - 基础服务状态：可用 (qwen2:1.5b)
2025-10-10 23:10:51.829 [main] INFO  c.r.L.service.AgentService - 高级服务状态：可用 (deepseek-chat)
2025-10-10 23:10:51.829 [main] INFO  c.r.L.service.AgentService - 自动降级：启用
2025-10-10 23:10:51.829 [main] INFO  c.r.L.service.AgentService - 混合AI架构完全就绪，智能路由已激活。
2025-10-10 23:10:51.829 [main] INFO  c.r.L.service.AgentService - ========================================
2025-10-10 23:10:51.843 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 聊天模型: qwen2:1.5b
2025-10-10 23:10:51.850 [main] INFO  c.r.L.config.LangChain4jConfig - 初始化 LangChain4j 流式聊天模型: qwen2:1.5b
2025-10-10 23:10:51.860 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 初始化法律查询路由器...
2025-10-10 23:10:51.861 [main] INFO  c.r.L.s.advanced.LegalQueryRouter - 法律查询路由器初始化完成，配置 6 个检索器
2025-10-10 23:10:51.869 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 开始初始化 Advanced Legal RAG 服务...
2025-10-10 23:10:51.869 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG 检索增强器...
2025-10-10 23:10:51.872 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 检索增强器构建完成
2025-10-10 23:10:51.872 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - 构建 Advanced RAG AI 服务...
2025-10-10 23:10:51.874 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced RAG AI 服务构建完成
2025-10-10 23:10:51.874 [main] INFO  c.r.L.s.a.AdvancedLegalRagService - Advanced Legal RAG 服务初始化成功
2025-10-10 23:10:51.922 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name userService
2025-10-10 23:10:52.369 [main] INFO  c.r.L.service.EtlService - ETL服务初始化完成 - chunk大小: 0, 重叠: 0, 最小块: 0
2025-10-10 23:10:52.505 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化基础聊天客户端，使用Ollama Chat模型
2025-10-10 23:10:52.507 [main] INFO  c.r.LegalAssistant.config.AiConfig - 初始化高级聊天客户端，使用DeepSeek Chat模型
2025-10-10 23:10:52.534 [main] INFO  c.r.L.config.ChatMemoryConfig - 创建默认聊天记忆，使用Ollama聊天记忆
2025-10-10 23:10:52.535 [main] INFO  c.r.L.config.OpenApiConfig - 初始化OpenAPI配置, contextPath: /api/v1, port: 8080
2025-10-10 23:10:52.656 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-10 23:10:52.888 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置现有JSON消息转换器，禁用非ASCII字符转义
2025-10-10 23:10:53.227 [main] INFO  c.r.LegalAssistant.config.SseConfig - SSE ObjectMapper配置完成，禁用非ASCII字符转义
2025-10-10 23:10:53.389 [main] INFO  c.r.LegalAssistant.config.WebConfig - 配置Web异步支持，设置超时为25分钟以支持长时间AI分析
2025-10-10 23:10:54.338 [main] INFO  c.r.L.LegalAssistantApplication - Started LegalAssistantApplication in 9.337 seconds (process running for 9.627)
2025-10-10 23:10:54.345 [main] INFO  c.r.L.config.StartupIndexer - 检查是否需要索引法律文档...
2025-10-10 23:10:54.347 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 发现 6 个法律文档，检查是否需要索引...
2025-10-10 23:10:54.449 [ForkJoinPool.commonPool-worker-1] INFO  c.r.L.config.StartupIndexer - 所有法律文档都已被索引，跳过自动索引
2025-10-10 23:10:57.274 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=d1d97cfd, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=80ms
2025-10-10 23:11:41.948 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=78493584, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=10ms
2025-10-10 23:11:59.734 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=b438c953, method=GET, uri=/api/v1/users, status=200, duration=24ms
2025-10-10 23:12:02.213 [http-nio-8080-exec-4] INFO  c.r.L.service.KnowledgeBaseService - 从数据库获取文档列表: 页码=0, 每页=20, 分类=null, 总数=9
2025-10-10 23:12:02.220 [http-nio-8080-exec-4] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=87728262, method=GET, uri=/api/v1/knowledge-base/documents, status=200, duration=33ms
2025-10-10 23:14:26.231 [http-nio-8080-exec-8] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=423a9346, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=9ms
2025-10-10 23:16:36.552 [http-nio-8080-exec-7] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=52be1016, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=8ms
2025-10-10 23:17:14.977 [http-nio-8080-exec-5] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=ed978524, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=6ms
2025-10-10 23:17:41.903 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求下载PDF报告，审查ID: 25
2025-10-10 23:17:41.932 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 从缓存读取PDF报告，审查ID: 25, 文件大小: 341043 bytes
2025-10-10 23:17:41.932 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 农村土地经营权出租合同分析报告.pdf
2025-10-10 23:17:41.933 [http-nio-8080-exec-10] INFO  c.r.L.c.ContractReviewController - PDF报告准备下载 [缓存]，审查ID: 25, 文件大小: 341043 bytes, 文件名: 农村土地经营权出租合同分析报告.pdf
2025-10-10 23:17:41.935 [http-nio-8080-exec-10] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=8879f9de, method=GET, uri=/api/v1/contracts/25/report, status=200, duration=33ms
2025-10-10 23:19:49.069 [http-nio-8080-exec-6] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7e02605d, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=7ms
2025-10-10 23:20:37.418 [http-nio-8080-exec-9] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=14901e56, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=7ms
2025-10-10 23:21:15.003 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求下载PDF报告，审查ID: 25
2025-10-10 23:21:15.009 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 从缓存读取PDF报告，审查ID: 25, 文件大小: 341043 bytes
2025-10-10 23:21:15.009 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 农村土地经营权出租合同分析报告.pdf
2025-10-10 23:21:15.009 [http-nio-8080-exec-1] INFO  c.r.L.c.ContractReviewController - PDF报告准备下载 [缓存]，审查ID: 25, 文件大小: 341043 bytes, 文件名: 农村土地经营权出租合同分析报告.pdf
2025-10-10 23:21:15.011 [http-nio-8080-exec-1] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=98ef874d, method=GET, uri=/api/v1/contracts/25/report, status=200, duration=9ms
2025-10-10 23:22:37.155 [http-nio-8080-exec-3] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=77b35e81, method=GET, uri=/api/v1/contracts/my-reviews, status=200, duration=6ms
2025-10-10 23:23:08.084 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 用户 admin 请求下载PDF报告，审查ID: 25
2025-10-10 23:23:08.090 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 从缓存读取PDF报告，审查ID: 25, 文件大小: 341043 bytes
2025-10-10 23:23:08.090 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - 生成最终报告文件名: 农村土地经营权出租合同分析报告.pdf
2025-10-10 23:23:08.090 [http-nio-8080-exec-2] INFO  c.r.L.c.ContractReviewController - PDF报告准备下载 [缓存]，审查ID: 25, 文件大小: 341043 bytes, 文件名: 农村土地经营权出租合同分析报告.pdf
2025-10-10 23:23:08.092 [http-nio-8080-exec-2] INFO  c.r.L.filter.RequestTrackingFilter - [REQUEST_END] traceId=7946d182, method=GET, uri=/api/v1/contracts/25/report, status=200, duration=9ms
2025-10-10 23:27:22.341 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-10 23:27:22.344 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
